<!-- Screen Location component://SimpleScreens/screen/SimpleScreens/Order/QuickItems.xml --><screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd" default-menu-title="Quick Items" default-menu-index="3"><parameter name="orderId" from="orderId ?: orderId_0" required="true"/><parameter name="orderPartSeqId" from="orderPartSeqId ?: orderPartSeqId_0"/><parameter name="productCategoryId" from="productCategoryId ?: productCategoryId_0"/><transition name="editProduct"><default-response url="//${appRoot}/Product/EditProduct"/></transition><transition name="setItemQuantities"><service-call name="mantle.order.OrderServices.add#OrderProductQuantity" multi="true" in-map="context + [addToQuantity:false, requireInventory:false, quantity:0, customerPartyId:null]" out-map="context"/><actions><log message="Order ${orderId} setItemQuantities parameters: ${ec.web.requestParameters}"/></actions><default-response url="."/></transition><actions><entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderHeader"/><if condition="orderPartSeqId"><entity-find-one entity-name="mantle.order.OrderPart" value-field="orderPart"/><set field="productStoreId" from="orderHeader.productStoreId"/><if condition="!productCategoryId && productStoreId"><entity-find entity-name="mantle.product.store.ProductStoreCategory" list="psCatList" cache="true"><date-filter/><econdition field-name="productStoreId"/><econdition field-name="storeCategoryTypeEnumId" value="PsctQuickInternal"/></entity-find><if condition="!psCatList"><entity-find entity-name="mantle.product.store.ProductStoreCategory" list="psCatList" cache="true"><date-filter/><econdition field-name="productStoreId"/><econdition field-name="storeCategoryTypeEnumId" value="PsctQuickAdd"/></entity-find></if><if condition="!psCatList"><entity-find entity-name="mantle.product.store.ProductStoreCategory" list="psCatList" cache="true"><date-filter/><econdition field-name="productStoreId"/><econdition field-name="storeCategoryTypeEnumId" value="PsctSearch"/></entity-find></if><set field="productCategoryId" from="psCatList ? psCatList[0].productCategoryId : null"/></if><set field="productInfoList" from="[]"/><if condition="productCategoryId"><entity-find entity-name="ProductCategoryMemberProduct" list="productList" cache="true"><date-filter/><econdition field-name="productCategoryId"/><econdition field-name="productTypeEnumId" operator="not-equals" value="PtVirtual"/></entity-find></if><entity-find entity-name="moqui.basic.EnumGroupMember" list="productItemTypeEgms" cache="true"><econdition field-name="enumGroupEnumId" value="EngItemsProduct"/></entity-find><set field="productItemTypes" from="productItemTypeEgms*.enumId"/><entity-find entity-name="mantle.order.OrderItem" list="orderItemList" cache="false"><econdition field-name="orderId"/><econdition field-name="orderPartSeqId"/><econdition field-name="productId" operator="is-not-null"/><econdition field-name="itemTypeEnumId" operator="in" from="productItemTypes"/></entity-find><iterate list="productList" entry="product"><set field="prodItemList" from="orderItemList.findAll({ it.productId == product.productId })"/><if condition="prodItemList"><then><iterate list="prodItemList" entry="prodItem"><script><![CDATA[productInfoList.add(product.getMap() + prodItem.getMap())]]></script></iterate><script><![CDATA[orderItemList.removeByAnd([productId:product.productId])]]></script></then><else><script><![CDATA[productInfoList.add(product.getMap())]]></script></else></if></iterate><iterate list="orderItemList" entry="orderItem"><entity-find-one entity-name="mantle.product.Product" value-field="product" cache="true"><field-map field-name="productId" from="orderItem.productId"/></entity-find-one><script><![CDATA[productInfoList.add(product.getMap() + orderItem.getMap())]]></script></iterate><set field="orderByField" from="orderByField ?: 'pseudoId,orderItemSeqId'"/><script><![CDATA[orderMapList(productInfoList, (orderByField.split(',').collect({it?.trim()}) as List))]]></script></if></actions><widgets><form-single name="QuickItemOptions" transition="."><field name="orderId"><default-field><hidden/></default-field></field><field name="orderByField"><default-field><hidden/></default-field></field><field name="orderPartSeqId"><default-field title="Order Part"><drop-down><entity-options key="${orderPartSeqId}" text="${orderPartSeqId} ${ec.l10n.formatCurrency(partTotal, orderHeader.currencyUomId)}"><entity-find entity-name="mantle.order.OrderPart"><econdition field-name="orderId"/><select-field field-name="orderPartSeqId,partTotal"/><order-by field-name="orderPartSeqId"/></entity-find></entity-options></drop-down></default-field></field><field name="productCategoryId"><default-field title="Category"><drop-down allow-empty="true"><entity-options key="${productCategoryId}" text="${categoryName}"><entity-find entity-name="mantle.product.category.ProductCategory"><econdition field-name="productCategoryTypeEnumId" operator="in" value="PctQuickAdd,PctSearch,PctCatalog"/><order-by field-name="categoryName"/></entity-find></entity-options></drop-down></default-field></field><field name="submitButton"><default-field title="Select"><submit/></default-field></field><field-layout><field-row-big><field-ref name="orderPartSeqId"/><field-ref name="productCategoryId"/><field-ref name="submitButton"/></field-row-big></field-layout></form-single><section name="QuickItemSection" condition="productInfoList"><widgets><form-list name="QuickItemList" list="productInfoList" multi="true" transition="setItemQuantities"><row-actions><service-call name="mantle.product.PriceServices.get#ProductPrice" out-map="priceOut" in-map="[productId:productId, priceUomId:orderHeader.currencyUomId,                                 productStoreId:productStoreId, customerPartyId:orderPart.customerPartyId]"/></row-actions><hidden-parameters><parameter name="orderId"/><parameter name="orderPartSeqId"/><parameter name="productCategoryId"/></hidden-parameters><field name="productId"><default-field><hidden/></default-field></field><field name="pseudoId"><header-field show-order-by="true"/><default-field><link url="editProduct" text="${pseudoId}" link-type="anchor"/></default-field></field><field name="productName"><header-field show-order-by="true"/><default-field><link url="editProduct" text="${productName}" link-type="anchor"/></default-field></field><field name="orderItemSeqId"><header-field title="Item" show-order-by="true"/><default-field><display/></default-field></field><field name="listPrice" from="priceOut.listPrice" align="right"><default-field><display currency-unit-field="orderHeader.currencyUomId" also-hidden="false"/></default-field></field><field name="calcPrice" from="priceOut.price" align="right"><default-field><display currency-unit-field="orderHeader.currencyUomId" also-hidden="false"/></default-field></field><field name="unitAmount" align="right"><conditional-field title="Price" condition="productId"><text-line size="8" format="#,##0.00"/></conditional-field><default-field title="Price"><display/></default-field></field><field name="quantity" align="right"><conditional-field condition="productId"><text-line size="4"/></conditional-field><default-field><display/></default-field></field><field name="itemQuantity" from="quantity" align="right"><default-field title="Cur Qty"><display also-hidden="false"/></default-field></field><field name="itemTotal" from="(quantity?:0.0)*(unitAmount?:0.0)" align="right"><default-field title="Cur Total"><display currency-unit-field="orderHeader.currencyUomId" also-hidden="false"/></default-field></field><field name="submitButton"><default-field title="Set Quantities"><submit/></default-field></field></form-list></widgets></section></widgets></screen>