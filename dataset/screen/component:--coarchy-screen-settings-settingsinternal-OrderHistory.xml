<!-- Screen Location component://coarchy/screen/settings/settingsinternal/OrderHistory.xml --><screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd" default-menu-title="Order History" default-menu-index="60" menu-image="fa fa-history" menu-image-type="icon"><actions><entity-find entity-name="mantle.order.OrderHeaderAndPart" list="existingOrder1List" limit="1"><econdition field-name="customerPartyId" from="ec.user.userAccount.partyId"/><select-field field-name="orderId,placedDate,completedDate,entryDate,statusId"/><order-by field-name="-entryDate"/></entity-find><set field="firstOrder" from="existingOrder1List.getFirst()"/><set field="shouldReload" from="firstOrder?.statusId == 'OrderOpen'&&Duration.between(firstOrder?.entryDate.toInstant(),ec.user.nowTimestamp.toInstant()).toMillis()<5000"/></actions><widgets><container-row><row-col md="2"/><row-col md="8"><label text="Orders" type="h4"/><link url="../BuyPremium" text="Buy Again" btn-type="success"/><form-list name="OrderItemPartForm" list="existingOrderList" header-dialog="true" show-csv-button="false"><entity-find entity-name="mantle.order.OrderHeaderAndPart" list="existingOrderList"><search-form-inputs/><econdition field-name="customerPartyId" from="ec.user.userAccount.partyId"/><select-field field-name="orderId,placedDate,entryDate,orderPartSeqId,currencyUomId,grandTotal"/><order-by field-name="-entryDate"/></entity-find><row-actions><entity-find entity-name="mantle.order.OrderItem" list="orderItemList" limit="1"><econdition field-name="orderId"/><econdition field-name="orderPartSeqId"/><order-by field-name="orderItemSeqId"/></entity-find><set field="orderItem" from="orderItemList.getFirst()"/><entity-find-one entity-name="moqui.basic.StatusItem" value-field="status" auto-field-map="[statusId:statusId]" cache="true"/><entity-find-count entity-name="mantle.account.financial.FinancialAccountAndTrans" count-field="finAccountAndTransCount"><econdition field-name="orderId"/><econdition field-name="ownerPartyId" from="ec.user.userAccount.partyId"/><econdition field-name="finAccountTypeId" value="OrganizationMonthCredit"/><econdition field-name="organizationPartyId" value="coarchy"/><econdition field-name="statusId" value="FaActive"/></entity-find-count></row-actions><field name="orderId"><header-field><text-find/></header-field><default-field><display/></default-field></field><field name="placedDate"><header-field><date-find type="date-time"/></header-field><default-field title="Date"><label text="${ec.l10n.format(placedDate ?: entryDate, 'dd MMM yyyy hh:mm a')}"/></default-field></field><field name="statusId"><default-field title="Status"><label text="${shouldReload&&                         existingOrderList_index==0?'Payment Processing...':status.description}"/></default-field></field><field name="quantity"><default-field title="Quantity"><label text="${ec.l10n.formatNumber((Number)orderItem.quantity,null,null)} ${orderItem.itemDescription}"/></default-field></field><field name="total"><default-field title="Total"><label text="${ec.l10n.formatCurrency(grandTotal,currencyUomId,2)}"/></default-field></field><field name="transaction"><conditional-field condition="finAccountAndTransCount"><link url="../TransactionHistory?orderId=${orderId}" text="Transaction"/></conditional-field></field><field name="submit"><header-field><submit text="Find"/></header-field></field></form-list></row-col><row-col md="2"/></container-row></widgets></screen>