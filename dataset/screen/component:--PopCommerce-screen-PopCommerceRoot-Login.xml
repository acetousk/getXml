<!-- Screen Location component://PopCommerce/screen/PopCommerceRoot/Login.xml --><screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd" default-menu-include="false" require-authentication="anonymous-all" history="false"><transition name="login" require-session-token="false"><actions><script><![CDATA[ec.user.loginUser(username, password)]]></script><if condition="ec.user.userAccount"><entity-find entity-name="mantle.order.OrderHeaderAndPart" list="existingOrderList"><econdition field-name="statusId" value="OrderOpen"/><econdition field-name="customerPartyId" from="ec.user.userAccount.partyId"/><select-field field-name="orderId"/><select-field field-name="orderPartSeqId"/><order-by field-name="-entryDate"/></entity-find><if condition="existingOrderList"><if condition="ec.web.sessionAttributes.cartOrderId"><service-call name="mantle.order.OrderServices.merge#OrderItems" in-map="[orderId:existingOrderList[0].orderId, fromOrderId:ec.web.sessionAttributes.cartOrderId]"/></if><set field="ec.web.sessionAttributes.cartOrderId" from="existingOrderList[0].orderId"/><else><if condition="ec.web.sessionAttributes.cartOrderId"><entity-find entity-name="OrderPart" list="orderPartList"><econdition field-name="orderId" from="ec.web.sessionAttributes.cartOrderId"/></entity-find><if condition="orderPartList"><set field="orderPart" from="orderPartList[0]"/><set field="orderPart.customerPartyId" from="ec.user.userAccount.partyId"/><entity-update value-field="orderPart"/></if></if></else></if></if></actions><default-response type="screen-last"/><error-response url="."/></transition><transition name="logout"><actions><script><![CDATA[ec.user.logoutUser()]]></script></actions><default-response url="/popc"/><error-response url="."/></transition><transition name="resetPassword" require-session-token="false"><service-call name="org.moqui.impl.UserServices.reset#Password" in-map="[username:username]" out-map="context" multi="parameter"/><default-response url="."/></transition><transition name="changePassword" require-session-token="false"><service-call name="org.moqui.impl.UserServices.update#Password" in-map="true" out-map="context" multi="parameter"/><default-response url="../Login"/><error-response url="."/></transition><transition name="createAccount" require-session-token="false"><service-call name="mantle.party.PartyServices.create#Account" in-map="context + [roleTypeId:'Customer']" out-map="context" multi="parameter"/><default-response type="screen-last"/><error-response url="."/></transition><widgets><container style="login"><container style="container"><render-mode><text type="html" template="true" location="component://PopCommerce/screen/PopCommerceRoot/Login.ftl"/></render-mode></container></container><link url="login" text="Test Login (Joe Q Public)"><parameter name="username" value="joe@public.com"/><parameter name="password" value="moqui"/></link></widgets></screen>