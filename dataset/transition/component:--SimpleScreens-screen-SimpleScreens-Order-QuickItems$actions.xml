<!--Transition Screen Location component://SimpleScreens/screen/SimpleScreens/Order/QuickItems.xml Transition Name actions--><transition name="actions"><parameter name="orderId" from="orderId ?: orderId_0" required="true"/><parameter name="orderPartSeqId" from="orderPartSeqId ?: orderPartSeqId_0"/><parameter name="productCategoryId" from="productCategoryId ?: productCategoryId_0"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://PopCommerce/screen/PopCommerceAdmin.xml--><set field="appRoot" value="PopcAdmin"/><set field="searchIndexName" value="mantle"/><set field="searchLinkSets" value="PopcAdmin"/><set field="searchProductDocType" value="MantleProduct"/><set field="searchPartyDocType" value="MantleParty"/><set field="appUserGroupTypeEnumId" value="UgtPopcAdmin"/><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--actions--><entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderHeader"/><if condition="orderPartSeqId"><entity-find-one entity-name="mantle.order.OrderPart" value-field="orderPart"/><set field="productStoreId" from="orderHeader.productStoreId"/><if condition="!productCategoryId && productStoreId"><entity-find entity-name="mantle.product.store.ProductStoreCategory" list="psCatList" cache="true"><date-filter/><econdition field-name="productStoreId"/><econdition field-name="storeCategoryTypeEnumId" value="PsctQuickInternal"/></entity-find><if condition="!psCatList"><entity-find entity-name="mantle.product.store.ProductStoreCategory" list="psCatList" cache="true"><date-filter/><econdition field-name="productStoreId"/><econdition field-name="storeCategoryTypeEnumId" value="PsctQuickAdd"/></entity-find></if><if condition="!psCatList"><entity-find entity-name="mantle.product.store.ProductStoreCategory" list="psCatList" cache="true"><date-filter/><econdition field-name="productStoreId"/><econdition field-name="storeCategoryTypeEnumId" value="PsctSearch"/></entity-find></if><set field="productCategoryId" from="psCatList ? psCatList[0].productCategoryId : null"/></if><set field="productInfoList" from="[]"/><if condition="productCategoryId"><entity-find entity-name="ProductCategoryMemberProduct" list="productList" cache="true"><date-filter/><econdition field-name="productCategoryId"/><econdition field-name="productTypeEnumId" operator="not-equals" value="PtVirtual"/></entity-find></if><entity-find entity-name="moqui.basic.EnumGroupMember" list="productItemTypeEgms" cache="true"><econdition field-name="enumGroupEnumId" value="EngItemsProduct"/></entity-find><set field="productItemTypes" from="productItemTypeEgms*.enumId"/><entity-find entity-name="mantle.order.OrderItem" list="orderItemList" cache="false"><econdition field-name="orderId"/><econdition field-name="orderPartSeqId"/><econdition field-name="productId" operator="is-not-null"/><econdition field-name="itemTypeEnumId" operator="in" from="productItemTypes"/></entity-find><iterate list="productList" entry="product"><set field="prodItemList" from="orderItemList.findAll({ it.productId == product.productId })"/><if condition="prodItemList"><then><iterate list="prodItemList" entry="prodItem"><script><![CDATA[productInfoList.add(product.getMap() + prodItem.getMap())]]></script></iterate><script><![CDATA[orderItemList.removeByAnd([productId:product.productId])]]></script></then><else><script><![CDATA[productInfoList.add(product.getMap())]]></script></else></if></iterate><iterate list="orderItemList" entry="orderItem"><entity-find-one entity-name="mantle.product.Product" value-field="product" cache="true"><field-map field-name="productId" from="orderItem.productId"/></entity-find-one><script><![CDATA[productInfoList.add(product.getMap() + orderItem.getMap())]]></script></iterate><set field="orderByField" from="orderByField ?: 'pseudoId,orderItemSeqId'"/><script><![CDATA[orderMapList(productInfoList, (orderByField.split(',').collect({it?.trim()}) as List))]]></script></if></actions></transition>