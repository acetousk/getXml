<!--Transition Screen Location component://webroot/screen/webroot/rest.xml Transition Name login--><transition name="login"><parameter name="factorId" required="true"/><parameter name="code" required="true"/><parameter name="username" required="true"/><parameter name="password" required="true"/><parameter name="code"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--transition actions--><set field="loggedIn" from="ec.user.loginUser(username, password)"/><if condition="ec.message.hasError()"><script><![CDATA[ec.web.sendJsonResponse([loggedIn:false])]]></script></if><if condition="ec.web.sessionAttributes.moquiAuthcFactorRequired"><then><if condition="code"><then><service-call name="org.moqui.impl.UserServices.validate#ExternalUserAuthcCode" in-map="[code:code]" out-map="validateOut"/><if condition="validateOut.verified"><then><script><![CDATA[ec.user.internalLoginUser(validateOut.username)]]></script><return/></then><else><message type="danger" public="true"><![CDATA[Authentication code is not valid]]></message></else></if></then></if><service-call name="org.moqui.impl.UserServices.get#ExternalUserAuthcFactorInfo" out-map="factorInfoOut"/><script><![CDATA[ec.web.sendJsonResponse(factorInfoOut)]]></script></then><else><script><![CDATA[ec.web.sendJsonResponse([loggedIn:loggedIn])]]></script></else></if></actions></transition>