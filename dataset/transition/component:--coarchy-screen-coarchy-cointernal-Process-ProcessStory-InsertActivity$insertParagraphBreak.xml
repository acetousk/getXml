<!--Transition Screen Location component://coarchy/screen/coarchy/cointernal/Process/ProcessStory/InsertActivity.xml Transition Name insertParagraphBreak--><transition name="insertParagraphBreak"><parameter name="pageIndex"/><parameter name="pageSize"/><parameter name="orderByField"/><parameter name="isEmptyStory"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://coarchy/screen/coarchy/cointernal.xml--><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--always-actions at component://coarchy/screen/coarchy/cointernal/Process/ProcessStory.xml--><if condition="!activeOrgId"><message><![CDATA[${ec.resource.expand('CoarchySelectAnOrg', null)}]]></message><script><![CDATA[sri.sendRedirectAndStopRender('/settings/Organizations')]]></script></if><entity-find-count entity-name="mantle.party.PartyRelationship" count-field="partyRelationshipCount"><date-filter/><econdition field-name="relationshipTypeEnumId" value="PrtMember"/><econdition field-name="toRoleTypeId" value="OrgInternal"/><econdition field-name="fromPartyId" from="ec.user.userAccount.partyId"/><econdition field-name="toPartyId" from="activeOrgId"/></entity-find-count><entity-find-count entity-name="mantle.party.PartyActivation" count-field="partyActivationCount"><date-filter/><econdition field-name="partyId" from="activeOrgId"/></entity-find-count><!--transition actions--><set field="insertSequenceNum" from="sequenceNum"/><if condition="insertType=='below'"><set field="pageIndex" from="downPageIndex"/><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="processStoryActivityMaxList" limit="1"><date-filter/><econdition field-name="replacedByActivityId" operator="is-null"/><econdition field-name="sequenceNum" operator="greater" from="sequenceNum.toInteger()"/><select-field field-name="processStoryActivityId,sequenceNum"/><order-by field-name="sequenceNum"/></entity-find><set field="insertSequenceNum" from="processStoryActivityMaxList?.getFirst()?.sequenceNum?:insertSequenceNum.toInteger()+1"/></if><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="processStoryActivityList"><date-filter/><econdition field-name="replacedByActivityId" operator="is-null"/><econdition field-name="sequenceNum" operator="greater-equals" from="insertSequenceNum.toInteger()"/><select-field field-name="processStoryActivityId,sequenceNum"/><order-by field-name="-sequenceNum"/></entity-find><iterate list="processStoryActivityList" entry="processStoryActivity"><service-call name="update#coarchy.ProcessStoryActivity" in-map="[processStoryActivityId:processStoryActivity.processStoryActivityId,sequenceNum:processStoryActivity.sequenceNum+1]"/></iterate><service-call name="create#coarchy.Activity" in-map="[organizationId:activeOrgId]" out-map="newActivity"/><service-call name="create#coarchy.ProcessStoryActivity" in-map="[processStoryId:processStoryId,activityId:newActivity.activityId, sequenceNum:insertSequenceNum, fromDate:ec.user.nowTimestamp, organizationId:activeOrgId]"/></actions></transition>