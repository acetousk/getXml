<!--Transition Screen Location component://coarchy/screen/settings/settingsinternal/Checkout.xml Transition Name actions--><transition name="actions"><parameter name="orderId" required="true"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://coarchy/screen/settings/settingsinternal/Checkout.xml--><entity-find entity-name="mantle.order.OrderHeaderAndPart" list="existingOrderList" limit="1"><econdition field-name="orderId"/><econdition field-name="statusId" value="OrderOpen"/><econdition field-name="customerPartyId" from="ec.user.userAccount.partyId"/><select-field field-name="orderId,orderPartSeqId,grandTotal,currencyUomId,productStoreId"/><order-by field-name="-entryDate"/></entity-find><if condition="existingOrderList.size() == 0"><message type="danger" public="true" error="true"><![CDATA[${ec.resource.expand('CoarchyInvalidOrder',null)}]]></message><script><![CDATA[sri.sendRedirectAndStopRender('/settings/BuyPremium')]]></script><return/></if><set field="headerAndPart" from="existingOrderList.getFirst()"/><!--actions--><set field="orderPartSeqId" from="existingOrderList[0].orderPartSeqId"/><entity-find entity-name="mantle.order.OrderItem" list="orderItemList" limit="1"><econdition field-name="orderId"/><econdition field-name="orderPartSeqId"/><econdition field-name="productId" value="c100000"/><econdition field-name="itemTypeEnumId" value="ItemProduct"/><econdition field-name="fromAssetId" operator="is-null"/><econdition field-name="selectedAmount" operator="is-null"/><select-field field-name="orderItemSeqId,unitAmount,itemDescription,quantity"/><order-by field-name="orderItemSeqId"/></entity-find><set field="orderItem" from="orderItemList.getFirst()"/><if condition="orderItemList.size() < 1"><log level="warn" message="No order items found for user."/><message type="danger" public="true" error="true"><![CDATA[${ec.resource.expand('CoarchyInvalidOrder',null)}]]></message><script><![CDATA[sri.sendRedirectAndStopRender('/settings/BuyPremium')]]></script></if><entity-find entity-name="mantle.product.store.ProductStorePaymentGateway" list="productStorePaymentGatewayList" limit="1"><econdition field-name="productStoreId" from="existingOrderList.getFirst().productStoreId"/><econdition field-name="paymentInstrumentEnumId" value="PiStripe"/><econdition field-name="paymentGatewayConfigId" operator="is-not-null"/><select-field field-name="paymentGatewayConfigId"/><order-by field-name="-lastUpdatedStamp"/></entity-find><entity-find-one entity-name="mantle.account.method.PaymentGatewayConfig" value-field="paymentGateway" auto-field-map="[paymentGatewayConfigId:productStorePaymentGatewayList.getFirst().paymentGatewayConfigId]"/><set field="stripeRemote" from="paymentGateway.remote"/><set field="public_key" from="stripeRemote.publicKey"/><set field="return_url" from="sri.buildUrl('/settings/ThankYou').url+'?orderId='+orderId"/></actions></transition>