<!--Transition Screen Location component://PopCommerce/screen/PopCommerceRoot/Login.xml Transition Name login--><transition name="login"><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://PopCommerce/screen/PopCommerceRoot.xml--><set field="productStoreId" value="POPC_DEFAULT"/><entity-find-one entity-name="mantle.product.store.ProductStore" value-field="productStore"/><set field="currencyUomId" from="productStore?.defaultCurrencyUomId"/><set field="priceUomId" from="productStore?.defaultCurrencyUomId"/><set field="defaultLocale" from="productStore?.defaultLocale"/><set field="organizationPartyId" from="productStore?.organizationPartyId"/><set field="vendorPartyId" from="productStore?.organizationPartyId"/><set field="wikiSpaceId" from="productStore?.wikiSpaceId"/><set field="cartOrderId" from="ec.web.sessionAttributes.cartOrderId" set-if-empty="false"/><set field="customerPartyId" from="ec.user.userAccount?.partyId"/><set field="defaultOrderParameters" from="[orderId:cartOrderId, customerPartyId:customerPartyId, currencyUomId:currencyUomId,                 productStoreId:productStoreId, salesChannelEnumId:'ScWeb']"/><!--transition actions--><script><![CDATA[ec.user.loginUser(username, password)]]></script><if condition="ec.user.userAccount"><entity-find entity-name="mantle.order.OrderHeaderAndPart" list="existingOrderList"><econdition field-name="statusId" value="OrderOpen"/><econdition field-name="customerPartyId" from="ec.user.userAccount.partyId"/><select-field field-name="orderId"/><select-field field-name="orderPartSeqId"/><order-by field-name="-entryDate"/></entity-find><if condition="existingOrderList"><if condition="ec.web.sessionAttributes.cartOrderId"><service-call name="mantle.order.OrderServices.merge#OrderItems" in-map="[orderId:existingOrderList[0].orderId, fromOrderId:ec.web.sessionAttributes.cartOrderId]"/></if><set field="ec.web.sessionAttributes.cartOrderId" from="existingOrderList[0].orderId"/><else><if condition="ec.web.sessionAttributes.cartOrderId"><entity-find entity-name="OrderPart" list="orderPartList"><econdition field-name="orderId" from="ec.web.sessionAttributes.cartOrderId"/></entity-find><if condition="orderPartList"><set field="orderPart" from="orderPartList[0]"/><set field="orderPart.customerPartyId" from="ec.user.userAccount.partyId"/><entity-update value-field="orderPart"/></if></if></else></if></if></actions></transition>