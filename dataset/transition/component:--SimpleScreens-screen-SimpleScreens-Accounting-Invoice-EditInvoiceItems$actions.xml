<!--Transition Screen Location component://SimpleScreens/screen/SimpleScreens/Accounting/Invoice/EditInvoiceItems.xml Transition Name actions--><transition name="actions"><parameter name="invoiceId" required="true"/><parameter name="organizationPartyId"/><parameter name="invoiceId"/><parameter name="onlyPostingAllowed"/><parameter name="pageIndex"/><parameter name="pageSize"/><parameter name="term"/><parameter name="term"/><parameter name="productId"/><parameter name="facilityId"/><parameter name="ownerPartyId"/><parameter name="assetTypeEnumId"/><parameter name="classEnumId"/><parameter name="assetOrderBy"/><parameter name="excludeZeroQoh"/><parameter name="term"/><parameter name="productFeatureIds"/><parameter name="productTypeEnumId"/><parameter name="productClassEnumId"/><parameter name="productCategoryIds"/><parameter name="assetTypeEnumId"/><parameter name="assetClassEnumId"/><parameter name="indexName"/><parameter name="documentType"/><parameter name="pageIndex"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://PopCommerce/screen/PopCommerceAdmin.xml--><set field="appRoot" value="PopcAdmin"/><set field="searchIndexName" value="mantle"/><set field="searchLinkSets" value="PopcAdmin"/><set field="searchProductDocType" value="MantleProduct"/><set field="searchPartyDocType" value="MantleParty"/><set field="appUserGroupTypeEnumId" value="UgtPopcAdmin"/><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--actions--><service-call name="mantle.account.InvoiceServices.get#InvoiceBasicInfo" out-map="context" in-map="[invoiceId:invoiceId, activeOrgId:activeOrgId]"/><entity-find entity-name="mantle.account.invoice.InvoiceItem" list="invoiceItemList"><search-form-inputs/><econdition field-name="invoiceId"/><order-by field-name="invoiceItemSeqId"/></entity-find><set field="topItemList" from="invoiceItemList.findAll({ it.parentItemSeqId == null })"/><script><![CDATA[itemWithChildrenSet = new HashSet()
            List reverseList = invoiceItemList.cloneList().orderByFields(["-invoiceItemSeqId"])
            for (invoiceItem in reverseList) {
                if (invoiceItem.parentItemSeqId) {
                    itemWithChildrenSet.add(invoiceItem.parentItemSeqId)
                    invoiceItemList.move(invoiceItemList.indexMatching([invoiceItemSeqId:invoiceItem.invoiceItemSeqId]),
                            invoiceItemList.indexMatching([invoiceItemSeqId:invoiceItem.parentItemSeqId])+1)
                }
            }]]></script><if condition="invoice.invoiceTypeEnumId == 'InvoiceSales' || invoice.invoiceTypeEnumId == 'InvoiceReturn'"><then><entity-find entity-name="moqui.basic.EnumAndGroup" list="itemTypeEnumList"><econdition field-name="enumGroupEnumId" from="isPayableInvoice ? 'EngItemsPurchase' : 'EngItemsSales'"/><order-by field-name="description"/></entity-find></then><else-if condition="invoice.invoiceTypeEnumId == 'InvoicePayroll'"><entity-find entity-name="moqui.basic.EnumAndParent" list="itemTypeEnumList"><econdition field-name="parentEnumId" operator="in" value="ItemPayrollIncome,ItemPayrollDeduct,ItemPayrollTaxes,ItemPayrollExpense"/><order-by field-name="description"/></entity-find></else-if><else><entity-find entity-name="moqui.basic.Enumeration" list="itemTypeEnumList"><econdition field-name="enumTypeId" value="ItemType"/><order-by field-name="description"/></entity-find></else></if><set field="glAccountCodeMask" from="ec.user.getPreference('GlAccountCodeMask')"/><set field="accountCodeFormatter" from="masker(glAccountCodeMask, '0')"/></actions></transition>