<!--Transition Screen Location component://coarchy/screen/coarchy/cointernal/Process/EditProcessStoryV3.xml Transition Name moveActivityTo--><transition name="moveActivityTo"><parameter name="processStoryId"/><parameter name="pageIndex" from="pageIndex?:0"/><parameter name="pageSize" from="pageSize?:50"/><parameter name="processStoryActivityId"/><parameter name="newSequenceNum"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://coarchy/screen/coarchy/cointernal.xml--><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--always-actions at component://coarchy/screen/coarchy/cointernal/Process/EditProcessStoryV3.xml--><if condition="!activeOrgId"><message><![CDATA[${ec.resource.expand('CoarchySelectAnOrg', null)}]]></message><script><![CDATA[sri.sendRedirectAndStopRender('/settings/Organizations')]]></script></if><entity-find-count entity-name="mantle.party.PartyRelationship" count-field="partyRelationshipCount"><date-filter/><econdition field-name="relationshipTypeEnumId" value="PrtMember"/><econdition field-name="toRoleTypeId" value="OrgInternal"/><econdition field-name="fromPartyId" from="ec.user.userAccount.partyId"/><econdition field-name="toPartyId" from="activeOrgId"/></entity-find-count><entity-find-count entity-name="mantle.party.PartyActivation" count-field="partyActivationCount"><date-filter/><econdition field-name="partyId" from="activeOrgId"/></entity-find-count><!--transition actions--><entity-find-one entity-name="coarchy.ProcessStoryActivity" value-field="processStoryActivity"><field-map field-name="processStoryActivityId"/></entity-find-one><set field="processStoryId" from="processStoryActivity?.processStoryId"/><if condition="!processStoryId"><return error="true" message="${ec.resource.expand('CoarchyProcessActivityMoveError', null)}"/></if><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="processStoryActivityList" distinct="true"><date-filter/><econdition field-name="processStoryId"/><econdition field-name="replacedByActivityId" operator="is-null"/><select-field field-name="processStoryActivityId,activityId,sequenceNum"/><order-by field-name="sequenceNum"/></entity-find><set field="newSequenceNum" type="Integer" from="newSequenceNum?:1"/><set field="sequenceNumIdx" from="1"/><iterate list="processStoryActivityList" entry="pSA"><if condition="(sequenceNumIdx == newSequenceNum) && (pSA.processStoryActivityId != processStoryActivityId)"><set field="sequenceNumIdx" from="sequenceNumIdx + 1"/></if><if condition="(pSA.processStoryActivityId == processStoryActivityId)"><service-call name="update#coarchy.ProcessStoryActivity" in-map="[processStoryActivityId:pSA.processStoryActivityId,sequenceNum:newSequenceNum]"/><continue/></if><service-call name="update#coarchy.ProcessStoryActivity" in-map="[processStoryActivityId:pSA.processStoryActivityId,sequenceNum:sequenceNumIdx]"/><set field="sequenceNumIdx" from="sequenceNumIdx + 1"/></iterate></actions></transition>