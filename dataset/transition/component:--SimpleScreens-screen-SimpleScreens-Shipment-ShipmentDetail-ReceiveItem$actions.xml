<!--Transition Screen Location component://SimpleScreens/screen/SimpleScreens/Shipment/ShipmentDetail/ReceiveItem.xml Transition Name actions--><transition name="actions"><parameter name="shipmentId" required="true"/><parameter name="productId"/><parameter name="statusId"/><parameter name="filterProductId"/><parameter name="onlyRemaining"/><parameter name="pageIndex"/><parameter name="term"/><parameter name="facilityId"/><parameter name="locationSeqId"/><parameter name="term"/><parameter name="mfgPartyId"/><parameter name="term"/><parameter name="ownerPartyId"/><parameter name="partyId"/><parameter name="productStoreId"/><parameter name="term"/><parameter name="facilityId"/><parameter name="locationTypeEnumId"/><parameter name="term"/><parameter name="productFeatureIds"/><parameter name="productTypeEnumId"/><parameter name="productClassEnumId"/><parameter name="productCategoryIds"/><parameter name="assetTypeEnumId"/><parameter name="assetClassEnumId"/><parameter name="indexName"/><parameter name="documentType"/><parameter name="pageIndex"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://PopCommerce/screen/PopCommerceAdmin.xml--><set field="appRoot" value="PopcAdmin"/><set field="searchIndexName" value="mantle"/><set field="searchLinkSets" value="PopcAdmin"/><set field="searchProductDocType" value="MantleProduct"/><set field="searchPartyDocType" value="MantleParty"/><set field="appUserGroupTypeEnumId" value="UgtPopcAdmin"/><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--actions--><set field="origProductId" from="productId"/><service-call name="mantle.product.ProductServices.find#ProductByIdValue" out-map="productByIdOut" in-map="[idValue:productId, shipmentId:shipmentId]"/><set field="productId" from="productByIdOut.productId ?: productId"/><entity-find-one entity-name="mantle.product.Product" value-field="product"/><if condition="product == null"><return error="true" message="No Product found with ID ${origProductId}"/></if><entity-find-one entity-name="mantle.shipment.ShipmentItem" value-field="shipmentItem"/><if condition="shipmentItem == null"><return error="true" message="Shipment ${shipmentId} item ${productId} not found"/></if><service-call name="mantle.shipment.ShipmentServices.get#ShipmentDisplayInfo" in-map="[shipmentId:shipmentId]" out-map="context"/><service-call name="org.moqui.impl.BasicServices.find#Enumeration" in-map="[enumTypeId:'RejectionReason']" out-map="reasonOut"/><set field="facilityId" from="shipmentRouteSegmentList ? shipmentRouteSegmentList[shipmentRouteSegmentList.size()-1].destinationFacilityId : null"/><set field="quantityAccepted" from="shipmentItem.quantity"/><entity-find entity-name="mantle.product.receipt.AssetReceipt" list="assetReceiptList"><econdition field-name="shipmentId"/><econdition field-name="productId"/></entity-find><iterate list="assetReceiptList" entry="assetReceipt"><set field="quantityAccepted" from="quantityAccepted - (assetReceipt.quantityAccepted ?: 0.0) - (assetReceipt.quantityRejected ?: 0.0)"/></iterate><entity-find entity-name="mantle.shipment.ShipmentItemSource" list="shipmentItemSourceList"><econdition field-name="shipmentId"/><econdition field-name="productId"/></entity-find><set field="returnShipmentItemSourceList" from="shipmentItemSourceList.findAll({ it.returnId && it.returnItemSeqId })"/><iterate list="returnShipmentItemSourceList" entry="returnShipmentItemSource"><entity-find-one entity-name="mantle.order.return.ReturnItem" value-field="returnItem"><field-map field-name="returnId" from="returnShipmentItemSource.returnId"/><field-map field-name="returnItemSeqId" from="returnShipmentItemSource.returnItemSeqId"/></entity-find-one><if condition="returnItem?.inventoryStatusId"><set field="statusId" from="returnItem.inventoryStatusId"/><break/></if></iterate><entity-find entity-name="mantle.shipment.ShipmentParty" list="assetOwnerPartyList"><econdition field-name="shipmentId"/><econdition field-name="roleTypeId" value="AssetOwner"/><order-by field-name="partyId"/></entity-find><set field="ownerPartyId" from="assetOwnerPartyList ? assetOwnerPartyList[0].partyId : null"/><set field="orderShipmentItemSourceList" from="shipmentItemSourceList.findAll({ it.orderId && it.orderItemSeqId })"/><iterate list="orderShipmentItemSourceList" entry="shipmentItemSource"><if condition="(!acquireCost || !ownerPartyId) && shipmentItemSource.orderId && shipmentItemSource.orderItemSeqId"><entity-find-one entity-name="mantle.order.OrderItem" value-field="orderItem"><field-map field-name="orderId" from="shipmentItemSource.orderId"/><field-map field-name="orderItemSeqId" from="shipmentItemSource.orderItemSeqId"/></entity-find-one><if condition="!acquireCost"><set field="acquireCost" from="orderItem?.standardCost ?: orderItem?.unitAmount"/></if><if condition="!ownerPartyId"><set field="orderPart" from="orderItem?.'mantle.order.OrderPart'"/><set field="ownerPartyId" from="orderPart?.customerPartyId"/></if></if></iterate><if condition="!ownerPartyId"><set field="ownerPartyId" from="activeOrgId"/></if><if condition="!ownerPartyId"><set field="ownerPartyId" from="product?.ownerPartyId"/></if><if condition="shipment.shipmentTypeEnumId == 'ShpTpSalesReturn'"><then><if condition="!ownerPartyId"><entity-find-one entity-name="mantle.facility.Facility" value-field="destFacility"/><set field="ownerPartyId" from="destFacility.ownerPartyId"/></if></then><else><if condition="!ownerPartyId"><set field="ownerPartyId" from="shipment.fromPartyId"/></if><if condition="!mfgPartyId"><set field="mfgPartyId" from="shipment.fromPartyId"/></if></else></if><entity-find entity-name="mantle.product.issuance.AssetIssuance" list="assetIssuanceList"><econdition field-name="shipmentId"/><econdition field-name="productId"/></entity-find><iterate list="assetIssuanceList" entry="assetIssuance"><set field="asset" from="assetIssuance.asset"/><if condition="!lotId && asset?.lotId"><set field="lotId" from="asset.lotId"/></if><if condition="!acquireCost && asset?.acquireCost"><set field="acquireCost" from="asset.acquireCost"/></if></iterate></actions></transition>