<!--Transition Screen Location component://SimpleScreens/screen/SimpleScreens/Shipping/PackShipment/PackSummary/PackCompleted.xml Transition Name actions--><transition name="actions"><parameter name="shipmentId" required="true"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://SimpleScreens/screen/BasicHandheld/Warehouse.xml--><set field="appRoot" value="hhwh"/><set field="searchIndexName" value="mantle"/><set field="searchProductDocType" value="MantleProduct"/><set field="searchPartyDocType" value="MantleParty"/><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--actions--><entity-find-one entity-name="mantle.shipment.Shipment" value-field="shipment"/><entity-find entity-name="mantle.shipment.ShipmentRouteSegment" list="shipmentRouteSegmentList"><econdition field-name="shipmentId"/><order-by field-name="shipmentRouteSegmentSeqId"/></entity-find><set field="firstRouteSegment" from="shipmentRouteSegmentList ? shipmentRouteSegmentList.first() : null"/><set field="shippingGatewayConfigId" from="firstRouteSegment.shippingGatewayConfigId ?: ec.user.getPreference('DefaultShipmentGatewayConfigId')"/><if condition="shippingGatewayConfigId"><entity-find-one entity-name="mantle.shipment.carrier.ShippingGatewayConfig" value-field="shippingGatewayConfig"/></if><entity-find entity-name="mantle.product.store.ProductStoreSettingLookup" list="settingsLookupList" distinct="true"><date-filter/><econdition field-name="shipmentId"/><econdition field-name="settingTypeEnumId" operator="in" value="PsstGetReturnLabels,PsstShipRestrictCarriers"/><select-field field-name="productStoreId,settingTypeEnumId,settingValue"/></entity-find><set field="retLabelSettings" from="settingsLookupList.findAll({it.settingTypeEnumId == 'PsstGetReturnLabels'})*.settingValue"/><set field="defaultGetReturnLabels" from="retLabelSettings.contains('true') ? 'true' : ''"/><set field="restrictCarrierProductStoreId" from="null"/><iterate list="settingsLookupList.findAll({it.settingTypeEnumId == 'PsstShipRestrictCarriers'})" entry="restrictCarrierSetting"><if condition="restrictCarrierSetting.settingValue == 'true'"><set field="restrictCarrierProductStoreId" from="restrictCarrierSetting.productStoreId"/></if></iterate><set field="carrierPartyIdList" from="null"/><if condition="restrictCarrierProductStoreId"><entity-find entity-name="mantle.product.store.ProductStoreShippingGateway" list="storeShippingGatewayList" cache="true"><econdition field-name="productStoreId" from="restrictCarrierProductStoreId"/></entity-find><set field="carrierPartyIdList" from="storeShippingGatewayList*.carrierPartyId"/></if><service-call name="mantle.shipment.ShipmentServices.get#ShipmentShippingOptions" out-map="context" in-map="[shipmentId:shipmentId, carrierPartyIdList:carrierPartyIdList, getRates:true]"/><set field="curShipmentMethodEnumId" from="firstRouteSegment.shipmentMethodEnumId"/><set field="lowestCarrierAndShipmentMethod" from="firstRouteSegment.carrierPartyId ? firstRouteSegment.carrierPartyId + ':' + firstRouteSegment.shipmentMethodEnumId : ''"/><set field="lowestRate" from="10000.0"/><iterate list="shippingOptions" entry="shipOption"><set field="shippingTotalBd" from="shipOption.shippingTotal ? new BigDecimal(shipOption.shippingTotal) : null"/><if condition="shippingTotalBd && shippingTotalBd < lowestRate && (!curShipmentMethodEnumId || curShipmentMethodEnumId == shipOption.shipmentMethodEnumId)"><set field="lowestCarrierAndShipmentMethod" from="shipOption.carrierPartyId + ':' + shipOption.shipmentMethodEnumId"/><set field="lowestRate" from="shippingTotalBd"/></if></iterate><entity-find entity-name="moqui.basic.print.NetworkPrinter" list="networkPrinterList"><order-by field-name="description,printerName"/></entity-find><set field="defaultNetworkPrinterId" from="ec.user.getPreference('Shipment.networkPrinterId.default')"/><entity-find entity-name="mantle.shipment.ShipmentItemSourceOrderItem" list="sisOrderItemList" distinct="true"><econdition field-name="shipmentId"/><econdition field-name="orderId" operator="is-not-null"/><econdition field-name="orderPartSeqId" operator="is-not-null"/><select-field field-name="orderId,orderPartSeqId"/></entity-find><if condition="sisOrderItemList"><entity-find-one entity-name="mantle.order.OrderPart" value-field="firstOrderPart"><field-map field-name="orderId" from="sisOrderItemList[0].orderId"/><field-map field-name="orderPartSeqId" from="sisOrderItemList[0].orderPartSeqId"/></entity-find-one><if condition="firstOrderPart != null"><if condition="firstOrderPart.carrierPartyId && firstOrderPart.carrierPartyId != '_NA_'"><entity-find-one entity-name="mantle.party.PartyDetail" value-field="orderCarrierDetail" cache="true"><field-map field-name="partyId" from="firstOrderPart.carrierPartyId"/></entity-find-one></if><entity-find-one entity-name="moqui.basic.Enumeration" value-field="orderShipmentMethodEnum"><field-map field-name="enumId" from="firstOrderPart.shipmentMethodEnumId"/></entity-find-one><entity-find-one entity-name="mantle.shipment.carrier.CarrierShipmentMethod" value-field="orderCarrierShipmentMethod"><field-map field-name="carrierPartyId" from="firstOrderPart.carrierPartyId"/><field-map field-name="shipmentMethodEnumId" from="firstOrderPart.shipmentMethodEnumId"/></entity-find-one></if></if><if condition="shipment.assemblyWorkEffortId"><entity-find-one entity-name="mantle.work.effort.WorkEffort" value-field="assemblyWorkEffort"><field-map field-name="workEffortId" from="shipment.assemblyWorkEffortId"/></entity-find-one><service-call name="mantle.work.ManufacturingServices.get#ConsumedAssetRemaining" in-map="[workEffortId:shipment.assemblyWorkEffortId]" out-map="assemblyAssetInfo"/></if></actions></transition>