<!--Transition Screen Location component://coarchy/screen/coarchy/cointernal/Process/EditProcessStory.xml Transition Name importText--><transition name="importText"><parameter name="processStoryId" required="true"/><parameter name="pageIndex" from="pageIndex?:0"/><parameter name="pageSize" from="pageSize?:50"/><parameter name="orderByField" value="sequenceNum"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://coarchy/screen/coarchy/cointernal.xml--><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--always-actions at component://coarchy/screen/coarchy/cointernal/Process/EditProcessStory.xml--><if condition="!activeOrgId"><message><![CDATA[${ec.resource.expand('CoarchySelectAnOrg', null)}]]></message><script><![CDATA[sri.sendRedirectAndStopRender('/settings/Organizations')]]></script></if><entity-find-count entity-name="mantle.party.PartyRelationship" count-field="partyRelationshipCount"><date-filter/><econdition field-name="relationshipTypeEnumId" value="PrtMember"/><econdition field-name="toRoleTypeId" value="OrgInternal"/><econdition field-name="fromPartyId" from="ec.user.userAccount.partyId"/><econdition field-name="toPartyId" from="activeOrgId"/></entity-find-count><entity-find-count entity-name="mantle.party.PartyActivation" count-field="partyActivationCount"><date-filter/><econdition field-name="partyId" from="activeOrgId"/></entity-find-count><!--transition actions--><set field="paragraphTextList" from="text.split('(?:\\r\\n|\\r|\\n){2}').toList()"/><set field="activityMapList" from="[]"/><iterate list="paragraphTextList" entry="paragraphText"><set field="intermediateActivityMapList" from="paragraphText.trim().split('\\.').toList()"/><iterate list="intermediateActivityMapList" entry="intermediateActivityText"><set field="intermediateActivityText" from="intermediateActivityText.trim()"/><set field="condition" value=""/><if condition="intermediateActivityText.contains(',')"><set field="intermediateActivityTextCondition" from="intermediateActivityText.split(',')"/><set field="condition" from="intermediateActivityTextCondition[0]"/><set field="intermediateActivityText" from="intermediateActivityText.replace(intermediateActivityTextCondition[0]+',','').trim()"/></if><set field="intermediateActivityTextActor" from="intermediateActivityText.split(' ')"/><set field="actorList" value=""/><if condition="java.lang.Character.isUpperCase(intermediateActivityText.charAt(0))"><set field="actorList" from="intermediateActivityTextActor[0]"/><set field="intermediateActivityText" from="intermediateActivityText.replace(actorList+' ','').trim()"/></if><set field="action" from="intermediateActivityText"/><set field="activityMapList" from="activityMapList + ['condition':condition, 'actorList':actorList, 'action':action]"/></iterate><set field="activityMapList" from="activityMapList + ['condition':null, 'actorList':null, 'action':null]"/></iterate><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="processStoryActivityList" distinct="true"><search-form-inputs default-order-by="sequenceNum,action"/><date-filter/><econdition field-name="replacedByActivityId" operator="is-null"/><econdition field-name="processStoryId"/><econdition field-name="actorId" operator="in" from="actorIdList" ignore-if-empty="true"/><select-field field-name="processStoryActivityId,sequenceNum,detailProcessStoryId,action,condition,activityId,implementationId"/></entity-find><set field="insertSequenceNum" from="processStoryActivityList?.size()>0?processStoryActivityList?.last()?.sequenceNum+1:0"/><iterate list="activityMapList" entry="activityMap"><if condition="activityMap.action"><if condition="activityMap.actorList"><entity-find entity-name="coarchy.Actor" list="insideActorList" distinct="true" limit="1"><econdition field-name="name" from="activityMap.actorList"/><select-field field-name="actorId,name"/><order-by field-name="name"/></entity-find><set field="actorIdList" from="[]"/><if condition="!insideActorList"><then><service-call name="create#coarchy.Actor" in-map="[name:activityMap.actorList,                             organizationId:activeOrgId]" out-map="actorContext"/><script><![CDATA[actorIdList.add(actorContext?.actorId)]]></script></then><else><script><![CDATA[actorIdList.add(insideActorList.getFirst().actorId)]]></script></else></if></if><service-call name="coarchy.CoarchyServices.create#Activity" in-map="[processStoryId:processStoryId,organizationId:activeOrgId,                         condition:activityMap.condition,actorIdList:actorIdList,action:activityMap.action,insertSequenceNum:insertSequenceNum]"/><else><service-call name="coarchy.CoarchyServices.new#Paragraph" in-map="[processStoryId:processStoryId,organizationId:activeOrgId,insertSequenceNum:insertSequenceNum]"/></else></if><set field="insertSequenceNum" from="insertSequenceNum+1"/></iterate></actions></transition>