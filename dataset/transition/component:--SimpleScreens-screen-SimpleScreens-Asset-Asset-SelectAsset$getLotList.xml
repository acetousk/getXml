<!--Transition Screen Location component://SimpleScreens/screen/SimpleScreens/Asset/Asset/SelectAsset.xml Transition Name getLotList--><transition name="getLotList"><parameter name="facilityId"/><parameter name="locationSeqId"/><parameter name="containerId"/><parameter name="productId"/><parameter name="assetPoolId"/><parameter name="lotId"/><parameter name="quantity"/><parameter name="toScanLocation"/><parameter name="term"/><parameter name="mfgPartyId"/><actions><!--always-actions at component://webroot/screen/webroot.xml--><set field="html_scripts" from="new LinkedHashSet()"/><set field="footer_scripts" from="new LinkedHashSet()"/><set field="html_stylesheets" from="new LinkedHashSet()"/><!--always-actions at component://PopCommerce/screen/PopCommerceAdmin.xml--><set field="appRoot" value="PopcAdmin"/><set field="searchIndexName" value="mantle"/><set field="searchLinkSets" value="PopcAdmin"/><set field="searchProductDocType" value="MantleProduct"/><set field="searchPartyDocType" value="MantleParty"/><set field="appUserGroupTypeEnumId" value="UgtPopcAdmin"/><service-call name="mantle.party.PartyServices.setup#UserOrganizationInfo" out-map="context"/><!--transition actions--><set field="term" from="term ?: ''"/><entity-find-one entity-name="mantle.product.asset.Lot" value-field="pkLot"><field-map field-name="lotId" from="term"/></entity-find-one><if condition="pkLot != null"><then><set field="lotList" from="[pkLot]"/></then><else><entity-find entity-name="mantle.product.asset.Lot" list="lotList" limit="20"><econdition field-name="mfgPartyId" ignore-if-empty="true"/><econditions combine="or"><econdition field-name="lotId" operator="like" value="%${term}%" ignore-case="true"/><econdition field-name="lotNumber" operator="like" value="%${term}%" ignore-case="true"/></econditions><select-field field-name="lotId,lotNumber,manufacturedDate,expirationDate"/><order-by field-name="lotNumber"/></entity-find></else></if><script><![CDATA[def outList = []
                for (lot in lotList) {
                    def lotNameMap = lot.getMap()
                    if (lot.mfgPartyId) lotNameMap.mfgParty = ec.entity.find("mantle.party.Party").condition("partyId", lot.mfgPartyId).useCache(true).one()
                    outList.add([value:lot.lotId, label:ec.resource.expand("LotNameTemplate", '', lotNameMap)])
                }
                ec.web.sendJsonResponse(outList)]]></script></actions></transition>