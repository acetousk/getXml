<!--Service Location coarchy.ProductEvaluationServices.remove#ProductEvaluationProcessStory--><service verb="remove" noun="ProductEvaluationProcessStory"><in-parameters><parameter name="productEvaluationId" required="true"/><parameter name="organizationId" required="true"/><parameter name="processStoryId" required="true"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="coarchy.product.ProductEvaluation" value-field="productEvaluation"/><if condition="productEvaluation.statusId != 'PeRequirementsSelection'"><return error="true" message="Cannot edit activities in this status."/></if><entity-find entity-name="coarchy.product.ProductEvaluationStory" list="productEvaluationStoryList"><econdition field-name="organizationId"/><econdition field-name="productEvaluationId"/><econdition field-name="processStoryId"/></entity-find><iterate list="productEvaluationStoryList" entry="productEvaluationStory"><service-call name="delete#coarchy.product.ProductEvaluationStory" in-map="[productEvaluationId:productEvaluationStory.productEvaluationId, processStoryId:productEvaluationStory.processStoryId]"/></iterate><service-call name="coarchy.ProductEvaluationServices.get#ProcessStoryDescendants" out-map="[descendantIdList:descOut.descendantIdList]" out-map-add-to-existing="false" in-map="[processStoryId:processStoryId]"/><entity-delete-by-condition entity-name="coarchy.product.ProductEvaluationActivity"><econdition field-name="productEvaluationId"/><econdition field-name="organizationId"/><econdition field-name="processStoryId" operator="in" from="[processStoryId]+descOut.descendantIdList"/></entity-delete-by-condition></actions></service>