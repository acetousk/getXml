<!--Service Location org.moqui.impl.InstanceServices.get#AppInstanceEnv--><service verb="get" noun="AppInstanceEnv"><in-parameters><parameter name="appInstanceId" required="true" entity-name="moqui.server.instance.AppInstanceEnv" field-name="appInstanceId"/></in-parameters><out-parameters><parameter name="envMap" type="Map"/><parameter name="adminMap" type="Map"/></out-parameters><actions><entity-find-one entity-name="moqui.server.instance.AppInstance" value-field="appInstance"/><set field="databaseHost" from="appInstance.database"/><if condition="databaseHost == null"><return message="No DatabaseHost found for AppInstance ${appInstanceId}"/></if><set field="envList" from="appInstance.envs"/><set field="envMap" from="[:]"/><iterate list="envList" entry="envItem"><script><![CDATA[envMap.put(envItem.envName, envItem.envValue)]]></script></iterate><set field="adminMap" from="[entity_ds_db_conf:databaseHost.type.confName, entity_ds_host:databaseHost.hostAddress,                     entity_ds_port:databaseHost.hostPort, entity_ds_user:databaseHost.adminUser, entity_ds_password:databaseHost.adminPassword]"/></actions></service>