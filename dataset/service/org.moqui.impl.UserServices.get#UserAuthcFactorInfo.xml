<!--Service Location org.moqui.impl.UserServices.get#UserAuthcFactorInfo--><service verb="get" noun="UserAuthcFactorInfo"><in-parameters><parameter name="userId" required="true"/><parameter name="getFactorsIfNotRequired" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="secondFactorRequired" type="Boolean"/><parameter name="factorTypeEnumIds" type="Set"/><parameter name="factorTypeDescriptions" type="List"/><parameter name="sendableFactors" type="List"><parameter name="sendableFactor" type="Map"><parameter name="factorId"/><parameter name="factorTypeEnumId"/><parameter name="factorOption"/></parameter></parameter></out-parameters><actions><service-call name="org.moqui.impl.UserServices.get#UserAuthcFactorRequired" out-map="[secondFactorRequired:context.secondFactorRequired]"><field-map field-name="userId"/></service-call><if condition="!getFactorsIfNotRequired && !secondFactorRequired"><return/></if><entity-find entity-name="moqui.security.UserAuthcFactor" list="userAuthcFactorList"><date-filter/><econdition field-name="userId"/><econdition field-name="fromFactorId" operator="is-null"/></entity-find><if condition="userAuthcFactorList.size() == 0"><entity-find-one entity-name="moqui.security.UserAccount" value-field="userAccount"/><if condition="userAccount?.emailAddress"><set field="userAuthcFactorList" from="[[factorId:'UserAccountEmail', userId:userId,                             factorTypeEnumId:'UafEmail', factorOption:userAccount.emailAddress]]"/></if></if><set field="factorTypeEnumIds" from="new TreeSet(userAuthcFactorList*.factorTypeEnumId)"/><set field="factorTypeDescriptions" from="new LinkedList(factorTypeEnumIds.collect({                 ec.entity.find('moqui.basic.Enumeration').condition('enumId', it).one()?.description ?: it }))"/><set field="sendableFactors" from="[]"/><iterate list="userAuthcFactorList" entry="factor"><if condition="factor.factorTypeEnumId in ['UafEmail', 'UafSms']"><script><![CDATA[sendableFactors.add([factorId:factor.factorId, factorTypeEnumId:factor.factorTypeEnumId,
                                                 factorOption:factor.factorOption])]]></script></if></iterate></actions></service>