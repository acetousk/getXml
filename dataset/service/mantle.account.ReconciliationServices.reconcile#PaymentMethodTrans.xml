<!--Service Location mantle.account.ReconciliationServices.reconcile#PaymentMethodTrans--><service verb="reconcile" noun="PaymentMethodTrans"><in-parameters><parameter name="paymentMethodId" required="true" entity-name="mantle.account.method.PaymentMethodTrans" field-name="paymentMethodId"/><parameter name="fitId" required="true" entity-name="mantle.account.method.PaymentMethodTrans" field-name="fitId"/><parameter name="bankAccountTrans" type="EntityValue"><description><![CDATA[Looked up from ID if not passed]]></description></parameter><parameter name="paymentId" entity-name="mantle.account.method.PaymentMethodTrans" field-name="paymentId"/><parameter name="payment" type="EntityValue"><description><![CDATA[Looked up from ID if not passed]]></description></parameter><parameter name="acctgTransId" entity-name="mantle.account.method.PaymentMethodTrans" field-name="acctgTransId"/><parameter name="acctgTransEntrySeqId" entity-name="mantle.account.method.PaymentMethodTrans" field-name="acctgTransEntrySeqId"/><parameter name="acctgTransEntry" type="EntityValue"><description><![CDATA[Looked up from ID if not passed]]></description></parameter><parameter name="pmtReconcileStatusId" default-value="PmtrRec"/><parameter name="ateReconcileStatusId" default-value="AterRec"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="paymentMethod"/><if condition="bankAccountTrans == null"><entity-find-one entity-name="mantle.account.method.PaymentMethodTrans" value-field="bankAccountTrans"/></if><if condition="acctgTransId && !paymentId"><entity-find-one entity-name="mantle.ledger.transaction.AcctgTrans" value-field="acctgTrans"/><if condition="acctgTrans?.paymentId"><set field="paymentId" from="acctgTrans?.paymentId"/></if></if><if condition="paymentId"><if condition="payment == null"><entity-find-one entity-name="mantle.account.payment.Payment" value-field="payment"/></if><entity-find entity-name="mantle.account.method.PaymentMethodTrans" list="existingTransList"><econdition field-name="paymentId"/><econditions combine="or"><econdition field-name="paymentMethodId" operator="not-equals"/><econdition field-name="fitId" operator="not-equals"/></econditions></entity-find><iterate list="existingTransList" entry="existingTrans"><set field="existingTrans.paymentId" from="null"/><entity-update value-field="existingTrans"/></iterate><set field="bankAccountTrans.paymentId" from="paymentId"/><set field="bankAccountTrans.noReconcile" value="N"/><entity-update value-field="bankAccountTrans"/><if condition="payment.reconcileStatusId != pmtReconcileStatusId"><set field="payment.reconcileStatusId" from="pmtReconcileStatusId"/><entity-update value-field="payment"/></if><if condition="!acctgTransId"><entity-find entity-name="mantle.ledger.transaction.AcctgTrans" list="existingTransList"><econdition field-name="paymentId"/><econdition field-name="acctgTransTypeEnumId" operator="in" from="['AttPayment', 'AttDisbursement', 'AttReceipt', 'AttIncomingPayment', 'AttOutgoingPayment']"/><econdition field-name="reversedByAcctgTransId" from="null"/><econdition field-name="reverseOfAcctgTransId" from="null"/></entity-find><if condition="existingTransList"><set field="acctgTransId" from="existingTransList[0].acctgTransId"/></if></if></if><if condition="acctgTransId"><if condition="!acctgTransEntrySeqId && paymentMethod.glAccountId"><entity-find entity-name="mantle.ledger.transaction.AcctgTransEntry" list="ateList"><econdition field-name="acctgTransId"/><econdition field-name="glAccountId" from="paymentMethod.glAccountId"/><order-by field-name="acctgTransEntrySeqId"/></entity-find><if condition="ateList"><set field="acctgTransEntry" from="ateList[0]"/><set field="acctgTransEntrySeqId" from="acctgTransEntry.acctgTransEntrySeqId"/></if></if><if condition="acctgTransEntry == null && acctgTransEntrySeqId"><entity-find-one entity-name="mantle.ledger.transaction.AcctgTransEntry" value-field="acctgTransEntry"/></if><entity-find entity-name="mantle.account.method.PaymentMethodTrans" list="existingTransList"><econdition field-name="acctgTransId"/><econdition field-name="acctgTransEntrySeqId" ignore-if-empty="true"/><econditions combine="or"><econdition field-name="paymentMethodId" operator="not-equals"/><econdition field-name="fitId" operator="not-equals"/></econditions></entity-find><iterate list="existingTransList" entry="existingTrans"><set field="existingTrans.acctgTransId" from="null"/><set field="existingTrans.acctgTransEntrySeqId" from="null"/><entity-update value-field="existingTrans"/></iterate><set field="bankAccountTrans.acctgTransId" from="acctgTransId"/><set field="bankAccountTrans.acctgTransEntrySeqId" from="acctgTransEntrySeqId"/><set field="bankAccountTrans.noReconcile" value="N"/><entity-update value-field="bankAccountTrans"/><if condition="acctgTransEntry != null"><if condition="acctgTransEntry.reconcileStatusId != ateReconcileStatusId"><set field="acctgTransEntry.reconcileStatusId" from="ateReconcileStatusId"/><entity-update value-field="acctgTransEntry"/></if></if></if></actions></service>