<!--Service Location mantle.facility.ContactServices.update#FacilityPostalAddress--><service verb="update" noun="FacilityPostalAddress"><in-parameters><parameter name="toName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="toName"/><parameter name="attnName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="attnName"/><parameter name="address1" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="address1"/><parameter name="address2" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="address2"/><parameter name="unitNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="unitNumber"/><parameter name="directions" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="directions"/><parameter name="city" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="city"/><parameter name="cityGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="cityGeoId"/><parameter name="schoolDistrictGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="schoolDistrictGeoId"/><parameter name="countyGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="countyGeoId"/><parameter name="stateProvinceGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="stateProvinceGeoId"/><parameter name="countryGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="countryGeoId"/><parameter name="postalCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCode"/><parameter name="postalCodeExt" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCodeExt"/><parameter name="postalCodeGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCodeGeoId"/><parameter name="geoPointId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="geoPointId"/><parameter name="commercial" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="commercial"/><parameter name="accessCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="accessCode"/><parameter name="telecomContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="telecomContactMechId"/><parameter name="emailContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="emailContactMechId"/><parameter name="shipGatewayAddressId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="shipGatewayAddressId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="lastUpdatedStamp"/><parameter name="geoPointTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="geoPointTypeEnumId"/><parameter name="description" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="description"/><parameter name="dataSourceId" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="dataSourceId"/><parameter name="latitude" type="java.lang.Double" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="latitude"/><parameter name="longitude" type="java.lang.Double" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="longitude"/><parameter name="elevation" type="java.lang.Double" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="elevation"/><parameter name="elevationUomId" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="elevationUomId"/><parameter name="information" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="information"/><parameter name="facilityId" required="true"/><parameter name="contactMechId" required="true"/><parameter name="contactMechPurposeId"/><parameter name="expireCurrent" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="contactMechId" required="true"/></out-parameters><actions><entity-find-one entity-name="mantle.party.contact.PostalAddress" value-field="origPostalAddress"/><set field="geoPointId" from="origPostalAddress.geoPointId"/><if condition="geoPointId"><entity-find-one entity-name="moqui.basic.GeoPoint" value-field="origGeoPoint"/><set field="newGeoPoint" from="origGeoPoint.cloneValue()"/><entity-set value-field="newGeoPoint" include="nonpk"/><if condition="newGeoPoint != origGeoPoint"><set field="newGeoPoint.geoPointId" from="null"/><entity-sequenced-id-primary value-field="newGeoPoint"/><entity-create value-field="newGeoPoint"/><set field="geoPointId" from="newGeoPoint.geoPointId"/></if><else><if condition="latitude || elevation"><service-call name="create#moqui.basic.GeoPoint" in-map="context" out-map="[geoPointId:context.geoPointId,geoPointTypeEnumId:context.geoPointTypeEnumId,description:context.description,dataSourceId:context.dataSourceId,latitude:context.latitude,longitude:context.longitude,elevation:context.elevation,elevationUomId:context.elevationUomId,information:context.information,lastUpdatedStamp:context.lastUpdatedStamp]"/></if></else></if><set field="newPostalAddress" from="origPostalAddress.cloneValue()"/><entity-set value-field="newPostalAddress" include="nonpk" set-if-empty="true"/><if condition="newPostalAddress == origPostalAddress"><log message="No fields were different for Postal Address with ID [${contactMechId}], not updating."/><return/></if><entity-find entity-name="mantle.facility.FacilityContactMech" list="origFcmList"><date-filter/><econdition field-name="facilityId"/><econdition field-name="contactMechId" from="contactMechId"/><econdition field-name="contactMechPurposeId" from="contactMechPurposeId" ignore-if-empty="true"/></entity-find><if condition="!origFcmList"><return error="true" message="Postal Address with ID [${contactMechId}] is not associated with Facility ID [${facilityId}] and purpose [${contactMechPurposeId?:'N/A'}], not updating."/></if><entity-find-one entity-name="mantle.party.contact.ContactMech" value-field="newContactMech"/><set field="newContactMech.replacesContactMechId" from="newContactMech.contactMechId"/><set field="newContactMech.contactMechId" from="null"/><set field="newContactMech.gatewayCimId" from="null"/><set field="newContactMech.trustLevelEnumId" value="CmtlNew"/><set field="newContactMech.validateMessage" from="null"/><set field="newContactMech.paymentFraudEvidenceId" from="null"/><entity-sequenced-id-primary value-field="newContactMech"/><entity-create value-field="newContactMech"/><set field="newPostalAddress.contactMechId" from="newContactMech.contactMechId"/><set field="newPostalAddress.shipGatewayAddressId" from="null"/><entity-create value-field="newPostalAddress"/><iterate list="origFcmList" entry="origFcm"><if condition="expireCurrent"><set field="origFcm.thruDate" from="ec.user.nowTimestamp"/><entity-update value-field="origFcm"/></if><entity-make-value entity-name="mantle.facility.FacilityContactMech" value-field="newFcm" map="[facilityId:facilityId, contactMechId:newContactMech.contactMechId, fromDate:ec.user.nowTimestamp]"/><set field="newFcm.contactMechPurposeId" from="origFcm.contactMechPurposeId"/><set field="newFcm.extension" from="origFcm.extension"/><set field="newFcm.comments" from="origFcm.comments"/><entity-create value-field="newFcm"/></iterate><set field="result.contactMechId" from="newContactMech.contactMechId"/></actions></service>