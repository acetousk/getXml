<!--Service Location mantle.party.TimeServices.find#PartyTimePeriodGroups--><service verb="find" noun="PartyTimePeriodGroups"><in-parameters><parameter name="partyId" required="true"/><parameter name="timePeriodTypeId" default-value="FiscalMonth"/><parameter name="groups" type="Integer" default="12"/><parameter name="perGroup" type="Integer" default="1"/><parameter name="thruDate" type="Date" default="new java.sql.Date(System.currentTimeMillis())"/></in-parameters><out-parameters><parameter name="timePeriodGroups" type="List" required="true"><parameter name="timePeriodIds" type="List"><parameter name="timePeriodId"/></parameter></parameter></out-parameters><actions><entity-find entity-name="mantle.party.time.TimePeriod" list="mainPeriods" limit="groups"><econdition field-name="partyId"/><econdition field-name="timePeriodTypeId"/><econdition field-name="fromDate" operator="less-equals" from="thruDate"/><order-by field-name="-fromDate"/></entity-find><order-map-list list="mainPeriods"><order-by field-name="fromDate"/></order-map-list><set field="timePeriodGroups" from="[]"/><iterate list="mainPeriods" entry="mainPeriod"><if condition="perGroup <= 1"><then><script><![CDATA[timePeriodGroups.add([mainPeriod.timePeriodId])]]></script></then><else><entity-find entity-name="mantle.party.time.TimePeriod" list="groupPeriods" limit="perGroup"><econdition field-name="partyId"/><econdition field-name="timePeriodTypeId"/><econdition field-name="fromDate" operator="less-equals" from="mainPeriod.fromDate"/><order-by field-name="-fromDate"/></entity-find><order-map-list list="groupPeriods"><order-by field-name="fromDate"/></order-map-list><script><![CDATA[timePeriodGroups.add(groupPeriods*.timePeriodId)]]></script></else></if></iterate></actions></service>