<!--Service Location coarchy.CoarchyServices.signUp#User--><service verb="signUp" noun="User"><in-parameters><parameter name="emailAddress" required="true"/><parameter name="username" required="true" default="emailAddress"/><parameter name="firstName" required="true"/><parameter name="lastName" required="true"/><parameter name="newPassword" required="true"/><parameter name="templateOrgId" type="String"/><parameter name="organizationName" type="String"/></in-parameters><out-parameters><parameter name="partyId"/><parameter name="partyClassificationId"/><parameter name="newOrganizationId"/><parameter name="username"/><parameter name="firstName"/><parameter name="lastName"/><parameter name="templateOrgId"/><parameter name="organizationName"/></out-parameters><actions><service-call name="coarchy.CoarchyServices.create#Account" out-map="[userId:context.userId,partyId:context.partyId,emailContactMechId:context.emailContactMechId]" in-map="[emailAddress:emailAddress,firstName:firstName,lastName:lastName,username:emailAddress,                     newPassword:newPassword,newPasswordVerify:newPassword,loginAfterCreate:true]"/><service-call name="update#mantle.party.Party" in-map="[partyId:partyId,visibilityEnumId:'PvOrganization']"/><service-call name="create#mantle.party.PartyRole" in-map="[partyId:partyId,roleTypeId:'Customer']"/><service-call name="create#moqui.security.UserGroupMember" in-map="[userGroupId:'COARCHY_USERS', userId:userId, fromDate:ec.user.nowTimestamp]"/><service-call name="mantle.party.PartyServices.set#PartyClassification" in-map="[partyId:partyId,partyClassificationId:'HotLead']" out-map="[]"/><if condition="templateOrgId?.length()>0"><entity-find-one entity-name="mantle.party.Party" value-field="templateOrg"><field-map field-name="partyId" from="templateOrgId"/></entity-find-one><if condition="!templateOrg || (templateOrg.visibilityEnumId!='PvPublic')"><return error="true" message="Invalid template"/></if><if condition="!organizationName.strip()"><return error="true" message="Please specify an organization name"/></if><service-call name="coarchy.CoarchyServices.create#Organization" in-map="[organizationId:templateOrgId,organizationName:organizationName,copyProducts:'copy']" out-map="[newOrganizationId:createOrgOut.newOrganizationId]"/><set field="newOrganizationId" from="createOrgOut?.newOrganizationId"/></if></actions></service>