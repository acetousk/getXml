<!--Service Location mantle.request.RequestServices.create#ContactRequest--><service verb="create" noun="ContactRequest"><in-parameters><parameter name="statusId" default-value="ReqSubmitted"/><parameter name="priority" type="Long" default="3"/><parameter name="requestTypeEnumId" default-value="RqtContact"/><parameter name="requestResolutionEnumId" default-value="RrUnresolved"/><parameter name="requestDate" default="ec.user.nowTimestamp"/><parameter name="productStoreId"/><parameter name="requestName"/><parameter name="description"/><parameter name="filedByPartyId" default="ec.user.userAccount?.partyId"/><parameter name="customerPartyId" default="ec.user.userAccount?.partyId"/><parameter name="firstName"/><parameter name="lastName"/><parameter name="emailContactMechId"/><parameter name="emailAddress"><text-email/></parameter></in-parameters><out-parameters><parameter name="requestId"/></out-parameters><actions><set field="visitId" from="ec.user.visitId"/><if condition="!customerPartyId"><if condition="!firstName || !lastName || !emailAddress"><message public="true" type="warning"><![CDATA[Please enter your first name, last name, and email address]]></message><return error="true" message="Name or email missing"/></if><set field="firstName" from="firstName.trim()"/><entity-find entity-name="mantle.party.contact.PartyContactMechInfo" list="emailPcmList"><date-filter/><econdition field-name="infoString" from="emailAddress"/></entity-find><iterate list="emailPcmList" entry="emailPcm"><entity-find-one entity-name="mantle.party.PartyDetail" value-field="party"><field-map field-name="partyId" from="emailPcm.partyId"/></entity-find-one><if condition="party.disabled == 'Y' || party.partyTypeEnumId != 'PtyPerson'"><continue/></if><if condition="!firstName.equalsIgnoreCase(party.firstName?.trim())"><continue/></if><set field="customerPartyId" from="emailPcm.partyId"/><set field="emailContactMechId" from="emailPcm.contactMechId"/><break/></iterate><if condition="!customerPartyId"><service-call name="mantle.party.PartyServices.create#Person" out-map="[partyId:createPartyOut.partyId]" in-map="[firstName:firstName, lastName:lastName, roleTypeId:'Customer']"/><set field="customerPartyId" from="createPartyOut.partyId"/></if><set field="filedByPartyId" from="customerPartyId"/></if><if condition="!emailContactMechId"><if condition="emailAddress"><then><set field="emailAddress" from="emailAddress.trim()"/><entity-find entity-name="mantle.party.contact.PartyContactMechInfo" list="existingEmailList"><date-filter/><econdition field-name="partyId" from="customerPartyId"/><econdition field-name="infoString" from="emailAddress"/></entity-find><if condition="existingEmailList"><then><set field="emailContactMechId" from="existingEmailList[0].contactMechId"/></then><else><service-call name="mantle.party.ContactServices.create#EmailAddress" out-map="[contactMechId:emailOut.contactMechId]" in-map="[partyId:customerPartyId, emailAddress:emailAddress, contactMechPurposeId:'EmailPrimary']"/><set field="emailContactMechId" from="emailOut.contactMechId"/></else></if></then><else><entity-find entity-name="mantle.party.contact.PartyContactMechInfo" list="existingEmailList"><date-filter/><econdition field-name="partyId" from="customerPartyId"/><econdition field-name="contactMechTypeEnumId" value="CmtEmailAddress"/></entity-find><set field="emailContactMechId" from="existingEmailList ? existingEmailList[0].contactMechId : null"/></else></if></if><if condition="!emailContactMechId"><message public="true" type="warning"><![CDATA[Please enter your email address]]></message><return error="true" message="Email record missing"/></if><service-call name="create#mantle.request.Request" out-map="[requestId:context.requestId,requestTypeEnumId:context.requestTypeEnumId,requestCategoryId:context.requestCategoryId,statusId:context.statusId,requestName:context.requestName,description:context.description,priority:context.priority,requestDate:context.requestDate,responseRequiredDate:context.responseRequiredDate,requestResolutionEnumId:context.requestResolutionEnumId,rootWorkEffortId:context.rootWorkEffortId,facilityId:context.facilityId,productStoreId:context.productStoreId,salesChannelEnumId:context.salesChannelEnumId,emailContactMechId:context.emailContactMechId,maximumAmountUomId:context.maximumAmountUomId,currencyUomId:context.currencyUomId,filedByPartyId:context.filedByPartyId,visitId:context.visitId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="context"/><service-call name="create#mantle.request.RequestParty" in-map="[requestId:requestId, partyId:filedByPartyId, roleTypeId:'Reporter', fromDate:ec.user.nowTimestamp]"/><service-call name="create#mantle.request.RequestParty" in-map="[requestId:requestId, partyId:customerPartyId, roleTypeId:'Customer', fromDate:ec.user.nowTimestamp]"/><message public="true" type="success"><![CDATA[Thank you, we have received your request. Your request number is ${requestId}]]></message></actions></service>