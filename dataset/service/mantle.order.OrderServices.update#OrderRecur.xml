<!--Service Location mantle.order.OrderServices.update#OrderRecur--><service verb="update" noun="OrderRecur"><in-parameters><parameter name="orderId" required="true"/><parameter name="recurCronExpression" required="true"/><parameter name="recurAutoInvoice" default-value="N"/><parameter name="lastOrderedDate" type="Timestamp"/></in-parameters><out-parameters/><actions><entity-find-count entity-name="mantle.order.OrderItemBilling" count-field="itemBillingCount"><econdition field-name="orderId"/></entity-find-count><if condition="itemBillingCount"><return error="true" message="Order ${orderId} has been invoiced (billed), cannot make recurring"/></if><entity-find-count entity-name="mantle.shipment.ShipmentItemSource" count-field="shipmentSourceCount"><econdition field-name="orderId"/></entity-find-count><if condition="shipmentSourceCount"><return error="true" message="Order ${orderId} has been shipped, cannot make recurring"/></if><script><![CDATA[try { org.moqui.impl.service.ScheduledJobRunner.getExecutionTime((String) recurCronExpression) } catch (Exception e) {
                    ec.message.addError("Invalid Cron expression '${recurCronExpression}': ${e.message}")
                    return
                }]]></script><service-call name="update#mantle.order.OrderHeader" in-map="context"/><service-call name="mantle.product.AssetServices.remove#OrderReservations" in-map="[orderId:orderId]"/></actions></service>