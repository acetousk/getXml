<!--Service Location coarchy.CoarchyServices.assign#AllTasks--><service verb="assign" noun="AllTasks"><in-parameters><parameter name="workEffortId" required="true"/><parameter name="actorId" required="true"/><parameter name="partyId" required="true"/><parameter name="organizationId" required="true"/></in-parameters><out-parameters><parameter name="workEffortId"/><parameter name="returnToScreen"/></out-parameters><actions><entity-find entity-name="coarchy.WorkEffortActivityDetail" list="taskList" distinct="true"><date-filter/><econdition field-name="rootWorkEffortId" from="workEffortId"/><econdition field-name="workEffortTypeEnumId" value="WetChecklistItem"/><econdition field-name="workEffortTypeEnumId" value="WetChecklistItem"/><econdition field-name="actorId"/><econdition field-name="roleTypeId" operator="is-null"/><econdition field-name="resolutionEnumId" operator="is-null"/><select-field field-name="workEffortId"/><order-by field-name="workEffortId"/></entity-find><if condition="!taskList"><return type="warning" message="No tasks found"/></if><iterate list="taskList" entry="task"><service-call name="coarchy.CoarchyServices.update#Task" in-map="[workEffortId:task.workEffortId,assignedPartyIdList:[partyId],organizationId:organizationId]"/></iterate><entity-find-count entity-name="WorkEffort" count-field="workEffortCount" distinct="true"><econdition field-name="rootWorkEffortId" from="workEffortId"/><econdition field-name="workEffortTypeEnumId" value="WetChecklistItem"/><select-field field-name="workEffortId"/></entity-find-count><entity-find-count entity-name="WorkEffortAndParty" count-field="workEffortPartyCount" distinct="true"><date-filter/><econdition field-name="rootWorkEffortId" from="workEffortId"/><econdition field-name="roleTypeId" value="Assignee"/><select-field field-name="workEffortId,roleTypeId"/></entity-find-count><set field="returnToScreen" from="workEffortCount==workEffortPartyCount"/></actions></service>