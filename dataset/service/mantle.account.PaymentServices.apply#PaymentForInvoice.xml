<!--Service Location mantle.account.PaymentServices.apply#PaymentForInvoice--><service verb="apply" noun="PaymentForInvoice"><in-parameters><parameter name="paymentId" required="true"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.account.payment.Payment" value-field="payment"/><if condition="payment.forInvoiceId && payment.statusId in ['PmntDelivered', 'PmntConfirmed'] &&                     (payment.unappliedTotal == null || payment.unappliedTotal > 0.0)"><service-call name="mantle.account.PaymentServices.apply#InvoicePayment" out-map="[paymentApplicationId:context.paymentApplicationId,amountApplied:context.amountApplied]" in-map="[paymentId:paymentId, invoiceId:payment.forInvoiceId]"/></if></actions></service>