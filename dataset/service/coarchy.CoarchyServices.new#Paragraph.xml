<!--Service Location coarchy.CoarchyServices.new#Paragraph--><service verb="new" noun="Paragraph"><in-parameters><parameter name="processStoryId" required="true"/><parameter name="organizationId" required="true"/><parameter name="insertSequenceNum" required="true"/></in-parameters><out-parameters><parameter name="newActivity" type="Map"/><parameter name="processStoryActivityId"/></out-parameters><actions><service-call name="create#coarchy.Activity" in-map="[organizationId:organizationId]" out-map="[activityId:newActivity.activityId,condition:newActivity.condition,action:newActivity.action,replacedByActivityId:newActivity.replacedByActivityId,implementationId:newActivity.implementationId,organizationId:newActivity.organizationId,lastUpdatedStamp:newActivity.lastUpdatedStamp]"/><entity-find entity-name="coarchy.ProcessStoryActivity" limit="1" list="processStoryInitialActivityList"><date-filter/><econdition field-name="processStoryId"/><econdition field-name="sequenceNum" from="insertSequenceNum.toInteger()"/><order-by field-name="-sequenceNum"/></entity-find><if condition="processStoryInitialActivityList?.size() > 0"><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="processStoryActivityList"><date-filter/><econdition field-name="replacedByActivityId" operator="is-null"/><econdition field-name="sequenceNum" operator="greater-equals" from="insertSequenceNum.toInteger()"/><select-field field-name="processStoryActivityId,sequenceNum"/><order-by field-name="-sequenceNum"/></entity-find><iterate list="processStoryActivityList" entry="processStoryActivity"><service-call name="update#coarchy.ProcessStoryActivity" in-map="[processStoryActivityId:processStoryActivity.processStoryActivityId,sequenceNum:processStoryActivity.sequenceNum+1]" out-map="[processStoryActivityId:context.processStoryActivityId,processStoryId:context.processStoryId,activityId:context.activityId,sequenceNum:context.sequenceNum,detailProcessStoryId:context.detailProcessStoryId,fromDate:context.fromDate,thruDate:context.thruDate,organizationId:context.organizationId,lastUpdatedStamp:context.lastUpdatedStamp]"/></iterate></if><service-call name="create#coarchy.ProcessStoryActivity" in-map="[processStoryId:processStoryId,activityId:newActivity.activityId, sequenceNum:insertSequenceNum, organizationId:organizationId]" out-map="[processStoryActivityId:context.processStoryActivityId,processStoryId:context.processStoryId,activityId:context.activityId,sequenceNum:context.sequenceNum,detailProcessStoryId:context.detailProcessStoryId,fromDate:context.fromDate,thruDate:context.thruDate,organizationId:context.organizationId,lastUpdatedStamp:context.lastUpdatedStamp]"/></actions></service>