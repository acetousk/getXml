<!--Service Location mantle.account.PaymentServices.get#PaymentTotals--><service verb="get" noun="PaymentTotals"><in-parameters><parameter name="paymentId"/></in-parameters><out-parameters><parameter name="paymentTotal" type="BigDecimal"/><parameter name="appliedTotal" type="BigDecimal"/><parameter name="unappliedTotal" type="BigDecimal"/></out-parameters><actions><entity-find-one entity-name="mantle.account.payment.Payment" value-field="payment"/><set field="paymentTotal" from="payment.amount ?: 0.0"/><entity-find entity-name="mantle.account.payment.PaymentApplication" list="paymentApplicationList"><econditions combine="or"><econdition field-name="paymentId"/><econdition field-name="toPaymentId" from="paymentId"/></econditions></entity-find><set field="appliedTotal" from="0.0"/><iterate list="paymentApplicationList" entry="paymentApplication"><set field="appliedTotal" from="appliedTotal + paymentApplication.amountApplied"/></iterate><set field="unappliedTotal" from="paymentTotal - appliedTotal"/></actions></service>