<!--Service Location mantle.ledger.AssetAutoPostServices.calculateAndPost#AllFixedAssetDepreciations--><service verb="calculateAndPost" noun="AllFixedAssetDepreciations"><in-parameters><parameter name="timePeriodId" required="true"><description><![CDATA[Should be a Fiscal Month period]]></description></parameter><parameter name="transactionDate" type="Timestamp"><description><![CDATA[If not specified defaults to TimePeriod.thruDate]]></description></parameter></in-parameters><out-parameters><parameter name="transactionDate" type="Timestamp"/></out-parameters><actions><entity-find-one entity-name="mantle.party.time.TimePeriod" value-field="timePeriod"/><if condition="timePeriod.timePeriodTypeId != 'FiscalMonth'"><return error="true" message="Can only post fixed asset depreciation to Fiscal Month periods"/></if><if condition="!transactionDate"><set field="transactionDate" from="new Timestamp(timePeriod.thruDate.time - 1)"/></if><service-call name="mantle.ledger.LedgerServices.expand#ChildOrganizationList" out-map="[orgPartyIdList:expandResult.orgPartyIdList]" in-map="[organizationPartyId:timePeriod.partyId, onlyWithNoAcctgPreference:true]"/><set field="orgPartyIdList" from="expandResult.orgPartyIdList"/><if condition="!orgPartyIdList.contains(timePeriod.partyId)"><script><![CDATA[orgPartyIdList.add(timePeriod.partyId)]]></script></if><entity-find entity-name="mantle.product.asset.Asset" list="assetList"><econdition field-name="ownerPartyId" operator="in" from="expandResult.orgPartyIdList"/><econdition field-name="depreciationTypeEnumId" operator="not-equals" from="null"/><order-by field-name="assetId"/></entity-find><log level="info" message="Calculating and posting depreciation for organizations: ${expandResult.orgPartyIdList}, assets: ${assetList.assetId}"/><iterate list="assetList" entry="asset"><service-call name="mantle.ledger.AssetAutoPostServices.calculateAndPost#FixedAssetDepreciation" in-map="[assetId:asset.assetId, timePeriodId:timePeriodId, transactionDate:transactionDate]"/></iterate></actions></service>