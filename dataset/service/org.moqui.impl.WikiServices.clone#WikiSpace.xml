<!--Service Location org.moqui.impl.WikiServices.clone#WikiSpace--><service verb="clone" noun="WikiSpace"><in-parameters><parameter name="baseWikiSpaceId" required="true"/><parameter name="wikiSpaceId" required="true" entity-name="moqui.resource.wiki.WikiSpace" field-name="wikiSpaceId"><matches regexp="[A-Za-z]\w*" message="ID must start with a letter and contain only letters, digits, or underscore"/><text-length min="3" max="8"/></parameter><parameter name="rootPageDirectory" default-value="dbresource://WikiSpace"/><parameter name="rootPageLocation" entity-name="moqui.resource.wiki.WikiSpace" field-name="rootPageLocation"/><parameter name="description" entity-name="moqui.resource.wiki.WikiSpace" field-name="description"/><parameter name="copyAttachments" type="Boolean" default="true"/><parameter name="publishNew" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="wikiSpaceId" entity-name="moqui.resource.wiki.WikiSpace" field-name="wikiSpaceId"/></out-parameters><actions><entity-find-one entity-name="moqui.resource.wiki.WikiSpace" value-field="checkWikiSpace" cache="false"><field-map field-name="wikiSpaceId" from="wikiSpaceId"/></entity-find-one><if condition="checkWikiSpace != null"><return error="true" message="Wiki Space with ID ${wikiSpaceId} already exists"/></if><entity-find-one entity-name="moqui.resource.wiki.WikiSpace" value-field="baseWikiSpace" cache="false"><field-map field-name="wikiSpaceId" from="baseWikiSpaceId"/></entity-find-one><if condition="baseWikiSpace == null"><return error="true" message="Base Wiki Space with ID ${wikiSpaceId} not found"/></if><service-call name="org.moqui.impl.WikiServices.get#WikiPageInfo" out-map="[wikiSpaceId:baseRootPageInfo.wikiSpaceId,pagePath:baseRootPageInfo.pagePath,wikiPageId:baseRootPageInfo.wikiPageId,wikiSpace:baseRootPageInfo.wikiSpace,wikiPage:baseRootPageInfo.wikiPage,rootPageLocation:baseRootPageInfo.rootPageLocation,rootPageRef:baseRootPageInfo.rootPageRef,spaceRootName:baseRootPageInfo.spaceRootName,pageReference:baseRootPageInfo.pageReference,wikiType:baseRootPageInfo.wikiType,versionName:baseRootPageInfo.versionName,currentVersionName:baseRootPageInfo.currentVersionName,publishedVersionName:baseRootPageInfo.publishedVersionName,attachmentList:baseRootPageInfo.attachmentList,pageLocation:baseRootPageInfo.pageLocation,pageName:baseRootPageInfo.pageName,parentPath:baseRootPageInfo.parentPath,breadcrumbNameList:baseRootPageInfo.breadcrumbNameList,breadcrumbMapList:baseRootPageInfo.breadcrumbMapList]" in-map="[wikiSpaceId:baseWikiSpaceId, pagePath:null]"/><if condition="!rootPageLocation"><set field="rootPageLocation" value="${rootPageDirectory}/${wikiSpaceId}.${baseRootPageInfo.wikiType}"/></if><set field="rootPageReference" from="ec.resource.getLocationReference(rootPageLocation)"/><if condition="!rootPageReference.exists"><script><![CDATA[rootPageReference.putText(baseRootPageInfo.pageReference.getText())]]></script></if><set field="wikiSpace" from="baseWikiSpace.cloneValue()"/><set field="wikiSpace.wikiSpaceId" from="wikiSpaceId"/><set field="wikiSpace.rootPageLocation" from="rootPageLocation"/><if condition="description"><set field="wikiSpace.description" from="description"/></if><entity-create value-field="wikiSpace"/><entity-find entity-name="moqui.resource.wiki.WikiSpaceUser" list="baseWikiSpaceUserList"><econdition field-name="wikiSpaceId" from="baseWikiSpaceId"/></entity-find><iterate list="baseWikiSpaceUserList" entry="baseWikiSpaceUser"><set field="wikiSpaceUser" from="baseWikiSpaceUser.cloneValue()"/><set field="wikiSpaceUser.wikiSpaceId" from="wikiSpaceId"/><entity-create value-field="wikiSpaceUser"/></iterate><service-call name="org.moqui.impl.WikiServices.clone#WikiPage" out-map="[basePageInfo:cloneRootOut.basePageInfo,wikiPageId:cloneRootOut.wikiPageId,pagePath:cloneRootOut.pagePath]" in-map="[baseWikiSpaceId:baseWikiSpaceId, wikiSpaceId:wikiSpaceId, pagePath:null,                             copyAttachments:copyAttachments, publishNew:publishNew]"/><set field="baseRootPageRef" from="ec.resource.getLocationReference(baseWikiSpace.rootPageLocation)"/><set field="baseRootPageDirRef" from="baseRootPageRef.findMatchingDirectory()"/><set field="allChildFileFlatList" from="new ArrayList()"/><script><![CDATA[baseRootPageDirRef.walkChildTree(allChildFileFlatList, null)]]></script><iterate list="allChildFileFlatList" entry="pageInfo"><service-call name="org.moqui.impl.WikiServices.clone#WikiPage" in-map="[baseWikiSpaceId:baseWikiSpaceId, wikiSpaceId:wikiSpaceId, pagePath:pageInfo.path,                             copyAttachments:copyAttachments, publishNew:publishNew]"/></iterate></actions></service>