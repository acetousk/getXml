<!--Service Location org.moqui.search.SearchServices.index#WikiSpacePages--><service verb="index" noun="WikiSpacePages"><in-parameters><parameter name="wikiSpaceId"/><parameter name="dataDocumentId" required="true"/><parameter name="clusterName" default-value="default"/></in-parameters><out-parameters/><actions><service-call name="org.moqui.impl.WikiServices.get#WikiSpacePages" in-map="[wikiSpaceId:wikiSpaceId]" out-map="[allChildFileFlatList:context.allChildFileFlatList,rootChildResourceList:context.rootChildResourceList]"/><set field="recordsCreated" from="0"/><set field="documentList" from="[]"/><iterate list="allChildFileFlatList" entry="allChildFileFlat"><service-call name="org.moqui.impl.WikiServices.get#WikiPageId" out-map="[wikiPageId:getWpiResult.wikiPageId,wikiPage:getWpiResult.wikiPage,createdRecord:getWpiResult.createdRecord]" in-map="[wikiSpaceId:wikiSpaceId, pagePath:allChildFileFlat.path, createIfMissing:true]"/><if condition="getWpiResult.createdRecord"><set field="recordsCreated" from="recordsCreated + 1"/></if><script><![CDATA[documentList.addAll(ec.entity.getDataDocuments(dataDocumentId,
                        ec.entity.conditionFactory.makeCondition([wikiPageId:getWpiResult.wikiPageId]), null, null))]]></script></iterate><script><![CDATA[ec.service.sync().name("org.moqui.search.SearchServices.index#DataDocuments").parameter("documentList", documentList).parameter("clusterName", clusterName).call()]]></script><message><![CDATA[Found and indexed ${allChildFileFlatList.size()} pages in Wiki Space ${wikiSpaceId}, created DB records for ${recordsCreated}.]]></message></actions></service>