<!--Service Location coarchy.CoarchyServices.delete#Activity--><service verb="delete" noun="Activity"><in-parameters><parameter name="activityId" required="true" entity-name="coarchy.Activity" field-name="activityId"/><parameter name="processStoryActivityId"/><parameter name="actorIdList" type="List"/><parameter name="pageIndex"/></in-parameters><out-parameters><parameter name="pageIndex"/><parameter name="activityId" entity-name="coarchy.Activity" field-name="activityId"/></out-parameters><actions><if condition="!processStoryActivityId"><entity-find entity-name="coarchy.ProcessStoryActivity" list="activityList"><date-filter/><econdition field-name="activityId"/></entity-find><if condition="activityList.size() == 0"><return type="danger" error="true" message="${ec.resource.expand('CoarchyProcessActivityNotFound', null)}"/></if><if condition="activityList.size() > 1"><return type="info" message="${ec.resource.expand('CoarchyProcessActivityMultiFound', null)}"/></if><set field="processStoryActivityId" from="activityList.getFirst().processStoryActivityId"/></if><entity-find entity-name="coarchy.product.ProductEvaluationActivityAndDetail" list="existingEvaluationRecords"><econdition field-name="statusId" operator="not-equals" value="PeRequirementsSelection"/><econdition field-name="activityId"/></entity-find><if condition="!existingEvaluationRecords"><entity-find entity-name="coarchy.product.ProductEvaluationActivityAndDetail" list="openEvaluationRecords"><econdition field-name="statusId" value="PeRequirementsSelection"/><econdition field-name="activityId"/></entity-find><iterate list="openEvaluationRecords" entry="openEvaluationRecord"><service-call name="delete#coarchy.product.ProductEvaluationActivity" in-map="[productEvaluationId:openEvaluationRecord.productEvaluationId, processStoryId:openEvaluationRecord.processStoryId, activityId:openEvaluationRecord.activityId]"/></iterate><entity-find entity-name="coarchy.ValueStatementActivity" list="statementList"><date-filter/><econdition field-name="activityId" from="activityId"/></entity-find><set field="statementActivityIdList" from="statementList*.valueStatementActivityId"/><iterate list="statementActivityIdList" entry="valueStatementActivityId"><service-call name="update#coarchy.ValueStatementActivity" in-map="[valueStatementActivityId:valueStatementActivityId, thruDate:ec.user.nowTimestamp]"/></iterate><service-call name="update#coarchy.ProcessStoryActivity" in-map="[processStoryActivityId:processStoryActivityId,thruDate:ec.user.nowTimestamp]"/><else><service-call name="update#coarchy.ProcessStoryActivity" in-map="[processStoryActivityId:processStoryActivityId, thruDate:ec.user.nowTimestamp]"/><entity-find entity-name="coarchy.ValueStatementActivity" list="statementList"><date-filter/><econdition field-name="activityId" from="activityId"/></entity-find><set field="statementActivityIdList" from="statementList*.valueStatementActivityId"/><iterate list="statementActivityIdList" entry="valueStatementActivityId"><service-call name="update#coarchy.ValueStatementActivity" in-map="[valueStatementActivityId:valueStatementActivityId, thruDate:ec.user.nowTimestamp]"/></iterate></else></if></actions></service>