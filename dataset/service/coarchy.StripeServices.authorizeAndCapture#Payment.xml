<!--Service Location coarchy.StripeServices.authorizeAndCapture#Payment--><service verb="authorizeAndCapture" noun="Payment"><in-parameters><parameter name="paymentId" required="true" entity-name="mantle.account.payment.Payment" field-name="paymentId"/><parameter name="paymentGatewayConfigId" required="true" entity-name="mantle.account.payment.Payment" field-name="paymentGatewayConfigId"/><parameter name="cardSecurityCode"/></in-parameters><out-parameters><parameter name="paymentGatewayResponseId"/></out-parameters><actions><entity-find entity-name="mantle.account.method.PaymentGatewayResponse" list="paymentGatewayResponseList"><econdition field-name="paymentId"/><econdition field-name="paymentGatewayConfigId"/><econdition field-name="paymentOperationEnumId" value="PgoAuthAndCapture"/><order-by field-name="-transactionDate"/></entity-find><if condition="paymentGatewayResponseList.size() == 0"><return error="true" type="danger" message="No payment gateway response found for payment."/></if><if condition="paymentGatewayResponseList.size() > 1"><log level="warn" message="Multiple payment gateway responses found for payment."/></if><set field="paymentGatewayResponseId" from="paymentGatewayResponseList.getFirst().paymentGatewayResponseId"/></actions></service>