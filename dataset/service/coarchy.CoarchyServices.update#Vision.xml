<!--Service Location coarchy.CoarchyServices.update#Vision--><service verb="update" noun="Vision"><in-parameters><parameter name="partyId" required="true"/><parameter name="originStoryDescription"/><parameter name="missionDescription"/><parameter name="visionDescription"/></in-parameters><out-parameters><parameter name="partyId"/><parameter name="originStoryContentId"/><parameter name="missionContentId"/><parameter name="visionContentId"/></out-parameters><actions><set field="originStoryDescription" from="originStoryDescription.trim()"/><set field="missionDescription" from="missionDescription.trim()"/><set field="visionDescription" from="visionDescription.trim()"/><entity-find entity-name="mantle.party.PartyContent" list="originStoryList" limit="1"><econdition field-name="partyId"/><econdition field-name="partyContentTypeEnumId" value="PcntOriginStory"/><order-by field-name="-contentDate"/></entity-find><if condition="originStoryList.size() == 0"><then><service-call name="create#mantle.party.PartyContent" out-map="[partyContentId:originStoryContent.partyContentId,partyId:originStoryContent.partyId,contentLocation:originStoryContent.contentLocation,partyContentTypeEnumId:originStoryContent.partyContentTypeEnumId,description:originStoryContent.description,contentDate:originStoryContent.contentDate,viewedDate:originStoryContent.viewedDate,userId:originStoryContent.userId,partyIdTypeEnumId:originStoryContent.partyIdTypeEnumId,originalPartyContentId:originStoryContent.originalPartyContentId,lastUpdatedStamp:originStoryContent.lastUpdatedStamp]" in-map="[partyId:partyId,partyContentTypeEnumId:'PcntOriginStory',description:originStoryDescription]"/><set field="originStoryContentId" from="originStoryContent.partyContentId"/></then><else><set field="originStoryContentId" from="originStoryList.getFirst().partyContentId"/><service-call name="update#mantle.party.PartyContent" out-map="[partyContentId:originStoryContent.partyContentId,partyId:originStoryContent.partyId,contentLocation:originStoryContent.contentLocation,partyContentTypeEnumId:originStoryContent.partyContentTypeEnumId,description:originStoryContent.description,contentDate:originStoryContent.contentDate,viewedDate:originStoryContent.viewedDate,userId:originStoryContent.userId,partyIdTypeEnumId:originStoryContent.partyIdTypeEnumId,originalPartyContentId:originStoryContent.originalPartyContentId,lastUpdatedStamp:originStoryContent.lastUpdatedStamp]" in-map="[partyContentId:originStoryContentId,description:originStoryDescription]"/></else></if><entity-find entity-name="mantle.party.PartyContent" list="missionList" limit="1"><econdition field-name="partyId"/><econdition field-name="partyContentTypeEnumId" value="PcntMission"/><order-by field-name="-contentDate"/></entity-find><if condition="missionList.size() == 0"><then><service-call name="create#mantle.party.PartyContent" out-map="[partyContentId:missionContent.partyContentId,partyId:missionContent.partyId,contentLocation:missionContent.contentLocation,partyContentTypeEnumId:missionContent.partyContentTypeEnumId,description:missionContent.description,contentDate:missionContent.contentDate,viewedDate:missionContent.viewedDate,userId:missionContent.userId,partyIdTypeEnumId:missionContent.partyIdTypeEnumId,originalPartyContentId:missionContent.originalPartyContentId,lastUpdatedStamp:missionContent.lastUpdatedStamp]" in-map="[partyId:partyId,partyContentTypeEnumId:'PcntMission',description:missionDescription]"/><set field="missionContentId" from="missionContent.partyContentId"/></then><else><set field="missionContentId" from="missionList.getFirst().partyContentId"/><service-call name="update#mantle.party.PartyContent" out-map="[partyContentId:missionContent.partyContentId,partyId:missionContent.partyId,contentLocation:missionContent.contentLocation,partyContentTypeEnumId:missionContent.partyContentTypeEnumId,description:missionContent.description,contentDate:missionContent.contentDate,viewedDate:missionContent.viewedDate,userId:missionContent.userId,partyIdTypeEnumId:missionContent.partyIdTypeEnumId,originalPartyContentId:missionContent.originalPartyContentId,lastUpdatedStamp:missionContent.lastUpdatedStamp]" in-map="[partyContentId:missionContentId,description:missionDescription]"/></else></if><entity-find entity-name="mantle.party.PartyContent" list="visionList" limit="1"><econdition field-name="partyId"/><econdition field-name="partyContentTypeEnumId" value="PcntVision"/><order-by field-name="-contentDate"/></entity-find><if condition="visionList.size() == 0"><then><service-call name="create#mantle.party.PartyContent" out-map="[partyContentId:visionContent.partyContentId,partyId:visionContent.partyId,contentLocation:visionContent.contentLocation,partyContentTypeEnumId:visionContent.partyContentTypeEnumId,description:visionContent.description,contentDate:visionContent.contentDate,viewedDate:visionContent.viewedDate,userId:visionContent.userId,partyIdTypeEnumId:visionContent.partyIdTypeEnumId,originalPartyContentId:visionContent.originalPartyContentId,lastUpdatedStamp:visionContent.lastUpdatedStamp]" in-map="[partyId:partyId,partyContentTypeEnumId:'PcntVision',description:visionDescription]"/><set field="visionContentId" from="visionContent.partyContentId"/></then><else><set field="visionContentId" from="visionList.getFirst().partyContentId"/><service-call name="update#mantle.party.PartyContent" out-map="[partyContentId:visionContent.partyContentId,partyId:visionContent.partyId,contentLocation:visionContent.contentLocation,partyContentTypeEnumId:visionContent.partyContentTypeEnumId,description:visionContent.description,contentDate:visionContent.contentDate,viewedDate:visionContent.viewedDate,userId:visionContent.userId,partyIdTypeEnumId:visionContent.partyIdTypeEnumId,originalPartyContentId:visionContent.originalPartyContentId,lastUpdatedStamp:visionContent.lastUpdatedStamp]" in-map="[partyContentId:visionContentId,description:visionDescription]"/></else></if></actions></service>