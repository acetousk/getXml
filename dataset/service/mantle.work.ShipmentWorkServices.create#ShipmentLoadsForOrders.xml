<!--Service Location mantle.work.ShipmentWorkServices.create#ShipmentLoadsForOrders--><service verb="create" noun="ShipmentLoadsForOrders"><in-parameters><parameter name="facilityId" required="true"/><parameter name="workEffortName" required="true"/><parameter name="estimatedStartDate" type="Timestamp" default="ec.user.nowTimestamp"/><parameter name="allowBulkLocations" type="Boolean" default="true"/><parameter name="ordersPerPicklist" type="Long" required="true"/><parameter name="orderByField"/><parameter name="inputFieldsMap" type="Map" default="ec.web.requestParameters"/><parameter name="excludeOnPicklist"/><parameter name="excludeNotPickLoc"/><parameter name="onlyPartlyShipped"/></in-parameters><out-parameters><parameter name="picklistsCreated" type="Long"/><parameter name="workEffortIdList" type="List"><parameter name="workEffortId"/></parameter></out-parameters><actions><set field="excludeOnPicklist" from="excludeOnPicklist ?: inputFieldsMap.excludeOnPicklist ?: 'true'"/><set field="excludeNotPickLoc" from="excludeNotPickLoc ?: inputFieldsMap.excludeNotPickLoc ?: 'true'"/><set field="onlyPartlyShipped" from="onlyPartlyShipped ?: inputFieldsMap.onlyPartlyShipped ?: 'false'"/><entity-find entity-name="moqui.basic.EnumGroupMember" list="productItemTypeEgms" cache="true"><econdition field-name="enumGroupEnumId" value="EngItemsProduct"/></entity-find><set field="itemTypeEnumIdList" from="productItemTypeEgms*.enumId"/><service-call name="mantle.work.ShipmentWorkServices.make#ShipmentLoadOrderConditions" out-map="[excludeOnPicklistCond:context.excludeOnPicklistCond,inventoryCategoryCond:context.inventoryCategoryCond]" in-map="[excludeOnPicklist:excludeOnPicklist, inventoryCategoryId:inventoryCategoryId]"/><log message="excludeOnPicklistCond ${excludeOnPicklistCond} type ${excludeOnPicklistCond?.class?.name}"/><entity-find entity-name="mantle.order.OrderPartFindView" list="orderPartList" limit="500"><search-form-inputs default-order-by="${orderByField}" paginate="false" input-fields-map="inputFieldsMap" skip-fields="vendorRoleTypeId,customerRoleTypeId,customerClassificationId,itemTypeEnumId,orderType,facilityId,workEffortId"/><econdition field-name="partStatusId" value="OrderApproved"/><econdition field-name="vendorRoleTypeId" value="OrgInternal"/><econdition field-name="itemTypeEnumId" operator="in" from="itemTypeEnumIdList"/><econdition field-name="facilityId" ignore-if-empty="true"/><econdition field-name="customerClassificationId" from="inputFieldsMap.customerClassificationId" ignore-if-empty="true"/><date-filter from-field-name="customerClassFromDate" thru-field-name="customerClassThruDate" ignore="!inputFieldsMap.customerClassificationId"/><econdition field-name="productId" operator="in" from="inputFieldsMap.findProductId" ignore-if-empty="true"/><econdition field-name="quantity" operator="greater-equals" from="inputFieldsMap.findQuantity_from" ignore-if-empty="true"/><econdition field-name="quantity" operator="less-equals" from="inputFieldsMap.findQuantity_thru" ignore-if-empty="true"/><econdition field-name="locationTypeEnumId" value="FltPick"/><econdition-object field="excludeOnPicklistCond"/><econdition-object field="inventoryCategoryCond"/><having-econditions><econdition field-name="quantityTotal" to-field-name="resQuantity" ignore="excludeNotPickLoc == 'false'"/><econdition field-name="issuedQuantity" operator="greater" from="0.0" ignore="onlyPartlyShipped != 'true'"/></having-econditions><select-field field-name="orderId,orderPartSeqId,quantityTotal"/><select-field field-name="resQuantity${onlyPartlyShipped != 'true' ? '' : ',issuedQuantity'}"/></entity-find><set field="picklistsCreated" from="0"/><set field="workEffortIdList" from="[]"/><set field="curWorkEffortId" from="null"/><set field="curBinLocationNumber" from="1"/><iterate list="orderPartList" entry="orderPart"><if condition="!curWorkEffortId"><set field="picklistsCreated" from="picklistsCreated + 1"/><service-call name="mantle.work.ShipmentWorkServices.create#ShipmentLoadShip" out-map="[workEffortId:createShipLoadOut.workEffortId]" out-map-add-to-existing="false" in-map="[facilityId:facilityId, estimatedStartDate:estimatedStartDate, ownerPartyId:vendorPartyId,                                 productStoreId:productStoreId, workEffortName:(workEffortName + ' ' + picklistsCreated)]"/><set field="curWorkEffortId" from="createShipLoadOut.workEffortId"/><set field="curBinLocationNumber" from="1"/></if><service-call name="mantle.work.ShipmentWorkServices.add#OrderPartToShipmentLoad" in-map="[orderId:orderPart.orderId, orderPartSeqId:orderPart.orderPartSeqId, workEffortId:curWorkEffortId,                             binLocationNumber:curBinLocationNumber, allowBulkLocations:allowBulkLocations]"/><set field="curBinLocationNumber" from="curBinLocationNumber + 1"/><if condition="curBinLocationNumber > ordersPerPicklist"><set field="curWorkEffortId" from="null"/><set field="curBinLocationNumber" from="1"/></if></iterate><message type="success"><![CDATA[Created ${picklistsCreated} picklists for ${orderPartList.size()} orders]]></message></actions></service>