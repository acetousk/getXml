<!--Service Location XmlServices.get#AllScreenList--><service verb="get" noun="AllScreenList"><in-parameters><parameter name="filterScreenName"/><parameter name="outputFile" type="Boolean" required="true" default="false"/><parameter name="outputFilesToFolder" type="Boolean" required="true" default="false"/><parameter name="outputFolder" default-value="component://getXml/dataset/screen"/></in-parameters><out-parameters/><actions><script><![CDATA[import org.jsoup.Jsoup;
                import org.jsoup.nodes.Document;
                import org.jsoup.nodes.Element;
                import org.jsoup.select.Elements;]]></script><set field="rootScreenLocationList" from="ec.screen.getAllRootScreenLocations()"/><if condition="rootScreenLocationList.size() > 0"><service-call name="XmlServices.walk#ScreenTree" in-map="[screenNameList:[], rootScreenLocation:rootScreenLocationList[0]]" out-map="[screenNameList:context.screenNameList]"/></if><set field="screenNameList" from="screenNameList.unique()"/><log level="warn" message="screenNameList after: ${screenNameList.size()}"/><set field="screenList" from="[]"/><script><![CDATA[if (filterScreenName) {
                    Iterator theIterator = screenNameList.iterator()
                    while (theIterator.hasNext()) {
                        String curSn = (String) theIterator.next()
                        if (!curSn.toUpperCase().contains(filterScreenName.toUpperCase())) theIterator.remove()
                    }
                }]]></script><if condition="outputFilesToFolder"><set field="outputFolder" from="ec.resource.getLocationReference(outputFolder)"/></if><set field="outScreenXml" value=""/><iterate list="screenNameList" entry="inScreen"><set field="sd" from="ec.screen.getScreenDefinition(inScreen)"/><set field="screenNode" from="sd.screenNode"/><set field="xml" from="screenNode.toString()"/><script><![CDATA[xml = "<!-- Screen Location ${inScreen} -->" + xml
                    xml = xml
                            .replaceAll(">\\s+<", "><")
                            .trim();]]></script><if condition="outputFile"><script><![CDATA[xml+="\n<!-- Screen Location ${inScreen}  -->"]]></script><set field="outScreenXml" from="outScreenXml+xml"/></if><if condition="outputFilesToFolder"><script><![CDATA[outputFolder.makeFile(inScreen.replaceAll('/', '-')).putText(xml)]]></script></if><set field="screenList" from="screenList+[name:inScreen,prettyName:sd.defaultMenuName,xml:minified]"/></iterate><if condition="outputFile"><script><![CDATA[ec.resource.getLocationReference('component://getXml/dataset/allScreens.xml').putText(outScreenXml)]]></script><script><![CDATA[ec.resource.getLocationReference('component://getXml/dataset/allScreens.txt').putText(outScreenXml)]]></script></if></actions></service>