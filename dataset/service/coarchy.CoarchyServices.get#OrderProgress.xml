<!--Service Location coarchy.CoarchyServices.get#OrderProgress--><service verb="get" noun="OrderProgress"><in-parameters><parameter name="orderId" required="true"/></in-parameters><out-parameters><parameter name="statusId"/><parameter name="description"/></out-parameters><actions><entity-find entity-name="mantle.order.OrderHeaderAndPart" list="existingOrder1List" limit="1"><econdition field-name="orderId"/><econdition field-name="customerPartyId" from="ec.user.userAccount.partyId"/><select-field field-name="orderId,placedDate,completedDate,entryDate,statusId"/><order-by field-name="-entryDate"/></entity-find><set field="statusId" from="existingOrder1List.getFirst()?.statusId"/><if condition="statusId==null"><return type="danger" error="true" message="${ec.resource.expand('CoarchyInvalidOrder', null)}"/></if><entity-find-one entity-name="moqui.basic.StatusItem" value-field="status" auto-field-map="[statusTypeId:'OrderHeader',statusId:statusId]" cache="true"/><set field="description" from="status.description"/><if condition="statusId=='OrderCompleted' && ec.web.sessionAttributes?.checkoutOrganizationId"><set field="checkoutOrganizationId" from="ec.web.sessionAttributes.checkoutOrganizationId"/><script><![CDATA[ec.web.sessionAttributes.remove('checkoutOrganizationId');
                    ec.user.setPreference("ACTIVE_ORGANIZATION", checkoutOrganizationId);]]></script><set field="ec.user.context?.activeOrgId" from="checkoutOrganizationId"/><set field="ec.user.context?.filterOrgIds" from="[checkoutOrganizationId]"/><service-call name="coarchy.CoarchyServices.activateOrDeactivate#Organization" in-map="[organizationPartyId:checkoutOrganizationId]"/><entity-find-one entity-name="mantle.party.Organization" value-field="organization" auto-field-map="[partyId:checkoutOrganizationId]"/><message public="true"><![CDATA[${ec.resource.expand('CoarchyOrgActivateAutoPremium', null, [organizationName:organization.organizationName])}]]></message></if></actions></service>