<!--Service Location mantle.ledger.LedgerServices.post#GlJournal--><service verb="post" noun="GlJournal"><in-parameters><parameter name="glJournalId" required="true" entity-name="mantle.ledger.transaction.GlJournal" field-name="glJournalId"/><parameter name="closeJournal" type="Boolean" default="false"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.ledger.transaction.GlJournal" value-field="glJournal" for-update="true"/><entity-find entity-name="mantle.ledger.transaction.AcctgTrans" list="acctgTransList"><econdition field-name="glJournalId"/><order-by field-name="acctgTransId"/></entity-find><set field="txPostCount" from="0"/><iterate list="acctgTransList" entry="acctgTrans"><service-call name="mantle.ledger.LedgerServices.post#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/><if condition="ec.message.hasError()"><then><return error="true"/></then><else><set field="txPostCount" from="txPostCount + 1"/></else></if></iterate><message><![CDATA[Posted ${txPostCount} transactions]]></message><if condition="closeJournal"><set field="glJournal.isPosted" value="Y"/><set field="glJournal.postedDate" from="ec.user.nowTimestamp"/><entity-update value-field="glJournal"/></if></actions></service>