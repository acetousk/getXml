<!--Service Location org.moqui.impl.WikiServices.get#WikiPageReference--><service verb="get" noun="WikiPageReference"><in-parameters><parameter name="wikiSpaceId"/><parameter name="pagePath"/><parameter name="wikiPageId"/><parameter name="extraPathNameList" type="List"/></in-parameters><out-parameters><parameter name="wikiSpaceId"/><parameter name="pagePath"/><parameter name="wikiPageId"/><parameter name="wikiSpace" type="org.moqui.entity.EntityValue"/><parameter name="wikiPage" type="org.moqui.entity.EntityValue"/><parameter name="rootPageLocation"/><parameter name="rootPageRef" type="org.moqui.resource.ResourceReference"/><parameter name="spaceRootName"/><parameter name="pageReference" type="org.moqui.resource.ResourceReference"/></out-parameters><actions><if condition="wikiPageId"><entity-find-one entity-name="moqui.resource.wiki.WikiPage" value-field="wikiPage" cache="true"/><set field="wikiSpaceId" from="wikiPage.wikiSpaceId"/><set field="pagePath" from="wikiPage.pagePath"/></if><if condition="extraPathNameList"><set field="wikiSpaceId" from="wikiSpaceId ?: extraPathNameList[0]"/><if condition="!pagePath && extraPathNameList.size > 1"><iterate list="extraPathNameList[1..extraPathNameList.size-1]" entry="pathName"><if condition="pagePath"><set field="pagePath" from="pagePath + '/'"/></if><set field="pagePath" from="(pagePath?:'') + pathName"/></iterate></if></if><if condition="!wikiSpaceId"><return error="true" message="Cannot get wiki page info without wikiSpaceId parameter or URL path element"/></if><entity-find-one entity-name="moqui.resource.wiki.WikiSpace" value-field="wikiSpace" cache="true"/><if condition="wikiSpace == null"><return error="true" message="Wiki Space with ID ${wikiSpaceId} not found"/></if><if condition="!wikiSpace.rootPageLocation"><return error="true" message="Wiki Space with ID ${wikiSpaceId} has no root page location"/></if><set field="rootPageLocation" from="wikiSpace.rootPageLocation"/><set field="spaceRootName" from="rootPageLocation.substring(rootPageLocation.lastIndexOf('/')+1)"/><if condition="spaceRootName.contains('.')"><set field="spaceRootName" from="spaceRootName.substring(0, spaceRootName.lastIndexOf('.'))"/></if><if condition="wikiPage == null"><service-call name="org.moqui.impl.WikiServices.get#WikiPageId" in-map="context" out-map="[wikiPageId:context.wikiPageId,wikiPage:context.wikiPage,createdRecord:context.createdRecord]"/></if><set field="rootPageRef" from="ec.resource.getLocationReference(wikiSpace.rootPageLocation)"/><set field="pageReference" from="rootPageRef.findChildFile(pagePath)"/></actions></service>