<!--Service Location mantle.work.TimeServices.store#WorkEffortPartyTime--><service verb="store" noun="WorkEffortPartyTime"><in-parameters><parameter name="timeEntryId"><description><![CDATA[If specified updates, if not creates]]></description></parameter><parameter name="childTimeEntryId"/><parameter name="parentEntryId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="parentEntryId"/><parameter name="timesheetId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="timesheetId"/><parameter name="partyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="partyId"><description><![CDATA[For convenience (for multi forms with some rows blank) not set as
                required, but if not passed no TimeEntry will be created.]]></description></parameter><parameter name="teamPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="teamPartyId"/><parameter name="vendorPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="vendorPartyId"/><parameter name="clientPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="clientPartyId"/><parameter name="rateTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="rateTypeEnumId"/><parameter name="rateModifierEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="rateModifierEnumId"/><parameter name="workTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="workTypeEnumId"/><parameter name="emplPositionClassId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="emplPositionClassId"/><parameter name="hasModifiedRates" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="hasModifiedRates"/><parameter name="rateAmountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="rateAmountId"/><parameter name="clientHourRate" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="clientHourRate"/><parameter name="vendorRateAmountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="vendorRateAmountId"/><parameter name="vendorHourRate" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="vendorHourRate"/><parameter name="fromDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="fromDate"/><parameter name="thruDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="thruDate"/><parameter name="hours" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="hours"/><parameter name="breakHours" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="breakHours"/><parameter name="pieceCount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="pieceCount"/><parameter name="pieceRateTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="pieceRateTypeEnumId"/><parameter name="pieceRateAmountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="pieceRateAmountId"/><parameter name="clientPieceRate" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="clientPieceRate"/><parameter name="vendorPieceRateAmountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="vendorPieceRateAmountId"/><parameter name="vendorPieceRate" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="vendorPieceRate"/><parameter name="comments" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="comments"/><parameter name="facilityId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="facilityId"/><parameter name="workEffortId" type="java.lang.String" required="true" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="workEffortId"/><parameter name="invoiceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="invoiceId"/><parameter name="invoiceItemSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="invoiceItemSeqId"/><parameter name="vendorInvoiceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="vendorInvoiceId"/><parameter name="vendorInvoiceItemSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="vendorInvoiceItemSeqId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.work.time.TimeEntry" field-name="lastUpdatedStamp"/><parameter name="moveToTeam"><description><![CDATA[If Y and a teamPartyId is specified add partyId Party to the team and
                remove from all other teams]]></description></parameter><parameter name="paidBreakHours" type="BigDecimal"/></in-parameters><out-parameters><parameter name="workEffortId"/></out-parameters><actions><if condition="!partyId"><return/></if><entity-find-one entity-name="mantle.party.Party" value-field="party"/><if condition="party.disabled == 'Y'"><return error="true" message="Time Entry not created, ${party.pseudoId} is not active."/></if><entity-find-one entity-name="mantle.work.effort.WorkEffort" value-field="workEffort"/><if condition="workEffort.estimatedStartDate > fromDate"><return error="true" message="Task start date outside of project's start date."/></if><if condition="workEffort.estimatedCompletionDate && fromDate && workEffort.estimatedCompletionDate < fromDate"><return error="true" message="Task end date out side of project's end date."/></if><if condition="workEffort.workEffortTypeEnumId != 'WetProject'"><set field="facilityId" from="null"/></if><entity-find entity-name="mantle.work.effort.WorkEffortParty" list="wepList"><econdition field-name="workEffortId"/><econdition field-name="partyId"/><order-by field-name="-fromDate"/></entity-find><if condition="wepList"><set field="workEffortParty" from="wepList[0]"/></if><if condition="!workTypeEnumId"><set field="workTypeEnumId" from="workEffortParty?.workTypeEnumId ?: workEffort.workTypeEnumId"/></if><if condition="!fromDate"><set field="fromDate" from="workEffort.actualStartDate ?: workEffort.estimatedStartDate"/></if><if condition="!hours && hours != 0"><set field="hours" from="workEffort.actualWorkDuration"/></if><if condition="!breakHours && hours != 0"><set field="breakHours" from="workEffort.actualBreakDuration"/></if><if condition="!clientPartyId"><entity-find entity-name="mantle.work.effort.WorkEffortParty" list="clientWepList"><econdition field-name="workEffortId"/><econdition field-name="roleTypeId" operator="in" value="Customer,CustomerBillTo"/><order-by field-name="-fromDate"/></entity-find><if condition="clientWepList"><set field="clientPartyId" from="clientWepList[0].partyId"/></if></if><service-call name="mantle.work.TimeServices.store#TimeEntry" in-map="context" out-map="[timeEntryId:context.timeEntryId]"/><if condition="paidBreakHours"><then><service-call name="mantle.work.TimeServices.store#TimeEntry" in-map="context + [timeEntryId:childTimeEntryId,parentEntryId:timeEntryId,hours:paidBreakHours,breakHours:null,workTypeEnumId:'WktpPaidBreak']"/><entity-find-one entity-name="mantle.work.time.TimeEntry" value-field="timeEntry"><field-map field-name="timeEntryId"/></entity-find-one><service-call name="mantle.work.TimeServices.store#TimeEntry" in-map="context + [thruDate: new Timestamp((Long) (timeEntry.thruDate.time + (paidBreakHours*60*60*1000)))]" out-map="[timeEntryId:context.timeEntryId]"/></then></if><if condition="teamPartyId && moveToTeam == 'Y'"><set field="effectiveThruDate" from="workEffort.actualStartDate ?: ec.user.nowTimestamp"/><entity-find entity-name="mantle.party.PartyRelationship" list="existingRelList"><date-filter valid-date="effectiveThruDate"/><econdition field-name="relationshipTypeEnumId" value="PrtMember"/><econdition field-name="fromPartyId" from="partyId"/><econdition field-name="toRoleTypeId" value="OrgTeam"/></entity-find><iterate list="existingRelList" entry="existingRel"><set field="existingRel.thruDate" from="effectiveThruDate"/><entity-update value-field="existingRel"/></iterate><service-call name="create#mantle.party.PartyRelationship" in-map="[fromPartyId:partyId, fromRoleTypeId:'Worker',                         relationshipTypeEnumId:'PrtMember', toPartyId:teamPartyId, toRoleTypeId:'OrgTeam', fromDate:effectiveThruDate]"/></if></actions></service>