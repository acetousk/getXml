<!--Service Location mantle.order.ReturnServices.checkUpdate#ReturnHeaderStatus--><service verb="checkUpdate" noun="ReturnHeaderStatus"><in-parameters><parameter name="returnId" required="true"/><parameter name="statusId" required="true"/><parameter name="itemStatusIds" type="Collection" required="true"/></in-parameters><out-parameters><parameter name="oldStatusId"/><parameter name="statusChanged" type="Boolean"/></out-parameters><actions><set field="allMatch" from="true"/><entity-find entity-name="mantle.order.return.ReturnItem" list="returnItemList"><econdition field-name="returnId"/></entity-find><iterate list="returnItemList" entry="otherItem"><if condition="!(otherItem.statusId in itemStatusIds)"><set field="allMatch" from="false"/></if></iterate><if condition="allMatch"><entity-find-one entity-name="mantle.order.return.ReturnHeader" value-field="returnHeader"/><if condition="returnHeader.statusId == statusId"><return/></if><entity-find-one entity-name="moqui.basic.StatusItem" value-field="curStatusItem"><field-map field-name="statusId" from="returnHeader.statusId"/></entity-find-one><entity-find-one entity-name="moqui.basic.StatusItem" value-field="statusItem"><field-map field-name="statusId"/></entity-find-one><if condition="statusItem.sequenceNum < curStatusItem.sequenceNum"><return/></if><entity-find entity-name="moqui.basic.StatusFlowTransition" list="transitionList"><econdition field-name="statusId" from="returnHeader.statusId"/><econdition field-name="toStatusId" from="statusId"/></entity-find><if condition="transitionList.size() == 0"><log level="warn" message="In checkUpdate#ReturnHeaderStatus return ${returnId} tried to change from status ${returnHeader.statusId} to ${statusId} which has no transition, not updating ReturnHeader.statusId"/><return/></if><service-call name="update#mantle.order.return.ReturnHeader" out-map="[returnId:context.returnId,statusId:context.statusId,customerPartyId:context.customerPartyId,vendorPartyId:context.vendorPartyId,paymentMethodId:context.paymentMethodId,useSingleRefundPayment:context.useSingleRefundPayment,finAccountId:context.finAccountId,entryDate:context.entryDate,postalContactMechId:context.postalContactMechId,telecomContactMechId:context.telecomContactMechId,facilityId:context.facilityId,shipmentMethodEnumId:context.shipmentMethodEnumId,carrierPartyId:context.carrierPartyId,currencyUomId:context.currencyUomId,supplierRmaId:context.supplierRmaId,visitId:context.visitId,systemMessageRemoteId:context.systemMessageRemoteId,displayId:context.displayId,externalId:context.externalId,originId:context.originId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[returnId:returnId, statusId:statusId]"/></if></actions></service>