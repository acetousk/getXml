<!--Service Location mantle.work.ManufacturingServices.recreate#ConsumeProductsFromProduce--><service verb="recreate" noun="ConsumeProductsFromProduce"><in-parameters><parameter name="workEffortId" required="true"/></in-parameters><out-parameters/><actions><entity-delete-by-condition entity-name="mantle.work.effort.WorkEffortProduct"><econdition field-name="workEffortId"/><econdition field-name="typeEnumId" value="WeptConsume"/></entity-delete-by-condition><entity-find entity-name="mantle.work.effort.WorkEffortProductAssoc" list="produceBomAssocList"><date-filter/><date-filter from-field-name="componentFromDate" thru-field-name="componentThruDate"/><econdition field-name="workEffortId"/><econdition field-name="typeEnumId" value="WeptProduce"/></entity-find><entity-find entity-name="mantle.work.effort.WorkEffortProduct" list="produceWepList"><date-filter/><econdition field-name="workEffortId"/><econdition field-name="typeEnumId" value="WeptProduce"/></entity-find><set field="componentQtyById" from="[:]"/><iterate list="produceWepList" entry="produceWep"><filter-map-list list="produceBomAssocList" to-list="curBomAssocList"><field-map field-name="productId" from="produceWep.productId"/></filter-map-list><iterate list="curBomAssocList" entry="curBomAssoc"><set field="usedQuantity" from="(produceWep.estimatedQuantity ?: 0.0) * (curBomAssoc.componentQuantity ?: 1.0)"/><script><![CDATA[addToBigDecimalInMap(curBomAssoc.toProductId, usedQuantity, componentQtyById)]]></script></iterate></iterate><log level="warn" message="componentQtyById: ${componentQtyById}"/><iterate list="componentQtyById" key="componentProductId" entry="componentQty"><service-call name="create#mantle.work.effort.WorkEffortProduct" in-map="[workEffortId:workEffortId, productId:componentProductId, fromDate:new Timestamp(0),                             typeEnumId:'WeptConsume', statusId:'WepdCreated', estimatedQuantity:componentQty]"/></iterate></actions></service>