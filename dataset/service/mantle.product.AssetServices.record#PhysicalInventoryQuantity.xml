<!--Service Location mantle.product.AssetServices.record#PhysicalInventoryQuantity--><service verb="record" noun="PhysicalInventoryQuantity"><in-parameters><parameter name="parentAssetId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="parentAssetId"/><parameter name="assetTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="assetTypeEnumId"/><parameter name="statusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="statusId"/><parameter name="ownerPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="ownerPartyId"/><parameter name="assetPoolId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="assetPoolId"/><parameter name="productId" type="java.lang.String" required="true" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="productId"/><parameter name="originalQuantity" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="originalQuantity"/><parameter name="originalQuantityUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="originalQuantityUomId"/><parameter name="assetName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="assetName"/><parameter name="comments" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="comments"/><parameter name="serialNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="serialNumber"/><parameter name="softIdentifier" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="softIdentifier"/><parameter name="activationNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="activationNumber"/><parameter name="activationValidThru" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="activationValidThru"/><parameter name="manufacturedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="manufacturedDate"/><parameter name="expectedEndOfLife" type="java.sql.Date" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="expectedEndOfLife"/><parameter name="actualEndOfLife" type="java.sql.Date" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="actualEndOfLife"/><parameter name="capacity" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="capacity"/><parameter name="capacityUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="capacityUomId"/><parameter name="facilityId" type="java.lang.String" required="true" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="facilityId"/><parameter name="locationSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="locationSeqId"/><parameter name="containerId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="containerId"/><parameter name="shipmentBoxTypeId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="shipmentBoxTypeId"/><parameter name="lotId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="lotId"/><parameter name="geoPointId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="geoPointId"/><parameter name="originId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="originId"/><parameter name="originFacilityId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="originFacilityId"/><parameter name="acquireOrderId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="acquireOrderId"/><parameter name="acquireOrderItemSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="acquireOrderItemSeqId"/><parameter name="acquireWorkEffortId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="acquireWorkEffortId"/><parameter name="acquireShipmentId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="acquireShipmentId"/><parameter name="acquireCost" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="acquireCost"/><parameter name="acquireCostUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="acquireCostUomId"/><parameter name="salvageValue" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="salvageValue"/><parameter name="depreciation" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="depreciation"/><parameter name="depreciationTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="depreciationTypeEnumId"/><parameter name="yearBeginDepreciation" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="yearBeginDepreciation"/><parameter name="taxDepreciation" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="taxDepreciation"/><parameter name="taxDepreciationTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="taxDepreciationTypeEnumId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.product.asset.Asset" field-name="lastUpdatedStamp"/><parameter name="physicalInventoryId"/><parameter name="physicalInventoryCountId"/><parameter name="quantity" type="BigDecimal" required="true"/><parameter name="partyId" default="ec.user.userAccount?.partyId"/><parameter name="physicalInventoryDate" type="Timestamp" default="ec.user.nowTimestamp"/><parameter name="varianceReasonEnumId"/><parameter name="strictLocation" type="Boolean" default="false"><description><![CDATA[If true filter by null locationSeqId (No Location), otherwise for null locationSeqId do not filter (Any Location)]]></description></parameter><parameter name="strictLot" type="Boolean" default="false"><description><![CDATA[If true filter by null lotId (No Lot), otherwise for null lotId do not filter (Any Lot)]]></description></parameter><parameter name="strictAll" type="Boolean" default="false"><description><![CDATA[If true filter by null locationSeqId, lotId, ownerPartyId, assetPoolId, and statusId (No/None); otherwise for null do not filter (Any)]]></description></parameter></in-parameters><out-parameters><parameter name="physicalInventoryId"/><parameter name="quantityChange" type="BigDecimal"/></out-parameters><actions><if condition="physicalInventoryCountId"><service-call name="update#mantle.product.asset.PhysicalInventoryCount" in-map="[physicalInventoryCountId:physicalInventoryCountId, quantityOnHand:quantity]"/></if><set field="currentQoh" from="0"/><entity-find entity-name="mantle.product.asset.Asset" list="assetList"><econdition field-name="productId"/><econdition field-name="facilityId"/><econdition field-name="locationSeqId" from="locationSeqId ?: null" ignore="!locationSeqId && !strictLocation && !strictAll"/><econdition field-name="lotId" from="lotId ?: null" ignore="!lotId && !strictLot && !strictAll"/><econdition field-name="ownerPartyId" from="ownerPartyId ?: null" ignore="!ownerPartyId && !strictAll"/><econdition field-name="assetPoolId" from="assetPoolId ?: null" ignore="!assetPoolId && !strictAll"/><econdition field-name="statusId" from="statusId ?: null" ignore="!statusId && !strictAll"/><econdition field-name="receivedDate" operator="less-equals" from="physicalInventoryDate" or-null="true"/></entity-find><iterate list="assetList" entry="asset"><entity-find entity-name="mantle.product.asset.AssetDetailSummary" list="detailSummaryList"><econdition field-name="assetId" from="asset.assetId"/><econdition field-name="effectiveDate" operator="less-equals" from="physicalInventoryDate"/><select-field field-name="quantityOnHandTotal"/></entity-find><if condition="detailSummaryList.size() > 0"><set field="currentQoh" from="currentQoh + (detailSummaryList.get(0).quantityOnHandTotal ?: 0.0)"/></if></iterate><set field="quantityChange" from="quantity - currentQoh"/><if condition="quantityChange != 0.0"><then><message><![CDATA[Quantity specified (${ec.l10n.format(quantity, null)}) differs from current on hand (${ec.l10n.format(currentQoh, null)}) by ${ec.l10n.format(quantityChange, null)}, adjusting (Prod:${productId}, Fac:${facilityId}, Loc:${locationSeqId?:(strictAll||strictLocation?'None':'Any')}, Lot:${lotId?:(strictAll||strictLot?'None':'Any')}, Owner:${ownerPartyId?:(strictAll?'None':'Any')}, Pool:${assetPoolId?:(strictAll?'None':'Any')}, Stts:${statusId?:(strictAll?'None':'Any')})]]></message><service-call name="mantle.product.AssetServices.record#PhysicalInventoryChange" in-map="context"/></then><else><message type="success"><![CDATA[Quantity specified (${ec.l10n.format(quantity, null)}) matched current records, no adjustment needed]]></message></else></if></actions></service>