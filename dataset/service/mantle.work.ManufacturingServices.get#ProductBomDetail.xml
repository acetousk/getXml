<!--Service Location mantle.work.ManufacturingServices.get#ProductBomDetail--><service verb="get" noun="ProductBomDetail"><in-parameters><parameter name="productId" required="true"/><parameter name="produceQuantity" default="1.0" type="BigDecimal"/></in-parameters><out-parameters><parameter name="bomDetailList" type="List"><parameter name="bomDetailMap" type="Map"><parameter name="bomQuantity" type="BigDecimal"/><parameter name="productIdSet" type="Set"><parameter name="productId"/></parameter></parameter></parameter></out-parameters><actions><entity-find entity-name="mantle.product.ProductAssoc" list="bomAssocList" cache="true"><econdition field-name="productId"/><econdition field-name="productAssocTypeEnumId" value="PatMfgBom"/><order-by field-name="sequenceNum,toProductId"/></entity-find><set field="bomDetailList" from="[]"/><iterate list="bomAssocList" entry="bomAssoc"><set field="productIdSet" from="new HashSet([bomAssoc.toProductId])"/><entity-find entity-name="mantle.product.ProductAssoc" list="variantAssocList" cache="true"><econdition field-name="toProductId" from="bomAssoc.toProductId"/><econdition field-name="productAssocTypeEnumId" value="PatVariant"/><order-by field-name="sequenceNum,productId"/></entity-find><iterate list="variantAssocList" entry="variantAssoc"><script><![CDATA[productIdSet.add(variantAssoc.productId)]]></script></iterate><script><![CDATA[bomDetailList.add([bomQuantity:(bomAssoc.quantity ?: 1) * produceQuantity, productIdSet:productIdSet])]]></script></iterate><if condition="!bomDetailList"><entity-find entity-name="mantle.product.ProductAssoc" list="varAssocList" cache="true"><econdition field-name="toProductId" from="productId"/><econdition field-name="productAssocTypeEnumId" value="PatVariant"/><order-by field-name="sequenceNum,productId"/></entity-find><set field="bomDetailList" from="[]"/><iterate list="varAssocList" entry="varAssoc"><set field="productIdSet" from="new HashSet([varAssoc.productId])"/><script><![CDATA[bomDetailList.add([bomQuantity:1 * produceQuantity, productIdSet:productIdSet])]]></script></iterate></if></actions></service>