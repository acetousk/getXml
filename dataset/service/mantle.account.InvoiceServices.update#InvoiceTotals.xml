<!--Service Location mantle.account.InvoiceServices.update#InvoiceTotals--><service verb="update" noun="InvoiceTotals"><in-parameters><parameter name="invoiceId" required="true"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.account.invoice.Invoice" value-field="invoice"/><service-call name="mantle.account.InvoiceServices.get#InvoiceTotal" in-map="[invoiceId:invoiceId]" out-map="[invoiceTotal:totalOut.invoiceTotal,appliedPaymentsTotal:totalOut.appliedPaymentsTotal,unpaidTotal:totalOut.unpaidTotal]"/><set field="invoice.invoiceTotal" from="totalOut.invoiceTotal"/><set field="invoice.appliedPaymentsTotal" from="totalOut.appliedPaymentsTotal"/><set field="invoice.unpaidTotal" from="totalOut.unpaidTotal"/><entity-update value-field="invoice"/><if condition="invoice.statusId == 'InvoiceFinalized' || invoice.statusId == 'InvoiceApproved'"><if condition="totalOut.unpaidTotal == 0.0"><service-call name="update#mantle.account.invoice.Invoice" in-map="[invoiceId:invoiceId, statusId:(invoice.statusId == 'InvoiceFinalized' ? 'InvoicePmtRecvd' : 'InvoicePmtSent')]"/></if></if></actions></service>