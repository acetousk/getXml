<!--Service Location mantle.account.InvoiceServices.check#InvoicesPaid--><service verb="check" noun="InvoicesPaid"><in-parameters/><out-parameters/><actions><entity-find entity-name="mantle.account.invoice.Invoice" list="invoiceList"><econdition field-name="statusId" operator="in" value="InvoiceFinalized,InvoiceSent,InvoiceAcked"/></entity-find><set field="updatedCount" from="0"/><iterate list="invoiceList" entry="invoice"><if condition="invoice.unpaidTotal == null"><service-call name="mantle.account.InvoiceServices.get#InvoiceTotal" in-map="[invoiceId:invoice.invoiceId]" out-map="[invoiceTotal:totalOut.invoiceTotal,appliedPaymentsTotal:totalOut.appliedPaymentsTotal,unpaidTotal:totalOut.unpaidTotal]"/><set field="invoice.invoiceTotal" from="totalOut.invoiceTotal"/><set field="invoice.appliedPaymentsTotal" from="totalOut.appliedPaymentsTotal"/><set field="invoice.unpaidTotal" from="totalOut.unpaidTotal"/><entity-update value-field="invoice"/></if><if condition="invoice.unpaidTotal == 0.0"><set field="invoice.statusId" value="InvoicePmtRecvd"/><entity-update value-field="invoice"/><set field="updatedCount" from="updatedCount + 1"/></if></iterate><log level="warn" message="Found ${invoiceList.size()} invoices in Finalized and Sent statuses, ${updatedCount} had zero unpaid and updated to Payment Received"/></actions></service>