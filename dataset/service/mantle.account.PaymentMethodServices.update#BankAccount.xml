<!--Service Location mantle.account.PaymentMethodServices.update#BankAccount--><service verb="update" noun="BankAccount"><in-parameters><parameter name="paymentMethodId" required="true" entity-name="mantle.account.method.BankAccount" field-name="paymentMethodId"/><parameter name="paymentMethodTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="paymentMethodTypeEnumId"/><parameter name="purposeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="purposeEnumId"/><parameter name="ownerPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="ownerPartyId"/><parameter name="description" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="description"/><parameter name="fromDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="fromDate"/><parameter name="thruDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="thruDate"/><parameter name="thruDateSetAuto" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="thruDateSetAuto"/><parameter name="openedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="openedDate"/><parameter name="titleOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="titleOnAccount"/><parameter name="firstNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="firstNameOnAccount"/><parameter name="middleNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="middleNameOnAccount"/><parameter name="lastNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="lastNameOnAccount"/><parameter name="suffixOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="suffixOnAccount"/><parameter name="companyNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="companyNameOnAccount"/><parameter name="ledgerBalance" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="ledgerBalance"/><parameter name="availableBalance" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="availableBalance"/><parameter name="balanceDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="balanceDate"/><parameter name="loanPaymentAmount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="loanPaymentAmount"/><parameter name="loanPaymentPeriodUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="loanPaymentPeriodUomId"/><parameter name="currencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="currencyUomId"/><parameter name="postalContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="postalContactMechId"/><parameter name="telecomContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="telecomContactMechId"/><parameter name="emailContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="emailContactMechId"/><parameter name="gatewayCimId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="gatewayCimId"/><parameter name="paymentGatewayConfigId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="paymentGatewayConfigId"/><parameter name="imageUrl" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="imageUrl"/><parameter name="trustLevelEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="trustLevelEnumId"/><parameter name="paymentFraudEvidenceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="paymentFraudEvidenceId"/><parameter name="glAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="glAccountId"/><parameter name="finAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="finAccountId"/><parameter name="originalPaymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="originalPaymentMethodId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="lastUpdatedStamp"/><parameter name="bankName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="bankName"/><parameter name="bankPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="bankPartyId"/><parameter name="typeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="typeEnumId"/><parameter name="routingNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="routingNumber"/><parameter name="accountNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="accountNumber"/><parameter name="lastCheckNumber" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="lastCheckNumber"/><parameter name="nachaImmedDest" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedDest"/><parameter name="nachaImmedOrig" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedOrig"/><parameter name="nachaImmedDestName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedDestName"/><parameter name="nachaImmedOrigName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedOrigName"/><parameter name="nachaCompanyName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaCompanyName"/><parameter name="nachaDiscrData" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaDiscrData"/><parameter name="nachaCompanyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaCompanyId"/><parameter name="nachaOdfiId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaOdfiId"/><parameter name="nachaEntryDescription" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaEntryDescription"/><parameter name="nachaAddNewLine" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaAddNewLine"/><parameter name="nachaAddOffsetRecord" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaAddOffsetRecord"/><parameter name="posPayBankNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="posPayBankNumber"/><parameter name="posPayFormatEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="posPayFormatEnumId"/></in-parameters><out-parameters><parameter name="paymentMethodId" entity-name="mantle.account.method.BankAccount" field-name="paymentMethodId"/></out-parameters><actions><entity-find-one entity-name="mantle.account.method.BankAccount" value-field="origBankAccount"/><set field="newBankAccount" from="origBankAccount.cloneValue()"/><entity-set value-field="newBankAccount" include="nonpk" set-if-empty="true"/><entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="origPaymentMethod"/><set field="newPaymentMethod" from="origPaymentMethod.cloneValue()"/><entity-set value-field="newPaymentMethod" include="nonpk"/><if condition="newBankAccount == origBankAccount && newPaymentMethod == origPaymentMethod"><log message="No fields were different for Bank Account with ID ${paymentMethodId}, not updating"/><return/></if><entity-find-one entity-name="mantle.party.PartyRole" value-field="ownerOrgRole"><field-map field-name="partyId" from="origPaymentMethod.ownerPartyId"/><field-map field-name="roleTypeId" value="OrgInternal"/></entity-find-one><if condition="ownerOrgRole != null"><then><entity-update value-field="newPaymentMethod"/><entity-update value-field="newBankAccount"/></then><else><set field="origPaymentMethod.thruDate" from="ec.user.nowTimestamp"/><entity-update value-field="origPaymentMethod"/><set field="newPaymentMethod.paymentMethodId" from="null"/><entity-sequenced-id-primary value-field="newPaymentMethod"/><set field="newPaymentMethod.fromDate" from="ec.user.nowTimestamp"/><set field="newPaymentMethod.originalPaymentMethodId" from="origPaymentMethod.originalPaymentMethodId ?: origPaymentMethod.paymentMethodId"/><if condition="!newPaymentMethod.description"><entity-find-one entity-name="moqui.basic.Enumeration" value-field="typeEnum"><field-map field-name="enumId" from="newBankAccount.typeEnumId"/></entity-find-one><set field="newPaymentMethod.description" from="(typeEnum?.description ?: 'Bank Account') + ' ' + newBankAccount.accountNumber"/></if><entity-create value-field="newPaymentMethod"/><set field="newBankAccount.paymentMethodId" from="newPaymentMethod.paymentMethodId"/><entity-create value-field="newBankAccount"/><set field="paymentMethodId" from="newPaymentMethod.paymentMethodId"/></else></if></actions></service>