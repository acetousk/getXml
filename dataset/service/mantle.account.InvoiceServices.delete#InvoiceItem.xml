<!--Service Location mantle.account.InvoiceServices.delete#InvoiceItem--><service verb="delete" noun="InvoiceItem"><in-parameters><parameter name="invoiceId" required="true" entity-name="mantle.account.invoice.InvoiceItem" field-name="invoiceId"/><parameter name="invoiceItemSeqId" required="true" entity-name="mantle.account.invoice.InvoiceItem" field-name="invoiceItemSeqId"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.account.invoice.Invoice" value-field="invoice"/><if condition="!(invoice.statusId in ['InvoiceInProcess', 'InvoiceIncoming', 'InvoiceReceived'])"><return error="true" message="Invoice ${invoiceId} is not in a status that allows change"/></if><entity-find-count entity-name="mantle.shipment.ShipmentItemSource" count-field="shipmentSourceCount"><econdition field-name="invoiceId"/><econdition field-name="invoiceItemSeqId"/></entity-find-count><if condition="shipmentSourceCount"><return error="true" message="Invoice Item ${invoiceId}:${invoiceItemSeqId} is from a Shipment, cannot delete"/></if><entity-find-count entity-name="mantle.account.invoice.InvoiceItem" count-field="childItemCount"><econdition field-name="invoiceId"/><econdition field-name="parentItemSeqId" from="invoiceItemSeqId"/></entity-find-count><if condition="childItemCount"><return error="true" message="Invoice Item ${invoiceId}:${invoiceItemSeqId} has child items, cannot delete"/></if><entity-find entity-name="mantle.order.OrderItemBilling" list="itemBillingList"><econdition field-name="invoiceId"/><econdition field-name="invoiceItemSeqId"/></entity-find><if condition="itemBillingList"><message type="warning"><![CDATA[Deleting Invoice Item ${invoiceId}:${invoiceItemSeqId} associations with Order ${itemBillingList*.orderId.join(', ')}]]></message><iterate list="itemBillingList" entry="itemBilling"><service-call name="delete#mantle.order.OrderItemBilling" in-map="[orderItemBillingId:itemBilling.orderItemBillingId]"/></iterate></if><service-call name="delete#mantle.account.invoice.InvoiceItem" in-map="context" out-map="[invoiceId:context.invoiceId,invoiceItemSeqId:context.invoiceItemSeqId,parentItemSeqId:context.parentItemSeqId,itemTypeEnumId:context.itemTypeEnumId,overrideGlAccountId:context.overrideGlAccountId,assetId:context.assetId,productId:context.productId,otherPartyProductId:context.otherPartyProductId,parentInvoiceId:context.parentInvoiceId,parentInvoiceItemSeqId:context.parentInvoiceItemSeqId,taxableFlag:context.taxableFlag,quantity:context.quantity,quantityUomId:context.quantityUomId,amount:context.amount,description:context.description,itemDate:context.itemDate,isAdjustment:context.isAdjustment,salesOpportunityId:context.salesOpportunityId,taxAuthorityId:context.taxAuthorityId,payrollAdjustmentId:context.payrollAdjustmentId,finAccountId:context.finAccountId,finAccountTransId:context.finAccountTransId,billThruVendorName:context.billThruVendorName,billThruVendorRef:context.billThruVendorRef,lastUpdatedStamp:context.lastUpdatedStamp]"/></actions></service>