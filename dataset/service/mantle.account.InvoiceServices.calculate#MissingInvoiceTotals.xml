<!--Service Location mantle.account.InvoiceServices.calculate#MissingInvoiceTotals--><service verb="calculate" noun="MissingInvoiceTotals"><in-parameters><parameter name="calculateAll" type="Boolean" default="false"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.account.invoice.Invoice" list="invoiceList"><econdition field-name="invoiceTotal" operator="is-null" ignore="calculateAll"/></entity-find><iterate list="invoiceList" entry="invoice"><service-call name="mantle.account.InvoiceServices.get#InvoiceTotal" in-map="[invoiceId:invoice.invoiceId]" out-map="[invoiceTotal:totalOut.invoiceTotal,appliedPaymentsTotal:totalOut.appliedPaymentsTotal,unpaidTotal:totalOut.unpaidTotal]" out-map-add-to-existing="false"/><set field="invoice.invoiceTotal" from="totalOut.invoiceTotal"/><set field="invoice.appliedPaymentsTotal" from="totalOut.appliedPaymentsTotal"/><set field="invoice.unpaidTotal" from="totalOut.unpaidTotal"/><entity-update value-field="invoice"/></iterate><log level="warn" message="Calculated totals for ${invoiceList.size()} Invoices"/></actions></service>