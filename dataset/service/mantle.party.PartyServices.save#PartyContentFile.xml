<!--Service Location mantle.party.PartyServices.save#PartyContentFile--><service verb="save" noun="PartyContentFile"><in-parameters><parameter name="partyContentId" required="true"/><parameter name="partyId" required="true"/><parameter name="contentFile" type="org.apache.commons.fileupload.FileItem" required="true"/><parameter name="saveContentLocation" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="contentLocation"/></out-parameters><actions><set field="filename" from="contentFile.getName()"/><if condition="org.moqui.resource.ResourceReference.isTextFilename(filename)"><then><set field="contentRoot" from="ec.user.getPreference('mantle.content.root') ?: 'dbresource://mantle/content'"/></then><else><set field="contentRoot" from="ec.user.getPreference('mantle.content.large.root') ?: 'dbresource://mantle/content'"/></else></if><set field="contentLocation" value="${contentRoot}/party/${partyId}/content_${partyContentId}/${filename}"/><set field="docRr" from="ec.resource.getLocationReference(contentLocation)"/><script><![CDATA[fileStream = contentFile.getInputStream()
                try { docRr.putStream(fileStream) } finally { fileStream.close() }]]></script><if condition="saveContentLocation"><service-call name="update#mantle.party.PartyContent" in-map="[partyContentId:partyContentId, contentLocation:contentLocation]"/></if></actions></service>