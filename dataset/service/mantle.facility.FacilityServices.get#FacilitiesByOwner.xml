<!--Service Location mantle.facility.FacilityServices.get#FacilitiesByOwner--><service verb="get" noun="FacilitiesByOwner"><in-parameters><parameter name="ownerPartyId"/><parameter name="productStoreId"/><parameter name="facilityTypeEnumId"/></in-parameters><out-parameters><parameter name="resultList" type="List"/></out-parameters><actions><set field="resultList" from="[]"/><if condition="productStoreId"><entity-find-one entity-name="mantle.product.store.ProductStore" value-field="productStore"/><if condition="productStore?.inventoryFacilityId"><entity-find-one entity-name="mantle.facility.Facility" value-field="fac" cache="true"><field-map field-name="facilityId" from="productStore?.inventoryFacilityId"/></entity-find-one><if condition="fac != null"><script><![CDATA[resultList.add([facilityId:fac.facilityId, label:ec.resource.expand('FacilityNameTemplate', '', fac)])]]></script></if></if></if><if condition="ownerPartyId"><set field="ownerPartyIdSet" from="new HashSet()"/><script><![CDATA[ownerPartyIdSet.add(ownerPartyId)]]></script><entity-find entity-name="mantle.party.PartyRelationship" list="parentRelList" cache="true"><date-filter/><econdition field-name="relationshipTypeEnumId" value="PrtOrgRollup"/><econdition field-name="fromPartyId" from="ownerPartyId"/><econdition field-name="toPartyId" operator="is-not-null"/></entity-find><script><![CDATA[if (parentRelList) ownerPartyIdSet.addAll(parentRelList*.toPartyId)]]></script><entity-find entity-name="mantle.facility.Facility" list="facList" cache="true"><econdition field-name="ownerPartyId" operator="in" from="ownerPartyIdSet"/><econdition field-name="facilityTypeEnumId" ignore-if-empty="true"/><order-by field-name="facilityName"/></entity-find></if><script><![CDATA[for (def fac in facList) resultList.add([facilityId:fac.facilityId, label:ec.resource.expand('FacilityNameTemplate', '', fac)])]]></script></actions></service>