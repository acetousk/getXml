<!--Service Location sales.AgreementServices.update#BillToParty--><service verb="update" noun="BillToParty"><in-parameters><parameter name="agreementId" required="true"/><parameter name="partyId" required="true"/></in-parameters><out-parameters/><actions><set field="roleTypeId" value="CustomerBillTo"/><entity-find-one entity-name="mantle.party.agreement.Agreement" value-field="agreement"/><if condition="partyId == agreement.otherPartyId"><entity-find entity-name="mantle.party.agreement.AgreementParty" list="agreementPartyList"><econdition field-name="agreementId"/><econdition field-name="roleTypeId"/></entity-find><iterate list="agreementPartyList" entry="agreementParty"><service-call name="delete#mantle.party.agreement.AgreementParty" out-map="[agreementId:context.agreementId,partyId:context.partyId,roleTypeId:context.roleTypeId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[agreementId:agreementId,roleTypeId:roleTypeId,partyId:agreementParty.partyId]"/></iterate><return/></if><entity-find-one entity-name="mantle.party.agreement.AgreementParty" value-field="billToParty"><field-map field-name="agreementId"/><field-map field-name="roleTypeId"/></entity-find-one><if condition="billToParty"><if condition="billToParty.partyId != partyId"><service-call name="delete#mantle.party.agreement.AgreementParty" out-map="[agreementId:context.agreementId,partyId:context.partyId,roleTypeId:context.roleTypeId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[agreementId:agreementId,partyId:billToParty.partyId,roleTypeId:roleTypeId]"/><service-call name="create#mantle.party.agreement.AgreementParty" out-map="[agreementId:context.agreementId,partyId:context.partyId,roleTypeId:context.roleTypeId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="context"/></if><else><service-call name="create#mantle.party.agreement.AgreementParty" out-map="[agreementId:context.agreementId,partyId:context.partyId,roleTypeId:context.roleTypeId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="context"/></else></if></actions></service>