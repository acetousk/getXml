<!--Service Location mantle.shipment.ShipmentServices.get#ShipmentProductByScan--><service verb="get" noun="ShipmentProductByScan"><in-parameters><parameter name="shipmentId" required="true"/><parameter name="scanInput" required="true"/></in-parameters><out-parameters><parameter name="productId"/><parameter name="assetId"><description><![CDATA[Only returned if productId found from assetId or serialNumber]]></description></parameter><parameter name="shipmentItemList" type="List"><parameter name="shipmentItem" type="Map"/></parameter></out-parameters><actions><entity-find entity-name="mantle.shipment.ShipmentItem" list="shipmentItemList"><econdition field-name="shipmentId"/></entity-find><set field="productIdList" from="shipmentItemList*.productId"/><if condition="!productIdList"><return message="Shipment ${shipmentId} has no items"/></if><if condition="scanInput in productIdList"><set field="productId" from="scanInput"/></if><if condition="!productId"><entity-find entity-name="mantle.product.Product" list="pseudoProductList"><econdition field-name="productId" operator="in" from="productIdList"/><econdition field-name="pseudoId" from="scanInput"/></entity-find><if condition="pseudoProductList"><set field="productId" from="pseudoProductList[0].productId"/></if></if><if condition="!productId"><entity-find-one entity-name="mantle.product.asset.Asset" value-field="asset"><field-map field-name="assetId" from="scanInput"/></entity-find-one><if condition="asset != null && asset.productId in productIdList"><set field="productId" from="asset.productId"/><set field="assetId" from="asset.assetId"/></if></if><if condition="!productId"><entity-find entity-name="mantle.product.asset.Asset" list="assetSnList"><econdition field-name="serialNumber" from="scanInput"/><econdition field-name="productId" operator="in" from="productIdList"/></entity-find><if condition="assetSnList"><if condition="assetSnList.size() > 1"><return type="warning" message="Found more than one product on shipment ${shipmentId} with Serial Number ${scanInput}, scan internal product or asset ID or manually select the product to pack"/></if><set field="productId" from="assetSnList[0].productId"/><set field="assetId" from="assetSnList[0].assetId"/></if></if><if condition="!productId"><entity-find entity-name="mantle.product.ProductIdentification" list="prodIdentList"><econdition field-name="idValue" from="scanInput"/><econdition field-name="productId" operator="in" from="productIdList"/></entity-find><if condition="prodIdentList"><if condition="prodIdentList.size() > 1"><return type="warning" message="Found more than one product on shipment ${shipmentId} with other ID ${scanInput}, scan internal product or asset ID or manually select the product to pack"/></if><set field="productId" from="prodIdentList[0].productId"/></if></if></actions></service>