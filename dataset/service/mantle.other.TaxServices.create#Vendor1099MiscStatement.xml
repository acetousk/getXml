<!--Service Location mantle.other.TaxServices.create#Vendor1099MiscStatement--><service verb="create" noun="Vendor1099MiscStatement"><in-parameters><parameter name="timePeriodId" required="true"/><parameter name="partyId" required="true"><description><![CDATA[The vendor Party, ie matches Invoice.fromPartyId]]></description></parameter><parameter name="taxAuthorityId" default-value="UsaIrs"/><parameter name="formId" default-value="UsaIrs1099Misc"/></in-parameters><out-parameters><parameter name="taxStatementId"/></out-parameters><actions><entity-find-one entity-name="mantle.party.time.TimePeriod" value-field="timePeriod"/><set field="rentTypes" from="['ItemExpLeaseVehicle', 'ItemExpLeaseEquip', 'ItemExpLeaseRealEst', 'ItemExpLeaseOther']"/><set field="royaltyTypes" from="['ItemExpRoyalties']"/><set field="medicalHealthTypes" from="['ItemExpMedical', 'ItemExpInsHealth']"/><set field="nonEmpCompTypes" from="['ItemExpCommissionFee', 'ItemExpServAccount', 'ItemExpServLabor']"/><set field="attorneyTypes" from="['ItemExpServLegal']"/><service-call name="mantle.party.TimeServices.get#TimePeriodInfo" in-map="[timePeriod:timePeriod]" out-map="[timePeriod:periodInfo.timePeriod,fromTimestamp:periodInfo.fromTimestamp,thruTimestamp:periodInfo.thruTimestamp,thruTimestampExclusive:periodInfo.thruTimestampExclusive,thruTimestampLate:periodInfo.thruTimestampLate]"/><set field="fromTimestamp" from="periodInfo.fromTimestamp"/><set field="thruTimestamp" from="periodInfo.thruTimestamp"/><entity-find entity-name="mantle.account.invoice.InvoiceItemSummary" list="invoiceItemSummaryList"><econdition field-name="fromPartyId" from="partyId"/><econdition field-name="toPartyId" from="timePeriod.partyId"/><econdition field-name="statusId" operator="in" value="InvoiceApproved,InvoicePmtSent"/><econdition field-name="invoiceTypeEnumId" operator="not-in" value="InvoicePayroll,InvoiceTax"/><econdition field-name="invoiceDate" operator="greater-equals" from="fromTimestamp"/><econdition field-name="invoiceDate" operator="less-equals" from="thruTimestamp"/><select-field field-name="itemsTotal"/><select-field field-name="itemTypeEnumId"/></entity-find><if condition="!invoiceItemSummaryList"><return message="No invoices found in period ${timePeriodId} for party ${partyId}"/></if><set field="rents" from="0"/><set field="royalties" from="0"/><set field="medicalAndHealthCarePayments" from="0"/><set field="nonemployeeCompensation" from="0"/><set field="cropInsuranceProceeds" from="0"/><set field="grossProceedsToAttorney" from="0"/><set field="otherIncome" from="0"/><iterate list="invoiceItemSummaryList" entry="invoiceItemSummary"><if condition="rentTypes.contains(invoiceItemSummary.itemTypeEnumId)"><then><set field="rents" from="rents + invoiceItemSummary.itemsTotal"/></then><else-if condition="royaltyTypes.contains(invoiceItemSummary.itemTypeEnumId)"><set field="royalties" from="royalties + invoiceItemSummary.itemsTotal"/></else-if><else-if condition="medicalHealthTypes.contains(invoiceItemSummary.itemTypeEnumId)"><set field="medicalAndHealthCarePayments" from="medicalAndHealthCarePayments + invoiceItemSummary.itemsTotal"/></else-if><else-if condition="nonEmpCompTypes.contains(invoiceItemSummary.itemTypeEnumId)"><set field="nonemployeeCompensation" from="nonemployeeCompensation + invoiceItemSummary.itemsTotal"/></else-if><else-if condition="attorneyTypes.contains(invoiceItemSummary.itemTypeEnumId)"><set field="grossProceedsToAttorney" from="grossProceedsToAttorney + invoiceItemSummary.itemsTotal"/></else-if><else><set field="otherIncome" from="otherIncome + invoiceItemSummary.itemsTotal"/></else></if></iterate><service-call name="mantle.other.TaxServices.get#UsaIrs1099MiscFormData" out-map="[formMap:context.formMap]" in-map="context + [recipientPartyId:partyId, payerPartyId:timePeriod.partyId]"/><service-call name="mantle.other.TaxServices.create#TaxStatement" in-map="context" out-map="[formResponseId:context.formResponseId,taxStatementId:context.taxStatementId]"/></actions></service>