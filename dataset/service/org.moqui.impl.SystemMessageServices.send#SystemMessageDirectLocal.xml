<!--Service Location org.moqui.impl.SystemMessageServices.send#SystemMessageDirectLocal--><service verb="send" noun="SystemMessageDirectLocal"><in-parameters><parameter name="systemMessageId" required="true" entity-name="moqui.service.message.SystemMessage" field-name="systemMessageId"/></in-parameters><out-parameters><parameter name="remoteMessageId" entity-name="moqui.service.message.SystemMessage" field-name="remoteMessageId"/></out-parameters><actions><entity-find-one entity-name="moqui.service.message.SystemMessage" value-field="systemMessage"/><set field="systemMessageType" from="systemMessage.'moqui.service.message.SystemMessageType'"/><if condition="!systemMessage.systemMessageRemoteId"><return error="true" message="System message ${systemMessageId} has no systemMessageRemoteId, not sending."/></if><set field="systemMessageRemote" from="systemMessage.'moqui.service.message.SystemMessageRemote'"/><set field="serviceName" from="systemMessageType.receiveServiceName ?: 'org.moqui.impl.SystemMessageServices.receive#IncomingSystemMessage'"/><set field="inMap" from="[systemMessageTypeId:systemMessageType.systemMessageTypeId,                     remoteMessageId:systemMessageId, messageText:systemMessage.messageText,                     authUsername:systemMessageRemote.username, authPassword:systemMessageRemote.password]"/><script><![CDATA[receiveOutMap = ec.service.sync().name(serviceName).parameters(inMap).call()]]></script><set field="remoteMessageId" from="receiveOutMap?.systemMessageIdList?.first()"/></actions></service>