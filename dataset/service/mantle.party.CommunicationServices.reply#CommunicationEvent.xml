<!--Service Location mantle.party.CommunicationServices.reply#CommunicationEvent--><service verb="reply" noun="CommunicationEvent"><in-parameters><parameter name="parentCommEventId" required="true" default="communicationEventId" entity-name="mantle.party.communication.CommunicationEvent" field-name="parentCommEventId"/><parameter name="communicationEventId" entity-name="mantle.party.communication.CommunicationEvent" field-name="communicationEventId"/><parameter name="subject" entity-name="mantle.party.communication.CommunicationEvent" field-name="subject"/><parameter name="body" entity-name="mantle.party.communication.CommunicationEvent" field-name="body"/><parameter name="contentType" default-value="text/plain" entity-name="mantle.party.communication.CommunicationEvent" field-name="contentType"/><parameter name="fromPartyId" default="ec.user.userAccount.partyId" entity-name="mantle.party.communication.CommunicationEvent" field-name="fromPartyId"/><parameter name="statusId" default-value="CeReceived" entity-name="mantle.party.communication.CommunicationEvent" field-name="statusId"/></in-parameters><out-parameters><parameter name="communicationEventId" entity-name="mantle.party.communication.CommunicationEvent" field-name="communicationEventId"/></out-parameters><actions><entity-find-one entity-name="mantle.party.communication.CommunicationEvent" value-field="parentCe"><field-map field-name="communicationEventId" from="parentCommEventId"/></entity-find-one><set field="rootCommEventId" from="parentCe?.rootCommEventId ?: parentCommEventId"/><set field="toPartyId" from="parentCe.fromPartyId == fromPartyId ? parentCe.toPartyId : parentCe.fromPartyId"/><service-call name="create#mantle.party.communication.CommunicationEvent" out-map="[communicationEventId:context.communicationEventId,communicationEventTypeId:context.communicationEventTypeId,contactMechTypeEnumId:context.contactMechTypeEnumId,statusId:context.statusId,parentCommEventId:context.parentCommEventId,rootCommEventId:context.rootCommEventId,fromContactMechId:context.fromContactMechId,toContactMechId:context.toContactMechId,fromPartyId:context.fromPartyId,fromRoleTypeId:context.fromRoleTypeId,toPartyId:context.toPartyId,toRoleTypeId:context.toRoleTypeId,entryDate:context.entryDate,datetimeStarted:context.datetimeStarted,datetimeEnded:context.datetimeEnded,subject:context.subject,contentType:context.contentType,body:context.body,note:context.note,reasonEnumId:context.reasonEnumId,contactListId:context.contactListId,emailMessageId:context.emailMessageId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[communicationEventTypeId:'Comment', contactMechTypeEnumId:'CmtWebForm', statusId:statusId,                         parentCommEventId:parentCommEventId, rootCommEventId:rootCommEventId,                         fromPartyId:fromPartyId, toPartyId:toPartyId, entryDate:ec.user.nowTimestamp,                         contentType:contentType, subject:subject, body:body]"/></actions></service>