<!--Service Location mantle.shipment.ShipmentServices.receive#EntireShipment--><service verb="receive" noun="EntireShipment"><in-parameters><parameter name="shipmentId" required="true"/><parameter name="facilityId"><description><![CDATA[If not specified uses ShipmentRouteSegment.destinationFacilityId.]]></description></parameter><parameter name="statusId"><description><![CDATA[Use this status on assets created]]></description></parameter></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.shipment.ShipmentItemDetail" list="shipmentItemDetailList"><econdition field-name="shipmentId"/><order-by field-name="productId"/></entity-find><iterate list="shipmentItemDetailList" entry="sid"><set field="quantityRemaining" from="sid.quantity - (sid.quantityAcceptedTotal ?: 0) - (sid.quantityRejectedTotal ?: 0)"/><service-call name="mantle.shipment.ShipmentServices.receive#ShipmentProduct" in-map="[shipmentId:shipmentId, productId:sid.productId, statusId:statusId,                             quantityAccepted:quantityRemaining, facilityId:facilityId]"/></iterate><service-call name="mantle.shipment.ShipmentServices.deliver#Shipment" out-map="[oldStatusId:context.oldStatusId,statusChanged:context.statusChanged]" in-map="[shipmentId:shipmentId]"/></actions></service>