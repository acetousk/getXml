<!--Service Location org.moqui.impl.WikiServices.get#WikiPageAttachment--><service verb="get" noun="WikiPageAttachment"><in-parameters><parameter name="wikiSpaceId"><description><![CDATA[Optional if pagePath is a wikiPageId or the first segment is a wikiSpaceId]]></description></parameter><parameter name="pagePath"><description><![CDATA[Not required, is empty for the space root page. Can be a wikiPageId or the page path within the space.]]></description></parameter><parameter name="filename"><description><![CDATA[If not specified last segment of pagePath will be used]]></description></parameter></in-parameters><out-parameters><parameter name="attachmentReference" type="org.moqui.resource.ResourceReference"/></out-parameters><actions><set field="pathList" from="pagePath ? pagePath.split('/') as List : []"/><if condition="!filename"><if condition="pathList"><then><set field="filename" from="pathList.remove(pathList.size()-1)"/><set field="pagePath" from="pathList.join('/')"/></then><else><return error="true" message="No filename specified and no path with filename"/></else></if></if><set field="pathFirst" from="pathList ? pathList[0] : null"/><if condition="pathFirst"><entity-find-one entity-name="moqui.resource.wiki.WikiSpace" value-field="wikiSpace" cache="true"><field-map field-name="wikiSpaceId" from="pathFirst"/></entity-find-one><if condition="wikiSpace != null"><set field="wikiSpaceId" from="pathList.remove(0)"/><set field="pagePath" from="pathList.join('/')"/><set field="pathFirst" from="pathList ? pathList[0] : null"/></if></if><if condition="pathFirst"><entity-find-one entity-name="moqui.resource.wiki.WikiPage" value-field="wikiPage" cache="true"><field-map field-name="wikiPageId" from="pathFirst"/></entity-find-one><if condition="wikiPage != null"><set field="wikiSpaceId" from="wikiPage.wikiSpaceId"/><set field="pagePath" from="wikiPage.pagePath"/></if></if><entity-find-one entity-name="moqui.resource.wiki.WikiSpace" value-field="wikiSpace" cache="true"/><if condition="wikiSpace == null"><return error="true" message="Wiki Space with ID ${wikiSpaceId} not found"/></if><if condition="!wikiSpace.rootPageLocation"><return error="true" message="Wiki Space with ID ${wikiSpaceId} has no root page location"/></if><set field="rootPageRef" from="ec.resource.getLocationReference(wikiSpace.rootPageLocation)"/><set field="pageReference" from="rootPageRef.findChildFile(pagePath)"/><set field="pageAttachmentsDirectoryRef" from="pageReference?.getChild('_attachments')"/><set field="attachmentReference" from="pageAttachmentsDirectoryRef?.getChild(filename)"/></actions></service>