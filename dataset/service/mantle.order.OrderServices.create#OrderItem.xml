<!--Service Location mantle.order.OrderServices.create#OrderItem--><service verb="create" noun="OrderItem"><in-parameters><parameter name="orderId" required="true" entity-name="mantle.order.OrderItem" field-name="orderId"/><parameter name="orderPartSeqId" type="java.lang.String" required="true" allow-html="none" entity-name="mantle.order.OrderItem" field-name="orderPartSeqId"/><parameter name="parentItemSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="parentItemSeqId"/><parameter name="itemTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="itemTypeEnumId" default-value="ItemProduct"/><parameter name="productId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="productId"/><parameter name="productFeatureId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="productFeatureId"/><parameter name="otherPartyProductId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="otherPartyProductId"/><parameter name="productParameterSetId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="productParameterSetId"/><parameter name="itemDescription" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="itemDescription"/><parameter name="comments" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="comments"/><parameter name="quantity" type="BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="quantity" default="1"/><parameter name="quantityUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="quantityUomId"/><parameter name="quantityCancelled" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="quantityCancelled"/><parameter name="selectedAmount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="selectedAmount"/><parameter name="priority" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="priority"/><parameter name="requiredByDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="requiredByDate"/><parameter name="unitAmount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="unitAmount"/><parameter name="unitListPrice" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="unitListPrice"/><parameter name="isModifiedPrice" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="isModifiedPrice"/><parameter name="standardCost" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="standardCost"/><parameter name="externalItemSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="externalItemSeqId"/><parameter name="fromAssetId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="fromAssetId"/><parameter name="productPriceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="productPriceId"/><parameter name="productCategoryId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="productCategoryId"/><parameter name="isPromo" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="isPromo"/><parameter name="promoQuantity" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="promoQuantity"/><parameter name="promoTimesUsed" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="promoTimesUsed"/><parameter name="storePromotionId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="storePromotionId"/><parameter name="promoCodeId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="promoCodeId"/><parameter name="promoCodeText" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="promoCodeText"/><parameter name="subscriptionId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="subscriptionId"/><parameter name="finAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="finAccountId"/><parameter name="finAccountTransId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="finAccountTransId"/><parameter name="overrideGlAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="overrideGlAccountId"/><parameter name="salesOpportunityId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="salesOpportunityId"/><parameter name="sourceReferenceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="sourceReferenceId"/><parameter name="sourcePercentage" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="sourcePercentage"/><parameter name="amountAlreadyIncluded" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="amountAlreadyIncluded"/><parameter name="exemptAmount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="exemptAmount"/><parameter name="customerReferenceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="customerReferenceId"/><parameter name="taxAuthorityId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="taxAuthorityId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderItem" field-name="lastUpdatedStamp"/><parameter name="requireInventory" type="Boolean"><description><![CDATA[If true make sure inventory is available, if false don't check. If null defer to ProductStore setting.]]></description></parameter></in-parameters><out-parameters><parameter name="orderItemSeqId" required="true" entity-name="mantle.order.OrderItem" field-name="orderItemSeqId"/></out-parameters><actions><set field="isProductItem" from="false"/><if condition="productId"><entity-find-one entity-name="mantle.product.Product" value-field="product" cache="true"/><if condition="product == null"><return error="true" message="Product ${productId} not found"/></if><if condition="product.productTypeEnumId == 'PtVirtual'"><return error="true" message="Product ${productId} is a Virtual product and may not be used on an Order"/></if><entity-find entity-name="moqui.basic.EnumGroupMember" list="productItemTypeEgms" cache="true"><econdition field-name="enumGroupEnumId" value="EngItemsProduct"/></entity-find><set field="productItemTypes" from="productItemTypeEgms*.enumId"/><set field="isProductItem" from="itemTypeEnumId in productItemTypes"/></if><if condition="isProductItem && quantity"><service-call name="mantle.order.OrderServices.check#AvailableInventory" in-map="[productId:productId, quantity:quantity, orderId:orderId, orderPartSeqId:orderPartSeqId,                             requireInventory:requireInventory]"/></if><if condition="isProductItem"><then><if condition="product?.amountRequire == 'Y' && !selectedAmount"><return error="true" message="Product ${productId} requires a selected amount"/></if><if condition="!itemDescription"><set field="itemDescription" from="product?.productName"/></if><if condition="!quantityUomId"><set field="quantityUomId" from="product?.amountUomId"/></if></then><else-if condition="parentItemSeqId"><if condition="!productId"><entity-find-one entity-name="mantle.order.OrderItem" value-field="parentItem"><field-map field-name="orderId"/><field-map field-name="orderItemSeqId" from="parentItemSeqId"/></entity-find-one><set field="productId" from="parentItem?.productId"/></if></else-if></if><service-call name="create#mantle.order.OrderItem" in-map="context" out-map="[orderId:context.orderId,orderItemSeqId:context.orderItemSeqId,orderPartSeqId:context.orderPartSeqId,parentItemSeqId:context.parentItemSeqId,itemTypeEnumId:context.itemTypeEnumId,productId:context.productId,productFeatureId:context.productFeatureId,otherPartyProductId:context.otherPartyProductId,productParameterSetId:context.productParameterSetId,itemDescription:context.itemDescription,comments:context.comments,quantity:context.quantity,quantityUomId:context.quantityUomId,quantityCancelled:context.quantityCancelled,selectedAmount:context.selectedAmount,priority:context.priority,requiredByDate:context.requiredByDate,unitAmount:context.unitAmount,unitListPrice:context.unitListPrice,isModifiedPrice:context.isModifiedPrice,standardCost:context.standardCost,externalItemSeqId:context.externalItemSeqId,fromAssetId:context.fromAssetId,productPriceId:context.productPriceId,productCategoryId:context.productCategoryId,isPromo:context.isPromo,promoQuantity:context.promoQuantity,promoTimesUsed:context.promoTimesUsed,storePromotionId:context.storePromotionId,promoCodeId:context.promoCodeId,promoCodeText:context.promoCodeText,subscriptionId:context.subscriptionId,finAccountId:context.finAccountId,finAccountTransId:context.finAccountTransId,overrideGlAccountId:context.overrideGlAccountId,salesOpportunityId:context.salesOpportunityId,sourceReferenceId:context.sourceReferenceId,sourcePercentage:context.sourcePercentage,amountAlreadyIncluded:context.amountAlreadyIncluded,exemptAmount:context.exemptAmount,customerReferenceId:context.customerReferenceId,taxAuthorityId:context.taxAuthorityId,lastUpdatedStamp:context.lastUpdatedStamp]"/></actions></service>