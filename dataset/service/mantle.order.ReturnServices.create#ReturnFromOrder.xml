<!--Service Location mantle.order.ReturnServices.create#ReturnFromOrder--><service verb="create" noun="ReturnFromOrder"><in-parameters><parameter name="orderId" required="true"/><parameter name="orderPartSeqId" required="true"/><parameter name="paymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="paymentMethodId"/><parameter name="useSingleRefundPayment" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="useSingleRefundPayment"/><parameter name="finAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="finAccountId"/><parameter name="postalContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="postalContactMechId"/><parameter name="telecomContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="telecomContactMechId"/><parameter name="facilityId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="facilityId"/><parameter name="shipmentMethodEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="shipmentMethodEnumId"/><parameter name="carrierPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="carrierPartyId"/><parameter name="supplierRmaId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="supplierRmaId"/><parameter name="systemMessageRemoteId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="systemMessageRemoteId"/><parameter name="displayId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="displayId"/><parameter name="externalId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="externalId"/><parameter name="originId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="originId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.return.ReturnHeader" field-name="lastUpdatedStamp"/><parameter name="statusId" default-value="ReturnCreated"/><parameter name="entryDate" type="Timestamp" default="ec.user.nowTimestamp"/></in-parameters><out-parameters><parameter name="returnId"/></out-parameters><actions><entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderHeader"/><entity-find-one entity-name="mantle.order.OrderPart" value-field="orderPart"/><if condition="!orderPart"><return error="true" message="Could not find Order Part [${orderId}:${orderPartSeqId}]"/></if><if condition="!(orderPart.statusId in ['OrderApproved', 'OrderSent', 'OrderCompleted'])"><return error="true" message="Order in status ${orderPart.statusId} cannot be returned"/></if><set field="customerPartyId" from="orderPart.customerPartyId"/><set field="vendorPartyId" from="orderPart.vendorPartyId"/><set field="currencyUomId" from="orderHeader.currencyUomId"/><if condition="!facilityId"><set field="facilityId" from="orderPart.facilityId"/></if><entity-find entity-name="mantle.party.PartyRole" list="vendorOrgInternalList"><econdition field-name="partyId" from="vendorPartyId"/><econdition field-name="roleTypeId" value="OrgInternal"/></entity-find><if condition="vendorOrgInternalList"><if condition="!postalContactMechId"><set field="postalContactMechId" from="orderPart.postalContactMechId"/></if><if condition="!telecomContactMechId"><set field="telecomContactMechId" from="orderPart.telecomContactMechId"/></if></if><if condition="!shipmentMethodEnumId"><set field="shipmentMethodEnumId" from="orderPart.shipmentMethodEnumId"/></if><if condition="!carrierPartyId"><set field="carrierPartyId" from="orderPart.carrierPartyId"/></if><if condition="!paymentMethodId"><entity-find entity-name="mantle.account.payment.Payment" list="paymentList"><econdition field-name="orderId"/><econdition field-name="orderPartSeqId"/></entity-find><iterate list="paymentList" entry="payment"><if condition="payment.paymentMethodId"><set field="paymentMethodId" from="payment.paymentMethodId"/></if></iterate></if><set field="visitId" from="ec.user.visitId"/><service-call name="create#mantle.order.return.ReturnHeader" in-map="context" out-map="[returnId:context.returnId,statusId:context.statusId,customerPartyId:context.customerPartyId,vendorPartyId:context.vendorPartyId,paymentMethodId:context.paymentMethodId,useSingleRefundPayment:context.useSingleRefundPayment,finAccountId:context.finAccountId,entryDate:context.entryDate,postalContactMechId:context.postalContactMechId,telecomContactMechId:context.telecomContactMechId,facilityId:context.facilityId,shipmentMethodEnumId:context.shipmentMethodEnumId,carrierPartyId:context.carrierPartyId,currencyUomId:context.currencyUomId,supplierRmaId:context.supplierRmaId,visitId:context.visitId,systemMessageRemoteId:context.systemMessageRemoteId,displayId:context.displayId,externalId:context.externalId,originId:context.originId,lastUpdatedStamp:context.lastUpdatedStamp]"/></actions></service>