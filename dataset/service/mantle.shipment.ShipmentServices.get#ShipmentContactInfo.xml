<!--Service Location mantle.shipment.ShipmentServices.get#ShipmentContactInfo--><service verb="get" noun="ShipmentContactInfo"><in-parameters><parameter name="shipmentId" required="true"/><parameter name="shipmentRouteSegmentSeqId"/></in-parameters><out-parameters><parameter name="shipment" type="Map"/><parameter name="shipmentRouteSegmentList" type="List"><parameter name="shipmentRouteSegment" type="Map"/></parameter><parameter name="firstRouteSegment" type="Map"/><parameter name="carrierParty" type="Map"/><parameter name="shipmentMethodEnum" type="Map"/><parameter name="carrierShipmentMethod" type="Map"/><parameter name="lastRouteSegment" type="Map"/><parameter name="originFacility" type="Map"/><parameter name="destinationFacility" type="Map"/><parameter name="fromPartyId"><description><![CDATA[Shipment.fromPartyId or if empty then warehouse Facility.ownerPartyId]]></description></parameter><parameter name="fromPartyDetail" type="Map"/><parameter name="fromContactInfo" type="Map"><description><![CDATA[The from ship info, first by
                ShipmentRouteSegment.origin* fields then the warehouse Facility
                (using mantle.facility.ContactServices.get#FacilityDefaultShipOrigin) or if no warehouse or contact info
                found then from the mantle.party.ContactServices.get#PartyContactInfo service for the fromPartyId.]]></description></parameter><parameter name="logoImageLocation"/><parameter name="toPartyId"/><parameter name="toPartyDetail" type="Map"/><parameter name="toContactInfo" type="Map"><description><![CDATA[The to ship info, first by ShipmentRouteSegment.dest*,
                then from the mantle.party.ContactServices.get#PartyContactInfo service for Shipment.toPartyId.]]></description></parameter></out-parameters><actions><entity-find-one entity-name="mantle.shipment.Shipment" value-field="shipment"/><if condition="shipment == null"><return error="true" message="Shipment not found with ID ${shipmentId}"/></if><entity-find entity-name="mantle.shipment.ShipmentRouteSegment" list="shipmentRouteSegmentList"><econdition field-name="shipmentId"/><econdition field-name="shipmentRouteSegmentSeqId" ignore-if-empty="true"/><order-by field-name="shipmentRouteSegmentSeqId"/></entity-find><set field="firstRouteSegment" from="shipmentRouteSegmentList ? shipmentRouteSegmentList.first() : null"/><set field="lastRouteSegment" from="shipmentRouteSegmentList ? shipmentRouteSegmentList.last() : null"/><if condition="firstRouteSegment?.carrierPartyId"><entity-find-one entity-name="mantle.party.PartyDetail" value-field="carrierParty" cache="true"><field-map field-name="partyId" from="firstRouteSegment.carrierPartyId"/></entity-find-one></if><if condition="firstRouteSegment?.shipmentMethodEnumId"><entity-find-one entity-name="moqui.basic.Enumeration" value-field="shipmentMethodEnum" cache="true"><field-map field-name="enumId" from="firstRouteSegment.shipmentMethodEnumId"/></entity-find-one></if><if condition="firstRouteSegment?.carrierPartyId && firstRouteSegment?.carrierPartyId != '_NA_' && firstRouteSegment?.shipmentMethodEnumId"><entity-find-one entity-name="mantle.shipment.carrier.CarrierShipmentMethod" value-field="carrierShipmentMethod" cache="true"><field-map field-name="carrierPartyId" from="firstRouteSegment.carrierPartyId"/><field-map field-name="shipmentMethodEnumId" from="firstRouteSegment.shipmentMethodEnumId"/></entity-find-one></if><entity-find-one entity-name="mantle.facility.Facility" value-field="originFacility"><field-map field-name="facilityId" from="firstRouteSegment?.originFacilityId"/></entity-find-one><entity-find-one entity-name="mantle.facility.Facility" value-field="destinationFacility"><field-map field-name="facilityId" from="lastRouteSegment?.destinationFacilityId"/></entity-find-one><set field="fromPartyId" from="shipment.fromPartyId ?: warehouseFacility?.ownerPartyId"/><entity-find-one entity-name="mantle.party.PartyDetail" value-field="fromPartyDetail"><field-map field-name="partyId" from="fromPartyId"/></entity-find-one><if condition="firstRouteSegment?.originPostalContactMechId"><service-call name="mantle.party.ContactServices.get#PartyContactInfo" out-map="[postalContactMechId:fromContactInfo.postalContactMechId,postalContactMech:fromContactInfo.postalContactMech,postalContactMechPurposeId:fromContactInfo.postalContactMechPurposeId,postalAddress:fromContactInfo.postalAddress,postalAddressStateGeo:fromContactInfo.postalAddressStateGeo,postalAddressCountryGeo:fromContactInfo.postalAddressCountryGeo,postalAddressGeoPoint:fromContactInfo.postalAddressGeoPoint,postalTrustLevelEnum:fromContactInfo.postalTrustLevelEnum,telecomContactMechId:fromContactInfo.telecomContactMechId,telecomContactMech:fromContactInfo.telecomContactMech,telecomPartyContactMech:fromContactInfo.telecomPartyContactMech,telecomContactMechPurposeId:fromContactInfo.telecomContactMechPurposeId,telecomNumber:fromContactInfo.telecomNumber,faxContactMechId:fromContactInfo.faxContactMechId,faxContactMech:fromContactInfo.faxContactMech,faxPartyContactMech:fromContactInfo.faxPartyContactMech,faxContactMechPurposeId:fromContactInfo.faxContactMechPurposeId,faxTelecomNumber:fromContactInfo.faxTelecomNumber,emailContactMechId:fromContactInfo.emailContactMechId,emailContactMech:fromContactInfo.emailContactMech,emailPartyContactMech:fromContactInfo.emailPartyContactMech,emailContactMechPurposeId:fromContactInfo.emailContactMechPurposeId,emailAddress:fromContactInfo.emailAddress,webContactMechId:fromContactInfo.webContactMechId,webContactMech:fromContactInfo.webContactMech,webPartyContactMech:fromContactInfo.webPartyContactMech,webContactMechPurposeId:fromContactInfo.webContactMechPurposeId,webAddress:fromContactInfo.webAddress,otherContactMechId:fromContactInfo.otherContactMechId,otherContactMech:fromContactInfo.otherContactMech,otherContactMechPurposeId:fromContactInfo.otherContactMechPurposeId,otherInfoString:fromContactInfo.otherInfoString]" in-map="[partyId:fromPartyId, postalContactMechId:firstRouteSegment.originPostalContactMechId,                             telecomContactMechPurposeId:'PhoneShippingOrigin', emailContactMechPurposeId:'EmailShippingOrigin']"/></if><if condition="!fromContactInfo && firstRouteSegment?.originFacilityId"><set field="fromContactIdMap" from="[facilityId:firstRouteSegment?.originFacilityId,                         postalContactMechId:firstRouteSegment?.originPostalContactMechId,                         telecomContactMechId:firstRouteSegment?.originTelecomContactMechId]"/><service-call name="mantle.facility.ContactServices.get#FacilityContactInfo" out-map="[facilityId:fromContactInfo.facilityId,postalContactMechId:fromContactInfo.postalContactMechId,postalContactMech:fromContactInfo.postalContactMech,postalContactMechPurposeId:fromContactInfo.postalContactMechPurposeId,postalAddress:fromContactInfo.postalAddress,postalAddressStateGeo:fromContactInfo.postalAddressStateGeo,postalAddressCountryGeo:fromContactInfo.postalAddressCountryGeo,postalAddressGeoPoint:fromContactInfo.postalAddressGeoPoint,postalTrustLevelEnum:fromContactInfo.postalTrustLevelEnum,telecomContactMechId:fromContactInfo.telecomContactMechId,telecomContactMechPurposeId:fromContactInfo.telecomContactMechPurposeId,telecomNumber:fromContactInfo.telecomNumber,emailContactMechId:fromContactInfo.emailContactMechId,emailContactMechPurposeId:fromContactInfo.emailContactMechPurposeId,emailAddress:fromContactInfo.emailAddress,otherContactMechId:fromContactInfo.otherContactMechId,otherContactMechPurposeId:fromContactInfo.otherContactMechPurposeId,otherInfoString:fromContactInfo.otherInfoString]" in-map="fromContactIdMap + [postalContactMechPurposeId:'PostalShippingOrigin',                             telecomContactMechPurposeId:'PhoneShippingOrigin', emailContactMechPurposeId:'EmailShippingOrigin']"/></if><if condition="!fromContactInfo && fromPartyId"><service-call name="mantle.party.ContactServices.get#PartyContactInfo" out-map="[postalContactMechId:fromContactInfo.postalContactMechId,postalContactMech:fromContactInfo.postalContactMech,postalContactMechPurposeId:fromContactInfo.postalContactMechPurposeId,postalAddress:fromContactInfo.postalAddress,postalAddressStateGeo:fromContactInfo.postalAddressStateGeo,postalAddressCountryGeo:fromContactInfo.postalAddressCountryGeo,postalAddressGeoPoint:fromContactInfo.postalAddressGeoPoint,postalTrustLevelEnum:fromContactInfo.postalTrustLevelEnum,telecomContactMechId:fromContactInfo.telecomContactMechId,telecomContactMech:fromContactInfo.telecomContactMech,telecomPartyContactMech:fromContactInfo.telecomPartyContactMech,telecomContactMechPurposeId:fromContactInfo.telecomContactMechPurposeId,telecomNumber:fromContactInfo.telecomNumber,faxContactMechId:fromContactInfo.faxContactMechId,faxContactMech:fromContactInfo.faxContactMech,faxPartyContactMech:fromContactInfo.faxPartyContactMech,faxContactMechPurposeId:fromContactInfo.faxContactMechPurposeId,faxTelecomNumber:fromContactInfo.faxTelecomNumber,emailContactMechId:fromContactInfo.emailContactMechId,emailContactMech:fromContactInfo.emailContactMech,emailPartyContactMech:fromContactInfo.emailPartyContactMech,emailContactMechPurposeId:fromContactInfo.emailContactMechPurposeId,emailAddress:fromContactInfo.emailAddress,webContactMechId:fromContactInfo.webContactMechId,webContactMech:fromContactInfo.webContactMech,webPartyContactMech:fromContactInfo.webPartyContactMech,webContactMechPurposeId:fromContactInfo.webContactMechPurposeId,webAddress:fromContactInfo.webAddress,otherContactMechId:fromContactInfo.otherContactMechId,otherContactMech:fromContactInfo.otherContactMech,otherContactMechPurposeId:fromContactInfo.otherContactMechPurposeId,otherInfoString:fromContactInfo.otherInfoString]" in-map="[partyId:fromPartyId, postalContactMechPurposeId:'PostalShippingOrigin',                         telecomContactMechPurposeId:'PhoneShippingOrigin', emailContactMechPurposeId:'EmailShippingOrigin']"/><service-call name="mantle.party.PartyServices.get#PartyContentLocation" out-map="[contentLocation:logoImageOut.contentLocation,partyContent:logoImageOut.partyContent,contentText:logoImageOut.contentText]" in-map="[partyId:fromPartyId, partyContentTypeEnumIdList:['PcntLogoImage', 'PcntPrimaryImage']]"/><set field="logoImageLocation" from="logoImageOut.contentLocation"/></if><set field="toPartyId" from="shipment.toPartyId"/><entity-find-one entity-name="mantle.party.PartyDetail" value-field="toPartyDetail"><field-map field-name="partyId" from="toPartyId"/></entity-find-one><if condition="lastRouteSegment?.destPostalContactMechId"><service-call name="mantle.party.ContactServices.get#PartyContactInfo" out-map="[postalContactMechId:toContactInfo.postalContactMechId,postalContactMech:toContactInfo.postalContactMech,postalContactMechPurposeId:toContactInfo.postalContactMechPurposeId,postalAddress:toContactInfo.postalAddress,postalAddressStateGeo:toContactInfo.postalAddressStateGeo,postalAddressCountryGeo:toContactInfo.postalAddressCountryGeo,postalAddressGeoPoint:toContactInfo.postalAddressGeoPoint,postalTrustLevelEnum:toContactInfo.postalTrustLevelEnum,telecomContactMechId:toContactInfo.telecomContactMechId,telecomContactMech:toContactInfo.telecomContactMech,telecomPartyContactMech:toContactInfo.telecomPartyContactMech,telecomContactMechPurposeId:toContactInfo.telecomContactMechPurposeId,telecomNumber:toContactInfo.telecomNumber,faxContactMechId:toContactInfo.faxContactMechId,faxContactMech:toContactInfo.faxContactMech,faxPartyContactMech:toContactInfo.faxPartyContactMech,faxContactMechPurposeId:toContactInfo.faxContactMechPurposeId,faxTelecomNumber:toContactInfo.faxTelecomNumber,emailContactMechId:toContactInfo.emailContactMechId,emailContactMech:toContactInfo.emailContactMech,emailPartyContactMech:toContactInfo.emailPartyContactMech,emailContactMechPurposeId:toContactInfo.emailContactMechPurposeId,emailAddress:toContactInfo.emailAddress,webContactMechId:toContactInfo.webContactMechId,webContactMech:toContactInfo.webContactMech,webPartyContactMech:toContactInfo.webPartyContactMech,webContactMechPurposeId:toContactInfo.webContactMechPurposeId,webAddress:toContactInfo.webAddress,otherContactMechId:toContactInfo.otherContactMechId,otherContactMech:toContactInfo.otherContactMech,otherContactMechPurposeId:toContactInfo.otherContactMechPurposeId,otherInfoString:toContactInfo.otherInfoString]" in-map="[partyId:toPartyId, postalContactMechId:lastRouteSegment.destPostalContactMechId,                             telecomContactMechPurposeId:'PhoneShippingDest', emailContactMechPurposeId:'EmailShippingDest']"/></if><if condition="!toContactInfo && lastRouteSegment?.destinationFacilityId"><set field="toContactIdMap" from="[facilityId:lastRouteSegment.destinationFacilityId,                         postalContactMechId:lastRouteSegment.destPostalContactMechId,                         telecomContactMechId:lastRouteSegment.destTelecomContactMechId]"/><service-call name="mantle.facility.ContactServices.get#FacilityContactInfo" out-map="[facilityId:toContactInfo.facilityId,postalContactMechId:toContactInfo.postalContactMechId,postalContactMech:toContactInfo.postalContactMech,postalContactMechPurposeId:toContactInfo.postalContactMechPurposeId,postalAddress:toContactInfo.postalAddress,postalAddressStateGeo:toContactInfo.postalAddressStateGeo,postalAddressCountryGeo:toContactInfo.postalAddressCountryGeo,postalAddressGeoPoint:toContactInfo.postalAddressGeoPoint,postalTrustLevelEnum:toContactInfo.postalTrustLevelEnum,telecomContactMechId:toContactInfo.telecomContactMechId,telecomContactMechPurposeId:toContactInfo.telecomContactMechPurposeId,telecomNumber:toContactInfo.telecomNumber,emailContactMechId:toContactInfo.emailContactMechId,emailContactMechPurposeId:toContactInfo.emailContactMechPurposeId,emailAddress:toContactInfo.emailAddress,otherContactMechId:toContactInfo.otherContactMechId,otherContactMechPurposeId:toContactInfo.otherContactMechPurposeId,otherInfoString:toContactInfo.otherInfoString]" in-map="toContactIdMap + [postalContactMechPurposeId:'PostalShippingDest',                             telecomContactMechPurposeId:'PhoneShippingDest', emailContactMechPurposeId:'EmailShippingDest']"/></if><if condition="!toContactInfo && toPartyId"><service-call name="mantle.party.ContactServices.get#PartyContactInfo" out-map="[postalContactMechId:toContactInfo.postalContactMechId,postalContactMech:toContactInfo.postalContactMech,postalContactMechPurposeId:toContactInfo.postalContactMechPurposeId,postalAddress:toContactInfo.postalAddress,postalAddressStateGeo:toContactInfo.postalAddressStateGeo,postalAddressCountryGeo:toContactInfo.postalAddressCountryGeo,postalAddressGeoPoint:toContactInfo.postalAddressGeoPoint,postalTrustLevelEnum:toContactInfo.postalTrustLevelEnum,telecomContactMechId:toContactInfo.telecomContactMechId,telecomContactMech:toContactInfo.telecomContactMech,telecomPartyContactMech:toContactInfo.telecomPartyContactMech,telecomContactMechPurposeId:toContactInfo.telecomContactMechPurposeId,telecomNumber:toContactInfo.telecomNumber,faxContactMechId:toContactInfo.faxContactMechId,faxContactMech:toContactInfo.faxContactMech,faxPartyContactMech:toContactInfo.faxPartyContactMech,faxContactMechPurposeId:toContactInfo.faxContactMechPurposeId,faxTelecomNumber:toContactInfo.faxTelecomNumber,emailContactMechId:toContactInfo.emailContactMechId,emailContactMech:toContactInfo.emailContactMech,emailPartyContactMech:toContactInfo.emailPartyContactMech,emailContactMechPurposeId:toContactInfo.emailContactMechPurposeId,emailAddress:toContactInfo.emailAddress,webContactMechId:toContactInfo.webContactMechId,webContactMech:toContactInfo.webContactMech,webPartyContactMech:toContactInfo.webPartyContactMech,webContactMechPurposeId:toContactInfo.webContactMechPurposeId,webAddress:toContactInfo.webAddress,otherContactMechId:toContactInfo.otherContactMechId,otherContactMech:toContactInfo.otherContactMech,otherContactMechPurposeId:toContactInfo.otherContactMechPurposeId,otherInfoString:toContactInfo.otherInfoString]" in-map="[partyId:toPartyId, postalContactMechPurposeId:'PostalShippingDest',                             telecomContactMechPurposeId:'PhoneShippingDest', emailContactMechPurposeId:'EmailShippingDest']"/></if></actions></service>