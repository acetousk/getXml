<!--Service Location mantle.ledger.InvoiceAutoPostServices.repost#Invoice--><service verb="repost" noun="Invoice"><in-parameters><parameter name="invoiceId" required="true" entity-name="mantle.account.invoice.Invoice" field-name="invoiceId"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.account.invoice.Invoice" value-field="invoice" for-update="true"/><if condition="invoice == null"><return error="true" message="Could not find Invoice with ID ${invoiceId}"/></if><if condition="invoice.statusId in ['InvoiceInProcess', 'InvoiceIncoming', 'InvoiceReceived', 'InvoiceCancelled']"><return error="true" message="Invoice ${invoiceId} cannot be posted in status ${invoice.statusId}"/></if><set field="allInvoiceTxTypes" from="['AttSalesInvoice', 'AttVendRtnInvoice', 'AttPurchaseInvoice', 'AttCustRtnInvoice',                     'AttCreditMemo', 'AttVendCreditMemo', 'AttPayrollInvoice', 'AttTaxInvoice', 'AttGarnishmentInvoice', 'AttCommissionInvoice', 'AttInvoiceAdjust']"/><entity-find entity-name="mantle.ledger.transaction.AcctgTrans" list="existingTransList"><econdition field-name="invoiceId"/><econdition field-name="acctgTransTypeEnumId" operator="in" from="allInvoiceTxTypes"/><econdition field-name="reversedByAcctgTransId" from="null"/><econdition field-name="reverseOfAcctgTransId" from="null"/></entity-find><if condition="!existingTransList"><log level="warn" message="In repost#Invoice ${invoiceId} no existing AcctgTrans records found"/></if><iterate list="existingTransList" entry="acctgTrans"><service-call name="mantle.ledger.LedgerServices.unpost#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/><service-call name="mantle.ledger.LedgerServices.delete#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/></iterate><service-call name="mantle.ledger.InvoiceAutoPostServices.post#Invoice" in-map="[invoiceId:invoiceId]"/></actions></service>