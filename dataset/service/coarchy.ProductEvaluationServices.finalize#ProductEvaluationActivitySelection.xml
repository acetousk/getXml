<!--Service Location coarchy.ProductEvaluationServices.finalize#ProductEvaluationActivitySelection--><service verb="finalize" noun="ProductEvaluationActivitySelection"><in-parameters><parameter name="productEvaluationId" required="true"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="coarchy.product.ProductEvaluation" value-field="productEvaluation" for-update="true"/><if condition="productEvaluation.statusId != 'PeRequirementsSelection'"><return error="true" message="Cannot finalize activities in this status."/></if><service-call name="coarchy.ProductEvaluationServices.get#ProductEvaluationActivites" in-map="[productEvaluationId:productEvaluationId]" out-map="[processStoryIds:productEvalActivities.processStoryIds,activityIds:productEvalActivities.activityIds,activityList:productEvalActivities.activityList]"/><if condition="productEvalActivities.activityIds?.size() == 0"><return error="true" message="Please add at least one activity to evaluate."/></if><set field="productEvaluation.statusId" value="PeInviteVendors"/><set field="productEvaluation.requirementsSetDate" from="ec.user.nowTimestamp"/><entity-update value-field="productEvaluation"/></actions></service>