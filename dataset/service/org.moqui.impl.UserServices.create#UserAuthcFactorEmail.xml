<!--Service Location org.moqui.impl.UserServices.create#UserAuthcFactorEmail--><service verb="create" noun="UserAuthcFactorEmail"><in-parameters><parameter name="userId" required="true"><description><![CDATA[User to enable Factor Method]]></description></parameter><parameter name="fromDate" type="Timestamp" default="ec.user.nowTimestamp"/><parameter name="thruDate" type="Timestamp"/><parameter name="factorTypeEnumId" default-value="UafEmail"/><parameter name="factorOption" required="true"><text-email/></parameter><parameter name="needsValidation" default-value="Y"/></in-parameters><out-parameters><parameter name="factorId"/></out-parameters><actions><entity-find-count entity-name="moqui.security.UserAuthcFactor" count-field="userAuthcFactorCount"><date-filter/><econdition field-name="userId"/><econdition field-name="factorOption"/></entity-find-count><if condition="userAuthcFactorCount == 0"><then><service-call name="create#moqui.security.UserAuthcFactor" in-map="context" out-map="[factorId:context.factorId,userId:context.userId,fromFactorId:context.fromFactorId,factorTypeEnumId:context.factorTypeEnumId,fromDate:context.fromDate,thruDate:context.thruDate,factorOption:context.factorOption,needsValidation:context.needsValidation,lastUpdatedStamp:context.lastUpdatedStamp]"/></then><else><return error="true" message="Entry already exists for ${factorOption}"/></else></if></actions></service>