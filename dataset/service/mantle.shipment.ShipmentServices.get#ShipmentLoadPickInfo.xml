<!--Service Location mantle.shipment.ShipmentServices.get#ShipmentLoadPickInfo--><service verb="get" noun="ShipmentLoadPickInfo"><in-parameters><parameter name="workEffortId" required="true"/><parameter name="locationOrderBy" default-value="facilityId,sequenceNum,areaId,aisleId,sectionId,levelId,positionId"/><parameter name="productOrderBy" default-value="pseudoId,productName"/></in-parameters><out-parameters><parameter name="workEffort" type="Map"/><parameter name="dockFacility" type="Map"/><parameter name="warehouseFacility" type="Map"><description><![CDATA[The warehouse the shipments come
                from. Based on WorkEffort.facilityId unless it is a dock type facility and has a warehouse parent
                facility.]]></description></parameter><parameter name="assignedAssetList" type="List"/><parameter name="shipmentList" type="List"/><parameter name="shipmentPickPackInfoList" type="List"><description><![CDATA[List of Maps withs result from calls to
                the get#ShipmentPickPackInfo service.]]></description></parameter><parameter name="reservedLocationInfoList" type="List"/><parameter name="otherLocationInfoList" type="List"/><parameter name="productInfoList" type="List"/></out-parameters><actions><entity-find-one entity-name="mantle.work.effort.WorkEffort" value-field="workEffort"/><entity-find-one entity-name="mantle.facility.Facility" value-field="dockFacility"><field-map field-name="facilityId" from="workEffort.facilityId"/></entity-find-one><if condition="dockFacility && dockFacility.facilityTypeEnumId != 'FcTpWarehouse'"><then><entity-find-one entity-name="mantle.facility.Facility" value-field="warehouseFacility"><field-map field-name="facilityId" from="dockFacility.parentFacilityId"/></entity-find-one></then><else-if condition="dockFacility?.facilityTypeEnumId == 'FcTpWarehouse'"><set field="warehouseFacility" from="dockFacility"/><set field="dockFacility" from="null"/></else-if></if><entity-find entity-name="mantle.work.effort.WorkEffortAssetAndAssign" list="assignedAssetList"><date-filter/><econdition field-name="workEffortId"/><order-by field-name="assetName"/></entity-find><entity-find entity-name="mantle.shipment.Shipment" list="shipmentList"><econdition field-name="shipWorkEffortId" from="workEffortId"/><order-by field-name="binLocationNumber,shipmentId"/></entity-find><set field="shipmentPickPackInfoList" from="[]"/><set field="productInfoMap" from="[:]"/><set field="reservedLocationInfoMap" from="[:]"/><set field="otherLocationInfoMap" from="[:]"/><iterate list="shipmentList" entry="shipment"><set field="pickInfoOut" from="null"/><service-call name="mantle.shipment.ShipmentServices.get#ShipmentPickPackInfo" out-map="[shipment:pickInfoOut.shipment,orderIdSet:pickInfoOut.orderIdSet,orderPartList:pickInfoOut.orderPartList,invoiceIdSet:pickInfoOut.invoiceIdSet,invoiceList:pickInfoOut.invoiceList,firstRouteSegment:pickInfoOut.firstRouteSegment,carrierParty:pickInfoOut.carrierParty,shipmentMethodEnum:pickInfoOut.shipmentMethodEnum,carrierShipmentMethod:pickInfoOut.carrierShipmentMethod,lastRouteSegment:pickInfoOut.lastRouteSegment,originFacility:pickInfoOut.originFacility,destinationFacility:pickInfoOut.destinationFacility,fromPartyId:pickInfoOut.fromPartyId,fromPartyDetail:pickInfoOut.fromPartyDetail,fromContactInfo:pickInfoOut.fromContactInfo,logoImageLocation:pickInfoOut.logoImageLocation,toPartyDetail:pickInfoOut.toPartyDetail,toContactInfo:pickInfoOut.toContactInfo,toBillingContactInfo:pickInfoOut.toBillingContactInfo,reservedLocationInfoList:pickInfoOut.reservedLocationInfoList,otherLocationInfoList:pickInfoOut.otherLocationInfoList,productInfoList:pickInfoOut.productInfoList,packageInfoList:pickInfoOut.packageInfoList,reservedLocationInfoMap:pickInfoOut.reservedLocationInfoMap,otherLocationInfoMap:pickInfoOut.otherLocationInfoMap,productInfoMap:pickInfoOut.productInfoMap,templateLocation:pickInfoOut.templateLocation]" out-map-add-to-existing="false" in-map="[shipmentId:shipment.shipmentId, locationOrderBy:locationOrderBy, productOrderBy:productOrderBy]"/><script><![CDATA[shipmentPickPackInfoList.add(pickInfoOut)]]></script><iterate list="pickInfoOut.productInfoList" entry="curProductInfo"><set field="productInfo" from="productInfoMap.get(curProductInfo.productId)"/><if condition="productInfo != null"><then><set field="productInfo.quantity" from="productInfo.quantity + curProductInfo.quantity"/><iterate list="curProductInfo.productReservedLocationInfoMap" entry="curLocationInfo" key="assetLocKey"><set field="locationInfo" from="productInfo.productReservedLocationInfoMap.get(assetLocKey)"/><if condition="locationInfo"><then><set field="locationInfo.quantity" from="locationInfo.quantity + curLocationInfo.quantity"/><iterate list="curLocationInfo.quantityByBin" entry="quantity" key="binLocationNumber"><script><![CDATA[addToBigDecimalInMap(binLocationNumber, quantity, locationInfo.quantityByBin)]]></script></iterate></then><else><script><![CDATA[productInfo.productReservedLocationInfoMap.put(assetLocKey, curLocationInfo)]]></script></else></if></iterate><iterate list="curProductInfo.productOtherLocationInfoMap" entry="curLocationInfo" key="assetLocKey"><set field="locationInfo" from="productInfo.productOtherLocationInfoMap.get(assetLocKey)"/><if condition="locationInfo"><then><set field="locationInfo.quantity" from="locationInfo.quantity + curLocationInfo.quantity"/><iterate list="curLocationInfo.quantityByBin" entry="quantity" key="binLocationNumber"><script><![CDATA[addToBigDecimalInMap(binLocationNumber, quantity, locationInfo.quantityByBin)]]></script></iterate></then><else><script><![CDATA[productInfo.productOtherLocationInfoMap.put(assetLocKey, curLocationInfo)]]></script></else></if></iterate></then><else><script><![CDATA[productInfoMap.put(curProductInfo.productId, new LinkedHashMap(curProductInfo))]]></script></else></if></iterate><iterate list="pickInfoOut.reservedLocationInfoMap" entry="curLocationInfo" key="assetLocKey"><set field="locationInfo" from="reservedLocationInfoMap.get(assetLocKey)"/><if condition="locationInfo"><then><iterate list="curLocationInfo.productInfoMap" entry="curProductInfo" key="productId"><set field="productInfo" from="locationInfo.productInfoMap.get(productId)"/><if condition="productInfo"><then><set field="productInfo.quantity" from="productInfo.quantity + curProductInfo.quantity"/><iterate list="curProductInfo.quantityByBin" entry="quantity" key="binLocationNumber"><script><![CDATA[addToBigDecimalInMap(binLocationNumber, quantity, productInfo.quantityByBin)]]></script></iterate></then><else><script><![CDATA[locationInfo.productInfoMap.put(productId, curProductInfo)]]></script></else></if></iterate></then><else><script><![CDATA[reservedLocationInfoMap.put(assetLocKey, curLocationInfo)]]></script></else></if></iterate><iterate list="pickInfoOut.otherLocationInfoMap" entry="curLocationInfo" key="assetLocKey"><set field="locationInfo" from="otherLocationInfoMap.get(assetLocKey)"/><if condition="locationInfo"><then><iterate list="curLocationInfo.productInfoMap" entry="curProductInfo" key="productId"><set field="productInfo" from="locationInfo.productInfoMap.get(productId)"/><if condition="productInfo"><then><set field="productInfo.quantity" from="productInfo.quantity + curProductInfo.quantity"/><iterate list="curProductInfo.quantityByBin" entry="quantity" key="binLocationNumber"><script><![CDATA[addToBigDecimalInMap(binLocationNumber, quantity, productInfo.quantityByBin)]]></script></iterate></then><else><script><![CDATA[locationInfo.productInfoMap.put(productId, curProductInfo)]]></script></else></if></iterate></then><else><script><![CDATA[otherLocationInfoMap.put(assetLocKey, curLocationInfo)]]></script></else></if></iterate></iterate><set field="productInfoList" from="new ArrayList(productInfoMap.values())"/><order-map-list list="productInfoList"><order-by field-name="${productOrderBy}"/></order-map-list><iterate list="productInfoList" entry="productInfo"><set field="productInfo.reservedLocationInfoList" from="new ArrayList(productInfo.productReservedLocationInfoMap.values())"/><order-map-list list="productInfo.reservedLocationInfoList"><order-by field-name="${locationOrderBy}"/></order-map-list><set field="productInfo.otherLocationInfoList" from="new ArrayList(productInfo.productOtherLocationInfoMap.values())"/><order-map-list list="productInfo.otherLocationInfoList"><order-by field-name="${locationOrderBy}"/></order-map-list></iterate><set field="reservedLocationInfoList" from="new ArrayList(reservedLocationInfoMap.values())"/><order-map-list list="reservedLocationInfoList"><order-by field-name="${locationOrderBy}"/></order-map-list><iterate list="reservedLocationInfoList" entry="locationInfo"><set field="locationInfo.productInfoList" from="new ArrayList(locationInfo.productInfoMap.values())"/><order-map-list list="locationInfo.productInfoList"><order-by field-name="${productOrderBy}"/></order-map-list></iterate><set field="otherLocationInfoList" from="new ArrayList(otherLocationInfoMap.values())"/><order-map-list list="otherLocationInfoList"><order-by field-name="${locationOrderBy}"/></order-map-list><iterate list="otherLocationInfoList" entry="locationInfo"><set field="locationInfo.productInfoList" from="new ArrayList(locationInfo.productInfoMap.values())"/><order-map-list list="locationInfo.productInfoList"><order-by field-name="${productOrderBy}"/></order-map-list></iterate></actions></service>