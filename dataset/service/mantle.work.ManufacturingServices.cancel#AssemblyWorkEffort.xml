<!--Service Location mantle.work.ManufacturingServices.cancel#AssemblyWorkEffort--><service verb="cancel" noun="AssemblyWorkEffort"><in-parameters><parameter name="workEffortId" required="true"/><parameter name="cancelDate" type="Timestamp" default="ec.user.nowTimestamp"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.product.issuance.AssetIssuance" list="issuanceList"><econdition field-name="workEffortId"/></entity-find><entity-find entity-name="mantle.product.receipt.AssetReceipt" list="receiptList"><econdition field-name="workEffortId"/></entity-find><set field="assemblyQtyByAssetId" from="[:]"/><iterate list="receiptList" entry="receipt"><script><![CDATA[addToBigDecimalInMap(receipt.assetId, receipt.quantityAccepted, assemblyQtyByAssetId)]]></script></iterate><iterate list="assemblyQtyByAssetId" key="assetId" entry="assetQuantity"><service-call name="mantle.work.ManufacturingServices.breakDown#Assembly" in-map="[assetId:assetId, workEffortId:workEffortId, quantityToBreakDown:assetQuantity,                             unissueAssemblyComponents:false, breakDownDate:cancelDate]"/></iterate><set field="componentIssuedQtyByProduct" from="[:]"/><iterate list="issuanceList" entry="issuance"><script><![CDATA[addToBigDecimalInMap(issuance.productId, issuance.quantity, componentIssuedQtyByProduct)]]></script></iterate><iterate list="componentIssuedQtyByProduct" key="componentProductId" entry="componentQuantity"><service-call name="mantle.work.ManufacturingServices.unissue#Component" in-map="[workEffortId:workEffortId, componentProductId:componentProductId,                             componentQuantity:componentQuantity, unissueDate:cancelDate]"/></iterate><service-call name="update#mantle.work.effort.WorkEffort" in-map="[workEffortId:workEffortId, statusId:'WeCancelled', actualCompletionDate:null]"/></actions></service>