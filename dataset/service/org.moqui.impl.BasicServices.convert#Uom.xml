<!--Service Location org.moqui.impl.BasicServices.convert#Uom--><service verb="convert" noun="Uom"><in-parameters><parameter name="uomId" required="true" entity-name="moqui.basic.Uom" field-name="uomId"/><parameter name="toUomId" required="true"/><parameter name="effectiveDate" default="ec.user.nowTimestamp" type="Timestamp"/><parameter name="amount" type="BigDecimal" required="true"/></in-parameters><out-parameters><parameter name="convertedAmount" type="BigDecimal"/></out-parameters><actions><if condition="uomId == toUomId"><set field="convertedAmount" from="amount"/><return/></if><entity-find entity-name="moqui.basic.UomConversion" list="uomConversionList"><date-filter valid-date="effectiveDate"/><econdition field-name="uomId"/><econdition field-name="toUomId"/><order-by field-name="-fromDate"/><order-by field-name="-uomConversionId"/></entity-find><if condition="uomConversionList"><set field="uomConversion" from="uomConversionList.first"/><set field="convertedAmount" from="amount"/><if condition="uomConversion.conversionFactor"><set field="convertedAmount" from="(convertedAmount * uomConversion.conversionFactor) as BigDecimal"/></if><if condition="uomConversion.conversionOffset"><set field="convertedAmount" from="(convertedAmount + uomConversion.conversionOffset) as BigDecimal"/></if><return/></if><if condition="!uomConversionList"><entity-find entity-name="moqui.basic.UomConversion" list="uomConversionList"><date-filter valid-date="effectiveDate"/><econdition field-name="uomId" from="toUomId"/><econdition field-name="toUomId" from="uomId"/><order-by field-name="-fromDate"/><order-by field-name="-uomConversionId"/></entity-find><if condition="uomConversionList"><set field="uomConversion" from="uomConversionList.first"/><set field="convertedAmount" from="amount"/><if condition="uomConversion.conversionOffset"><set field="convertedAmount" from="(convertedAmount - uomConversion.conversionOffset) as BigDecimal"/></if><if condition="uomConversion.conversionFactor"><set field="convertedAmount" from="(convertedAmount / uomConversion.conversionFactor) as BigDecimal"/></if><return/></if></if><if condition="!uomConversionList"><entity-find-one entity-name="moqui.basic.Uom" value-field="uom"/><entity-find-one entity-name="moqui.basic.Uom" value-field="toUom"><field-map field-name="uomId" from="toUomId"/></entity-find-one><return error="true" message="Could not convert from ${uom?.description ?: uomId} to ${toUom?.description ?: toUomId}, no UOM Conversion found."/></if></actions></service>