<!--Service Location coarchy.CoarchyServices.create#Actor--><service verb="create" noun="Actor"><in-parameters><parameter name="name" required="true" entity-name="coarchy.Actor" field-name="name"/><parameter name="description" entity-name="coarchy.Actor" field-name="description"/><parameter name="partyIdList" type="List"/><parameter name="organizationId" required="true" entity-name="coarchy.Actor" field-name="organizationId"/><parameter name="isOwner" required="true" type="Boolean"/></in-parameters><out-parameters><parameter name="actorId" entity-name="coarchy.Actor" field-name="actorId"/><parameter name="partyIdList" type="List"/></out-parameters><actions><set field="name" from="name.trim()"/><if condition="Character.isLowerCase(name.charAt(0))"><set field="name" from="name[0].toUpperCase() + name.substring(1)"/></if><set field="description" from="description?.trim()"/><entity-find entity-name="coarchy.Actor" list="actorList" limit="20"><econdition field-name="name" from="name" ignore-case="true"/></entity-find><if condition="actorList"><return type="danger" message="Actor '${actorList?.getFirst()?.name}' already exists"/></if><service-call name="create#coarchy.Actor" in-map="[name:name,description:description,organizationId:organizationId]" out-map="[actorId:context.actorId,name:context.name,description:context.description,organizationId:context.organizationId,lastUpdatedStamp:context.lastUpdatedStamp]"/><if condition="isOwner"><iterate list="partyIdList" entry="partyId"><service-call name="create#coarchy.ActorParty" in-map="[actorId:actorId,partyId:partyId,organizationId:organizationId]"/></iterate></if></actions></service>