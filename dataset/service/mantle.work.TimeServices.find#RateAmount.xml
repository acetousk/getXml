<!--Service Location mantle.work.TimeServices.find#RateAmount--><service verb="find" noun="RateAmount"><in-parameters><parameter name="fromDate" type="Timestamp" entity-name="mantle.humanres.rate.RateAmount" field-name="fromDate"/><parameter name="thruDate" type="Timestamp" entity-name="mantle.humanres.rate.RateAmount" field-name="thruDate"/><parameter name="rateTypeEnumId" required="true" entity-name="mantle.humanres.rate.RateAmount" field-name="rateTypeEnumId"/><parameter name="ratePurposeEnumId" required="true" entity-name="mantle.humanres.rate.RateAmount" field-name="ratePurposeEnumId"/><parameter name="rateCurrencyUomId" required="true" entity-name="mantle.humanres.rate.RateAmount" field-name="rateCurrencyUomId"/><parameter name="timePeriodUomId" default-value="TF_hr" entity-name="mantle.humanres.rate.RateAmount" field-name="timePeriodUomId"/><parameter name="workEffortId" entity-name="mantle.humanres.rate.RateAmount" field-name="workEffortId"/><parameter name="partyId" entity-name="mantle.humanres.rate.RateAmount" field-name="partyId"/><parameter name="partyRelationshipId"/><parameter name="employerPartyId"/><parameter name="workTypeEnumId" entity-name="mantle.humanres.rate.RateAmount" field-name="workTypeEnumId"/><parameter name="payGradeId" entity-name="mantle.humanres.rate.RateAmount" field-name="payGradeId"/><parameter name="emplPositionClassId" entity-name="mantle.humanres.rate.RateAmount" field-name="emplPositionClassId"/></in-parameters><out-parameters><parameter name="rateAmountId" entity-name="mantle.humanres.rate.RateAmount" field-name="rateAmountId"/><parameter name="rateAmount" type="BigDecimal" entity-name="mantle.humanres.rate.RateAmount" field-name="rateAmount"/></out-parameters><actions><if condition="workEffortId"><entity-find-one entity-name="mantle.work.effort.WorkEffort" value-field="taskWorkEffort"><field-map field-name="workEffortId"/></entity-find-one></if><entity-find entity-name="mantle.humanres.rate.RateAmount" list="rateAmountList"><date-filter valid-date="fromDate ?: ec.user.nowTimestamp"/><econdition field-name="partyId" from="partyId" or-null="true"/><econditions combine="or"><econdition field-name="workEffortId" from="taskWorkEffort?.workEffortId" ignore-if-empty="true"/><econdition field-name="workEffortId" from="taskWorkEffort?.rootWorkEffortId" ignore-if-empty="true"/><econdition field-name="workEffortId" from="null"/></econditions><econdition field-name="emplPositionClassId" from="emplPositionClassId" or-null="true" ignore-if-empty="true"/><econdition field-name="workTypeEnumId" from="workTypeEnumId" or-null="true" ignore-if-empty="true"/><econdition field-name="ratePurposeEnumId"/><econdition field-name="rateTypeEnumId"/><econdition field-name="rateCurrencyUomId" or-null="true"/><econdition field-name="timePeriodUomId"/></entity-find><set field="fullRateAmountList" from="rateAmountList"/><if condition="taskWorkEffort != null"><set field="taskRaList" from="rateAmountList.findAll({ it.workEffortId == taskWorkEffort.workEffortId })"/><if condition="taskRaList"><then><set field="rateAmountList" from="taskRaList"/></then><else-if condition="taskWorkEffort.rootWorkEffortId"><set field="rootWeRaList" from="rateAmountList.findAll({ it.workEffortId == taskWorkEffort.rootWorkEffortId })"/><if condition="rootWeRaList"><set field="rateAmountList" from="rootWeRaList"/></if></else-if></if></if><set field="workTypeEnumId" from="workTypeEnumId ?: taskWorkEffort?.workTypeEnumId"/><if condition="partyId || partyRelationshipId"><if condition="partyRelationshipId"><then><entity-find entity-name="mantle.humanres.employment.EmploymentAndRelationship" list="employmentList"><date-filter valid-date="thruDate"/><econdition field-name="partyRelationshipId"/><econdition field-name="fromPartyId" from="partyId" ignore-if-empty="true"/><econdition field-name="toPartyId" from="employerPartyId" ignore-if-empty="true"/></entity-find><set field="employment" from="employmentList ? employmentList[0] : null"/><set field="partyId" from="partyId ?: employment?.fromPartyId ?: null"/></then><else-if condition="partyId && employerPartyId"><entity-find entity-name="mantle.humanres.employment.EmploymentAndRelationship" list="employmentList"><date-filter valid-date="thruDate"/><econdition field-name="fromPartyId" from="partyId"/><econdition field-name="toPartyId" from="employerPartyId"/></entity-find><set field="employment" from="employmentList ? employmentList[0] : null"/></else-if></if><if condition="employment?.emplPositionId"><entity-find-one entity-name="mantle.humanres.position.EmplPosition" value-field="emplPosition"><field-map field-name="emplPositionId" from="employment.emplPositionId"/></entity-find-one></if><set field="payGradeId" from="payGradeId ?: emplPosition?.payGradeId"/><set field="emplPositionClassId" from="emplPositionClassId ?: emplPosition?.emplPositionClassId"/><set field="partyRaList" from="rateAmountList.findAll({ it.partyId == partyId })"/><if condition="partyRaList"><set field="partyRateAmountToUse" from="findMaximalMatch(partyRaList,                         [workTypeEnumId:workTypeEnumId, payGradeId:payGradeId, emplPositionClassId:emplPositionClassId])"/></if></if><set field="nonPartyRaList" from="rateAmountList.findAll({it.partyId == null })"/><set field="nonPartyRateAmountToUse" from="findMaximalMatch(nonPartyRaList,                     [workTypeEnumId:workTypeEnumId, payGradeId:payGradeId, emplPositionClassId:emplPositionClassId])"/><if condition="partyRateAmountToUse"><then><if condition="nonPartyRateAmountToUse &&                                (nonPartyRateAmountToUse.rateAmount > partyRateAmountToUse.rateAmount)"><then><set field="rateAmountId" from="nonPartyRateAmountToUse.rateAmountId"/><set field="rateAmount" from="nonPartyRateAmountToUse.rateAmount"/></then><else><set field="rateAmountId" from="partyRateAmountToUse.rateAmountId"/><set field="rateAmount" from="partyRateAmountToUse.rateAmount"/></else></if></then><else><set field="rateAmountId" from="nonPartyRateAmountToUse?.rateAmountId"/><set field="rateAmount" from="nonPartyRateAmountToUse?.rateAmount"/></else></if></actions></service>