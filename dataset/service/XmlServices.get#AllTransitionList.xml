<!--Service Location XmlServices.get#AllTransitionList--><service verb="get" noun="AllTransitionList"><in-parameters><parameter name="filterScreenName"/><parameter name="outputFile" type="Boolean" required="true" default="false"/><parameter name="outputFilesToFolder" type="Boolean" required="true" default="false"/><parameter name="outputFolder" default-value="component://getXml/dataset/transition"/></in-parameters><out-parameters/><actions><script><![CDATA[import org.jsoup.Jsoup;
                import org.jsoup.nodes.Document;
                import org.jsoup.nodes.Element;
                import org.jsoup.select.Elements;]]></script><set field="rootScreenLocationList" from="ec.screen.getAllRootScreenLocations()"/><if condition="rootScreenLocationList.size() > 0"><set field="screenInfoList" from="ec.screen.getScreenInfoList(rootScreenLocationList[0], 100)"/></if><script><![CDATA[if (filterScreenName) {
                    Iterator theIterator = screenInfoList.iterator()
                    while (theIterator.hasNext()) {
                        String curSn = (String) theIterator.next().sd.location
                        if (!curSn.toUpperCase().contains(filterScreenName.toUpperCase())) theIterator.remove()
                    }
                }]]></script><if condition="outputFilesToFolder"><set field="outputFolder" from="ec.resource.getLocationReference(outputFolder)"/></if><set field="outTransitionXml" value=""/><iterate list="screenInfoList" entry="screenInfo"><set field="sd" from="screenInfo.sd"/><set field="inScreen" from="sd.location"/><set field="screenNode" from="sd.screenNode"/><set field="parameterList" from="screenNode.children('parameter')*.toString()"/><set field="screenActionList" from="[]"/><log level="warn" message="screenInfoParentList: ${screenInfoParentList}"/><set field="screenLevel" from="screenInfo.level"/><set field="usedScreenInfo" from="screenInfo"/><while condition="screenLevel >= -1"><set field="alwaysActionsNodeList" from="usedScreenInfo.sd.screenNode.children('always-actions')"/><if condition="!alwaysActionsNodeList"><set field="beforeLevel" from="usedScreenInfo.level"/><set field="usedScreenInfo" from="usedScreenInfo.parentInfo?:usedScreenInfo.rootInfo"/><if condition="!beforeLevel == usedScreenInfo?.level"><log level="warn" message="break"/><break/></if><set field="screenLevel" from="usedScreenInfo.level"/><continue/></if><set field="alwaysscreenActionList" from="alwaysActionsNodeList.get(0).children*.toString().reverse()"/><if condition="alwaysscreenActionList"><then><script><![CDATA[screenActionList +=alwaysscreenActionList+["""<!--always-actions at ${usedScreenInfo.sd.location}-->"""]]]></script></then><else/></if><set field="usedScreenInfo" from="usedScreenInfo?.parentInfo"/><set field="screenLevel" from="usedScreenInfo?.level"/></while><script><![CDATA[screenActionList = screenActionList.reverse()]]></script><set field="transitionInfoNameList" from="screenInfo.transitionInfoByName.keySet()"/><set field="transitionNameExcludeList" from="['formSelectColumns','screenDoc','formSaveFind']"/><iterate list="sd.getAllTransitions()" entry="transitionItem"><set field="transitionName" from="transitionItem.name"/><if condition="transitionNameExcludeList.contains(transitionName)"><continue/></if><set field="transitionNode" from="transitionItem.transitionNode"/><if condition="transitionNode == null"><else/></if><set field="actionList" from="screenActionList"/><if condition="!transitionNode && transitionItem.name == 'actions'"><log level="warn" message="transitionItem.location ${transitionItem.location} transitionName ${transitionName}"/><set field="preActionList" from="screenNode.children('pre-actions')"/><if condition="preActionList.size() > 0"><script><![CDATA[actionList += ["""<!--pre-actions-->"""]+preActionList.get(0).children*.toString()]]></script></if><set field="actionsList" from="screenNode.children('actions')"/><if condition="actionsList.size() > 0"><script><![CDATA[actionList += ["""<!--actions-->"""]+actionsList.get(0).children*.toString()]]></script></if></if><if condition="transitionNode && transitionItem.name != 'actions'"><set field="parameterList" from="parameterList+transitionNode.children('parameter')*.toString()"/><set field="parameterList" from="parameterList+transitionNode.children('path-parameter')*.toString()"/><set field="transitionServiceCallList" from="transitionNode.children('service-call')"/><if condition="transitionServiceCallList.size() > 0"><script><![CDATA[actionList += ["""<!--transition service-call-->"""]+transitionServiceCallList.get(0).toString()]]></script></if><set field="actionsList" from="transitionNode.children('actions')"/><set field="actionsList" from="transitionNode.children('actions')"/><if condition="actionsList.size() > 0"><script><![CDATA[actionList += ["""<!--transition actions-->"""]+actionsList.get(0).children*.toString()]]></script></if></if><set field="xml" from="ec.resource.template('component://getXml/template/transitionRender.xml.ftl', '.ftl')"/><log level="warn" message="xml: ${xml}"/><set field="xml" from="xml.replaceAll('>\\s+<', '><').trim()"/><if condition="outputFile"><set field="outTransitionXml" from="outTransitionXml+'\n'+xml"/></if><if condition="outputFilesToFolder"><script><![CDATA[outputFolder.makeFile((inScreen-'.xml'+'$'+transitionName+'.xml').replaceAll('/', '-')).putText(xml)]]></script></if></iterate></iterate><if condition="outputFile"><script><![CDATA[ec.resource.getLocationReference('component://getXml/dataset/allTransitions.xml').putText(outScreenXml)]]></script><script><![CDATA[ec.resource.getLocationReference('component://getXml/dataset/allTransitions.txt').putText(outScreenXml)]]></script></if></actions></service>