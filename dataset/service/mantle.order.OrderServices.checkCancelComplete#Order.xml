<!--Service Location mantle.order.OrderServices.checkCancelComplete#Order--><service verb="checkCancelComplete" noun="Order"><in-parameters><parameter name="orderId"/></in-parameters><out-parameters><parameter name="oldStatusId"/><parameter name="statusChanged" type="Boolean"/></out-parameters><actions><set field="statusChanged" from="false"/><entity-find entity-name="mantle.order.OrderPart" list="orderPartList"><econdition field-name="orderId"/></entity-find><set field="allCancelled" from="true"/><set field="anyCompleted" from="false"/><set field="allCancelledOrCompleted" from="true"/><iterate list="orderPartList" entry="curOrderPart"><if condition="curOrderPart.statusId in ['OrderRejected', 'OrderCancelled']"><continue/></if><if condition="curOrderPart.statusId == 'OrderCompleted'"><set field="allCancelled" from="false"/><set field="anyCompleted" from="true"/><continue/></if><set field="allCancelled" from="false"/><set field="allCancelledOrCompleted" from="false"/></iterate><if condition="allCancelled"><then><service-call name="update#mantle.order.OrderHeader" out-map="[orderId:context.orderId,orderName:context.orderName,entryDate:context.entryDate,placedDate:context.placedDate,approvedDate:context.approvedDate,completedDate:context.completedDate,statusId:context.statusId,processingStatusId:context.processingStatusId,orderRevision:context.orderRevision,currencyUomId:context.currencyUomId,billingAccountId:context.billingAccountId,productStoreId:context.productStoreId,salesChannelEnumId:context.salesChannelEnumId,terminalId:context.terminalId,displayId:context.displayId,externalId:context.externalId,externalRevision:context.externalRevision,originId:context.originId,originUrl:context.originUrl,syncStatusId:context.syncStatusId,systemMessageRemoteId:context.systemMessageRemoteId,visitId:context.visitId,enteredByPartyId:context.enteredByPartyId,parentOrderId:context.parentOrderId,recurCronExpression:context.recurCronExpression,lastOrderedDate:context.lastOrderedDate,recurAutoInvoice:context.recurAutoInvoice,remainingSubTotal:context.remainingSubTotal,grandTotal:context.grandTotal,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[orderId:orderId, statusId:'OrderCancelled']"/></then><else-if condition="anyCompleted && allCancelledOrCompleted"><service-call name="update#mantle.order.OrderHeader" out-map="[orderId:context.orderId,orderName:context.orderName,entryDate:context.entryDate,placedDate:context.placedDate,approvedDate:context.approvedDate,completedDate:context.completedDate,statusId:context.statusId,processingStatusId:context.processingStatusId,orderRevision:context.orderRevision,currencyUomId:context.currencyUomId,billingAccountId:context.billingAccountId,productStoreId:context.productStoreId,salesChannelEnumId:context.salesChannelEnumId,terminalId:context.terminalId,displayId:context.displayId,externalId:context.externalId,externalRevision:context.externalRevision,originId:context.originId,originUrl:context.originUrl,syncStatusId:context.syncStatusId,systemMessageRemoteId:context.systemMessageRemoteId,visitId:context.visitId,enteredByPartyId:context.enteredByPartyId,parentOrderId:context.parentOrderId,recurCronExpression:context.recurCronExpression,lastOrderedDate:context.lastOrderedDate,recurAutoInvoice:context.recurAutoInvoice,remainingSubTotal:context.remainingSubTotal,grandTotal:context.grandTotal,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[orderId:orderId, statusId:'OrderCompleted']"/></else-if></if></actions></service>