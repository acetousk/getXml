<!--Service Location mantle.party.PartyServices.get#PartyOrganizationInfo--><service verb="get" noun="PartyOrganizationInfo"><in-parameters><parameter name="partyId" default="ec.user.userAccount?.partyId"/></in-parameters><out-parameters><parameter name="activeOrgId"/><parameter name="userOrgIds" type="List"><parameter name="userOrgId"/></parameter><parameter name="filterOrgIds" type="List"><parameter name="userOrgId"/></parameter></out-parameters><actions><if condition="!partyId"><set field="userOrgIds" from="[]"/><set field="filterOrgIds" from="[]"/><return/></if><entity-find entity-name="mantle.party.PartyToAndRelationship" list="userOrgRelList"><date-filter/><econditions combine="or"><econditions><econdition field-name="relationshipTypeEnumId" operator="in" value="PrtAgent,PrtEmployee,PrtMember"/><econdition field-name="toRoleTypeId" value="OrgInternal"/><econdition field-name="fromPartyId" from="partyId"/></econditions><econdition field-name="visibilityEnumId" value="PvPublic"/></econditions></entity-find><set field="userOrgIds" from="[]"/><iterate list="userOrgRelList" entry="userOrgRel"><if condition="!userOrgIds.contains(userOrgRel.toPartyId)"><script><![CDATA[userOrgIds.add(userOrgRel.toPartyId)]]></script><entity-find entity-name="mantle.party.PartyRelationship" list="childRelList"><date-filter/><econdition field-name="relationshipTypeEnumId" value="PrtOrgRollup"/><econdition field-name="toPartyId" from="userOrgRel.toPartyId"/><econdition field-name="fromPartyId" operator="is-not-null"/></entity-find><iterate list="childRelList" entry="childRel"><if condition="!userOrgIds.contains(childRel.fromPartyId)"><entity-find-one entity-name="mantle.party.PartyDetail" value-field="childOrg"><field-map field-name="partyId" from="childRel.fromPartyId"/></entity-find-one><script><![CDATA[userOrgIds.add(childRel.fromPartyId)]]></script></if></iterate></if></iterate><set field="activeOrgId" from="ec.user.getPreference('ACTIVE_ORGANIZATION')"/><if condition="activeOrgId != null && activeOrgId.length() == 0"><set field="activeOrgId" from="null"/></if><if condition="activeOrgId && !userOrgIds.contains(activeOrgId)"><set field="activeOrgId" from="null"/><script><![CDATA[ec.user.setPreference('ACTIVE_ORGANIZATION', null)]]></script></if><set field="filterOrgIds" from="activeOrgId ? [activeOrgId] : userOrgIds"/></actions></service>