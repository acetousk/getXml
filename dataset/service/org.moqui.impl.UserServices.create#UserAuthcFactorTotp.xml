<!--Service Location org.moqui.impl.UserServices.create#UserAuthcFactorTotp--><service verb="create" noun="UserAuthcFactorTotp"><in-parameters><parameter name="userId" required="true"/><parameter name="thruDate" type="Timestamp" default="ec.user.nowTimestamp + 365"/><parameter name="needsValidation" default-value="Y"/></in-parameters><out-parameters><parameter name="factorId"/><parameter name="factorOption"/></out-parameters><actions><script><![CDATA[import dev.samstevens.totp.secret.DefaultSecretGenerator
                DefaultSecretGenerator gen = new DefaultSecretGenerator()]]></script><set field="factorTypeEnumId" value="UafTotp"/><set field="fromDate" from="ec.user.nowTimestamp"/><set field="factorOption" from="gen.generate()"/><service-call name="create#moqui.security.UserAuthcFactor" in-map="context" out-map="[factorId:context.factorId,userId:context.userId,fromFactorId:context.fromFactorId,factorTypeEnumId:context.factorTypeEnumId,fromDate:context.fromDate,thruDate:context.thruDate,factorOption:context.factorOption,needsValidation:context.needsValidation,lastUpdatedStamp:context.lastUpdatedStamp]"/></actions></service>