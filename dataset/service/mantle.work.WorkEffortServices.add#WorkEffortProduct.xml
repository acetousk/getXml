<!--Service Location mantle.work.WorkEffortServices.add#WorkEffortProduct--><service verb="add" noun="WorkEffortProduct"><in-parameters><parameter name="workEffortId" required="true" entity-name="mantle.work.effort.WorkEffortProduct" field-name="workEffortId"/><parameter name="productId" required="true" entity-name="mantle.work.effort.WorkEffortProduct" field-name="productId"/><parameter name="thruDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.work.effort.WorkEffortProduct" field-name="thruDate"/><parameter name="typeEnumId" type="java.lang.String" required="true" allow-html="none" entity-name="mantle.work.effort.WorkEffortProduct" field-name="typeEnumId"/><parameter name="statusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.work.effort.WorkEffortProduct" field-name="statusId"/><parameter name="estimatedQuantity" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.effort.WorkEffortProduct" field-name="estimatedQuantity"/><parameter name="estimatedCost" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.work.effort.WorkEffortProduct" field-name="estimatedCost"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.work.effort.WorkEffortProduct" field-name="lastUpdatedStamp"/></in-parameters><out-parameters><parameter name="fromDate" type="Timestamp" entity-name="mantle.work.effort.WorkEffortProduct" field-name="fromDate"/></out-parameters><actions><entity-find entity-name="mantle.work.effort.WorkEffortProduct" list="existingWepList"><date-filter/><econdition field-name="workEffortId"/><econdition field-name="productId"/><econdition field-name="typeEnumId"/></entity-find><if condition="existingWepList"><set field="existingWep" from="existingWepList[0]"/><set field="estimatedQuantity" from="(estimatedQuantity ?: 0) + (existingWep.estimatedQuantity ?: 0)"/><entity-set value-field="existingWep" include="nonpk"/><entity-update value-field="existingWep"/><else><service-call name="create#mantle.work.effort.WorkEffortProduct" in-map="context" out-map="[workEffortId:context.workEffortId,productId:context.productId,fromDate:context.fromDate,thruDate:context.thruDate,typeEnumId:context.typeEnumId,statusId:context.statusId,estimatedQuantity:context.estimatedQuantity,estimatedCost:context.estimatedCost,lastUpdatedStamp:context.lastUpdatedStamp]"/></else></if></actions></service>