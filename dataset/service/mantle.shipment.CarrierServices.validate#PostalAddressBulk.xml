<!--Service Location mantle.shipment.CarrierServices.validate#PostalAddressBulk--><service verb="validate" noun="PostalAddressBulk"><in-parameters><parameter name="partyClassificationId"/><parameter name="contactMechPurposeId"/><parameter name="validateLimit" type="Long" default="100"/><parameter name="countOnly" type="Boolean" default="true"><description><![CDATA[Set to false for actual bulk validate, defaults to true as a safety measure.]]></description></parameter><parameter name="shippingGatewayConfigId"><description><![CDATA[Defaults in call to validate#PostalAddress]]></description></parameter></in-parameters><out-parameters><parameter name="foundNewCount" type="Long"/><parameter name="validateCount" type="Long"/></out-parameters><actions><entity-find entity-name="mantle.party.PartyContactMechAndClass" list="pcmList"><date-filter/><econdition field-name="contactMechTypeEnumId" value="CmtPostalAddress"/><econdition field-name="trustLevelEnumId" value="CmtlNew" or-null="true"/><econdition field-name="partyClassificationId" ignore-if-empty="true"/><econdition field-name="contactMechPurposeId" ignore-if-empty="true"/><select-field field-name="contactMechId,partyId,contactMechPurposeId"/></entity-find><set field="foundNewCount" from="pcmList.size()"/><set field="validateCount" from="0"/><log message="In validate#PostalAddressBulk found ${foundNewCount} new addresses; validateLimit=${validateLimit}, partyClassificationId=${partyClassificationId}, contactMechPurposeId=${contactMechPurposeId}"/><if condition="countOnly"><return/></if><set field="startTime" from="System.currentTimeMillis()"/><iterate list="pcmList" entry="pcm"><if condition="validateCount >= validateLimit"><break/></if><service-call name="mantle.shipment.CarrierServices.validate#PostalAddress" out-map="[contactMechId:validateOut.contactMechId]" transaction="force-new" in-map="[contactMechId:pcm.contactMechId, partyId:pcm.partyId, shippingGatewayConfigId:shippingGatewayConfigId]"/><set field="validateCount" from="validateCount + 1"/></iterate><log message="Validated ${validateCount} addresses in ${(System.currentTimeMillis() - startTime)/(1000*60)} minutes"/></actions></service>