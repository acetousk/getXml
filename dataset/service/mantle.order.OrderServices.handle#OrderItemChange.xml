<!--Service Location mantle.order.OrderServices.handle#OrderItemChange--><service verb="handle" noun="OrderItemChange"><in-parameters><parameter name="orderId" required="true"/><parameter name="orderItemSeqId"/><parameter name="orderPartSeqId"/><parameter name="itemTypeEnumId"/><parameter name="quantity" type="BigDecimal"/><parameter name="unitAmount" type="BigDecimal"/><parameter name="selectedAmount" type="BigDecimal"/><parameter name="isPromo"/><parameter name="originalValue" type="Map"/><parameter name="eecaOperation"/></in-parameters><out-parameters/><actions><if condition="eecaOperation == 'delete'"><service-call name="mantle.order.OrderServices.update#OrderPartTotal" in-map="context"/><return/></if><if condition="!originalValue || quantity != originalValue.quantity || unitAmount != originalValue.unitAmount ||                     selectedAmount != originalValue.selectedAmount || orderPartSeqId != originalValue.orderPartSeqId"><then><entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderHeader" for-update="true"/><service-call name="mantle.order.OrderServices.update#OrderPartTotal" in-map="context"/><if condition="originalValue && orderPartSeqId != originalValue.orderPartSeqId"><service-call name="mantle.order.OrderServices.update#OrderPartTotal" in-map="[orderId:orderId, orderPartSeqId:originalValue.orderPartSeqId]"/></if><if condition="orderHeader.productStoreId && isPromo != 'Y' && !(itemTypeEnumId in ['ItemShipping', 'ItemSalesTax', 'ItemVatTax'])"><service-call name="mantle.order.OrderServices.handle#OrderMajorChange" in-map="[orderId:orderId, orderPartSeqId:orderPartSeqId]"/><if condition="originalValue && orderPartSeqId != originalValue.orderPartSeqId"><service-call name="mantle.order.OrderServices.handle#OrderMajorChange" in-map="[orderId:orderId, orderPartSeqId:originalValue.orderPartSeqId]"/></if></if></then><else><service-call name="mantle.order.OrderServices.increment#OrderRevision" in-map="context"/></else></if></actions></service>