<!--Service Location mantle.product.AssetServices.move#IssuancesToNewShipment--><service verb="move" noun="IssuancesToNewShipment"><in-parameters><parameter name="shipmentId" required="true"/><parameter name="newOrderId" required="true"/><parameter name="newShipmentId" required="true"/><parameter name="issuedDate" type="Timestamp" default="ec.user.nowTimestamp"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.product.issuance.AssetIssuance" list="issuanceList" for-update="true"><econdition field-name="shipmentId"/></entity-find><entity-find entity-name="mantle.order.OrderItem" list="orderItemList"><econdition field-name="orderId" from="newOrderId"/></entity-find><iterate list="issuanceList" entry="issuance"><service-call name="update#mantle.product.issuance.AssetIssuance" in-map="[assetIssuanceId:issuance.assetIssuanceId, quantityCancelled:issuance.quantity, quantity:0]"/><filter-map-list list="orderItemList" to-list="prodOrderItemList"><field-map field-name="productId" from="issuance.productId"/></filter-map-list><if condition="!prodOrderItemList"><return error="true" message="In move issuance to new shipment no Order Item found on order ${newOrderId} for product ${issuance.productId}"/></if><service-call name="create#mantle.product.issuance.AssetIssuance" in-map="[assetId:issuance.assetId, quantity:issuance.quantity, orderId:newOrderId,                             orderItemSeqId:prodOrderItemList[0].orderItemSeqId, shipmentId:newShipmentId,                             productId:issuance.productId, issuedDate:issuedDate, issuedByUserId:ec.user.userId]"/></iterate></actions></service>