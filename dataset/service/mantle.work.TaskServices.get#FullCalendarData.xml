<!--Service Location mantle.work.TaskServices.get#FullCalendarData--><service verb="get" noun="FullCalendarData"><in-parameters><parameter name="partyId"/><parameter name="partyIdList" type="List"><parameter name="partyId"/></parameter><parameter name="start" required="true"/><parameter name="end" required="true"/><parameter name="titleGString" default-value="\${(workEffort.workEffortName ?: (workEffort.purposeEnumId ? workEffort.'WorkEffortPurpose#moqui.basic.Enumeration'.description : 'Event')) + ' [' + workEffort.workEffortId + ']'}"/><parameter name="urlGString"/></in-parameters><out-parameters><parameter name="eventList" type="List"><parameter name="eventMap" type="Map"><parameter name="id"/><parameter name="title"/><parameter name="start"><description><![CDATA[actualStartDate or estimatedStartDate as ISO8601 formatted String]]></description></parameter><parameter name="end"><description><![CDATA[actualCompletionDate or estimatedCompletionDate (or if null start date +
                        actualWorkDuration, estimatedWorkDuration, or estimatedWorkTime) as a ISO8601 (yyyy-MM-dd'T'HH:mm:ss) formatted String]]></description></parameter><parameter name="url"><description><![CDATA[Only returned if urlGString is specified]]></description></parameter></parameter></parameter></out-parameters><actions><set field="startTs" from="ec.l10n.parseTimestamp(start.toString() + ' 00:00:00.000', 'yyyy-MM-dd HH:mm:ss.SSS')"/><set field="endTs" from="ec.l10n.parseTimestamp(end.toString() + ' 23:59:59.999', 'yyyy-MM-dd HH:mm:ss.SSS')"/><set field="partyIdSet" from="new HashSet()"/><if condition="partyId"><script><![CDATA[partyIdSet.add(partyId)]]></script></if><if condition="partyIdList"><script><![CDATA[partyIdSet.addAll(partyIdList)]]></script></if><set field="eventList" from="[]"/><if condition="!partyIdSet"><return/></if><entity-find entity-name="mantle.work.effort.WorkEffortAndParty" list="workEffortList"><econdition field-name="workEffortTypeEnumId" value="WetTask"/><econditions combine="or"><econdition field-name="ownerPartyId" operator="in" from="partyIdSet" ignore-if-empty="true"/><econdition field-name="partyId" operator="in" from="partyIdSet" ignore-if-empty="true"/></econditions><econditions combine="or"><econditions combine="and"><econdition field-name="estimatedCompletionDate" operator="greater-equals" from="startTs"/><econdition field-name="estimatedCompletionDate" operator="less-equals" from="endTs"/></econditions><econditions combine="and"><econdition field-name="actualCompletionDate" operator="greater-equals" from="startTs"/><econdition field-name="actualCompletionDate" operator="less-equals" from="endTs"/></econditions></econditions><select-field field-name="workEffortId,purposeEnumId,workEffortName,description,location,timeUomId"/><select-field field-name="actualStartDate,actualCompletionDate,actualWorkTime,actualWorkDuration"/><select-field field-name="estimatedStartDate,estimatedCompletionDate,estimatedWorkTime,estimatedWorkDuration"/></entity-find><iterate list="workEffortList" entry="workEffortDef"><set field="workEffort" from="workEffortDef"/><set field="title" from="ec.resource.expand(titleGString, '')"/><service-call name="mantle.work.WorkEffortServices.get#WorkEffortStartEnd" out-map="[startDate:startEndOut.startDate,endDate:startEndOut.endDate,duration:startEndOut.duration,allDay:startEndOut.allDay]" in-map="[workEffortId:workEffort.workEffortId, workEffort:workEffort]"/><set field="start" from="ec.l10n.format(startEndOut.startDate, 'yyyy-MM-dd\'T\'HH:mm:ss')"/><set field="end" from="ec.l10n.format(startEndOut.endDate, 'yyyy-MM-dd\'T\'HH:mm:ss')"/><if condition="urlGString"><set field="url" from="ec.resource.expand(urlGString, '')"/><else><set field="url" value=""/></else></if><set field="eventMap" from="[id:workEffort.workEffortId, title:title, start:start, end:end, url:url, allDay:true]"/><script><![CDATA[eventList.add(eventMap)]]></script></iterate></actions></service>