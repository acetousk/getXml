<!--Service Location org.moqui.impl.UserServices.increment#UserAccountFailedLogins--><service verb="increment" noun="UserAccountFailedLogins"><in-parameters><parameter name="userId" required="true"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="moqui.security.UserAccount" value-field="userAccount"/><set field="userAccount.successiveFailedLogins" from="userAccount.successiveFailedLogins ? userAccount.successiveFailedLogins + 1 : 1"/><set field="maxFailures" from="(ec.ecfi.confXmlRoot.first('user-facade').first('login').attribute('max-failures') ?: 3) as Integer"/><if condition="userAccount.successiveFailedLogins > maxFailures && userAccount.disabled != 'Y'"><set field="userAccount.disabled" value="Y"/><set field="userAccount.disabledDateTime" from="ec.user.nowTimestamp"/></if><log level="warn" message="User ${userId} failed logins [${userAccount.successiveFailedLogins}], maxFailures [${maxFailures}], disabled [${userAccount.disabled}]"/><entity-update value-field="userAccount"/></actions></service>