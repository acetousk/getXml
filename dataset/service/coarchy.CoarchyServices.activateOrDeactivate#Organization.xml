<!--Service Location coarchy.CoarchyServices.activateOrDeactivate#Organization--><service verb="activateOrDeactivate" noun="Organization"><in-parameters><parameter name="organizationPartyId" required="true"/></in-parameters><out-parameters><parameter name="needsCredits" type="Boolean"/><parameter name="creditsNeeded" type="Integer"/></out-parameters><actions><entity-find entity-name="mantle.party.Party" list="organizationPartyList"><econdition field-name="partyId" from="organizationPartyId"/><econdition field-name="ownerPartyId" from="ec.user.userAccount.partyId"/></entity-find><if condition="organizationPartyList.size() == 0"><return type="danger" message="Cannot activate organization you do not own"/></if><entity-find entity-name="mantle.party.PartyActivation" list="partyActivationList"><econdition field-name="partyId" from="organizationPartyId"/><date-filter/></entity-find><if condition="partyActivationList.size() == 0"><then><service-call name="coarchy.CoarchyServices.check#PartyActivation" in-map="[userPartyId:ec.user.userAccount?.partyId, finAccountTypeId:'OrganizationMonthCredit']" out-map="[organizationChangeList:context.organizationChangeList,needsCredits:context.needsCredits,creditsNeeded:context.creditsNeeded,totalCreditsUsed:context.totalCreditsUsed,periodFromDate:context.periodFromDate,periodThruDate:context.periodThruDate,activationThruDate:context.activationThruDate]"/><if condition="needsCredits"><then><return type="warning" public="true" message="${ec.resource.expand('CoarchyOrgActivateInsuffCredits', null, [creditsNeeded: creditsNeeded])}"/></then><else><service-call name="create#mantle.party.PartyActivation" in-map="[partyId:organizationPartyId,                         fromDate:ec.user.nowTimestamp]"/></else></if></then><else><service-call name="update#mantle.party.PartyActivation" in-map="[partyId:organizationPartyId,                     fromDate:partyActivationList.getFirst().fromDate,thruDate:ec.user.nowTimestamp]"/></else></if></actions></service>