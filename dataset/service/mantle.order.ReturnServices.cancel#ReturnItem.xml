<!--Service Location mantle.order.ReturnServices.cancel#ReturnItem--><service verb="cancel" noun="ReturnItem"><in-parameters><parameter name="returnId" required="true" entity-name="mantle.order.return.ReturnItem" field-name="returnId"/><parameter name="returnItemSeqId" required="true" entity-name="mantle.order.return.ReturnItem" field-name="returnItemSeqId"/></in-parameters><out-parameters><parameter name="statusId" entity-name="mantle.order.return.ReturnItem" field-name="statusId"/><parameter name="oldStatusId"/><parameter name="statusChanged" type="Boolean"/></out-parameters><actions><entity-find-one entity-name="mantle.order.return.ReturnItem" value-field="returnItem"/><if condition="returnItem.statusId == 'ReturnCancelled'"><set field="statusId" value="ReturnCancelled"/><set field="oldStatusId" value="ReturnCancelled"/><set field="statusChanged" from="false"/><return/></if><if condition="!(returnItem.statusId in ['ReturnCreated', 'ReturnRequested', 'ReturnApproved'])"><return error="true" message="Return item ${returnId}:${returnItemSeqId} in status ${returnItem.status?.description} cannot be cancelled"/></if><set field="statusId" value="ReturnCancelled"/><entity-find entity-name="mantle.order.return.ReturnItem" list="childItemList"><econdition field-name="returnId"/><econdition field-name="parentItemSeqId" from="returnItemSeqId"/></entity-find><iterate list="childItemList" entry="childItem"><service-call name="mantle.order.ReturnServices.cancel#ReturnItem" out-map="[statusId:itemOut.statusId,oldStatusId:itemOut.oldStatusId,statusChanged:itemOut.statusChanged]" in-map="[returnId:returnId, returnItemSeqId:childItem.returnItemSeqId]"/></iterate><service-call name="update#mantle.order.return.ReturnItem" out-map="[returnId:context.returnId,returnItemSeqId:context.returnItemSeqId,parentItemSeqId:context.parentItemSeqId,returnReasonEnumId:context.returnReasonEnumId,returnResponseEnumId:context.returnResponseEnumId,responseImmediate:context.responseImmediate,itemTypeEnumId:context.itemTypeEnumId,productId:context.productId,replacementProductId:context.replacementProductId,description:context.description,orderId:context.orderId,orderItemSeqId:context.orderItemSeqId,statusId:context.statusId,inventoryStatusId:context.inventoryStatusId,returnQuantity:context.returnQuantity,receivedQuantity:context.receivedQuantity,returnPrice:context.returnPrice,responseAmount:context.responseAmount,externalId:context.externalId,responseDate:context.responseDate,replacementOrderId:context.replacementOrderId,finAccountTransId:context.finAccountTransId,refundPaymentId:context.refundPaymentId,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[returnId:returnId, returnItemSeqId:returnItemSeqId, statusId:statusId]"/></actions></service>