<!--Service Location mantle.shipment.ShipmentServices.convert#ProductBoxQuantity--><service verb="convert" noun="ProductBoxQuantity"><in-parameters><parameter name="productId" required="true"/><parameter name="originalQuantity" type="BigDecimal"/><parameter name="shipmentBoxTypeId"/><parameter name="originalQuantityUomId"><description><![CDATA[If not specified uses ShipmentBoxType.capacityUomId]]></description></parameter></in-parameters><out-parameters><parameter name="originalQuantityUomId"/><parameter name="convertedQuantity" type="BigDecimal"/></out-parameters><actions><if condition="originalQuantity == null"><set field="convertedQuantity" from="0"/><return/></if><if condition="shipmentBoxTypeId && !originalQuantityUomId"><entity-find-one entity-name="mantle.shipment.ShipmentBoxType" value-field="shipmentBoxType" cache="true"/><set field="originalQuantityUomId" from="shipmentBoxType.capacityUomId"/></if><entity-find-one entity-name="mantle.product.Product" value-field="product" cache="true"/><if condition="!product?.amountUomId"><return error="true" message="Cannot convert quantity for product [${productId}], no amountUomId found."/></if><service-call name="org.moqui.impl.BasicServices.convert#Uom" out-map="[convertedAmount:convertQuantityOut.convertedAmount]" in-map="[uomId:originalQuantityUomId, toUomId:product.amountUomId, amount:originalQuantity]"/><set field="convertedQuantity" from="convertQuantityOut?.convertedAmount ?: 0"/></actions></service>