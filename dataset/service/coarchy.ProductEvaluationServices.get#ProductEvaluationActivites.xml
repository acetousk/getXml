<!--Service Location coarchy.ProductEvaluationServices.get#ProductEvaluationActivites--><service verb="get" noun="ProductEvaluationActivites"><in-parameters><parameter name="productEvaluationId" required="true"/></in-parameters><out-parameters><parameter name="processStoryIds"/><parameter name="activityIds"/><parameter name="activityList"/></out-parameters><actions><entity-find-one entity-name="coarchy.product.ProductEvaluation" value-field="productEvaluation"/><entity-find entity-name="coarchy.product.ProductEvaluationStory" list="productEvaluationStoryList"><econdition field-name="productEvaluationId"/></entity-find><set field="processStoryIds" from="productEvaluationStoryList*.processStoryId"/><iterate list="productEvaluationStoryList" entry="productEvaluationStory"><service-call name="coarchy.ProductEvaluationServices.get#ProcessStoryDescendants" out-map="[descendantIdList:descOut.descendantIdList]" out-map-add-to-existing="false" in-map="[processStoryId:productEvaluationStory.processStoryId]"/><script><![CDATA[processStoryIds.addAll(descOut.descendantIdList)]]></script></iterate><entity-find entity-name="coarchy.product.ProductEvaluationActivity" list="includedActivityList"><econdition field-name="productEvaluationId"/><econdition field-name="excludeFlag" value="N" or-null="true"/></entity-find><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="activityList"><econdition field-name="processStoryId" operator="in" from="processStoryIds"/><econdition field-name="activityId" operator="in" from="includedActivityList*.activityId"/><econditions combine="or"><econdition field-name="condition" operator="not-equals" value=""/><econdition field-name="action" operator="not-equals" value=""/></econditions><select-field field-name="processStoryId,activityId,condition,action"/></entity-find><set field="activityIds" from="activityList*.activityId"/></actions></service>