<!--Service Location mantle.product.AssetServices.issue#AnyAssetToWorkEffort--><service verb="issue" noun="AnyAssetToWorkEffort"><in-parameters><parameter name="productId" required="true"/><parameter name="facilityId" required="true"/><parameter name="workEffortId" required="true"/><parameter name="quantity" type="BigDecimal" required="true"/><parameter name="issuedDate" type="Timestamp" default="ec.user.nowTimestamp"/></in-parameters><out-parameters><parameter name="assetIdList" type="List"><parameter name="assetId"/></parameter></out-parameters><actions><entity-find entity-name="mantle.product.asset.Asset" list="assetList"><econdition field-name="productId"/><econdition field-name="facilityId"/><econdition field-name="availableToPromiseTotal" operator="greater" from="0"/><econdition field-name="statusId" value="AstAvailable"/><order-by field-name="receivedDate"/></entity-find><set field="assetIdList" from="[]"/><set field="remainingQuantity" from="quantity"/><iterate list="assetList" entry="asset"><set field="curQuantity" from="asset.availableToPromiseTotal > remainingQuantity ? remainingQuantity : asset.availableToPromiseTotal"/><if condition="curQuantity"><service-call name="mantle.product.AssetServices.issue#AssetToWorkEffort" in-map="[workEffortId:workEffortId, assetId:asset.assetId, issuedDate:issuedDate, quantity:curQuantity]"/><set field="remainingQuantity" from="remainingQuantity - curQuantity"/><if condition="remainingQuantity == 0"><break/></if></if></iterate><if condition="remainingQuantity > 0"><message><![CDATA[Could not find available inventory for ${remainingQuantity} out of ${quantity}]]></message></if></actions></service>