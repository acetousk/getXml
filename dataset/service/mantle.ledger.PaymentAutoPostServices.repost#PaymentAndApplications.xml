<!--Service Location mantle.ledger.PaymentAutoPostServices.repost#PaymentAndApplications--><service verb="repost" noun="PaymentAndApplications"><in-parameters><parameter name="paymentId" required="true"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.account.payment.Payment" value-field="payment" for-update="true"/><if condition="payment == null"><return error="true" message="Could not find Payment with ID ${paymentId}"/></if><if condition="!(payment.statusId in ['PmntDelivered', 'PmntConfirmed'])"><return error="true" message="Payment ${paymentId} cannot be posted in status ${payment.statusId}"/></if><entity-find entity-name="mantle.account.payment.PaymentApplication" list="paymentApplicationList" for-update="true"><econdition field-name="paymentId"/></entity-find><set field="allPaymentTxTypes" from="['AttPayment', 'AttDisbursement', 'AttReceipt', 'AttPaymentAdjust',                     'AttIncomingPayment', 'AttOutgoingPayment', 'AttOutgoingPaymentAp', 'AttIncomingPaymentAp', 'AttPaymentApplied']"/><entity-find entity-name="mantle.ledger.transaction.AcctgTrans" list="existingTransList"><econdition field-name="paymentId"/><econdition field-name="acctgTransTypeEnumId" operator="in" from="allPaymentTxTypes"/><econdition field-name="reversedByAcctgTransId" from="null"/><econdition field-name="reverseOfAcctgTransId" from="null"/></entity-find><if condition="!existingTransList"><log level="warn" message="In repost#PaymentAndApplications ${paymentId} no existing AcctgTrans records found"/></if><iterate list="existingTransList" entry="acctgTrans"><service-call name="mantle.ledger.LedgerServices.unpost#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/><service-call name="mantle.ledger.LedgerServices.delete#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/></iterate><service-call name="mantle.ledger.PaymentAutoPostServices.post#Payment" in-map="[paymentId:paymentId]"/><iterate list="paymentApplicationList" entry="paymentApplication"><service-call name="mantle.ledger.PaymentAutoPostServices.post#PaymentApplication" in-map="[paymentApplicationId:paymentApplication.paymentApplicationId]"/></iterate></actions></service>