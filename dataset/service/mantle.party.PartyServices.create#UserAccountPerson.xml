<!--Service Location mantle.party.PartyServices.create#UserAccountPerson--><service verb="create" noun="UserAccountPerson"><in-parameters><parameter name="userId" required="true"/></in-parameters><out-parameters><parameter name="partyId"/><parameter name="emailContactMechId"/></out-parameters><actions><entity-find-one entity-name="moqui.security.UserAccount" value-field="userAccount"/><if condition="userAccount.partyId"><return/></if><service-call name="create#mantle.party.Party" in-map="[partyTypeEnumId:'PtyPerson', disabled:'N']" out-map="[partyId:newPartyOut.partyId,pseudoId:newPartyOut.pseudoId,partyTypeEnumId:newPartyOut.partyTypeEnumId,disabled:newPartyOut.disabled,customerStatusId:newPartyOut.customerStatusId,ownerPartyId:newPartyOut.ownerPartyId,externalId:newPartyOut.externalId,dataSourceId:newPartyOut.dataSourceId,gatewayCimId:newPartyOut.gatewayCimId,comments:newPartyOut.comments,shippingInstructions:newPartyOut.shippingInstructions,hasDuplicates:newPartyOut.hasDuplicates,lastDupCheckDate:newPartyOut.lastDupCheckDate,mergedToPartyId:newPartyOut.mergedToPartyId,visibilityEnumId:newPartyOut.visibilityEnumId,lastUpdatedStamp:newPartyOut.lastUpdatedStamp]"/><set field="partyId" from="newPartyOut.partyId"/><set field="userAccount.partyId" from="partyId"/><entity-update value-field="userAccount"/><set field="firstName" from="userAccount.userFullName ?: userAccount.username"/><set field="lastName" from="null"/><if condition="firstName?.contains(' ')"><set field="lastName" from="firstName.substring(firstName.lastIndexOf(' ')+1)"/><set field="firstName" from="firstName.substring(0, firstName.lastIndexOf(' '))"/></if><service-call name="create#mantle.party.Person" in-map="[partyId:partyId, firstName:firstName, lastName:lastName]"/><if condition="userAccount.emailAddress"><service-call name="mantle.party.ContactServices.create#EmailAddress" out-map="[contactMechId:emailOut.contactMechId]" in-map="[emailAddress:userAccount.emailAddress, partyId:partyId, contactMechPurposeId:'EmailPrimary']"/><set field="emailContactMechId" from="emailOut.contactMechId"/></if></actions></service>