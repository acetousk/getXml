<!--Service Location mantle.account.PaymentServices.check#InvoiceStatusForPayment--><service verb="check" noun="InvoiceStatusForPayment"><in-parameters><parameter name="invoiceId"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.account.invoice.Invoice" value-field="invoice"/><set field="validStatusIds" from="['InvoiceInProcess', 'InvoiceFinalized', 'InvoiceSent', 'InvoiceAcked', 'InvoiceWriteOff', 'InvoiceReceived', 'InvoiceApproved']"/><if condition="!validStatusIds.contains(invoice.statusId)"><entity-find-related-one value-field="invoice" relationship-name="Invoice#moqui.basic.StatusItem" to-value-field="statusEnum"/><return error="true" message="Invoice is in ${statusEnum.description} status, payment not allowed."/></if><if condition="invoice.statusId == 'InvoiceInProcess'"><service-call name="update#mantle.account.invoice.Invoice" in-map="[invoiceId:invoiceId, statusId:'InvoiceFinalized']"/></if><if condition="invoice.statusId == 'InvoiceReceived'"><service-call name="update#mantle.account.invoice.Invoice" in-map="[invoiceId:invoiceId, statusId:'InvoiceApproved']"/></if></actions></service>