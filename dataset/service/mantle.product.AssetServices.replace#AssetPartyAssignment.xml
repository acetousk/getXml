<!--Service Location mantle.product.AssetServices.replace#AssetPartyAssignment--><service verb="replace" noun="AssetPartyAssignment"><in-parameters><parameter name="assetId" required="true" entity-name="mantle.product.asset.AssetPartyAssignment" field-name="assetId"/><parameter name="roleTypeId" required="true" entity-name="mantle.product.asset.AssetPartyAssignment" field-name="roleTypeId"/><parameter name="newPartyId" required="true"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.product.asset.AssetPartyAssignment" list="apaList"><date-filter/><econdition field-name="assetId"/><econdition field-name="roleTypeId"/></entity-find><set field="foundExisting" from="false"/><iterate list="apaList" entry="apaValue"><if condition="apaValue.partyId != newPartyId"><then><set field="apaValue.thruDate" from="ec.user.nowTimestamp"/><entity-update value-field="apaValue"/></then><else><set field="foundExisting" from="true"/></else></if></iterate><if condition="!foundExisting"><service-call name="create#mantle.product.asset.AssetPartyAssignment" in-map="[assetId:assetId,                     partyId:newPartyId, roleTypeId:roleTypeId, fromDate:ec.user.nowTimestamp]"/></if></actions></service>