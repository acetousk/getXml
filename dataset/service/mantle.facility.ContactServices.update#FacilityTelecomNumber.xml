<!--Service Location mantle.facility.ContactServices.update#FacilityTelecomNumber--><service verb="update" noun="FacilityTelecomNumber"><in-parameters><parameter name="countryCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="countryCode"/><parameter name="areaCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="areaCode"/><parameter name="contactNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="contactNumber"/><parameter name="askForName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="askForName"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="lastUpdatedStamp"/><parameter name="facilityId" required="true"/><parameter name="contactMechId" required="true"/><parameter name="contactMechPurposeId"/></in-parameters><out-parameters><parameter name="contactMechId" required="true"/></out-parameters><actions><entity-find-one entity-name="mantle.party.contact.TelecomNumber" value-field="origTelecomNumber"/><script><![CDATA[newTelecomNumber = origTelecomNumber.cloneValue()]]></script><entity-set value-field="newTelecomNumber" include="nonpk"/><if condition="newTelecomNumber == origTelecomNumber"><log message="No fields were different for Telecom Number with ID [${contactMechId}], not updating."/><return/></if><entity-find entity-name="mantle.facility.FacilityContactMech" list="origFcmList"><date-filter/><econdition field-name="facilityId" from="facilityId"/><econdition field-name="contactMechId" from="contactMechId"/><econdition field-name="contactMechPurposeId" from="contactMechPurposeId" ignore-if-empty="true"/></entity-find><if condition="!origFcmList"><return error="true" message="Telecom Number with ID [${contactMechId}] is not associated with Facility ID [${facilityId}] and purpose [${contactMechPurposeId?:'N/A'}], not updating."/></if><entity-find-one entity-name="mantle.party.contact.ContactMech" value-field="newContactMech"/><set field="newContactMech.contactMechId" from="null"/><set field="newContactMech.replacesContactMechId" from="newContactMech.contactMechId"/><set field="newContactMech.contactMechId" from="null"/><set field="newContactMech.gatewayCimId" from="null"/><set field="newContactMech.trustLevelEnumId" value="CmtlNew"/><set field="newContactMech.validateMessage" from="null"/><set field="newContactMech.paymentFraudEvidenceId" from="null"/><entity-sequenced-id-primary value-field="newContactMech"/><entity-create value-field="newContactMech"/><set field="newTelecomNumber.contactMechId" from="newContactMech.contactMechId"/><entity-create value-field="newTelecomNumber"/><iterate list="origFcmList" entry="origFcm"><set field="origFcm.thruDate" from="ec.user.nowTimestamp"/><entity-update value-field="origFcm"/><entity-make-value entity-name="mantle.facility.FacilityContactMech" value-field="newFcm" map="[facilityId:facilityId, contactMechId:newContactMech.contactMechId, fromDate:ec.user.nowTimestamp]"/><set field="newFcm.contactMechPurposeId" from="origFcm.contactMechPurposeId"/><set field="newFcm.extension" from="origFcm.extension"/><set field="newFcm.comments" from="origFcm.comments"/><entity-create value-field="newFcm"/></iterate><set field="result.contactMechId" from="newContactMech.contactMechId"/></actions></service>