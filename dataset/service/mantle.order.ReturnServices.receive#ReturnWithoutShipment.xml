<!--Service Location mantle.order.ReturnServices.receive#ReturnWithoutShipment--><service verb="receive" noun="ReturnWithoutShipment"><in-parameters><parameter name="returnId" required="true"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.shipment.ShipmentItemSource" list="shipmentItemSourceList"><econdition field-name="returnId"/></entity-find><set field="shipmentIdSet" from="new TreeSet(shipmentItemSourceList*.shipmentId)"/><iterate list="shipmentIdSet" entry="shipmentId"><service-call name="mantle.shipment.ShipmentServices.cancel#Shipment" in-map="[shipmentId:shipmentId, undoIssueReceive:false]"/><message><![CDATA[Canceled return shipment ${shipmentId}]]></message></iterate><entity-find entity-name="mantle.order.return.ReturnItem" list="returnItemList" for-update="true"><econdition field-name="returnId"/></entity-find><iterate list="returnItemList" entry="returnItem"><if condition="!(returnItem.statusId in ['ReturnApproved', 'ReturnShipped'])"><continue/></if><service-call name="mantle.order.ReturnServices.receive#ReturnItem" out-map="[oldStatusId:context.oldStatusId,statusChanged:context.statusChanged]" in-map="[returnId:returnId,                     returnItemSeqId:returnItem.returnItemSeqId, receivedQuantity:(returnItem.returnQuantity - (returnItem.receivedQuantity ?: 0.0))]"/></iterate><service-call name="mantle.order.ReturnServices.process#ReturnItemResponses" in-map="[returnId:returnId]"/></actions></service>