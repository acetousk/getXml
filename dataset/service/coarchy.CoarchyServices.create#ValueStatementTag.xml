<!--Service Location coarchy.CoarchyServices.create#ValueStatementTag--><service verb="create" noun="ValueStatementTag"><in-parameters><parameter name="description"><matches regexp="(?<=\s|^)(\w*[A-Za-z_]+\w*)" message="CoarchyTagInvalidFormat"/></parameter><parameter name="tagId" entity-name="coarchy.ValueStatementTag" field-name="tagId"/><parameter name="organizationId" required="true" entity-name="coarchy.ValueStatementTag" field-name="organizationId"/><parameter name="valueStatementId" required="true" entity-name="coarchy.ValueStatementTag" field-name="valueStatementId"/></in-parameters><out-parameters><parameter name="tagId" entity-name="coarchy.ValueStatementTag" field-name="tagId"/></out-parameters><actions><set field="description" from="(description?:'').trim()"/><if condition="!tagId && !description"><return error="true" message="Please specify at least one existing tag, or a new one."/></if><if condition="tagId"><entity-find entity-name="coarchy.Tag" list="tagList"><econdition field-name="tagId"/><econdition field-name="organizationId"/></entity-find><if condition="!tagList"><return error="true" message="Invalid tag specified."/></if><else><service-call name="coarchy.CoarchyServices.getOrCreate#Tag" in-map="[description:description, organizationId:organizationId]" out-map="[tagId:context.tagId]"/></else></if><service-call name="coarchy.CoarchyServices.delete#ValueStatementTag" in-map="[tagId:tagId, valueStatementId:valueStatementId, organizationId:organizationId]" out-map="[]"/><service-call name="create#coarchy.ValueStatementTag" in-map="[tagId:tagId, valueStatementId:valueStatementId, organizationId:organizationId, fromDate:ec.user.nowTimestamp]" out-map="[tagId:context.tagId,valueStatementId:context.valueStatementId,fromDate:context.fromDate,thruDate:context.thruDate,organizationId:context.organizationId,lastUpdatedStamp:context.lastUpdatedStamp]"/></actions></service>