<!--Service Location mantle.product.ProductServices.find#ProductByIdValue--><service verb="find" noun="ProductByIdValue"><in-parameters><parameter name="idValue" required="true"/><parameter name="ownerPartyId"/><parameter name="shipmentId"><description><![CDATA[For Product lookup in the context of a Shipment, common case for scanned IDs]]></description></parameter></in-parameters><out-parameters><parameter name="productId"/></out-parameters><actions><if condition="shipmentId"><entity-find entity-name="mantle.shipment.ShipmentItem" list="shipmentItemList"><econdition field-name="shipmentId"/></entity-find><set field="productIdList" from="shipmentItemList*.productId"/></if><if condition="ownerPartyId"><then><set field="ownerPartyIds" from="['_NA_', ownerPartyId]"/></then><else><entity-find entity-name="mantle.shipment.ShipmentParty" list="assetOwnerPartyList"><econdition field-name="shipmentId"/><econdition field-name="roleTypeId" value="AssetOwner"/><order-by field-name="partyId"/></entity-find><if condition="assetOwnerPartyList"><set field="ownerPartyIds" from="['_NA_'] + assetOwnerPartyList*.partyId"/></if></else></if><entity-find entity-name="mantle.product.Product" list="productByPseudoList"><econdition field-name="pseudoId" from="idValue"/><econdition field-name="ownerPartyId" operator="in" from="ownerPartyIds" ignore-if-empty="true"/><econdition field-name="productId" operator="in" from="productIdList" ignore-if-empty="true"/><select-field field-name="productId"/></entity-find><if condition="productByPseudoList"><set field="productId" from="productByPseudoList[0].productId"/></if><if condition="!productId"><entity-find entity-name="mantle.product.ProductIdentificationAndProduct" list="prodIdentList"><econdition field-name="idValue"/><econdition field-name="ownerPartyId" operator="in" from="ownerPartyIds" ignore-if-empty="true"/><econdition field-name="productId" operator="in" from="productIdList" ignore-if-empty="true"/></entity-find><if condition="prodIdentList.size() == 1"><then><set field="productId" from="prodIdentList[0].productId"/></then><else-if condition="prodIdentList.size() > 1"><message type="warning"><![CDATA[Found multiple products with ID ${idValue}: ${prodIdentList*.productId.join(', ')}]]></message></else-if></if></if><if condition="!productId"><entity-find entity-name="mantle.product.Product" list="productByProdIdList"><econdition field-name="productId" from="idValue"/><econdition field-name="ownerPartyId" operator="in" from="ownerPartyIds" ignore-if-empty="true"/><select-field field-name="productId"/></entity-find><if condition="productByProdIdList"><set field="productId" from="productByProdIdList[0].productId"/></if></if></actions></service>