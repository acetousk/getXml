<!--Service Location coarchy.CoarchyServices.update#Actor--><service verb="update" noun="Actor"><in-parameters><parameter name="actorId" required="true" entity-name="coarchy.Actor" field-name="actorId"/><parameter name="name" required="true" entity-name="coarchy.Actor" field-name="name"/><parameter name="description" entity-name="coarchy.Actor" field-name="description"/><parameter name="partyIdList" type="List"/><parameter name="organizationId" required="true" entity-name="coarchy.Actor" field-name="organizationId"/><parameter name="isOwner" required="true" type="Boolean"/></in-parameters><out-parameters><parameter name="actorId" entity-name="coarchy.Actor" field-name="actorId"/></out-parameters><actions><set field="name" from="name.trim()"/><if condition="Character.isLowerCase(name.charAt(0))"><set field="name" from="name[0].toUpperCase() + name.substring(1)"/></if><set field="description" from="description?.trim()"/><entity-find entity-name="coarchy.Actor" list="actorList" limit="20"><econdition field-name="actorId" operator="not-equals"/><econdition field-name="name" from="name" ignore-case="true"/></entity-find><if condition="actorList"><return type="danger" message="Actor '${actorList?.getFirst()?.name}' already exists"/></if><service-call name="update#coarchy.Actor" in-map="[actorId:actorId,name:name,description:description,organizationId:organizationId]"/><if condition="isOwner"><entity-find entity-name="coarchy.ActorParty" list="actorPartyList"><econdition field-name="actorId"/><order-by field-name="actorId"/></entity-find><set field="partyIdServerList" from="actorPartyList*.partyId"/><if condition="partyIdServerList"><set field="partyIdDeleteList" from="partyIdServerList - partyIdList?:[]"/><iterate list="partyIdDeleteList" entry="partyIdDelete"><service-call name="delete#coarchy.ActorParty" in-map="[actorId:actorId,partyId:partyIdDelete]"/></iterate></if><set field="partyIdCreateList" from="partyIdList?:[] - partyIdDeleteList?:[]"/><if condition="partyIdCreateList instanceof String"><then><service-call name="store#coarchy.ActorParty" in-map="[actorId:actorId, partyId:partyIdCreateList, organizationId:organizationId]"/></then><else><iterate list="partyIdCreateList" entry="partyIdCreate"><service-call name="store#coarchy.ActorParty" in-map="[actorId:actorId, partyId:partyIdCreate, organizationId:organizationId]"/></iterate></else></if></if></actions></service>