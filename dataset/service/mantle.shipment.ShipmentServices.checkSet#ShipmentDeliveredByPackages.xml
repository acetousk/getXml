<!--Service Location mantle.shipment.ShipmentServices.checkSet#ShipmentDeliveredByPackages--><service verb="checkSet" noun="ShipmentDeliveredByPackages"><in-parameters><parameter name="shipmentId"/></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.shipment.Shipment" value-field="shipment"/><if condition="shipment.statusId in ['ShipPacked', 'ShipShipped']"><entity-find entity-name="mantle.shipment.ShipmentPackageRouteSeg" list="checkSprsList"><econdition field-name="shipmentId"/></entity-find><set field="foundNotDelivered" from="false"/><set field="trackingStatusDate" from="null"/><iterate list="checkSprsList" entry="checkSprs"><if condition="checkSprs.trackingStatusEnumId == 'ShTsDelivered'"><then><if condition="trackingStatusDate == null || trackingStatusDate < checkSprs.trackingStatusDate"><set field="trackingStatusDate" from="checkSprs.trackingStatusDate"/></if></then><else><set field="foundNotDelivered" from="true"/></else></if></iterate><if condition="checkSprsList && !foundNotDelivered"><service-call name="mantle.shipment.ShipmentServices.deliver#Shipment" in-map="[shipmentId:shipment.shipmentId, actualArrivalDate:trackingStatusDate]"/></if></if></actions></service>