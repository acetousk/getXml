<!--Service Location mantle.party.CommunicationServices.save#CommunicationEventContentFile--><service verb="save" noun="CommunicationEventContentFile"><in-parameters><parameter name="communicationEventContentId" required="true"/><parameter name="communicationEventId" required="true"/><parameter name="contentFile" type="org.apache.commons.fileupload.FileItem" required="true"/><parameter name="saveContentLocation" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="contentLocation"/></out-parameters><actions><set field="filename" from="contentFile.getName()"/><if condition="org.moqui.resource.ResourceReference.isTextFilename(filename)"><then><set field="contentRoot" from="ec.user.getPreference('mantle.content.root') ?: 'dbresource://mantle/content'"/></then><else><set field="contentRoot" from="ec.user.getPreference('mantle.content.large.root') ?: 'dbresource://mantle/content'"/></else></if><set field="contentLocation" value="${contentRoot}/CommunicationEvent/${communicationEventId}/content_${communicationEventContentId}/${filename}"/><set field="docRr" from="ec.resource.getLocationReference(contentLocation)"/><script><![CDATA[fileStream = contentFile.getInputStream()
                try { docRr.putStream(fileStream) } finally { fileStream.close() }]]></script><if condition="saveContentLocation"><service-call name="update#mantle.party.communication.CommunicationEventContent" in-map="[communicationEventContentId:communicationEventContentId, contentLocation:contentLocation]"/></if></actions></service>