<!--Service Location mantle.ledger.AssetAutoPostServices.repost#AssetIssuance--><service verb="repost" noun="AssetIssuance"><in-parameters><parameter name="assetIssuanceId" required="true" entity-name="mantle.product.issuance.AssetIssuance" field-name="assetIssuanceId"/></in-parameters><out-parameters><parameter name="acctgTransId"/></out-parameters><actions><entity-find-one entity-name="mantle.product.issuance.AssetIssuance" value-field="assetIssuance" for-update="true"/><if condition="assetIssuance == null"><return error="true" message="In repost could not find Asset Issuance with ID ${assetIssuanceId}"/></if><if condition="assetIssuance.quantity == null"><return message="No quantity issued (is null), not reposting inventory transaction to GL for issuance ${assetIssuanceId}"/></if><entity-find entity-name="mantle.ledger.transaction.AcctgTrans" list="existingTransList"><econdition field-name="assetIssuanceId"/><econdition field-name="acctgTransTypeEnumId" operator="in" from="['AttInventoryIssuance', 'AttAssetIssuance']"/><econdition field-name="reversedByAcctgTransId" from="null"/><econdition field-name="reverseOfAcctgTransId" from="null"/></entity-find><if condition="!existingTransList"><then><log level="warn" message="In repost#AssetIssuance ${assetIssuanceId} no existing AcctgTrans records found"/></then><else><log message="In repost#AssetIssuance ${assetIssuanceId} unposting and deleting AcctgTrans ${existingTransList*.acctgTransId}"/></else></if><iterate list="existingTransList" entry="acctgTrans"><service-call name="mantle.ledger.LedgerServices.unpost#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/><service-call name="mantle.ledger.LedgerServices.delete#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/></iterate><entity-find-one entity-name="mantle.product.asset.Asset" value-field="asset"><field-map field-name="assetId" from="assetIssuance.assetId"/></entity-find-one><if condition="asset?.acquireCost && asset?.ownerPartyId"><service-call name="mantle.ledger.AssetAutoPostServices.post#AssetIssuance" in-map="[assetIssuanceId:assetIssuanceId]"/></if></actions></service>