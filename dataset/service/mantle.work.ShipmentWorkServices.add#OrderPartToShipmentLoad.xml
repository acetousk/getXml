<!--Service Location mantle.work.ShipmentWorkServices.add#OrderPartToShipmentLoad--><service verb="add" noun="OrderPartToShipmentLoad"><in-parameters><parameter name="orderId" required="true"/><parameter name="orderPartSeqId" required="true"/><parameter name="workEffortId" required="true"/><parameter name="binLocationNumber" type="Long"/><parameter name="allowBulkLocations" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="shipmentIdList"/></out-parameters><actions><entity-find-one entity-name="mantle.work.effort.WorkEffort" value-field="workEffort" for-update="true"/><if condition="workEffort.statusId in ['WeInProgress', 'WeComplete', 'WeClosed', 'WeCancelled']"><return type="danger" message="Cannot add Order to Picklist ${workEffortId} in status ${workEffort.status?.description ?: workEffort.statusId}"/></if><entity-find-one entity-name="mantle.order.OrderPart" value-field="orderPart"/><if condition="orderPart.statusId != 'OrderApproved'"><return type="danger" message="Order ${orderId} part ${orderPartSeqId} is not in Approved status, not shipping"/></if><entity-find entity-name="mantle.order.OrderItem" list="orderItemList"><econdition field-name="orderId"/><econdition field-name="orderPartSeqId"/></entity-find><set field="orderItemSeqIdList" from="orderItemList*.orderItemSeqId"/><entity-find entity-name="mantle.shipment.ShipmentAndItemSource" list="shipmentItemSourceList" distinct="true"><econdition field-name="orderId"/><econdition field-name="orderItemSeqId" operator="in" from="orderItemSeqIdList"/><econdition field-name="shipmentStatusId" operator="in" value="ShipInput,ShipScheduled"/><econdition field-name="statusId" operator="not-equals" value="SisCancelled"/><select-field field-name="shipmentId"/></entity-find><set field="shipmentIdList" from="shipmentItemSourceList*.shipmentId"/><if condition="!shipmentIdList"><service-call name="mantle.shipment.ShipmentServices.create#OrderPartShipment" out-map="[shipmentId:createShipmentOut.shipmentId,shipmentPackageSeqId:createShipmentOut.shipmentPackageSeqId]" in-map="[orderId:orderId, orderPartSeqId:orderPartSeqId]"/><if condition="createShipmentOut.shipmentId"><set field="shipmentIdList" from="[createShipmentOut.shipmentId]"/></if></if><iterate list="shipmentIdList" entry="shipmentId"><service-call name="mantle.work.ShipmentWorkServices.add#ShipmentToShipmentLoad" in-map="[shipmentId:shipmentId,                         workEffortId:workEffortId, binLocationNumber:binLocationNumber, allowBulkLocations:allowBulkLocations]"/></iterate></actions></service>