<!--Service Location mantle.work.ManufacturingServices.unissue#AssemblyComponents--><service verb="unissue" noun="AssemblyComponents"><in-parameters><parameter name="workEffortId" required="true"/><parameter name="assemblyProductId" required="true"/><parameter name="assemblyQuantity" type="BigDecimal" required="true"><description><![CDATA[Unissues up to this * ProductAssoc.quantity for each component]]></description></parameter><parameter name="unissueDate" type="Timestamp" default="ec.user.nowTimestamp"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.shipment.Shipment" list="shipmentList"><econdition field-name="assemblyWorkEffortId" from="workEffortId"/></entity-find><if condition="shipmentList.size() == 1"><set field="shipmentId" from="shipmentList[0].shipmentId"/></if><if condition="shipmentId"><entity-find entity-name="mantle.shipment.ShipmentItemSource" list="assemblySisList"><econdition field-name="shipmentId"/><econdition field-name="productId" from="assemblyProductId"/><order-by field-name="shipmentItemSourceId"/></entity-find></if><entity-find entity-name="mantle.product.ProductAssoc" list="bomAssocList"><date-filter/><econdition field-name="productId" from="assemblyProductId"/><econdition field-name="productAssocTypeEnumId" value="PatMfgBom"/></entity-find><iterate list="bomAssocList" entry="bomAssoc"><service-call name="mantle.work.ManufacturingServices.unissue#Component" in-map="[workEffortId:workEffortId, componentProductId:bomAssoc.toProductId,                             componentQuantity:(assemblyQuantity * (bomAssoc.quantity ?: 1.0)), unissueDate:unissueDate]"/></iterate></actions></service>