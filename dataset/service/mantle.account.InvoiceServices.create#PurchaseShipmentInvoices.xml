<!--Service Location mantle.account.InvoiceServices.create#PurchaseShipmentInvoices--><service verb="create" noun="PurchaseShipmentInvoices"><in-parameters><parameter name="shipmentId" required="true"/><parameter name="statusId"><description><![CDATA[If specified after create set to
                this statusId (always created initially in InvoiceInProcess, so there must be a transition to specified
                status).]]></description></parameter><parameter name="invoiceDate" type="Timestamp"><description><![CDATA[Defaults to Shipment packedDate or now.]]></description></parameter></in-parameters><out-parameters><parameter name="invoiceIdList" type="List"><parameter name="invoiceId"/></parameter></out-parameters><actions><entity-find-one entity-name="mantle.shipment.Shipment" value-field="shipment"/><if condition="shipment == null"><return error="true" message="Shipment not found with ID ${shipmentId}"/></if><set field="shipmentTypeEnum" from="shipment.'ShipmentType#moqui.basic.Enumeration'"/><if condition="shipmentTypeEnum?.enumId == 'ShpTpIncoming' || shipmentTypeEnum?.parentEnumId == 'ShpTpIncoming'"><set field="handleIssuances" from="false"/><set field="applyPayments" from="false"/><set field="handleReceipts" from="true"/><service-call name="mantle.account.InvoiceServices.create#SalesShipmentInvoices" in-map="context" out-map="[invoiceIdByOrderPartIdMap:context.invoiceIdByOrderPartIdMap]"/></if></actions></service>