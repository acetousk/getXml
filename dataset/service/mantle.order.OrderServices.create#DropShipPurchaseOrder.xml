<!--Service Location mantle.order.OrderServices.create#DropShipPurchaseOrder--><service verb="create" noun="DropShipPurchaseOrder"><in-parameters><parameter name="salesOrderId" required="true"/><parameter name="vendorPartyId"><description><![CDATA[Party of the Dropshipper]]></description></parameter><parameter name="customerPartyId"><description><![CDATA[Party of the Internal Organization. Defaults to the Sales Order Part vendorPartyId that has an OrgInternal PartyRole]]></description></parameter><parameter name="productStoreId" default="null"/><parameter name="orderName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="orderName"/><parameter name="entryDate" type="Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="entryDate" default="ec.user.nowTimestamp"/><parameter name="placedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="placedDate"/><parameter name="approvedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="approvedDate"/><parameter name="completedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="completedDate"/><parameter name="statusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="statusId" default-value="OrderOpen"/><parameter name="processingStatusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="processingStatusId"/><parameter name="orderRevision" type="Integer" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="orderRevision" default="1"/><parameter name="currencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="currencyUomId"/><parameter name="billingAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="billingAccountId"/><parameter name="salesChannelEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="salesChannelEnumId"/><parameter name="terminalId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="terminalId"/><parameter name="displayId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="displayId"/><parameter name="externalId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="externalId"/><parameter name="externalRevision" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="externalRevision"/><parameter name="originId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="originId"/><parameter name="originUrl" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="originUrl"/><parameter name="syncStatusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="syncStatusId"/><parameter name="systemMessageRemoteId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="systemMessageRemoteId"/><parameter name="visitId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="visitId" default="ec.user.visitId"/><parameter name="enteredByPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="enteredByPartyId"/><parameter name="recurCronExpression" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="recurCronExpression"/><parameter name="recurAutoInvoice" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="recurAutoInvoice"/><parameter name="remainingSubTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="remainingSubTotal"/><parameter name="grandTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="grandTotal"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="lastUpdatedStamp"/><parameter name="parentPartSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="parentPartSeqId"/><parameter name="partName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="partName"/><parameter name="otherPartyOrderId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="otherPartyOrderId"/><parameter name="otherPartyOrderDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="otherPartyOrderDate"/><parameter name="facilityId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="facilityId"/><parameter name="carrierPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="carrierPartyId"/><parameter name="shipmentMethodEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="shipmentMethodEnumId"/><parameter name="tradeTermEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="tradeTermEnumId"/><parameter name="settlementTermId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="settlementTermId"/><parameter name="postalContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="postalContactMechId"/><parameter name="telecomContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="telecomContactMechId"/><parameter name="trackingNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="trackingNumber"/><parameter name="shippingInstructions" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="shippingInstructions"/><parameter name="maySplit" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="maySplit"/><parameter name="signatureRequiredEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="signatureRequiredEnumId"/><parameter name="giftMessage" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="giftMessage"/><parameter name="isGift" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="isGift"/><parameter name="isNewCustomer" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="isNewCustomer"/><parameter name="partTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="partTotal"/><parameter name="priority" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="priority"/><parameter name="shipAfterDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="shipAfterDate"/><parameter name="shipBeforeDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="shipBeforeDate"/><parameter name="estimatedShipDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="estimatedShipDate"/><parameter name="estimatedDeliveryDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="estimatedDeliveryDate"/><parameter name="estimatedPickUpDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="estimatedPickUpDate"/><parameter name="validFromDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="validFromDate"/><parameter name="validThruDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="validThruDate"/><parameter name="autoCancelDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="autoCancelDate"/><parameter name="dontCancelSetDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="dontCancelSetDate"/><parameter name="dontCancelSetUserId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="dontCancelSetUserId"/><parameter name="disablePromotions" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="disablePromotions"/><parameter name="disableShippingCalc" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="disableShippingCalc"/><parameter name="disableTaxCalc" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="disableTaxCalc"/><parameter name="reservationAutoEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="reservationAutoEnumId"/><parameter name="checkoutId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="checkoutId"/><parameter name="checkoutUrl" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderPart" field-name="checkoutUrl"/><parameter name="requiredByDate" type="Timestamp"/><parameter name="clearDates" type="Boolean" default="true"/><parameter name="productItemsOnly" type="Boolean" default="true"/><parameter name="copyContactMech" type="Boolean" default="true"/><parameter name="copyContent" type="Boolean" default="true"/><parameter name="copyNote" type="Boolean" default="true"/><parameter name="copyPartParty" type="Boolean" default="false"/><parameter name="copyTerm" type="Boolean" default="false"/><parameter name="copyItemWorkEffort" type="Boolean" default="true"/><parameter name="copyPayment" type="Boolean" default="false"/><parameter name="paymentStatusId" default-value="PmntPromised"/></in-parameters><out-parameters><parameter name="orderId"><description><![CDATA[Dropship Purchase Order Id]]></description></parameter><parameter name="orderPartIdList" type="List"/><parameter name="orderItemIdList" type="List"><parameter name="orderPartSeqId"/><parameter name="orderItemSeqId"/></parameter></out-parameters><actions><set field="orderPartIdList" from="[]"/><set field="orderItemIdList" from="[]"/><set field="orderPartShipmentList" from="[]"/><entity-find entity-name="mantle.party.PartyRole" list="vendorInternalOrgList" cache="true"><econdition field-name="roleTypeId" value="OrgInternal"/></entity-find><set field="baseOrderId" from="salesOrderId"/><if condition="vendorPartyId"><entity-find-one entity-name="mantle.party.Party" value-field="vendorParty"><field-map field-name="partyId" from="vendorPartyId"/></entity-find-one><if condition="!vendorParty"><log level="warn" message="vendorPartyId ${vendorPartyId} does not exist. Setting to null default"/><set field="vendorPartyId" from="null"/></if></if><entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderHeader"><field-map field-name="orderId" from="baseOrderId"/></entity-find-one><if condition="!orderHeader"><return/></if><set field="orderHeader.orderId" from="null"/><entity-sequenced-id-primary value-field="orderHeader"/><entity-set value-field="orderHeader" include="nonpk"/><set field="orderHeader.parentOrderId" from="baseOrderId"/><set field="orderHeader.recurCronExpression" from="null"/><set field="orderHeader.lastOrderedDate" from="null"/><set field="orderHeader.recurAutoInvoice" from="null"/><if condition="clearDates"><set field="orderHeader.entryDate" from="entryDate"/><set field="orderHeader.placedDate" from="placedDate"/><set field="orderHeader.approvedDate" from="approvedDate"/><set field="orderHeader.completedDate" from="completedDate"/></if><entity-find entity-name="mantle.order.OrderPart" list="orderPartList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="vendorPartyId" operator="in" from="vendorInternalOrgList*.partyId"/></entity-find><if condition="orderPartList.size() == 0"><return/></if><entity-find entity-name="mantle.order.OrderItem" list="orderItemList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderPartSeqId" operator="in" from="orderPartList*.orderPartSeqId"/><order-by field-name="orderItemSeqId"/></entity-find><entity-find entity-name="mantle.product.issuance.AssetReservation" list="reservationList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderItemSeqId" operator="in" from="orderItemList*.orderItemSeqId"/></entity-find><if condition="reservationList.size() == 0"><entity-find entity-name="moqui.entity.EntityAuditLog" list="orderHeaderStatusCount"><econdition field-name="changedEntityName" value="mantle.order.OrderHeader"/><econdition field-name="pkPrimaryValue" from="salesOrderId"/><econdition field-name="changedFieldName" value="statusId"/><econdition field-name="newValueText" value="OrderPlaced"/><select-field field-name="changedEntityName"/></entity-find><if condition="orderHeaderStatusCount.size() == 0"><log message="Order ${salesOrderId} has not ever been placed, cannot create Dropship Purchase Order because no asset reservations are made"/><return/></if><return/></if><entity-find entity-name="mantle.product.asset.Asset" list="assetList"><econdition field-name="assetId" from="reservationList*.assetId"/></entity-find><entity-find entity-name="mantle.facility.Facility" list="facilityList"><econdition field-name="facilityId" from="assetList*.facilityId"/><econdition field-name="facilityTypeEnumId" value="FcTpDropShip"/></entity-find><if condition="facilityList.size() == 0"><return/></if><entity-find entity-name="mantle.party.PartyRole" list="facilityOwnerInternalOrgList"><econdition field-name="partyId" operator="in" from="facilityList*.ownerPartyId"/><econdition field-name="roleTypeId" value="OrgInternal"/></entity-find><entity-create value-field="orderHeader"/><set field="orderId" from="orderHeader.orderId"/><iterate list="orderPartList" entry="value"><set field="value.orderId" from="orderId"/><set field="valueCustomerPartyId" from="value.customerPartyId"/><if condition="!customerPartyId"><set field="valueVendorPartyId" from="value.vendorPartyId"/></if><entity-set value-field="value" include="nonpk"/><if condition="!customerPartyId"><set field="value.customerPartyId" from="valueVendorPartyId"/></if><if condition="!vendorPartyId"><filter-map-list list="orderItemList" to-list="orderPartItemList"><field-map field-name="orderPartSeqId" from="value.orderPartSeqId"/></filter-map-list><set field="orderPartReservationList" from="reservationList.findAll { it.orderItemSeqId in orderPartItemList*.orderItemSeqId }"/><set field="orderPartAssetList" from="assetList.findAll { it.assetId in orderPartReservationList*.assetId }"/><set field="orderPartFacilityList" from="facilityList.findAll { it.facilityId in orderPartAssetList*.facilityId }"/><set field="value.vendorPartyId" from="orderPartFacilityList.groupBy { it.ownerPartyId }.max { it.value.size() }?.key"/><if condition="!value.vendorPartyId"><log level="warn" message="No vendorPartyId found for OrderPart ${value.orderId}:${value.orderPartSeqId} based on order item -> asset reservation -> asset -> facility.ownerPartyId || ${orderPartItemList*.orderItemSeqId} ${orderPartReservationList*.assetReservationId} -> ${orderPartAssetList.assetId} -> ${orderPartFacilityList*.ownerPartyId}"/><continue/></if><if condition="facilityOwnerInternalOrgList*.partyId.contains(value.vendorPartyId)"><log level="info" message="Cannot add create a drop-ship order part for an internal organization: Vendor ${value.vendorPartyId} is an internal organization, skipping order part ${value.orderId}:${value.orderPartSeqId}"/><continue/></if></if><if condition="clearDates"><set field="value.shipAfterDate" from="shipAfterDate"/><set field="value.shipBeforeDate" from="shipBeforeDate"/><set field="value.estimatedShipDate" from="estimatedShipDate"/><set field="value.estimatedDeliveryDate" from="estimatedDeliveryDate"/><set field="value.validFromDate" from="validFromDate"/><set field="value.validThruDate" from="validThruDate"/><set field="value.autoCancelDate" from="autoCancelDate"/><set field="value.dontCancelSetDate" from="dontCancelSetDate"/></if><entity-create value-field="value"/><set field="facility" from="facilityList.find { it.facilityId == value.facilityId }"/><set field="orderPartIdList" from="orderPartIdList + [orderPartSeqId:value.orderPartSeqId,facilityId:value.facilityId,vendorPartyId:value.vendorPartyId,dropShipRemoteId:facility.dropShipRemoteId]"/><service-call name="create#mantle.order.OrderPartParty" in-map="[orderId:orderId, orderPartSeqId:value.orderPartSeqId, partyId:valueCustomerPartyId, roleTypeId:'CustomerShipTo']"/></iterate><if condition="orderPartIdList.size() == 0"><log level="warn" message="No OrderParts created for Dropship Purchase Order"/><return/></if><entity-find entity-name="moqui.basic.EnumGroupMember" list="productItemTypeEgms" cache="true"><econdition field-name="enumGroupEnumId" value="EngItemsProduct"/></entity-find><set field="productItemTypes" from="productItemTypeEgms*.enumId"/><iterate list="orderItemList" entry="value"><if condition="!orderPartIdList*.orderPartSeqId.contains(value.orderPartSeqId)"><log level="warn" message="Skipping copying OrderItem ${value.orderId}:${value.orderItemSeqId} because OrderPart has no valid dropship items"/><continue/></if><if condition="productItemsOnly && (!value.productId || !productItemTypes.contains(value.itemTypeEnumId))"><continue/></if><set field="orderItemReservationList" from="reservationList.findAll { it.orderItemSeqId == value.orderItemSeqId }"/><if condition="orderItemReservationList.size() == 0"><continue/></if><set field="reservation" from="orderItemReservationList.getFirst()"/><if condition="orderItemReservationList.size() > 1"><log level="warn" message="Multiple asset reservations found for order item ${value.orderId}:${value.orderItemSeqId}, chose reservation ${reservation.assetReservationId} out of ${orderItemReservationList*.assetReservationId}"/></if><set field="asset" from="assetList.find { it.assetId == reservation.assetId }"/><if condition="asset == null"><log level="info" message="No asset found for asset reservation ${reservation.assetReservationId} with id ${reservation.assetId} on order item ${value.orderId}:${value.orderPartSeqId}:${value.orderItemSeqId}"/><continue/></if><set field="facility" from="facilityList.find { it.facilityId == asset.facilityId }"/><if condition="facility == null"><log level="info" message="No facility found for asset ${asset.assetId} with facilityId ${asset.facilityId} on order item ${value.orderId}:${value.orderPartSeqId}:${value.orderItemSeqId}"/><continue/></if><if condition="facilityOwnerInternalOrgList*.partyId.contains(facility.ownerPartyId)"><log level="info" message="Cannot add create a drop-ship order item for an internal organization: Facility ${facility.facilityId} with owner party ${facility.ownerPartyId} is an internal organization, skipping order item ${value.orderId}:${value.orderPartSeqId}:${value.orderItemSeqId}"/><continue/></if><set field="value.orderId" from="orderId"/><set field="value.orderItemSeqId" from="null"/><entity-sequenced-id-secondary value-field="value"/><if condition="clearDates"><set field="value.requiredByDate" from="requiredByDate"/></if><entity-create value-field="value"/><set field="orderItemIdList" from="orderItemIdList + [orderPartSeqId:value.orderPartSeqId,                     orderItemSeqId:value.orderItemSeqId, productId:value.productId, facilityId:facility.facilityId]"/><service-call name="mantle.order.OrderServices.recalc#OrderItemAmount" in-map="value"/></iterate><if condition="!orderItemIdList"><log level="warn" message="No OrderItems created for Dropship Purchase Order ${orderId} from Sales Order ${salesOrderId}"/><return/></if><if condition="copyContactMech"><entity-find entity-name="mantle.order.OrderPartContactMech" list="valueList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderPartSeqId" operator="in" from="orderPartList*.orderPartSeqId"/></entity-find><iterate list="valueList" entry="value"><set field="value.orderId" from="orderId"/><entity-create value-field="value"/></iterate></if><if condition="copyContent"><entity-find entity-name="mantle.order.OrderContent" list="valueList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderItemSeqId" operator="in" from="orderItemList*.orderItemSeqId" ignore-if-empty="true"/></entity-find><iterate list="valueList" entry="value"><set field="value.orderId" from="orderId"/><set field="value.orderContentId" from="null"/><entity-sequenced-id-primary value-field="value"/><entity-create value-field="value"/></iterate></if><if condition="copyNote"><entity-find entity-name="mantle.order.OrderNote" list="valueList"><econdition field-name="orderId" from="baseOrderId"/></entity-find><iterate list="valueList" entry="value"><set field="value.orderId" from="orderId"/><entity-create value-field="value"/></iterate></if><if condition="copyPartParty"><entity-find entity-name="mantle.order.OrderPartParty" list="valueList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderPartSeqId" operator="in" from="orderPartList*.orderPartSeqId"/></entity-find><iterate list="valueList" entry="value"><set field="value.orderId" from="orderId"/><entity-create value-field="value"/></iterate></if><if condition="copyTerm"><entity-find entity-name="mantle.order.OrderPartTerm" list="valueList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderPartSeqId" operator="in" from="orderPartList*.orderPartSeqId"/></entity-find><iterate list="valueList" entry="value"><set field="value.orderId" from="orderId"/><entity-create value-field="value"/></iterate></if><if condition="copyItemWorkEffort"><entity-find entity-name="mantle.order.OrderItemWorkEffort" list="valueList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderItemSeqId" operator="in" from="orderItemList*.orderItemSeqId"/></entity-find><iterate list="valueList" entry="value"><set field="value.orderId" from="orderId"/><entity-create value-field="value"/></iterate></if><if condition="copyPayment"><entity-find entity-name="mantle.account.payment.Payment" list="valueList"><econdition field-name="orderId" from="baseOrderId"/><econdition field-name="orderPartSeqId" operator="in" from="orderPartList*.orderPartSeqId" ignore-if-empty="true"/><econdition field-name="orderItemSeqId" operator="in" from="orderItemList*.orderItemSeqId" ignore-if-empty="true"/></entity-find><iterate list="valueList" entry="value"><set field="value.orderId" from="orderId"/><set field="value.statusId" from="paymentStatusId"/><set field="value.paymentAuthCode" from="null"/><set field="value.paymentRefNum" from="null"/><set field="value.presentFlag" from="null"/><set field="value.swipedFlag" from="null"/><set field="value.processAttempt" from="null"/><set field="value.needsNsfRetry" from="null"/><set field="value.visitId" from="visitId"/><if condition="clearDates"><set field="value.effectiveDate" from="null"/></if><set field="value.paymentId" from="null"/><entity-sequenced-id-primary value-field="value"/><entity-create value-field="value"/></iterate></if><log level="info" message="Created Order ${orderId} as a clone of Order ${baseOrderId}"/><service-call name="mantle.order.OrderServices.place#Order" in-map="[orderId:orderId]" out-map="[oldStatusId:context.oldStatusId,statusChanged:context.statusChanged]"/><if condition="!ec.user.userAccount?.partyId"><then><service-call name="mantle.order.OrderServices.update#OrderStatus" out-map="[oldStatusId:context.oldStatusId,statusChanged:context.statusChanged]" in-map="context + [statusId:'OrderApproved']"/></then><else><service-call name="mantle.order.OrderServices.approve#Order" in-map="[orderId:orderId]" out-map="[oldStatusId:context.oldStatusId,statusChanged:context.statusChanged]"/></else></if><iterate list="orderPartIdList" entry="orderPart"><if condition="!orderPart.dropShipRemoteId"><log level="warn" message="Facility has no dropShipRemoteId. Create a SystemMessageRemote here ${ec.web?.getWebappRootUrl(false,true)?:''}/qapps/system/SystemMessage/Remote/MessageRemoteList, then go here to add it ${ec.web?.getWebappRootUrl(false,true)?:''}/qapps/tools/AutoScreen/AutoEdit/AutoEditMaster?facilityId=${orderPart.facilityId}&aen=mantle.facility.Facility"/><return/></if><entity-find-one entity-name="moqui.service.message.SystemMessageRemote" value-field="remote" auto-field-map="[systemMessageRemoteId:orderPart.dropShipRemoteId]"/><if condition="!remote"><log level="warn" message="SystemMessageRemote ${orderPart.dropShipRemoteId} not found"/><return/></if><if condition="!remote.sendServiceName"><log level="warn" message="SystemMessageRemote ${orderPart.dropShipRemoteId} has no sendServiceName"/><return/></if><service-call name="${remote.sendServiceName}" in-map="[orderId:orderId,orderPartSeqId:orderPart.orderPartSeqId,                      facilityId:orderPart.facilityId]"/></iterate></actions></service>