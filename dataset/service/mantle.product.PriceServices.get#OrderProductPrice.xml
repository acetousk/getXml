<!--Service Location mantle.product.PriceServices.get#OrderProductPrice--><service verb="get" noun="OrderProductPrice"><in-parameters><parameter name="productId" required="true"/><parameter name="quantity" type="BigDecimal" default="1"/><parameter name="orderId"/><parameter name="orderPartSeqId"/><parameter name="priceUomId"><description><![CDATA[If not specified defaults to OrderHeader.currencyUomId, then
                ProductStore.defaultCurrencyUomId, then the CurrencyDefault user preference (usually for the ALL_USERS group) then USD.]]></description></parameter><parameter name="pricePurposeEnumId"><description><![CDATA[If not specified defaults to PppPurchase unless OrderHeader is
                recurring (recurCronExpression not empty) then defaults to PppRecurring]]></description></parameter><parameter name="productStoreId"/><parameter name="vendorPartyId"/><parameter name="customerPartyId"/></in-parameters><out-parameters><parameter name="price" type="BigDecimal"/><parameter name="productPriceId"/><parameter name="listPrice" type="BigDecimal"/><parameter name="listProductPriceId"/><parameter name="priceUomId"/></out-parameters><actions><if condition="orderId"><entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderHeader"><field-map field-name="orderId"/></entity-find-one><set field="productStoreId" from="productStoreId ?: orderHeader?.productStoreId"/><entity-find-one entity-name="mantle.product.store.ProductStore" value-field="productStore"><field-map field-name="productStoreId"/></entity-find-one><set field="priceUomId" from="priceUomId ?: orderHeader?.currencyUomId ?: productStore?.defaultCurrencyUomId ?: ec.user.getPreference('CurrencyDefault') ?: 'USD'"/><set field="pricePurposeEnumId" from="pricePurposeEnumId ?: (orderHeader?.recurCronExpression ? 'PppRecurring' : 'PppPurchase')"/><if condition="orderPartSeqId"><entity-find-one entity-name="mantle.order.OrderPart" value-field="orderPart"/><set field="vendorPartyId" from="(vendorPartyId ?: orderPart?.vendorPartyId) ?: productStore?.organizationPartyId"/><set field="customerPartyId" from="(customerPartyId ?: orderPart?.customerPartyId) ?: ec.user.userAccount?.partyId"/></if><set field="vendorPartyId" from="orderPart?.vendorPartyId ?: productStore?.organizationPartyId"/></if><if condition="!pricePurposeEnumId"><set field="pricePurposeEnumId" value="PppPurchase"/></if><set field="defaultToListPrice" from="pricePurposeEnumId != 'PppRecurring'"/><service-call name="mantle.product.PriceServices.get#ProductPrice" in-map="context" out-map="[price:context.price,productPriceId:context.productPriceId,listPrice:context.listPrice,listProductPriceId:context.listProductPriceId,priceUomId:context.priceUomId]"/><if condition="!price && pricePurposeEnumId == 'PppRecurring'"><set field="pricePurposeEnumId" value="PppPurchase"/><set field="defaultToListPrice" from="true"/><service-call name="mantle.product.PriceServices.get#ProductPrice" in-map="context" out-map="[price:context.price,productPriceId:context.productPriceId,listPrice:context.listPrice,listProductPriceId:context.listProductPriceId,priceUomId:context.priceUomId]"/></if></actions></service>