<!--Service Location mantle.ledger.AssetAutoPostServices.repost#AssetReceipt--><service verb="repost" noun="AssetReceipt"><in-parameters><parameter name="assetReceiptId" required="true" entity-name="mantle.product.receipt.AssetReceipt" field-name="assetReceiptId"/></in-parameters><out-parameters><parameter name="acctgTransId"/></out-parameters><actions><entity-find-one entity-name="mantle.product.receipt.AssetReceipt" value-field="assetReceipt" for-update="true"/><if condition="assetReceipt == null"><return error="true" message="Could not find Asset Receipt with ID ${assetReceiptId}"/></if><if condition="assetReceipt.quantityAccepted == null"><return message="No quantity accepted on receipt (is null), not reposting inventory transaction to GL for receipt ${assetReceiptId}"/></if><entity-find entity-name="mantle.ledger.transaction.AcctgTrans" list="existingTransList"><econdition field-name="assetReceiptId"/><econdition field-name="acctgTransTypeEnumId" operator="in" from="['AttInventoryReceipt', 'AttAssetReceipt']"/><econdition field-name="reversedByAcctgTransId" from="null"/><econdition field-name="reverseOfAcctgTransId" from="null"/></entity-find><if condition="!existingTransList"><log level="warn" message="In repost#AssetReceipt ${assetReceiptId} no existing AcctgTrans records found"/></if><iterate list="existingTransList" entry="acctgTrans"><service-call name="mantle.ledger.LedgerServices.unpost#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/><service-call name="mantle.ledger.LedgerServices.delete#AcctgTrans" in-map="[acctgTransId:acctgTrans.acctgTransId]"/></iterate><entity-find-one entity-name="mantle.product.asset.Asset" value-field="asset"><field-map field-name="assetId" from="assetReceipt.assetId"/></entity-find-one><if condition="asset?.acquireCost && asset?.ownerPartyId"><service-call name="mantle.ledger.AssetAutoPostServices.post#AssetReceipt" in-map="[assetReceiptId:assetReceiptId]"/></if></actions></service>