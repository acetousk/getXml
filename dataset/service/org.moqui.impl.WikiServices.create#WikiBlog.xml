<!--Service Location org.moqui.impl.WikiServices.create#WikiBlog--><service verb="create" noun="WikiBlog"><in-parameters><parameter name="wikiPageId" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.resource.wiki.WikiBlog" field-name="wikiPageId"/><parameter name="title" type="java.lang.String" required="true" allow-html="none" entity-name="moqui.resource.wiki.WikiBlog" field-name="title"><matches regexp="[\w\.\-,':()!\? ]*" message="Invalid title (letters, digits, [.,'-_:()!? ] only)"/></parameter><parameter name="author" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.resource.wiki.WikiBlog" field-name="author"/><parameter name="summary" type="java.lang.String" required="false" allow-html="safe" entity-name="moqui.resource.wiki.WikiBlog" field-name="summary"/><parameter name="publishDate" type="Timestamp" required="false" allow-html="none" entity-name="moqui.resource.wiki.WikiBlog" field-name="publishDate" default="ec.user.nowTimestamp"/><parameter name="metaKeywords" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.resource.wiki.WikiBlog" field-name="metaKeywords"/><parameter name="metaDescription" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.resource.wiki.WikiBlog" field-name="metaDescription"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="moqui.resource.wiki.WikiBlog" field-name="lastUpdatedStamp"/><parameter name="wikiSpaceId" required="true"/><parameter name="smallImage" type="org.apache.commons.fileupload.FileItem"/><parameter name="blogText" allow-html="any"/></in-parameters><out-parameters><parameter name="wikiBlogId" entity-name="moqui.resource.wiki.WikiBlog" field-name="wikiBlogId"/></out-parameters><actions><if condition="!blogText && !wikiPageId"><return error="true" message="Blog text or Wiki Page required to create a blog article"/></if><if condition="blogText"><service-call name="org.moqui.impl.WikiServices.update#WikiPage" out-map="[wikiPageId:context.wikiPageId,pagePath:context.pagePath,encodedPagePath:context.encodedPagePath]" in-map="[wikiSpaceId:wikiSpaceId, wikiPageId:wikiPageId, pageName:title, parentPath:wikiSpaceId, wikiType:'html', pageText:blogText]"/></if><service-call name="create#moqui.resource.wiki.WikiBlog" in-map="context" out-map="[wikiBlogId:context.wikiBlogId,wikiPageId:context.wikiPageId,title:context.title,author:context.author,summary:context.summary,publishDate:context.publishDate,metaKeywords:context.metaKeywords,metaDescription:context.metaDescription,smallImageLocation:context.smallImageLocation,lastUpdatedStamp:context.lastUpdatedStamp]"/><if condition="smallImage && smallImage.size > 0"><set field="filename" from="smallImage.getName()"/><set field="contentRoot" from="ec.user.getPreference('mantle.content.root') ?: 'dbresource://mantle/content'"/><set field="contentLocation" value="${contentRoot}/WikiBlog/${wikiBlogId}/smallImage/${filename}"/><set field="ref" from="ec.resource.getLocationReference(contentLocation)"/><script><![CDATA[fileStream = smallImage.getInputStream()
                try { ref.putStream(fileStream) } finally { fileStream.close() }]]></script><service-call name="update#moqui.resource.wiki.WikiBlog" in-map="[wikiBlogId:wikiBlogId, smallImageLocation:contentLocation]"/></if></actions></service>