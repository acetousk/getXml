<!--Service Location org.moqui.impl.UserServices.send#AuthcCodeSms--><service verb="send" noun="AuthcCodeSms"><in-parameters><parameter name="factorId" required="true"/></in-parameters><out-parameters><parameter name="singleUseFactorId"/><parameter name="code"/></out-parameters><actions><entity-find-one entity-name="moqui.security.UserAuthcFactor" value-field="userAuthcFactor"><field-map field-name="factorId"/></entity-find-one><set field="userId" from="userAuthcFactor.userId"/><set field="contactNumber" from="userAuthcFactor.factorOption"/><service-call name="org.moqui.impl.UserServices.create#SingleUseAuthcFactor" in-map="[userId:userId, fromFactorId:factorId]" out-map="[factorId:createSuFactorOut.factorId,code:createSuFactorOut.code,thruDate:createSuFactorOut.thruDate]"/><set field="singleUseFactorId" from="createSuFactorOut.factorId"/><service-call name="org.moqui.SmsServices.send#SmsMessage"><field-map field-name="contactNumber"/><field-map field-name="message" from="ec.resource.expand('UserAuthcOtpMessage', null, [code:createSuFactorOut.code])"/></service-call><message public="true" type="success"><![CDATA[Authentication code sent to ${contactNumber}]]></message></actions></service>