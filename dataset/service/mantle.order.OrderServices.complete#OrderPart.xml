<!--Service Location mantle.order.OrderServices.complete#OrderPart--><service verb="complete" noun="OrderPart"><in-parameters><parameter name="orderId" required="true" entity-name="mantle.order.OrderPart" field-name="orderId"/><parameter name="orderPartSeqId" required="true" entity-name="mantle.order.OrderPart" field-name="orderPartSeqId"/><parameter name="completedDate" type="Timestamp" default="ec.user.nowTimestamp"/></in-parameters><out-parameters><parameter name="oldStatusId"/><parameter name="statusChanged" type="Boolean"/></out-parameters><actions><service-call name="update#mantle.order.OrderPart" out-map="[orderId:context.orderId,orderPartSeqId:context.orderPartSeqId,parentPartSeqId:context.parentPartSeqId,partName:context.partName,statusId:context.statusId,vendorPartyId:context.vendorPartyId,customerPartyId:context.customerPartyId,otherPartyOrderId:context.otherPartyOrderId,otherPartyOrderDate:context.otherPartyOrderDate,facilityId:context.facilityId,carrierPartyId:context.carrierPartyId,shipmentMethodEnumId:context.shipmentMethodEnumId,tradeTermEnumId:context.tradeTermEnumId,settlementTermId:context.settlementTermId,postalContactMechId:context.postalContactMechId,telecomContactMechId:context.telecomContactMechId,trackingNumber:context.trackingNumber,shippingInstructions:context.shippingInstructions,maySplit:context.maySplit,signatureRequiredEnumId:context.signatureRequiredEnumId,giftMessage:context.giftMessage,isGift:context.isGift,isNewCustomer:context.isNewCustomer,partTotal:context.partTotal,priority:context.priority,shipAfterDate:context.shipAfterDate,shipBeforeDate:context.shipBeforeDate,estimatedShipDate:context.estimatedShipDate,estimatedDeliveryDate:context.estimatedDeliveryDate,estimatedPickUpDate:context.estimatedPickUpDate,validFromDate:context.validFromDate,validThruDate:context.validThruDate,autoCancelDate:context.autoCancelDate,dontCancelSetDate:context.dontCancelSetDate,dontCancelSetUserId:context.dontCancelSetUserId,disablePromotions:context.disablePromotions,disableShippingCalc:context.disableShippingCalc,disableTaxCalc:context.disableTaxCalc,reservationAutoEnumId:context.reservationAutoEnumId,checkoutId:context.checkoutId,checkoutUrl:context.checkoutUrl,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[orderId:orderId, orderPartSeqId:orderPartSeqId, statusId:'OrderCompleted']"/><set field="allComplete" from="true"/><entity-find entity-name="mantle.order.OrderPart" list="orderPartList"><econdition field-name="orderId"/></entity-find><iterate list="orderPartList" entry="orderPart"><if condition="orderPart.statusId != 'OrderCompleted'"><set field="allComplete" from="false"/></if></iterate><if condition="allComplete"><service-call name="update#mantle.order.OrderHeader" out-map="[orderId:context.orderId,orderName:context.orderName,entryDate:context.entryDate,placedDate:context.placedDate,approvedDate:context.approvedDate,completedDate:context.completedDate,statusId:context.statusId,processingStatusId:context.processingStatusId,orderRevision:context.orderRevision,currencyUomId:context.currencyUomId,billingAccountId:context.billingAccountId,productStoreId:context.productStoreId,salesChannelEnumId:context.salesChannelEnumId,terminalId:context.terminalId,displayId:context.displayId,externalId:context.externalId,externalRevision:context.externalRevision,originId:context.originId,originUrl:context.originUrl,syncStatusId:context.syncStatusId,systemMessageRemoteId:context.systemMessageRemoteId,visitId:context.visitId,enteredByPartyId:context.enteredByPartyId,parentOrderId:context.parentOrderId,recurCronExpression:context.recurCronExpression,lastOrderedDate:context.lastOrderedDate,recurAutoInvoice:context.recurAutoInvoice,remainingSubTotal:context.remainingSubTotal,grandTotal:context.grandTotal,lastUpdatedStamp:context.lastUpdatedStamp]" in-map="[orderId:orderId, statusId:'OrderCompleted', completedDate:completedDate]"/></if></actions></service>