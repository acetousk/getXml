<!--Service Location coarchy.CoarchyServices.get#ActivityList--><service verb="get" noun="ActivityList"><in-parameters><parameter name="processStoryId" required="true"/><parameter name="organizationId" required="true"/><parameter name="term"/></in-parameters><out-parameters><parameter name="outList" type="List"/></out-parameters><actions><set field="ec.user.context?.activeOrgId" from="organizationId"/><set field="ec.user.context?.filterOrgIds" from="[organizationId]"/><set field="activityList" from="[]"/><if condition="!term"><then><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="activityList"><date-filter/><econdition field-name="replacedByActivityId" operator="is-null"/><econdition field-name="processStoryId"/><econdition field-name="action" operator="is-not-null"/><select-field field-name="activityId,condition,action"/><order-by field-name="sequenceNum"/></entity-find></then><else><entity-find entity-name="coarchy.ProcessStoryActivityDetail" list="activityList"><date-filter/><econdition field-name="replacedByActivityId" operator="is-null"/><econdition field-name="processStoryId"/><econdition field-name="action" operator="is-not-null"/><econditions combine="or"><econdition field-name="condition" operator="like" value="%${term}%" ignore-case="true"/><econdition field-name="action" operator="like" value="%${term}%" ignore-case="true"/></econditions><select-field field-name="activityId,condition,action"/><order-by field-name="sequenceNum"/></entity-find></else></if><set field="outList" from="[]"/><iterate list="activityList" entry="activity"><entity-find entity-name="coarchy.ActivityActorDetail" list="activityActorList"><econdition field-name="activityId" from="activity.activityId"/><order-by field-name="name"/></entity-find><set field="processStoryActivity" from="activity.getMap() + [actorNames:activityActorList*.name]"/><set field="label" from="ec.resource.template('component://coarchy/template/Activity.html.ftl', '.ftl')"/><script><![CDATA[outList.add([value:activity?.activityId, label:"${label.size()>97?label.take(97)+'...':label}"])]]></script></iterate></actions></service>