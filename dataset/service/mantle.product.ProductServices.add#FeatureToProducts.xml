<!--Service Location mantle.product.ProductServices.add#FeatureToProducts--><service verb="add" noun="FeatureToProducts"><in-parameters><parameter name="productFeatureId" required="true"/><parameter name="applTypeEnumId" required="true"/><parameter name="productIdList" type="List"><parameter name="productId"/></parameter></in-parameters><out-parameters/><actions><if condition="!productIdList"><return type="danger" message="No products specified"/></if><set field="addedCount" from="0"/><set field="alreadyCount" from="0"/><iterate list="productIdList" entry="productId"><set field="productId" from="productId.trim()"/><entity-find entity-name="mantle.product.feature.ProductFeatureAppl" list="existingPfaList"><date-filter/><econdition field-name="productId"/><econdition field-name="productFeatureId"/></entity-find><if condition="!existingPfaList"><then><service-call name="create#mantle.product.feature.ProductFeatureAppl" in-map="[productId:productId, productFeatureId:productFeatureId, applTypeEnumId:applTypeEnumId, fromDate:ec.user.nowTimestamp]"/><script><![CDATA[addedCount++]]></script></then><else><script><![CDATA[alreadyCount++]]></script></else></if></iterate><entity-find-one entity-name="mantle.product.feature.ProductFeature" value-field="productFeature"><field-map field-name="productFeatureId"/></entity-find-one><message><![CDATA[Added feature ${ec.resource.expand('ProductFeatureNameTemplate','',productFeature)} to ${addedCount} products (${alreadyCount} already had it)]]></message></actions></service>