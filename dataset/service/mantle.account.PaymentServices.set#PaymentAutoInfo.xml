<!--Service Location mantle.account.PaymentServices.set#PaymentAutoInfo--><service verb="set" noun="PaymentAutoInfo"><in-parameters><parameter name="paymentId"><description><![CDATA[Not required, used to exclude current Payment from total of other payments]]></description></parameter><parameter name="paymentTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentTypeEnumId"/><parameter name="fromPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="fromPartyId"/><parameter name="toPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="toPartyId"/><parameter name="paymentInstrumentEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentInstrumentEnumId"/><parameter name="paymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentMethodId"/><parameter name="toPaymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="toPaymentMethodId"/><parameter name="paymentGatewayConfigId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentGatewayConfigId"/><parameter name="orderId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="orderId"/><parameter name="orderPartSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="orderPartSeqId"/><parameter name="orderItemSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="orderItemSeqId"/><parameter name="statusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="statusId"/><parameter name="effectiveDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="effectiveDate"/><parameter name="settlementDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="settlementDate"/><parameter name="dueDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="dueDate"/><parameter name="paymentAuthCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentAuthCode"/><parameter name="paymentRefNum" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentRefNum"/><parameter name="comments" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="comments"/><parameter name="memo" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="memo"/><parameter name="distGroupEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="distGroupEnumId"/><parameter name="amount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="amount"/><parameter name="amountUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="amountUomId"/><parameter name="appliedTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="appliedTotal"/><parameter name="unappliedTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="unappliedTotal"/><parameter name="forInvoiceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="forInvoiceId"/><parameter name="refundForPaymentId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="refundForPaymentId"/><parameter name="finAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="finAccountId"/><parameter name="finAccountAuthId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="finAccountAuthId"/><parameter name="finAccountTransId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="finAccountTransId"/><parameter name="overrideGlAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="overrideGlAccountId"/><parameter name="overrideOrgPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="overrideOrgPartyId"/><parameter name="partyRelationshipId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="partyRelationshipId"/><parameter name="timePeriodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="timePeriodId"/><parameter name="originalCurrencyAmount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="originalCurrencyAmount"/><parameter name="originalCurrencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="originalCurrencyUomId"/><parameter name="presentFlag" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="presentFlag"/><parameter name="swipedFlag" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="swipedFlag"/><parameter name="processAttempt" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="processAttempt"/><parameter name="needsNsfRetry" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="needsNsfRetry"/><parameter name="visitId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="visitId"/><parameter name="acctgTransResultEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="acctgTransResultEnumId"/><parameter name="reconcileStatusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="reconcileStatusId"/><parameter name="paymentMethodFileId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentMethodFileId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="lastUpdatedStamp"/></in-parameters><out-parameters><parameter name="paymentTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentTypeEnumId"/><parameter name="fromPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="fromPartyId"/><parameter name="toPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="toPartyId"/><parameter name="paymentInstrumentEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentInstrumentEnumId"/><parameter name="paymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentMethodId"/><parameter name="toPaymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="toPaymentMethodId"/><parameter name="paymentGatewayConfigId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentGatewayConfigId"/><parameter name="orderId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="orderId"/><parameter name="orderPartSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="orderPartSeqId"/><parameter name="orderItemSeqId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="orderItemSeqId"/><parameter name="statusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="statusId"/><parameter name="effectiveDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="effectiveDate"/><parameter name="settlementDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="settlementDate"/><parameter name="dueDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="dueDate"/><parameter name="paymentAuthCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentAuthCode"/><parameter name="paymentRefNum" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentRefNum"/><parameter name="comments" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="comments"/><parameter name="memo" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="memo"/><parameter name="distGroupEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="distGroupEnumId"/><parameter name="amount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="amount"/><parameter name="amountUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="amountUomId"/><parameter name="appliedTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="appliedTotal"/><parameter name="unappliedTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="unappliedTotal"/><parameter name="forInvoiceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="forInvoiceId"/><parameter name="refundForPaymentId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="refundForPaymentId"/><parameter name="finAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="finAccountId"/><parameter name="finAccountAuthId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="finAccountAuthId"/><parameter name="finAccountTransId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="finAccountTransId"/><parameter name="overrideGlAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="overrideGlAccountId"/><parameter name="overrideOrgPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="overrideOrgPartyId"/><parameter name="partyRelationshipId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="partyRelationshipId"/><parameter name="timePeriodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="timePeriodId"/><parameter name="originalCurrencyAmount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="originalCurrencyAmount"/><parameter name="originalCurrencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="originalCurrencyUomId"/><parameter name="presentFlag" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="presentFlag"/><parameter name="swipedFlag" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="swipedFlag"/><parameter name="processAttempt" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="processAttempt"/><parameter name="needsNsfRetry" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="needsNsfRetry"/><parameter name="visitId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="visitId"/><parameter name="acctgTransResultEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="acctgTransResultEnumId"/><parameter name="reconcileStatusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="reconcileStatusId"/><parameter name="paymentMethodFileId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="paymentMethodFileId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.payment.Payment" field-name="lastUpdatedStamp"/></out-parameters><actions><entity-find entity-name="mantle.party.PartyRole" list="fromOrgInternalList"><econdition field-name="partyId" from="fromPartyId"/><econdition field-name="roleTypeId" value="OrgInternal"/></entity-find><set field="isOutgoing" from="fromOrgInternalList as boolean"/><if condition="!paymentInstrumentEnumId && finAccountId"><set field="paymentInstrumentEnumId" value="PiFinancialAccount"/></if><if condition="paymentMethodId"><entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="paymentMethod"/></if><if condition="toPaymentMethodId"><entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="toPaymentMethod"><field-map field-name="paymentMethodId" from="toPaymentMethodId"/></entity-find-one></if><if condition="isOutgoing"><then><if condition="!paymentInstrumentEnumId && toPaymentMethod != null"><entity-find entity-name="moqui.basic.Enumeration" list="instrEnumList"><econdition field-name="relatedEnumId" from="toPaymentMethod.paymentMethodTypeEnumId"/><order-by field-name="description"/></entity-find><set field="paymentInstrumentEnumId" from="instrEnumList ? instrEnumList[0].enumId : null"/></if><if condition="toPaymentMethod?.paymentGatewayConfigId"><set field="paymentGatewayConfigId" from="toPaymentMethod.paymentGatewayConfigId"/></if></then><else><if condition="!paymentInstrumentEnumId && paymentMethod != null"><entity-find entity-name="moqui.basic.Enumeration" list="instrEnumList"><econdition field-name="relatedEnumId" from="paymentMethod.paymentMethodTypeEnumId"/><order-by field-name="description"/></entity-find><set field="paymentInstrumentEnumId" from="instrEnumList ? instrEnumList[0].enumId : null"/></if><if condition="paymentMethod?.paymentGatewayConfigId"><set field="paymentGatewayConfigId" from="paymentMethod.paymentGatewayConfigId"/></if></else></if><if condition="!paymentInstrumentEnumId"><set field="paymentInstrumentEnumId" value="PiCompanyCheck"/></if><if condition="orderId"><entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderHeader"/><if condition="!amountUomId"><set field="amountUomId" from="orderHeader?.currencyUomId"/></if><if condition="!paymentGatewayConfigId && paymentInstrumentEnumId && orderHeader?.productStoreId"><entity-find-one entity-name="mantle.product.store.ProductStorePaymentGateway" value-field="productStorePaymentGateway" cache="true"><field-map field-name="productStoreId" from="orderHeader.productStoreId"/><field-map field-name="paymentInstrumentEnumId" from="paymentInstrumentEnumId"/></entity-find-one><set field="paymentGatewayConfigId" from="productStorePaymentGateway?.paymentGatewayConfigId"/></if><if condition="orderPartSeqId && !amount"><entity-find-one entity-name="mantle.order.OrderPart" value-field="orderPart"/><entity-find entity-name="mantle.account.payment.Payment" list="partPaymentList"><econdition field-name="orderId"/><econdition field-name="orderPartSeqId"/><econdition field-name="statusId" operator="not-in" value="PmntCancelled,PmntVoid,PmntDeclined"/><econdition field-name="paymentId" operator="not-equals" ignore-if-empty="true"/></entity-find><set field="partOtherPaymentTotal" from="partPaymentList*.amount.sum() ?: 0.0"/><set field="amount" from="(orderPart?.partTotal ?: 0.0) - partOtherPaymentTotal"/><if condition="amount < 0.0"><set field="amount" from="0.0"/></if></if></if><if condition="!amountUomId"><service-call name="mantle.ledger.LedgerServices.find#PartyAcctgPreference" out-map="[partyAcctgPreference:context.partyAcctgPreference]" in-map="[organizationPartyId:fromPartyId]"/><if condition="partyAcctgPreference"><then><set field="amountUomId" from="partyAcctgPreference.baseCurrencyUomId"/></then><else><service-call name="mantle.ledger.LedgerServices.find#PartyAcctgPreference" out-map="[partyAcctgPreference:context.partyAcctgPreference]" in-map="[organizationPartyId:toPartyId]"/><if condition="partyAcctgPreference != null"><set field="amountUomId" from="partyAcctgPreference.baseCurrencyUomId"/></if></else></if></if><if condition="!amountUomId"><set field="amountUomId" value="USD"/></if></actions></service>