<!--Service Location mantle.GeneralServices.search#MantleFiltered--><service verb="search" noun="MantleFiltered"><in-parameters><parameter name="indexName" required="true"/><parameter name="documentType"><description><![CDATA[The ElasticSearch document type. For DataDocument based docs this is the dataDocumentId.]]></description></parameter><parameter name="queryString" required="true"/><parameter name="nestedQueryMap" type="Map"><description><![CDATA[For explicit field constraints and such; key is path and
                may be null for a general query; value is a query JSON String (parsed to Map) or a query Map object]]></description></parameter><parameter name="orderByFields" type="List"><parameter name="orderByField"/></parameter><parameter name="highlightFields" type="List"><parameter name="highlightField"/></parameter><parameter name="pageIndex" type="Integer" default="0"/><parameter name="pageSize" type="Integer" default="20"/><parameter name="pageNoLimit" type="Boolean" default="false"/><parameter name="flattenDocument" type="Boolean" default="true"/><parameter name="clusterName" default-value="default"/></in-parameters><out-parameters><parameter name="documentList" type="List"><parameter name="document" type="Map"/></parameter><parameter name="documentListCount" type="Integer"><description><![CDATA[The total count of hits, not just the limited number returned.]]></description></parameter><parameter name="documentListPageIndex" type="Integer"/><parameter name="documentListPageSize" type="Integer"/><parameter name="documentListPageMaxIndex" type="Integer"/><parameter name="documentListPageRangeLow" type="Integer"/><parameter name="documentListPageRangeHigh" type="Integer"/></out-parameters><actions><set field="queryString" from="elasticQueryAutoWildcard(queryString, false)"/><set field="activeOrgId" from="ec.user.context?.activeOrgId"/><set field="filterOrgIds" from="ec.user.context?.filterOrgIds"/><if condition="!documentType"><then><set field="findFilters" from="ec.artifactExecution.getFindFiltersForUser('mantle.product.Product')"/><if condition="findFilters"><set field="entityFilterSetId" from="findFilters[0].entityFilterSetId"/></if><if condition="!entityFilterSetId"><set field="findFilters" from="ec.artifactExecution.getFindFiltersForUser('mantle.party.Party')"/><if condition="findFilters"><set field="entityFilterSetId" from="findFilters[0].entityFilterSetId"/></if></if><script><![CDATA[if ('MANTLE_USER_ORG'.equals(entityFilterSetId)) {
                        queryString = (queryString ? queryString + ' AND ' : '' ) + 'ownerPartyId:(' + filterOrgIds.join(' OR ') + ')'
                    } else if ('MANTLE_ACTIVE_ORG'.equals(entityFilterSetId) && activeOrgId) {
                        queryString = (queryString ? queryString + ' AND ' : '' ) + 'ownerPartyId:(' + activeOrgId + ' OR _NA_)'
                    }]]></script></then><else-if condition="documentType == 'MantleParty'"><set field="findFilters" from="ec.artifactExecution.getFindFiltersForUser('mantle.party.Party')"/><if condition="findFilters"><set field="entityFilterSetId" from="findFilters[0].entityFilterSetId"/></if><script><![CDATA[if ('MANTLE_USER_ORG'.equals(entityFilterSetId)) {
                        queryString = (queryString ? queryString + ' AND ' : '' ) + 'ownerPartyId:(' + (filterOrgIds ? filterOrgIds.join(' OR ') + ' OR ' : '') + '_NA_)'
                    } else if ('MANTLE_ACTIVE_ORG'.equals(entityFilterSetId) && activeOrgId) {
                        queryString = (queryString ? queryString + ' AND ' : '' ) + 'ownerPartyId:(' + activeOrgId + ' OR _NA_)'
                    }]]></script></else-if><else-if condition="documentType == 'MantleProduct'"><set field="findFilters" from="ec.artifactExecution.getFindFiltersForUser('mantle.product.Product')"/><if condition="findFilters"><set field="entityFilterSetId" from="findFilters[0].entityFilterSetId"/></if><script><![CDATA[if ('MANTLE_USER_ORG'.equals(entityFilterSetId)) {
                        queryString = (queryString ? queryString + ' AND ' : '' ) + 'ownerPartyId:(' + filterOrgIds.join(' OR ') + ')'
                    } else if ('MANTLE_ACTIVE_ORG'.equals(entityFilterSetId) && activeOrgId) {
                        queryString = (queryString ? queryString + ' AND ' : '' ) + 'ownerPartyId:(' + activeOrgId + ' OR _NA_)'
                    }]]></script></else-if></if><service-call name="org.moqui.search.SearchServices.search#DataDocuments" out-map="[documentList:context.documentList,documentListCount:context.documentListCount,documentListPageIndex:context.documentListPageIndex,documentListPageSize:context.documentListPageSize,documentListPageMaxIndex:context.documentListPageMaxIndex,documentListPageRangeLow:context.documentListPageRangeLow,documentListPageRangeHigh:context.documentListPageRangeHigh]" in-map="context + [flattenDocument:false]"/></actions></service>