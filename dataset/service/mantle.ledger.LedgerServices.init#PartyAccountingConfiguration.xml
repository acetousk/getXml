<!--Service Location mantle.ledger.LedgerServices.init#PartyAccountingConfiguration--><service verb="init" noun="PartyAccountingConfiguration"><in-parameters><parameter name="sourcePartyId" required="true"/><parameter name="organizationPartyId" required="true"/><parameter name="fiscalYearStartMonth" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="fiscalYearStartMonth"/><parameter name="fiscalYearStartDay" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="fiscalYearStartDay"/><parameter name="realTimeGlSummary" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="realTimeGlSummary"/><parameter name="hourlyTimePeriodTypeId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="hourlyTimePeriodTypeId"/><parameter name="salaryTimePeriodTypeId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="salaryTimePeriodTypeId"/><parameter name="taxFormEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="taxFormEnumId"/><parameter name="payrollTaxFormEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="payrollTaxFormEnumId"/><parameter name="taxClassificationEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="taxClassificationEnumId"/><parameter name="employerClassEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="employerClassEnumId"/><parameter name="cogsMethodEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="cogsMethodEnumId"/><parameter name="baseCurrencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="baseCurrencyUomId"/><parameter name="localCurrencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="localCurrencyUomId"/><parameter name="invoiceSequenceEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="invoiceSequenceEnumId"/><parameter name="invoiceIdPrefix" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="invoiceIdPrefix"/><parameter name="useInvoiceIdForReturns" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="useInvoiceIdForReturns"/><parameter name="orderSequenceEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="orderSequenceEnumId"/><parameter name="orderIdPrefix" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="orderIdPrefix"/><parameter name="refundPaymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="refundPaymentMethodId"/><parameter name="errorGlJournalId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="errorGlJournalId"/><parameter name="glAccountCodeMask" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="glAccountCodeMask"/><parameter name="settlementTermId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="settlementTermId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.ledger.config.PartyAcctgPreference" field-name="lastUpdatedStamp"/><parameter name="startYear" format="0000"><description><![CDATA[If specified creates fiscal time periods (year, quarter, month) starting that
                year and through the following year, otherwise starts now and creates current and next year, quarter, and month]]></description></parameter></in-parameters><out-parameters/><actions><entity-find-one entity-name="mantle.ledger.config.PartyAcctgPreference" value-field="existingPartyAcctgPreference"><field-map field-name="organizationPartyId"/></entity-find-one><if condition="existingPartyAcctgPreference"><return message="Party [${organizationPartyId}] already has a PartyAcctgPreference record, so not initializing accounting configuration."/></if><entity-find-one entity-name="mantle.party.Organization" value-field="organization"><field-map field-name="partyId" from="organizationPartyId"/></entity-find-one><set field="errorGlJournalId" value="${organizationPartyId}Error"/><service-call name="create#mantle.ledger.transaction.GlJournal" in-map="[organizationPartyId:organizationPartyId, glJournalId:errorGlJournalId,                         glJournalTypeEnumId:'GLJRNL_ERROR', isPosted:'N',                         glJournalName:('Error Journal for ' + (organization?.organizationName ?: organizationPartyId))]"/><entity-find-one entity-name="mantle.ledger.config.PartyAcctgPreference" value-field="sourcePartyAcctgPreference"><field-map field-name="organizationPartyId" from="sourcePartyId"/></entity-find-one><if condition="!sourcePartyAcctgPreference"><return error="true" message="Could not find PartyAcctgPreference for source party [${sourcePartyId}]"/></if><set field="partyAcctgPreference" from="sourcePartyAcctgPreference.cloneValue()"/><entity-set value-field="partyAcctgPreference" include="nonpk" set-if-empty="false"/><service-call name="create#mantle.ledger.config.PartyAcctgPreference" in-map="partyAcctgPreference + [organizationPartyId:organizationPartyId, errorGlJournalId:errorGlJournalId]"/><entity-find entity-name="mantle.ledger.account.GlAccountOrganization" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.AssetTypeGlAccount" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><set field="record.assetTypeGlAccountId" from="null"/><entity-sequenced-id-primary value-field="record"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.GlAccountTypeDefault" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.InvoiceTypeTransType" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.ItemTypeGlAccount" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.PaymentTypeGlAccount" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.PaymentInstrumentGlAccount" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.FinancialAccountTypeGlAccount" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><entity-find entity-name="mantle.ledger.config.FinancialAccountReasonGlAccount" list="recordList"><econdition field-name="organizationPartyId" from="sourcePartyId"/></entity-find><iterate list="recordList" entry="record"><set field="record.organizationPartyId" from="organizationPartyId"/><entity-create value-field="record"/></iterate><if condition="startYear"><then><set field="nextYearInt" from="((Calendar) ec.user.nowCalendar).get(Calendar.YEAR) + 1"/><set field="lastYear" from="ec.l10n.format(nextYearInt, '0000')"/><set field="curYear" from="startYear"/><set field="prevPeriodId" from="null"/><while condition="curYear <= lastYear"><set field="fromDate" from="ec.l10n.parseDate(curYear + '-01-01', 'yyyy-MM-dd')"/><service-call name="mantle.party.TimeServices.getOrCreate#TimePeriod" out-map="[timePeriodId:curYearOut.timePeriodId,timePeriod:curYearOut.timePeriod]" in-map="[partyId:organizationPartyId, timePeriodTypeId:'FiscalYear', fromDate:fromDate, previousPeriodId:prevPeriodId]"/><service-call name="mantle.party.TimeServices.get#DescendantPeriods" out-map="[timePeriodList:quartersOut.timePeriodList]" in-map="[parentPeriodId:curYearOut.timePeriodId, timePeriodTypeId:'FiscalQuarter', createMissing:true]"/><iterate list="quartersOut.timePeriodList" entry="quarterPeriod"><service-call name="mantle.party.TimeServices.get#DescendantPeriods" out-map="[timePeriodList:quartersOut.timePeriodList]" in-map="[parentPeriodId:quarterPeriod.timePeriodId, timePeriodTypeId:'FiscalMonth', createMissing:true]"/></iterate><set field="prevPeriodId" from="curYearOut.timePeriodId"/><set field="curYear" from="((curYear as int) + 1) as String"/></while></then><else><service-call name="mantle.ledger.LedgerServices.check#NextFiscalTimePeriods" in-map="[organizationPartyId:organizationPartyId]"/></else></if></actions></service>