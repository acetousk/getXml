<!--Service Location mantle.account.PaymentServices.send#PromisedPayment--><service verb="send" noun="PromisedPayment"><in-parameters><parameter name="paymentId" required="true"/><parameter name="invoiceId" required="true"/><parameter name="statusId" default-value="PmntDelivered"/><parameter name="effectiveDate" type="Timestamp"/><parameter name="paymentRefNum"/><parameter name="comments"/><parameter name="billingAccountId"/><parameter name="overrideGlAccountId"/><parameter name="amount" type="BigDecimal"><description><![CDATA[Defaults to Payment.amount and if different from
                Payment.amount sets the value there. The rest of the invoice, if needed, can be paid with
                create#InvoicePayment.]]></description></parameter></in-parameters><out-parameters><parameter name="paymentApplicationId"/><parameter name="amountApplied" type="BigDecimal"/></out-parameters><actions><service-call name="mantle.account.PaymentServices.check#InvoiceStatusForPayment" in-map="[invoiceId:invoiceId]"/><entity-find-one entity-name="mantle.account.payment.Payment" value-field="payment" for-update="true"/><if condition="!amount"><set field="amount" from="payment.amount"/></if><if condition="effectiveDate == null"><set field="effectiveDate" from="payment.effectiveDate ?: ec.user.nowTimestamp"/></if><service-call name="update#mantle.account.payment.Payment" in-map="context"/><service-call name="mantle.account.PaymentServices.apply#InvoicePayment" in-map="context" out-map="[paymentApplicationId:context.paymentApplicationId,amountApplied:context.amountApplied]"/></actions></service>