<!--Service Location mantle.work.TimeServices.get#TimeEntryRate--><service verb="get" noun="TimeEntryRate"><in-parameters><parameter name="timeEntryId" required="true"/><parameter name="rateCurrencyUomId" default-value="${ec.user.getPreference('CurrencyDefault') ?: 'USD'}"/><parameter name="resetRates" type="Boolean" default="false"/></in-parameters><out-parameters><parameter name="rateAmountId"/><parameter name="rateAmount"/><parameter name="vendorRateAmountId"/><parameter name="vendorRateAmount"/><parameter name="pieceRateAmountId"/><parameter name="pieceRateAmount"/><parameter name="vendorPieceRateAmountId"/><parameter name="vendorPieceRateAmount"/></out-parameters><actions><entity-find-one entity-name="mantle.work.time.TimeEntry" value-field="timeEntry" for-update="true"/><if condition="resetRates"><set field="timeEntry.rateAmountId" from="null"/><set field="timeEntry.vendorRateAmountId" from="null"/><set field="timeEntry.pieceRateAmountId" from="null"/><set field="timeEntry.vendorPieceRateAmountId" from="null"/></if><if condition="!timeEntry.rateAmountId && timeEntry.rateTypeEnumId"><then><service-call name="mantle.work.TimeServices.find#TimeEntryRateAmount" out-map="[rateAmountId:clientRate.rateAmountId,rateAmount:clientRate.rateAmount]" in-map="[timeEntry:timeEntry, ratePurposeEnumId:'RaprClient',                             rateTypeEnumId:timeEntry.rateTypeEnumId, rateCurrencyUomId:rateCurrencyUomId]"/><if condition="clientRate.rateAmountId"><set field="timeEntry.rateAmountId" from="clientRate.rateAmountId"/><set field="rateAmountId" from="clientRate.rateAmountId"/><set field="rateAmount" from="clientRate.rateAmount"/></if></then><else><set field="rateAmountId" from="timeEntry.rateAmountId"/><set field="rateAmount" from="timeEntry.'mantle.humanres.rate.RateAmount'?.rateAmount"/><if condition="timeEntry.hasModifiedRates != 'Y'"><set field="timeEntry.clientHourRate" from="rateAmount"/></if></else></if><if condition="!timeEntry.vendorRateAmountId && timeEntry.rateTypeEnumId"><then><service-call name="mantle.work.TimeServices.find#TimeEntryRateAmount" out-map="[rateAmountId:vendorRate.rateAmountId,rateAmount:vendorRate.rateAmount]" in-map="[timeEntry:timeEntry, ratePurposeEnumId:'RaprVendor',                             rateTypeEnumId:timeEntry.rateTypeEnumId, rateCurrencyUomId:rateCurrencyUomId]"/><if condition="vendorRate.rateAmountId"><set field="timeEntry.vendorRateAmountId" from="vendorRate.rateAmountId"/><set field="vendorRateAmountId" from="vendorRate.rateAmountId"/><set field="vendorRateAmount" from="vendorRate.rateAmount"/></if></then><else><set field="vendorRateAmountId" from="timeEntry.vendorRateAmountId"/><set field="vendorRateAmount" from="timeEntry.'Vendor#mantle.humanres.rate.RateAmount'?.rateAmount"/><if condition="timeEntry.hasModifiedRates != 'Y'"><set field="timeEntry.vendorHourRate" from="vendorRateAmount"/></if></else></if><if condition="!timeEntry.pieceRateAmountId && timeEntry.pieceRateTypeEnumId"><then><service-call name="mantle.work.TimeServices.find#TimeEntryRateAmount" out-map="[rateAmountId:pieceRate.rateAmountId,rateAmount:pieceRate.rateAmount]" in-map="[timeEntry:timeEntry, ratePurposeEnumId:'RaprClient', timePeriodUomId:'OTH_ea',                             rateTypeEnumId:timeEntry.pieceRateTypeEnumId, rateCurrencyUomId:rateCurrencyUomId]"/><if condition="pieceRate.rateAmountId"><set field="timeEntry.pieceRateAmountId" from="pieceRate.rateAmountId"/><set field="pieceRateAmountId" from="pieceRate.rateAmountId"/><set field="pieceRateAmount" from="pieceRate.rateAmount"/></if></then><else><set field="pieceRateAmountId" from="timeEntry.pieceRateAmountId"/><set field="pieceRateAmount" from="timeEntry.'Piece#mantle.humanres.rate.RateAmount'?.rateAmount"/><if condition="timeEntry.hasModifiedRates != 'Y'"><set field="timeEntry.clientPieceRate" from="pieceRateAmount"/></if></else></if><if condition="!timeEntry.vendorPieceRateAmountId && timeEntry.pieceRateTypeEnumId"><then><service-call name="mantle.work.TimeServices.find#TimeEntryRateAmount" out-map="[rateAmountId:vendorPieceRate.rateAmountId,rateAmount:vendorPieceRate.rateAmount]" in-map="[timeEntry:timeEntry, ratePurposeEnumId:'RaprVendor', timePeriodUomId:'OTH_ea',                             rateTypeEnumId:timeEntry.pieceRateTypeEnumId, rateCurrencyUomId:rateCurrencyUomId]"/><if condition="vendorPieceRate.rateAmountId"><set field="timeEntry.vendorPieceRateAmountId" from="vendorPieceRate.rateAmountId"/><set field="vendorPieceRateAmountId" from="vendorPieceRate.rateAmountId"/><set field="vendorPieceRateAmount" from="vendorPieceRate.rateAmount"/></if></then><else><set field="vendorPieceRateAmountId" from="timeEntry.vendorPieceRateAmountId"/><set field="vendorPieceRateAmount" from="timeEntry.'VendorPiece#mantle.humanres.rate.RateAmount'?.rateAmount"/><if condition="timeEntry.hasModifiedRates != 'Y'"><set field="timeEntry.vendorPieceRate" from="vendorPieceRateAmount"/></if></else></if><entity-update value-field="timeEntry"/></actions></service>