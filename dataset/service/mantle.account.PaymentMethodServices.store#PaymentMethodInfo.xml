<!--Service Location mantle.account.PaymentMethodServices.store#PaymentMethodInfo--><service verb="store" noun="PaymentMethodInfo"><in-parameters><parameter name="partyId" required="true"/><parameter name="paymentMethodTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="paymentMethodTypeEnumId" default-value="PmtCreditCard"/><parameter name="purposeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="purposeEnumId"/><parameter name="ownerPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="ownerPartyId"/><parameter name="description" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="description"/><parameter name="fromDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="fromDate"/><parameter name="thruDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="thruDate"/><parameter name="thruDateSetAuto" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="thruDateSetAuto"/><parameter name="openedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="openedDate"/><parameter name="titleOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="titleOnAccount"/><parameter name="firstNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="firstNameOnAccount"/><parameter name="middleNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="middleNameOnAccount"/><parameter name="lastNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="lastNameOnAccount"/><parameter name="suffixOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="suffixOnAccount"/><parameter name="companyNameOnAccount" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="companyNameOnAccount"/><parameter name="ledgerBalance" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="ledgerBalance"/><parameter name="availableBalance" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="availableBalance"/><parameter name="balanceDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="balanceDate"/><parameter name="loanPaymentAmount" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="loanPaymentAmount"/><parameter name="loanPaymentPeriodUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="loanPaymentPeriodUomId"/><parameter name="currencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="currencyUomId"/><parameter name="postalContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="postalContactMechId"/><parameter name="telecomContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="telecomContactMechId"/><parameter name="emailContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="emailContactMechId"/><parameter name="gatewayCimId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="gatewayCimId"/><parameter name="paymentGatewayConfigId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="paymentGatewayConfigId"/><parameter name="imageUrl" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="imageUrl"/><parameter name="trustLevelEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="trustLevelEnumId"/><parameter name="paymentFraudEvidenceId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="paymentFraudEvidenceId"/><parameter name="glAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="glAccountId"/><parameter name="finAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="finAccountId"/><parameter name="originalPaymentMethodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.PaymentMethod" field-name="originalPaymentMethodId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="lastUpdatedStamp"/><parameter name="paymentMethodId"/><parameter name="bankName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="bankName"/><parameter name="bankPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="bankPartyId"/><parameter name="typeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="typeEnumId" default-value="BatChecking"/><parameter name="routingNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="routingNumber"/><parameter name="accountNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="accountNumber"/><parameter name="nachaImmedDest" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedDest"/><parameter name="nachaImmedOrig" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedOrig"/><parameter name="nachaImmedDestName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedDestName"/><parameter name="nachaImmedOrigName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaImmedOrigName"/><parameter name="nachaCompanyName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaCompanyName"/><parameter name="nachaDiscrData" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaDiscrData"/><parameter name="nachaCompanyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaCompanyId"/><parameter name="nachaOdfiId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaOdfiId"/><parameter name="nachaEntryDescription" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaEntryDescription"/><parameter name="nachaAddNewLine" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaAddNewLine"/><parameter name="nachaAddOffsetRecord" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="nachaAddOffsetRecord"/><parameter name="posPayBankNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="posPayBankNumber"/><parameter name="posPayFormatEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.BankAccount" field-name="posPayFormatEnumId"/><parameter name="creditCardTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.CreditCard" field-name="creditCardTypeEnumId"/><parameter name="cardNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.CreditCard" field-name="cardNumber"><credit-card/></parameter><parameter name="validFromDate" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.CreditCard" field-name="validFromDate"/><parameter name="expireDate" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.CreditCard" field-name="expireDate" default-value="${expireMonth?:''}/${expireYear?:''}"><time-range after="now" format="MM/yyyy"/></parameter><parameter name="issueNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.CreditCard" field-name="issueNumber"/><parameter name="cardSecurityCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.method.CreditCard" field-name="cardSecurityCode"/><parameter name="validateSecurityCode"><description><![CDATA[Not persisted, just passed through so available to SECA rules for validation by gateway, etc]]></description></parameter><parameter name="expireMonth"/><parameter name="expireYear"/><parameter name="postalContactMechPurposeId" default-value="PostalBilling"/><parameter name="toName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="toName" default="companyNameOnAccount ?: (firstNameOnAccount ? firstNameOnAccount + ' ' + lastNameOnAccount : null)"/><parameter name="attnName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="attnName" default="companyNameOnAccount && firstNameOnAccount ? firstNameOnAccount + ' ' + lastNameOnAccount : null"/><parameter name="address1" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="address1"/><parameter name="address2" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="address2"/><parameter name="unitNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="unitNumber"/><parameter name="directions" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="directions"/><parameter name="city" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="city"/><parameter name="cityGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="cityGeoId"/><parameter name="schoolDistrictGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="schoolDistrictGeoId"/><parameter name="countyGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="countyGeoId"/><parameter name="stateProvinceGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="stateProvinceGeoId"/><parameter name="countryGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="countryGeoId"/><parameter name="postalCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCode"/><parameter name="postalCodeExt" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCodeExt"/><parameter name="postalCodeGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCodeGeoId"/><parameter name="geoPointId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="geoPointId"/><parameter name="commercial" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="commercial"/><parameter name="accessCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="accessCode"/><parameter name="shipGatewayAddressId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="shipGatewayAddressId"/><parameter name="telecomContactMechPurposeId" default-value="PhoneBilling"/><parameter name="countryCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="countryCode"/><parameter name="areaCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="areaCode"><text-digits/></parameter><parameter name="contactNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="contactNumber"><matches regexp="^\d\d[-\. \d]*\d\d$" message="Please enter a valid phone number"/></parameter><parameter name="askForName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.TelecomNumber" field-name="askForName"/><parameter name="emailContactMechPurposeId" default-value="EmailBilling"/><parameter name="emailAddress"><text-email/></parameter></in-parameters><out-parameters><parameter name="paymentMethodId"/><parameter name="postalContactMechId"/><parameter name="telecomContactMechId"/><parameter name="emailContactMechId"/></out-parameters><actions><set field="origPaymentMethodId" from="paymentMethodId"/><if condition="paymentMethodId"><entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="paymentMethod"/><set field="paymentMethodTypeEnumId" from="paymentMethod.paymentMethodTypeEnumId"/><if condition="!postalContactMechId"><set field="postalContactMechId" from="paymentMethod.postalContactMechId"/></if><if condition="!telecomContactMechId"><set field="telecomContactMechId" from="paymentMethod.telecomContactMechId"/></if><if condition="!emailContactMechId"><set field="emailContactMechId" from="paymentMethod.emailContactMechId"/></if></if><if condition="paymentMethodId"><then><service-call name="mantle.party.ContactServices.store#PartyContactInfo" in-map="context" out-map="[postalContactMechId:context.postalContactMechId,telecomContactMechId:context.telecomContactMechId,emailContactMechId:context.emailContactMechId,webContactMechId:context.webContactMechId,otherContactMechId:context.otherContactMechId]"/></then><else><if condition="!postalContactMechId && address1"><service-call name="mantle.party.ContactServices.create#PostalAddress" out-map="[contactMechId:paOut.contactMechId]" in-map="context + [contactMechPurposeId:postalContactMechPurposeId]"/><set field="postalContactMechId" from="paOut.contactMechId"/></if><if condition="!telecomContactMechId && contactNumber"><service-call name="mantle.party.ContactServices.create#TelecomNumber" out-map="[contactMechId:tnOut.contactMechId,trustLevelEnumId:tnOut.trustLevelEnumId]" in-map="context + [contactMechPurposeId:telecomContactMechPurposeId]"/><set field="telecomContactMechId" from="tnOut.contactMechId"/></if><if condition="!emailContactMechId && emailAddress"><service-call name="mantle.party.ContactServices.create#EmailAddress" out-map="[contactMechId:emOut.contactMechId]" in-map="context + [contactMechPurposeId:emailContactMechPurposeId]"/><set field="emailContactMechId" from="emOut.contactMechId"/></if></else></if><if condition="paymentMethodId"><then><if condition="paymentMethodTypeEnumId == 'PmtCreditCard'"><then><service-call name="mantle.account.PaymentMethodServices.update#CreditCard" in-map="context" out-map="[paymentMethodId:context.paymentMethodId]"/></then><else-if condition="paymentMethodTypeEnumId == 'PmtBankAccount'"><service-call name="mantle.account.PaymentMethodServices.update#BankAccount" in-map="context" out-map="[paymentMethodId:context.paymentMethodId]"/></else-if></if></then><else><if condition="paymentMethodTypeEnumId == 'PmtCreditCard'"><then><service-call name="mantle.account.PaymentMethodServices.create#CreditCard" out-map="[paymentMethodId:context.paymentMethodId]" in-map="context + [ownerPartyId:partyId]"/></then><else-if condition="paymentMethodTypeEnumId == 'PmtBankAccount'"><service-call name="mantle.account.PaymentMethodServices.create#BankAccount" out-map="[paymentMethodId:context.paymentMethodId]" in-map="context + [ownerPartyId:partyId]"/></else-if></if></else></if><if condition="origPaymentMethodId && origPaymentMethodId != paymentMethodId"><entity-find entity-name="mantle.account.payment.Payment" list="paymentList"><econdition field-name="paymentMethodId" from="origPaymentMethodId"/><econdition field-name="statusId" operator="in" value="PmntProposed,PmntPromised,PmntAuthorized,PmntDeclined"/><econdition field-name="paymentAuthCode" operator="is-null"/></entity-find><iterate list="paymentList" entry="payment"><set field="payment.paymentMethodId" from="paymentMethodId"/><entity-update value-field="payment"/><message><![CDATA[Updated Payment Method on Payment ${payment.paymentId}]]></message></iterate><entity-find entity-name="mantle.account.payment.Payment" list="toPaymentList"><econdition field-name="toPaymentMethodId" from="origPaymentMethodId"/><econdition field-name="statusId" operator="in" value="PmntProposed,PmntPromised,PmntAuthorized,PmntDeclined"/></entity-find><iterate list="toPaymentList" entry="toPayment"><set field="toPayment.toPaymentMethodId" from="paymentMethodId"/><entity-update value-field="toPayment"/><message><![CDATA[Updated To Payment Method on Payment ${toPayment.paymentId}]]></message></iterate></if></actions></service>