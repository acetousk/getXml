<!--Service Location org.moqui.impl.SystemMessageServices.send#AllProducedSystemMessages--><service verb="send" noun="AllProducedSystemMessages"><in-parameters><parameter name="retryMinutes" type="BigDecimal" default="60"/><parameter name="retryLimit" type="Integer" default="24"/></in-parameters><out-parameters/><actions><set field="retryTimestamp" from="new Timestamp((System.currentTimeMillis() - (retryMinutes * 60000)) as long)"/><entity-find entity-name="moqui.service.message.SystemMessage" list="smList" limit="200"><econdition field-name="statusId" value="SmsgProduced"/><econdition field-name="isOutgoing" value="Y"/><econdition field-name="lastAttemptDate" operator="less" from="retryTimestamp" or-null="true"/><order-by field-name="initDate"/></entity-find><iterate list="smList" entry="sm"><if condition="sm.failCount < retryLimit"><service-call name="org.moqui.impl.SystemMessageServices.send#ProducedSystemMessage" in-map="[systemMessageId:sm.systemMessageId]" async="true"/><else><service-call name="update#moqui.service.message.SystemMessage" transaction="force-new" in-map="[systemMessageId:sm.systemMessageId, statusId:'SmsgError',                                     lastAttemptDate:ec.user.nowTimestamp]"/></else></if></iterate></actions></service>