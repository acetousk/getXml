<!--Service Location mantle.account.InvoiceServices.create#InvoiceBillThroughItems--><service verb="create" noun="InvoiceBillThroughItems"><in-parameters><parameter name="originalInvoiceId" required="true"/><parameter name="newInvoiceId" required="true"/></in-parameters><out-parameters><parameter name="invoiceItemCreatedCount" type="Long"/></out-parameters><actions><set field="invoiceItemCreatedCount" from="0" type="Long"/><entity-find-one entity-name="mantle.account.invoice.Invoice" value-field="originalInvoice"><field-map field-name="invoiceId" from="originalInvoiceId"/></entity-find-one><entity-find entity-name="mantle.account.invoice.InvoiceItem" list="originalInvoiceItemList"><econdition field-name="invoiceId" from="originalInvoiceId"/></entity-find><iterate list="originalInvoiceItemList" entry="originalInvoiceItem"><entity-find entity-name="mantle.work.time.TimeEntry" list="timeEntryList"><econdition field-name="vendorInvoiceId" from="originalInvoiceItem.invoiceId"/><econdition field-name="vendorInvoiceItemSeqId" from="originalInvoiceItem.invoiceItemSeqId"/></entity-find><if condition="!timeEntryList"><service-call name="create#mantle.account.invoice.InvoiceItem" out-map="[invoiceId:iiOut.invoiceId,invoiceItemSeqId:iiOut.invoiceItemSeqId,parentItemSeqId:iiOut.parentItemSeqId,itemTypeEnumId:iiOut.itemTypeEnumId,overrideGlAccountId:iiOut.overrideGlAccountId,assetId:iiOut.assetId,productId:iiOut.productId,otherPartyProductId:iiOut.otherPartyProductId,parentInvoiceId:iiOut.parentInvoiceId,parentInvoiceItemSeqId:iiOut.parentInvoiceItemSeqId,taxableFlag:iiOut.taxableFlag,quantity:iiOut.quantity,quantityUomId:iiOut.quantityUomId,amount:iiOut.amount,description:iiOut.description,itemDate:iiOut.itemDate,isAdjustment:iiOut.isAdjustment,salesOpportunityId:iiOut.salesOpportunityId,taxAuthorityId:iiOut.taxAuthorityId,payrollAdjustmentId:iiOut.payrollAdjustmentId,finAccountId:iiOut.finAccountId,finAccountTransId:iiOut.finAccountTransId,billThruVendorName:iiOut.billThruVendorName,billThruVendorRef:iiOut.billThruVendorRef,lastUpdatedStamp:iiOut.lastUpdatedStamp]" in-map="[invoiceId:newInvoiceId, itemTypeEnumId:originalInvoiceItem.itemTypeEnumId,                                 amount:originalInvoiceItem.amount, quantity:originalInvoiceItem.quantity,                                 description:originalInvoiceItem.description, itemDate:originalInvoiceItem.itemDate]"/><set field="invoiceItemCreatedCount" from="invoiceItemCreatedCount + 1"/><service-call name="create#mantle.account.invoice.InvoiceItemAssoc" in-map="[invoiceId:originalInvoiceItem.invoiceId, invoiceItemSeqId:originalInvoiceItem.invoiceItemSeqId,                                 toInvoiceId:newInvoiceId, toInvoiceItemSeqId:iiOut.invoiceItemSeqId,                                 invoiceItemAssocTypeEnumId:'IiatBillThrough', amount:originalInvoiceItem.amount,                                 quantity:originalInvoiceItem.quantity]"/></if></iterate></actions></service>