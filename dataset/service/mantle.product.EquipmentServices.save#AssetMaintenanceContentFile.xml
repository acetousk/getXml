<!--Service Location mantle.product.EquipmentServices.save#AssetMaintenanceContentFile--><service verb="save" noun="AssetMaintenanceContentFile"><in-parameters><parameter name="assetMaintenanceId" required="true"/><parameter name="contentDate" type="Timestamp" required="true"/><parameter name="contentFile" type="org.apache.commons.fileupload.FileItem" required="true"/><parameter name="saveContentLocation" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="contentLocation"/></out-parameters><actions><entity-find-one entity-name="mantle.product.maintenance.AssetMaintenance" value-field="assetMaintenance"/><set field="filename" from="contentFile.getName()"/><if condition="org.moqui.resource.ResourceReference.isTextFilename(filename)"><then><set field="contentRoot" from="ec.user.getPreference('mantle.content.root') ?: 'dbresource://mantle/content'"/></then><else><set field="contentRoot" from="ec.user.getPreference('mantle.content.large.root') ?: 'dbresource://mantle/content'"/></else></if><set field="contentLocation" value="${contentRoot}/asset/${assetMaintenance.assetId?:'_NA_'}/maintenance/${assetMaintenanceId}/${filename}"/><set field="docRr" from="ec.resource.getLocationReference(contentLocation)"/><script><![CDATA[fileStream = contentFile.getInputStream()
                try { docRr.putStream(fileStream) } finally { fileStream.close() }]]></script><if condition="saveContentLocation"><service-call name="update#mantle.product.maintenance.AssetMaintenanceContent" in-map="[assetMaintenanceId:assetMaintenanceId, contentDate:contentDate, contentLocation:contentLocation]"/></if></actions></service>