<!--Service Location mantle.account.PaymentServices.calculate#MissingPaymentTotals--><service verb="calculate" noun="MissingPaymentTotals"><in-parameters><parameter name="calculateAll" type="Boolean" default="false"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.account.payment.Payment" list="paymentList"><econdition field-name="unappliedTotal" operator="is-null" ignore="calculateAll"/></entity-find><iterate list="paymentList" entry="payment"><service-call name="mantle.account.PaymentServices.get#PaymentTotals" in-map="[paymentId:payment.paymentId]" out-map="[paymentTotal:totalOut.paymentTotal,appliedTotal:totalOut.appliedTotal,unappliedTotal:totalOut.unappliedTotal]" out-map-add-to-existing="false"/><set field="payment.appliedTotal" from="totalOut.appliedTotal"/><set field="payment.unappliedTotal" from="totalOut.unappliedTotal"/><entity-update value-field="payment"/></iterate><log level="warn" message="Calculated totals for ${paymentList.size()} Payments"/></actions></service>