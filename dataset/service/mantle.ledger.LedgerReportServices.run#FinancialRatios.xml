<!--Service Location mantle.ledger.LedgerReportServices.run#FinancialRatios--><service verb="run" noun="FinancialRatios"><in-parameters><parameter name="organizationPartyId" required="true"/><parameter name="timePeriodIdList" type="List" required="true"><parameter name="timePeriodId"/></parameter><parameter name="childOrgPeriods" type="Boolean" default="false"/></in-parameters><out-parameters><parameter name="organizationName"/><parameter name="partyAcctgPreference" type="Map"/><parameter name="currencyUomId"/><parameter name="timePeriodIdList" type="List"><parameter name="timePeriodId"/></parameter><parameter name="timePeriodIdMap" type="Map"/><parameter name="accountCodeFormatter" type="javax.swing.text.MaskFormatter"/><parameter name="classInfoById" type="Map"/><parameter name="netIncomeMap" type="Map"/><parameter name="salesMap" type="Map"/><parameter name="grossProfitMap" type="Map"/><parameter name="ebtMap" type="Map"/><parameter name="ibieMap" type="Map"/><parameter name="ebitMap" type="Map"/><parameter name="costOfSalesMap" type="Map"/><parameter name="cogsMap" type="Map"/><parameter name="totalAssetsMap" type="Map"/><parameter name="netFixedAssetsMap" type="Map"/><parameter name="currentAssetsMap" type="Map"/><parameter name="currentLiabilitiesMap" type="Map"/><parameter name="inventoryMap" type="Map"/><parameter name="totalLiabilitiesMap" type="Map"/><parameter name="longTermDebtMap" type="Map"/><parameter name="equityMap" type="Map"/><parameter name="accountsReceivableMap" type="Map"/><parameter name="depreciationMap" type="Map"/><parameter name="amortizationMap" type="Map"/><parameter name="interestExpenseMap" type="Map"/><parameter name="currentLiquidityMap" type="Map"/><parameter name="quickLiquidityMap" type="Map"/><parameter name="netCapitalToAssetsMap" type="Map"/><parameter name="inventoryTurnoverMap" type="Map"/><parameter name="fixedAssetTurnoverMap" type="Map"/><parameter name="totalAssetsTurnoverMap" type="Map"/><parameter name="debtRatioMap" type="Map"/><parameter name="debtToEquityMap" type="Map"/><parameter name="timesInterestEarnedMap" type="Map"/><parameter name="cashCoverageMap" type="Map"/><parameter name="equityMultiplierMap" type="Map"/><parameter name="grossProfitMarginMap" type="Map"/><parameter name="netProfitMarginMap" type="Map"/><parameter name="returnOnAssetsMap" type="Map"/><parameter name="returnOnEquityMap" type="Map"/></out-parameters><actions><service-call name="mantle.ledger.LedgerReportServices.get#ReportBasicInfo" in-map="context" out-map="[organizationName:context.organizationName,partyAcctgPreference:context.partyAcctgPreference,currencyUomId:context.currencyUomId,timePeriodIdList:context.timePeriodIdList,timePeriodIdMap:context.timePeriodIdMap,accountCodeFormatter:context.accountCodeFormatter]"/><set field="classIdList" from="['DEBIT', 'CREDIT']"/><set field="classInfoById" from="[:]"/><iterate list="classIdList" entry="classId"><service-call name="mantle.ledger.LedgerReportServices.get#GlAccountClassReportInfo" in-map="[organizationPartyId:organizationPartyId, timePeriodIdList:timePeriodIdList,                             classInfoById:classInfoById, negateDebit:true, glAccountClassEnumId:classId]"/></iterate><set field="metricMapNames" from="['salesMap', 'grossProfitMap', 'ebtMap', 'ibieMap', 'ebitMap']"/><set field="classMapNames" from="['costOfSalesMap', 'cogsMap', 'totalAssetsMap', 'netFixedAssetsMap', 'currentAssetsMap',                     'currentLiabilitiesMap', 'inventoryMap', 'totalLiabilitiesMap', 'longTermDebtMap', 'equityMap',                     'accountsReceivableMap', 'depreciationMap', 'amortizationMap', 'interestExpenseMap']"/><set field="ratioMapNames" from="['currentLiquidityMap', 'quickLiquidityMap', 'netCapitalToAssetsMap', 'inventoryTurnoverMap',                     'collectionPeriodMap', 'fixedAssetTurnoverMap', 'totalAssetsTurnoverMap', 'debtRatioMap',                     'debtToEquityMap', 'timesInterestEarnedMap', 'cashCoverageMap', 'fixedChargeCoverageMap',                     'equityMultiplierMap', 'grossProfitMarginMap', 'netProfitMarginMap', 'returnOnAssetsMap',                     'returnOnEquityMap']"/><iterate list="metricMapNames" entry="mapName"><script><![CDATA[context.put(mapName, [:])]]></script></iterate><iterate list="classMapNames" entry="mapName"><script><![CDATA[context.put(mapName, [:])]]></script></iterate><iterate list="ratioMapNames" entry="mapName"><script><![CDATA[context.put(mapName, [:])]]></script></iterate><set field="netIncomeClassIdList" from="['REVENUE', 'COST_OF_SALES', 'INCOME', 'EXPENSE', 'NON_OP_EXPENSE']"/><service-call name="mantle.ledger.LedgerReportServices.get#GlAccountClassInfoSums" out-map="[totalPosted:netIncomeOut.totalPosted,totalPostedNoClosing:netIncomeOut.totalPostedNoClosing,totalBalance:netIncomeOut.totalBalance]" in-map="[classInfoById:classInfoById, classIdList:netIncomeClassIdList]"/><set field="netIncomeMap" from="netIncomeOut.totalPosted"/><iterate list="timePeriodIdList" entry="timePeriodId"><set field="costOfSales" from="-(classInfoById.COST_OF_SALES.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[costOfSalesMap.put(timePeriodId, costOfSales)]]></script><set field="cogs" from="-(classInfoById.COST_GOODS_SOLD.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[cogsMap.put(timePeriodId, cogs)]]></script><set field="totalAssets" from="(classInfoById.ASSET.totalBalanceByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[totalAssetsMap.put(timePeriodId, totalAssets)]]></script><set field="netFixedAssets" from="(classInfoById.LONG_TERM_ASSET.totalBalanceByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[netFixedAssetsMap.put(timePeriodId, netFixedAssets)]]></script><set field="currentAssets" from="classInfoById.CURRENT_ASSET.totalBalanceByTimePeriod[timePeriodId] ?: 0.0"/><script><![CDATA[currentAssetsMap.put(timePeriodId, currentAssets)]]></script><set field="currentLiabilities" from="-(classInfoById.CURRENT_LIABILITY.totalBalanceByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[currentLiabilitiesMap.put(timePeriodId, currentLiabilities)]]></script><set field="inventory" from="classInfoById.INVENTORY_ASSET.totalBalanceByTimePeriod[timePeriodId] ?: 0.0"/><script><![CDATA[inventoryMap.put(timePeriodId, inventory)]]></script><set field="totalLiabilities" from="-(classInfoById.LIABILITY.totalBalanceByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[totalLiabilitiesMap.put(timePeriodId, totalLiabilities)]]></script><set field="longTermDebt" from="-(classInfoById.LONG_TERM_LIABILITY.totalBalanceByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[longTermDebtMap.put(timePeriodId, longTermDebt)]]></script><set field="equity" from="classInfoById.EQUITY.totalBalanceByTimePeriod[timePeriodId] ?: 0.0"/><script><![CDATA[equityMap.put(timePeriodId, equity)]]></script><set field="accountsReceivable" from="-(classInfoById.ACCOUNTS_RECEIVABLE.totalBalanceByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[accountsReceivableMap.put(timePeriodId, accountsReceivable)]]></script><set field="depreciation" from="-(classInfoById.DEPRECIATION.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[depreciationMap.put(timePeriodId, depreciation)]]></script><set field="amortization" from="-(classInfoById.AMORTIZATION.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[amortizationMap.put(timePeriodId, amortization)]]></script><set field="interestExpense" from="-(classInfoById.INTEREST_EXPENSE.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[interestExpenseMap.put(timePeriodId, interestExpense)]]></script><set field="sales" from="(classInfoById.REVENUE.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[salesMap.put(timePeriodId, sales)]]></script><set field="grossProfit" from="sales - costOfSales"/><script><![CDATA[grossProfitMap.put(timePeriodId, grossProfit)]]></script><set field="netIncome" from="netIncomeMap[timePeriodId] ?: 0"/><set field="ebt" from="netIncome - (classInfoById.INCOME_TAX_EXPENSE.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[ebtMap.put(timePeriodId, ebt)]]></script><set field="ibie" from="ebt - (classInfoById.INTEREST_EXPENSE.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[ibieMap.put(timePeriodId, ibie)]]></script><set field="ebit" from="ibie - (classInfoById.INTEREST_INCOME.totalPostedByTimePeriod[timePeriodId] ?: 0.0)"/><script><![CDATA[ebitMap.put(timePeriodId, ebit)]]></script><iterate list="classMapNames" entry="mapName"><script><![CDATA[addToBigDecimalInMap('ALL', context[mapName][timePeriodId], context[mapName])]]></script></iterate><iterate list="metricMapNames" entry="mapName"><script><![CDATA[addToBigDecimalInMap('ALL', context[mapName][timePeriodId], context[mapName])]]></script></iterate><script><![CDATA[currentLiquidityMap.put(timePeriodId, currentLiabilities ? currentAssets / currentLiabilities : 0.0)]]></script><script><![CDATA[quickLiquidityMap.put(timePeriodId, currentLiabilities ? (currentAssets - inventory) / currentLiabilities : 0.0)]]></script><script><![CDATA[netCapitalToAssetsMap.put(timePeriodId, totalAssets ? (currentAssets - inventory) / totalAssets : 0.0)]]></script><script><![CDATA[inventoryTurnoverMap.put(timePeriodId, inventory ? cogs / inventory : 0.0)]]></script><script><![CDATA[fixedAssetTurnoverMap.put(timePeriodId, netFixedAssets ? sales / netFixedAssets : 0.0)]]></script><script><![CDATA[totalAssetsTurnoverMap.put(timePeriodId, totalAssets ? sales / totalAssets : 0.0)]]></script><script><![CDATA[debtRatioMap.put(timePeriodId, totalAssets ? totalLiabilities / totalAssets : 0.0)]]></script><script><![CDATA[debtToEquityMap.put(timePeriodId, equity ? longTermDebt / equity : 0.0)]]></script><script><![CDATA[timesInterestEarnedMap.put(timePeriodId, interestExpense ? ebit / interestExpense : 0.0)]]></script><script><![CDATA[cashCoverageMap.put(timePeriodId, interestExpense ? (ebit + depreciation + amortization) / interestExpense : 0.0)]]></script><script><![CDATA[equityMultiplierMap.put(timePeriodId, equity ? totalAssets / equity : 0.0)]]></script><script><![CDATA[grossProfitMarginMap.put(timePeriodId, sales ? grossProfit / sales : 0.0)]]></script><script><![CDATA[netProfitMarginMap.put(timePeriodId, sales ? netIncome / sales : 0.0)]]></script><script><![CDATA[returnOnAssetsMap.put(timePeriodId, totalAssets ? netIncome / totalAssets : 0.0)]]></script><script><![CDATA[returnOnEquityMap.put(timePeriodId, equity ? netIncome / equity : 0.0)]]></script></iterate><script><![CDATA[currentLiquidityMap.put('ALL', currentLiabilitiesMap['ALL'] ? currentAssetsMap['ALL'] / currentLiabilitiesMap['ALL'] : 0.0)]]></script><script><![CDATA[quickLiquidityMap.put('ALL', currentLiabilitiesMap['ALL'] ? (currentAssetsMap['ALL'] - inventoryMap['ALL']) / currentLiabilitiesMap['ALL'] : 0.0)]]></script><script><![CDATA[netCapitalToAssetsMap.put('ALL', totalAssetsMap['ALL'] ? (currentAssetsMap['ALL'] - inventoryMap['ALL']) / totalAssetsMap['ALL'] : 0.0)]]></script><script><![CDATA[inventoryTurnoverMap.put('ALL', inventoryMap['ALL'] ? cogsMap['ALL'] / inventoryMap['ALL'] : 0.0)]]></script><script><![CDATA[fixedAssetTurnoverMap.put('ALL', netFixedAssetsMap['ALL'] ? salesMap['ALL'] / netFixedAssetsMap['ALL'] : 0.0)]]></script><script><![CDATA[totalAssetsTurnoverMap.put('ALL', totalAssetsMap['ALL'] ? salesMap['ALL'] / totalAssetsMap['ALL'] : 0.0)]]></script><script><![CDATA[debtRatioMap.put('ALL', totalAssetsMap['ALL'] ? totalLiabilitiesMap['ALL'] / totalAssetsMap['ALL'] : 0.0)]]></script><script><![CDATA[debtToEquityMap.put('ALL', equityMap['ALL'] ? longTermDebtMap['ALL'] / equityMap['ALL'] : 0.0)]]></script><script><![CDATA[timesInterestEarnedMap.put('ALL', interestExpenseMap['ALL'] ? ebitMap['ALL'] / interestExpenseMap['ALL'] : 0.0)]]></script><script><![CDATA[cashCoverageMap.put('ALL', interestExpenseMap['ALL'] ? (ebitMap['ALL'] + depreciationMap['ALL'] + amortizationMap['ALL']) / interestExpenseMap['ALL'] : 0.0)]]></script><script><![CDATA[equityMultiplierMap.put('ALL', equityMap['ALL'] ? totalAssetsMap['ALL'] / equityMap['ALL'] : 0.0)]]></script><script><![CDATA[grossProfitMarginMap.put('ALL', salesMap['ALL'] ? grossProfitMap['ALL'] / salesMap['ALL'] : 0.0)]]></script><script><![CDATA[netProfitMarginMap.put('ALL', salesMap['ALL'] ? netIncomeMap['ALL'] / salesMap['ALL'] : 0.0)]]></script><script><![CDATA[returnOnAssetsMap.put('ALL', totalAssetsMap['ALL'] ? netIncomeMap['ALL'] / totalAssetsMap['ALL'] : 0.0)]]></script><script><![CDATA[returnOnEquityMap.put('ALL', equityMap['ALL'] ? netIncomeMap['ALL'] / equityMap['ALL'] : 0.0)]]></script></actions></service>