<!--Service Location mantle.ledger.PaymentAutoPostServices.get#PaymentMethodGlAccount--><service verb="get" noun="PaymentMethodGlAccount"><in-parameters><parameter name="paymentId" required="true"/><parameter name="organizationPartyId" required="true"/><parameter name="otherPartyId"/><parameter name="finAccountTypeId"/><parameter name="creditCardTypeEnumId"/></in-parameters><out-parameters><parameter name="glAccountId"/><parameter name="glAccountTypeEnumId"/></out-parameters><actions><entity-find-one entity-name="mantle.account.payment.Payment" value-field="payment"/><set field="isPayable" from="organizationPartyId == payment.fromPartyId ? 'Y' : 'N'"/><set field="paymentInstrumentEnumId" from="payment.paymentInstrumentEnumId"/><set field="glAccountId" from="payment.overrideGlAccountId"/><if condition="!glAccountId && payment.paymentMethodId && payment.fromPartyId == organizationPartyId"><entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="paymentMethod"><field-map field-name="paymentMethodId" from="payment.paymentMethodId"/></entity-find-one><set field="glAccountId" from="paymentMethod.glAccountId"/></if><if condition="!glAccountId && payment.toPaymentMethodId && payment.toPartyId == organizationPartyId"><entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="paymentMethod"><field-map field-name="paymentMethodId" from="payment.toPaymentMethodId"/></entity-find-one><set field="glAccountId" from="paymentMethod.glAccountId"/></if><service-call name="mantle.ledger.LedgerServices.expand#ParentOrganizationList" out-map="[orgPartyIdList:context.orgPartyIdList]" in-map="[organizationPartyId:organizationPartyId]"/><if condition="!glAccountId && paymentInstrumentEnumId == 'PiCreditCard'"><entity-find entity-name="mantle.ledger.config.CreditCardTypeGlAccount" list="creditCardTypeGlAccountList" cache="true"><econdition field-name="organizationPartyId" operator="in" from="orgPartyIdList"/><econdition field-name="creditCardTypeEnumId"/></entity-find><set field="glAccountId" from="creditCardTypeGlAccountList.first?.glAccountId"/></if><if condition="!glAccountId"><if condition="payment.paymentTypeEnumId == 'PtFinancialAccount'"><then><entity-find entity-name="mantle.ledger.config.FinancialAccountTypeGlAccount" list="financialAccountTypeGlAccountList" cache="true"><econdition field-name="organizationPartyId" operator="in" from="orgPartyIdList"/><econdition field-name="finAccountTypeId"/></entity-find><set field="glAccountId" from="financialAccountTypeGlAccountList.first?.glAccountId"/></then><else-if condition="payment.paymentInstrumentEnumId == 'PiFinancialAccount'"><entity-find entity-name="mantle.ledger.config.FinancialAccountReasonGlAccount" list="accountReasonGlAccountList" cache="true"><econdition field-name="organizationPartyId" operator="in" from="orgPartyIdList"/><econdition field-name="reasonEnumId" from="isPayable == 'Y' ? 'FatrReplenish' : 'FatrDisbursement'"/></entity-find><set field="glAccountId" from="accountReasonGlAccountList?.first?.glAccountId"/></else-if></if></if><if condition="!glAccountId"><entity-find entity-name="mantle.ledger.config.PaymentInstrumentGlAccount" list="paymentInstrumentGlAccountList" cache="true"><econdition field-name="organizationPartyId" operator="in" from="orgPartyIdList"/><econdition field-name="paymentInstrumentEnumId"/><econdition field-name="isPayable"/></entity-find><if condition="!paymentInstrumentGlAccountList"><entity-find entity-name="mantle.ledger.config.PaymentInstrumentGlAccount" list="paymentInstrumentGlAccountList" cache="true"><econdition field-name="organizationPartyId" operator="in" from="orgPartyIdList"/><econdition field-name="paymentInstrumentEnumId"/><econdition field-name="isPayable" value="E"/></entity-find></if><set field="glAccountId" from="paymentInstrumentGlAccountList.first?.glAccountId"/></if><if condition="glAccountId"><entity-find-one entity-name="mantle.ledger.account.GlAccount" value-field="glAccount" cache="true"><field-map field-name="glAccountId"/></entity-find-one><set field="glAccountTypeEnumId" from="glAccount?.glAccountTypeEnumId"/></if></actions></service>