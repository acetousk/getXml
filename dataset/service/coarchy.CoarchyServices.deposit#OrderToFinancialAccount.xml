<!--Service Location coarchy.CoarchyServices.deposit#OrderToFinancialAccount--><service verb="deposit" noun="OrderToFinancialAccount"><in-parameters><parameter name="orderId" required="true"/><parameter name="orderName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="orderName"/><parameter name="entryDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="entryDate"/><parameter name="placedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="placedDate"/><parameter name="approvedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="approvedDate"/><parameter name="completedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="completedDate"/><parameter name="statusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="statusId"/><parameter name="processingStatusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="processingStatusId"/><parameter name="orderRevision" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="orderRevision"/><parameter name="currencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="currencyUomId"/><parameter name="billingAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="billingAccountId"/><parameter name="productStoreId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="productStoreId"/><parameter name="salesChannelEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="salesChannelEnumId"/><parameter name="terminalId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="terminalId"/><parameter name="displayId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="displayId"/><parameter name="externalId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="externalId"/><parameter name="externalRevision" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="externalRevision"/><parameter name="originId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="originId"/><parameter name="originUrl" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="originUrl"/><parameter name="syncStatusId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="syncStatusId"/><parameter name="systemMessageRemoteId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="systemMessageRemoteId"/><parameter name="visitId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="visitId"/><parameter name="enteredByPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="enteredByPartyId"/><parameter name="parentOrderId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="parentOrderId"/><parameter name="recurCronExpression" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="recurCronExpression"/><parameter name="lastOrderedDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="lastOrderedDate"/><parameter name="recurAutoInvoice" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="recurAutoInvoice"/><parameter name="remainingSubTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="remainingSubTotal"/><parameter name="grandTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="grandTotal"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.order.OrderHeader" field-name="lastUpdatedStamp"/></in-parameters><out-parameters/><actions><entity-find entity-name="mantle.order.OrderItemAndPart" list="orderItemPartList"><econdition field-name="orderId"/><econdition field-name="itemTypeEnumId" value="ItemProduct"/><econdition field-name="productId" value="c100000"/><order-by field-name="orderItemSeqId"/></entity-find><if condition="orderItemPartList.size() == 0"><return type="warning" message="No Organization-Month Items found for order"/></if><iterate list="orderItemPartList" entry="orderItemPart"><service-call name="mantle.account.FinancialAccountServices.getOrCreate#FinancialAccount" in-map="[                         finAccountTypeId:'OrganizationMonthCredit',organizationPartyId:'coarchy',                         ownerPartyId:orderItemPart.customerPartyId,currencyUomId:'DSM']" out-map="[finAccountId:context.finAccountId]"/><service-call name="mantle.account.FinancialAccountServices.deposit#FinancialAccount" in-map="[                         finAccountId:finAccountId,amount:orderItemPart.quantity,orderId:orderId,                         orderItemSeqId:orderItemPart.orderItemSeqId]"/></iterate><set field="partsAlreadyInvoiced" from="[]"/><iterate list="orderItemPartList" entry="orderItemPart"><if condition="partsAlreadyInvoiced.contains(orderItemPart.orderPartSeqId)"><continue/></if><service-call name="mantle.account.InvoiceServices.create#EntireOrderPartInvoice" in-map="[orderId:orderId,                     orderPartSeqId:orderItemPart.orderPartSeqId,statusId:'InvoiceFinalized']" out-map="[invoiceId:context.invoiceId]"/><set field="partsAlreadyInvoiced" from="partsAlreadyInvoiced + [orderItemPart.orderPartSeqId]"/></iterate><service-call name="mantle.order.OrderServices.complete#Order" in-map="[orderId:orderId]"/><service-call name="mantle.party.PartyServices.set#PartyClassification" in-map="[partyId:partyId,partyClassificationId:'PayingCustomer']" out-map="[]"/></actions></service>