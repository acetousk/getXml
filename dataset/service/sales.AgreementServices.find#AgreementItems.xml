<!--Service Location sales.AgreementServices.find#AgreementItems--><service verb="find" noun="AgreementItems"><in-parameters><parameter name="agreementId" required="true"/></in-parameters><out-parameters><parameter name="agreementItemList" type="List"/></out-parameters><actions><entity-find entity-name="mantle.party.agreement.AgreementItemAndProductPrice" list="agreementItemListMain"><econdition field-name="agreementId"/><econdition field-name="agreementItemTypeEnumId" value="AitPricing"/><order-by field-name="agreementItemSeqId"/></entity-find><set field="agreementItemList" from="[]"/><if condition="agreementItemListMain"><iterate list="agreementItemListMain" entry="ai"><set field="agItem" from="new HashMap()"/><script><![CDATA[agItem.putAll(ai)
                        agreementItemList.add(agItem)]]></script><set field="formattedLineAmount" from="ec.l10n.formatCurrency(ai.lineAmount ?: 0, ai?.priceUomId)"/><script><![CDATA[agItem.put("formattedLineAmount",formattedLineAmount)]]></script><entity-find-one entity-name="mantle.product.Product" value-field="product"><field-map field-name="productId" from="ai.productId"/></entity-find-one><if condition="product"><script><![CDATA[agItem.put("product",product.productName)]]></script></if><entity-find-one entity-name="moqui.basic.Enumeration" value-field="itemType"><field-map field-name="enumId" from="ai.agreementItemTypeEnumId"/></entity-find-one><if condition="itemType"><script><![CDATA[agItem.put("itemType",itemType.description)]]></script></if><entity-find entity-name="mantle.product.ProductPrice" list="productPrice"><econdition field-name="productId" from="ai.productId"/><econdition field-name="priceTypeEnumId" value="PptList"/><date-filter/></entity-find><if condition="productPrice"><set field="listPrice" from="ec.l10n.formatCurrency(productPrice[0]['price'] ?: 0, productPrice[0]['priceUomId'])"/><script><![CDATA[agItem.put("listPrice",listPrice)]]></script></if></iterate></if></actions></service>