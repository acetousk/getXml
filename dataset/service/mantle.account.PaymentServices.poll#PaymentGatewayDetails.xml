<!--Service Location mantle.account.PaymentServices.poll#PaymentGatewayDetails--><service verb="poll" noun="PaymentGatewayDetails"><in-parameters><parameter name="statusIds" default-value="PmntAuthorized,PmntDelivered"/><parameter name="checkLimit" type="Integer" default="1000"/><parameter name="lookBackDays" type="Integer" default="60"/></in-parameters><out-parameters/><actions><script><![CDATA[Calendar basisCal = ec.user.getCalendarSafe()
                basisCal.add(Calendar.DAY_OF_YEAR, (int) -lookBackDays)
                basisTimestamp = new java.sql.Timestamp(basisCal.getTimeInMillis())]]></script><entity-find entity-name="mantle.account.payment.Payment" list="paymentList" limit="checkLimit"><econdition field-name="statusId" operator="in" from="statusIds"/><econdition field-name="paymentRefNum" operator="is-not-null"/><econdition field-name="paymentGatewayConfigId" operator="is-not-null"/><econdition field-name="paymentMethodId" operator="is-not-null"/><econdition field-name="effectiveDate" operator="greater" from="basisTimestamp" or-null="true"/><select-field field-name="paymentId,paymentGatewayConfigId"/></entity-find><iterate list="paymentList" entry="payment"><entity-find-one entity-name="mantle.account.method.PaymentGatewayConfig" value-field="paymentGatewayConfig" cache="true"><field-map field-name="paymentGatewayConfigId" from="payment.paymentGatewayConfigId"/></entity-find-one><if condition="!paymentGatewayConfig?.detailsServiceName"><continue/></if><service-call name="mantle.account.PaymentServices.get#SinglePaymentGatewayDetails" transaction="force-new" in-map="[paymentId:payment.paymentId]"/></iterate></actions></service>