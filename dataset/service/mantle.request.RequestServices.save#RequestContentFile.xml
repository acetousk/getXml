<!--Service Location mantle.request.RequestServices.save#RequestContentFile--><service verb="save" noun="RequestContentFile"><in-parameters><parameter name="requestContentId" required="true"/><parameter name="requestId" required="true"/><parameter name="contentFile" type="org.apache.commons.fileupload.FileItem" required="true"/><parameter name="saveContentLocation" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="contentLocation"/></out-parameters><actions><set field="filename" from="contentFile.getName()"/><if condition="org.moqui.resource.ResourceReference.isTextFilename(filename)"><then><set field="contentRoot" from="ec.user.getPreference('mantle.content.root') ?: 'dbresource://mantle/content'"/></then><else><set field="contentRoot" from="ec.user.getPreference('mantle.content.large.root') ?: 'dbresource://mantle/content'"/></else></if><set field="contentLocation" value="${contentRoot}/request/${requestId}/content_${requestContentId}/${filename}"/><set field="docRr" from="ec.resource.getLocationReference(contentLocation)"/><script><![CDATA[fileStream = contentFile.getInputStream()
                try { docRr.putStream(fileStream) } finally { fileStream.close() }]]></script><if condition="saveContentLocation"><service-call name="update#mantle.request.RequestContent" in-map="[requestContentId:requestContentId, contentLocation:contentLocation]"/></if></actions></service>