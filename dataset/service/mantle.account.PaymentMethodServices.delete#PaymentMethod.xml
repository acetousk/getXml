<!--Service Location mantle.account.PaymentMethodServices.delete#PaymentMethod--><service verb="delete" noun="PaymentMethod"><in-parameters><parameter name="paymentMethodId" required="true" entity-name="mantle.account.method.PaymentMethod" field-name="paymentMethodId"/><parameter name="thruDate" type="Timestamp" default="ec.user.nowTimestamp" entity-name="mantle.account.method.PaymentMethod" field-name="thruDate"/></in-parameters><out-parameters/><actions><entity-find-count entity-name="mantle.account.payment.Payment" count-field="paymentCount"><econditions combine="or"><econdition field-name="paymentMethodId"/><econdition field-name="toPaymentMethodId" from="paymentMethodId"/></econditions><econdition field-name="statusId" operator="in" value="PmntProposed,PmntPromised,PmntAuthorized,PmntDeclined"/></entity-find-count><if condition="paymentCount > 0"><service-call name="update#mantle.account.method.PaymentMethod" in-map="[paymentMethodId:paymentMethodId, thruDateSetAuto:'Y']"/><return type="danger" message="Payment method ${paymentMethodId} has active payments and will be deleted once completed"/></if><service-call name="update#mantle.account.method.PaymentMethod" in-map="context"/></actions></service>