<!--Service Location mantle.ledger.AssetAutoPostServices.calculateAndPost#FixedAssetDepreciation--><service verb="calculateAndPost" noun="FixedAssetDepreciation"><in-parameters><parameter name="assetId" required="true"/><parameter name="timePeriodId" required="true"/><parameter name="transactionDate" type="Timestamp"/></in-parameters><out-parameters><parameter name="usefulLifeYears" type="Integer"/><parameter name="yearsRemaining" type="Integer"/><parameter name="isLastYearPeriod" type="Boolean"/><parameter name="annualDepreciation" type="BigDecimal"/><parameter name="monthlyDepreciation" type="BigDecimal"/><parameter name="acctgTransId"/></out-parameters><actions><entity-find-one entity-name="mantle.product.asset.Asset" value-field="asset" for-update="true"/><entity-find-one entity-name="mantle.party.time.TimePeriod" value-field="timePeriod"/><if condition="transactionDate == null"><service-call name="mantle.party.TimeServices.get#TimePeriodInfo" in-map="[timePeriod:timePeriod]" out-map="[timePeriod:periodInfo.timePeriod,fromTimestamp:periodInfo.fromTimestamp,thruTimestamp:periodInfo.thruTimestamp,thruTimestampExclusive:periodInfo.thruTimestampExclusive,thruTimestampLate:periodInfo.thruTimestampLate]"/><set field="transactionDate" from="periodInfo.thruTimestampLate"/></if><if condition="timePeriod.timePeriodTypeId != 'FiscalMonth'"><return error="true" message="Can only post fixed asset depreciation to Fiscal Month periods"/></if><service-call name="mantle.ledger.AssetAutoPostServices.calculate#FixedAssetDepreciation" in-map="context" out-map="[transactionDate:context.transactionDate,usefulLifeYears:context.usefulLifeYears,yearsRemaining:context.yearsRemaining,isLastYearPeriod:context.isLastYearPeriod,annualDepreciation:context.annualDepreciation,monthlyDepreciation:context.monthlyDepreciation,netBookValue:context.netBookValue,yearBeginNetBookValue:context.yearBeginNetBookValue]"/><if condition="monthlyDepreciation"><service-call name="mantle.ledger.AssetAutoPostServices.post#FixedAssetDepreciation" in-map="context" out-map="[acctgTransId:context.acctgTransId]"/></if></actions></service>