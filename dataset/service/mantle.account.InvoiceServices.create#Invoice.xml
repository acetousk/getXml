<!--Service Location mantle.account.InvoiceServices.create#Invoice--><service verb="create" noun="Invoice"><in-parameters><parameter name="invoiceTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="invoiceTypeEnumId" default-value="InvoiceSales"/><parameter name="fromPartyId" type="java.lang.String" required="true" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="fromPartyId"/><parameter name="toPartyId" type="java.lang.String" required="true" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="toPartyId"/><parameter name="billingAccountId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="billingAccountId"/><parameter name="invoiceDate" type="Timestamp" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="invoiceDate" default="ec.user.nowTimestamp"/><parameter name="dueDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="dueDate"/><parameter name="settlementTermId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="settlementTermId"/><parameter name="paidDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="paidDate"/><parameter name="invoiceMessage" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="invoiceMessage"/><parameter name="referenceNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="referenceNumber"/><parameter name="otherPartyOrderId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="otherPartyOrderId"/><parameter name="description" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="description"/><parameter name="currencyUomId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="currencyUomId"><description><![CDATA[Defaults to PartyAcctgPreference.baseCurrencyUomId for whichever
                Party (from or to) is an internal organization with an accounting preference record.]]></description></parameter><parameter name="overrideOrgPartyId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="overrideOrgPartyId"/><parameter name="productStoreId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="productStoreId"/><parameter name="partyRelationshipId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="partyRelationshipId"/><parameter name="timePeriodId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="timePeriodId"/><parameter name="acctgTransResultEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="acctgTransResultEnumId"/><parameter name="systemMessageRemoteId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="systemMessageRemoteId"/><parameter name="externalId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="externalId"/><parameter name="originId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="originId"/><parameter name="invoiceTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="invoiceTotal"/><parameter name="appliedPaymentsTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="appliedPaymentsTotal"/><parameter name="unpaidTotal" type="java.math.BigDecimal" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="unpaidTotal"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.account.invoice.Invoice" field-name="lastUpdatedStamp"/></in-parameters><out-parameters><parameter name="invoiceId" entity-name="mantle.account.invoice.Invoice" field-name="invoiceId"/></out-parameters><actions><entity-find-count entity-name="mantle.party.PartyRole" count-field="fromOrgInternalCount"><econdition field-name="partyId" from="fromPartyId"/><econdition field-name="roleTypeId" value="OrgInternal"/></entity-find-count><set field="isFromPartyOrgInternal" from="fromOrgInternalCount > 0"/><entity-find-count entity-name="mantle.party.PartyRole" count-field="toOrgInternalCount"><econdition field-name="partyId" from="toPartyId"/><econdition field-name="roleTypeId" value="OrgInternal"/></entity-find-count><set field="isToPartyOrgInternal" from="toOrgInternalCount > 0"/><if condition="isToPartyOrgInternal && !isFromPartyOrgInternal"><then><set field="organizationPartyId" from="toPartyId"/><set field="otherPartyId" from="fromPartyId"/><set field="statusId" value="InvoiceIncoming"/></then><else><set field="organizationPartyId" from="fromPartyId"/><set field="otherPartyId" from="toPartyId"/><set field="statusId" value="InvoiceInProcess"/></else></if><if condition="!currencyUomId"><service-call name="mantle.ledger.LedgerServices.find#PartyAcctgPreference" out-map="[partyAcctgPreference:context.partyAcctgPreference]" in-map="[organizationPartyId:organizationPartyId]"/><set field="currencyUomId" from="partyAcctgPreference?.baseCurrencyUomId"/></if><if condition="!currencyUomId"><set field="currencyUomId" value="USD"/></if><service-call name="create#mantle.account.invoice.Invoice" in-map="context" out-map="[invoiceId:context.invoiceId,invoiceTypeEnumId:context.invoiceTypeEnumId,fromPartyId:context.fromPartyId,toPartyId:context.toPartyId,statusId:context.statusId,billingAccountId:context.billingAccountId,invoiceDate:context.invoiceDate,dueDate:context.dueDate,settlementTermId:context.settlementTermId,paidDate:context.paidDate,invoiceMessage:context.invoiceMessage,referenceNumber:context.referenceNumber,otherPartyOrderId:context.otherPartyOrderId,description:context.description,currencyUomId:context.currencyUomId,overrideOrgPartyId:context.overrideOrgPartyId,productStoreId:context.productStoreId,partyRelationshipId:context.partyRelationshipId,timePeriodId:context.timePeriodId,acctgTransResultEnumId:context.acctgTransResultEnumId,systemMessageRemoteId:context.systemMessageRemoteId,externalId:context.externalId,originId:context.originId,invoiceTotal:context.invoiceTotal,appliedPaymentsTotal:context.appliedPaymentsTotal,unpaidTotal:context.unpaidTotal,lastUpdatedStamp:context.lastUpdatedStamp]"/></actions></service>