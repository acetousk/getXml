<!--Service Location mantle.ledger.LedgerServices.expand#ChildOrganizationList--><service verb="expand" noun="ChildOrganizationList"><in-parameters><parameter name="organizationPartyId" required="true"/><parameter name="onlyWithNoAcctgPreference" type="Boolean" default="false"/></in-parameters><out-parameters><parameter name="orgPartyIdList" type="List"/></out-parameters><actions><entity-find-one entity-name="mantle.ledger.config.PartyAcctgPreference" value-field="partyAcctgPreference" cache="true"><field-map field-name="organizationPartyId"/></entity-find-one><if condition="onlyWithNoAcctgPreference && partyAcctgPreference"><then><set field="orgPartyIdList" from="[]"/></then><else><set field="orgPartyIdList" from="[organizationPartyId]"/></else></if><entity-find entity-name="mantle.party.PartyRelationship" list="partyRelationshipList" cache="true"><date-filter/><econdition field-name="toPartyId" from="organizationPartyId"/><econdition field-name="relationshipTypeEnumId" value="PrtOrgRollup"/><econdition field-name="fromRoleTypeId" value="OrgInternal"/><econdition field-name="toRoleTypeId" value="OrgInternal"/></entity-find><iterate list="partyRelationshipList" entry="partyRelationship"><if condition="onlyWithNoAcctgPreference"><entity-find-one entity-name="mantle.ledger.config.PartyAcctgPreference" value-field="partyAcctgPreference" cache="true"><field-map field-name="organizationPartyId" from="partyRelationship.fromPartyId"/></entity-find-one><if condition="partyAcctgPreference"><continue/></if></if><service-call name="mantle.ledger.LedgerServices.expand#ChildOrganizationList" out-map="[orgPartyIdList:expandResult.orgPartyIdList]" in-map="[organizationPartyId:partyRelationship.fromPartyId, onlyWithNoAcctgPreference:onlyWithNoAcctgPreference]"/><script><![CDATA[orgPartyIdList.addAll(expandResult.orgPartyIdList)]]></script></iterate></actions></service>