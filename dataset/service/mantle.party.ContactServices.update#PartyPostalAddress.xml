<!--Service Location mantle.party.ContactServices.update#PartyPostalAddress--><service verb="update" noun="PartyPostalAddress"><in-parameters><parameter name="toName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="toName"/><parameter name="attnName" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="attnName"/><parameter name="address1" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="address1"/><parameter name="address2" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="address2"/><parameter name="unitNumber" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="unitNumber"/><parameter name="directions" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="directions"/><parameter name="city" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="city"/><parameter name="cityGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="cityGeoId"/><parameter name="schoolDistrictGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="schoolDistrictGeoId"/><parameter name="countyGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="countyGeoId"/><parameter name="stateProvinceGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="stateProvinceGeoId"/><parameter name="countryGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="countryGeoId"/><parameter name="postalCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCode"/><parameter name="postalCodeExt" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCodeExt"/><parameter name="postalCodeGeoId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="postalCodeGeoId"/><parameter name="geoPointId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="geoPointId"/><parameter name="commercial" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="commercial"/><parameter name="accessCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="accessCode"/><parameter name="telecomContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="telecomContactMechId"/><parameter name="emailContactMechId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="emailContactMechId"/><parameter name="shipGatewayAddressId" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PostalAddress" field-name="shipGatewayAddressId"/><parameter name="lastUpdatedStamp" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="lastUpdatedStamp"/><parameter name="geoPointTypeEnumId" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="geoPointTypeEnumId"/><parameter name="description" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="description"/><parameter name="dataSourceId" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="dataSourceId"/><parameter name="latitude" type="java.lang.Double" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="latitude"/><parameter name="longitude" type="java.lang.Double" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="longitude"/><parameter name="elevation" type="java.lang.Double" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="elevation"/><parameter name="elevationUomId" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="elevationUomId"/><parameter name="information" type="java.lang.String" required="false" allow-html="none" entity-name="moqui.basic.GeoPoint" field-name="information"/><parameter name="thruDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="thruDate"/><parameter name="extension" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="extension"/><parameter name="comments" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="comments"/><parameter name="allowSolicitation" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="allowSolicitation"/><parameter name="usedSince" type="java.sql.Date" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="usedSince"/><parameter name="usedUntil" type="java.sql.Date" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="usedUntil"/><parameter name="verifyCode" type="java.lang.String" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="verifyCode"/><parameter name="verifyCodeDate" type="java.sql.Timestamp" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="verifyCodeDate"/><parameter name="verifyCodeAttempts" type="java.lang.Long" required="false" allow-html="none" entity-name="mantle.party.contact.PartyContactMech" field-name="verifyCodeAttempts"/><parameter name="partyId" required="true"/><parameter name="contactMechId" required="true"/><parameter name="contactMechPurposeId"/><parameter name="orderId"><description><![CDATA[If specified update matching OrderPart.postalContactMechId]]></description></parameter><parameter name="orderPartSeqId"><description><![CDATA[If specified along with orderId set OrderPart.postalContactMechId]]></description></parameter><parameter name="shipmentId"><description><![CDATA[If specified update matching ShipmentRouteSegment origin and dest postal IDs]]></description></parameter><parameter name="shipmentRouteSegmentSeqId"><description><![CDATA[If specified along with shipmentId set ShipmentRouteSegment origin or dest postal IDs]]></description></parameter><parameter name="shipmentSetOrigin" type="Boolean"><description><![CDATA[If specified along with shipmentId set ShipmentRouteSegment.originPostalContactMechId]]></description></parameter><parameter name="shipmentSetDest" type="Boolean"><description><![CDATA[If specified along with shipmentId set ShipmentRouteSegment.destPostalContactMechId]]></description></parameter><parameter name="expireCurrent" type="Boolean" default="true"/></in-parameters><out-parameters><parameter name="contactMechId" required="true"/></out-parameters><actions><set field="origContactMechId" from="contactMechId"/><entity-find-one entity-name="mantle.party.contact.PostalAddress" value-field="origPostalAddress"/><set field="geoPointId" from="origPostalAddress.geoPointId"/><if condition="geoPointId"><then><entity-find-one entity-name="moqui.basic.GeoPoint" value-field="origGeoPoint"/><set field="newGeoPoint" from="origGeoPoint.cloneValue()"/><entity-set value-field="newGeoPoint" include="nonpk"/><if condition="newGeoPoint != origGeoPoint"><set field="newGeoPoint.geoPointId" from="null"/><entity-sequenced-id-primary value-field="newGeoPoint"/><entity-create value-field="newGeoPoint"/><set field="geoPointId" from="newGeoPoint.geoPointId"/></if></then><else><if condition="latitude || elevation"><service-call name="create#moqui.basic.GeoPoint" in-map="context" out-map="[geoPointId:context.geoPointId,geoPointTypeEnumId:context.geoPointTypeEnumId,description:context.description,dataSourceId:context.dataSourceId,latitude:context.latitude,longitude:context.longitude,elevation:context.elevation,elevationUomId:context.elevationUomId,information:context.information,lastUpdatedStamp:context.lastUpdatedStamp]"/></if></else></if><set field="newPostalAddress" from="origPostalAddress.cloneValue()"/><entity-set value-field="newPostalAddress" include="nonpk" set-if-empty="true"/><if condition="newPostalAddress == origPostalAddress"><log message="No fields were different for Postal Address ${contactMechId}, not updating."/><return/></if><if condition="contactMechPurposeId"><entity-find entity-name="mantle.party.contact.PartyContactMech" list="origPcmList"><econdition field-name="partyId"/><econdition field-name="contactMechId"/></entity-find><if condition="!origPcmList"><entity-find entity-name="mantle.account.method.PaymentMethod" list="payMethList"><econdition field-name="ownerPartyId" from="partyId"/><econdition field-name="postalContactMechId" from="contactMechId"/></entity-find><if condition="!payMethList"><return error="true" message="Postal Address ${contactMechId} is not associated with party ${partyId}, not updating."/></if></if><filter-map-list list="origPcmList"><date-filter/></filter-map-list><filter-map-list list="origPcmList"><field-map field-name="contactMechPurposeId"/></filter-map-list></if><entity-find-one entity-name="mantle.party.contact.ContactMech" value-field="newContactMech"/><set field="newContactMech.replacesContactMechId" from="origContactMechId"/><set field="newContactMech.contactMechId" from="null"/><set field="newContactMech.gatewayCimId" from="null"/><set field="newContactMech.trustLevelEnumId" value="CmtlNew"/><set field="newContactMech.validateMessage" from="null"/><set field="newContactMech.paymentFraudEvidenceId" from="null"/><entity-sequenced-id-primary value-field="newContactMech"/><entity-create value-field="newContactMech"/><set field="contactMechId" from="newContactMech.contactMechId"/><set field="newPostalAddress.contactMechId" from="contactMechId"/><set field="newPostalAddress.shipGatewayAddressId" from="null"/><entity-create value-field="newPostalAddress"/><if condition="contactMechPurposeId"><iterate list="origPcmList" entry="origPcm"><if condition="expireCurrent"><set field="origPcm.thruDate" from="ec.user.nowTimestamp"/><entity-update value-field="origPcm"/></if><entity-make-value entity-name="mantle.party.contact.PartyContactMech" value-field="newPcm" map="[partyId:partyId, contactMechId:contactMechId, fromDate:ec.user.nowTimestamp]"/><set field="newPcm.contactMechPurposeId" from="origPcm.contactMechPurposeId"/><set field="newPcm.extension" from="extension ?: origPcm.extension"/><set field="newPcm.comments" from="comments ?: origPcm.comments"/><set field="newPcm.allowSolicitation" from="allowSolicitation ?: origPcm.allowSolicitation"/><entity-create value-field="newPcm"/></iterate><if condition="origPcmList.size() == 0 && contactMechPurposeId"><entity-make-value entity-name="mantle.party.contact.PartyContactMech" value-field="newPcm" map="[partyId:partyId, contactMechId:contactMechId, fromDate:ec.user.nowTimestamp,                                 contactMechPurposeId:contactMechPurposeId, extension:extension, comments:comments,                                 allowSolicitation:allowSolicitation]"/><entity-create value-field="newPcm"/></if></if><if condition="orderId"><entity-find entity-name="mantle.order.OrderPart" list="orderPartList"><econdition field-name="orderId"/></entity-find><iterate list="orderPartList" entry="orderPart"><if condition="orderPart.postalContactMechId == origContactMechId || orderPart.orderPartSeqId == orderPartSeqId"><service-call name="update#mantle.order.OrderPart" in-map="[orderId:orderId, orderPartSeqId:orderPart.orderPartSeqId, postalContactMechId:contactMechId]"/></if></iterate></if><if condition="shipmentId"><entity-find entity-name="mantle.shipment.ShipmentRouteSegment" list="routeSegmentList"><econdition field-name="shipmentId"/></entity-find><iterate list="routeSegmentList" entry="routeSegment"><if condition="routeSegment.originPostalContactMechId == origContactMechId ||                             (shipmentSetOrigin && routeSegment.shipmentRouteSegmentSeqId == shipmentRouteSegmentSeqId)"><set field="routeSegment.originPostalContactMechId" from="contactMechId"/></if><if condition="routeSegment.destPostalContactMechId == origContactMechId ||                             (shipmentSetDest && routeSegment.shipmentRouteSegmentSeqId == shipmentRouteSegmentSeqId)"><set field="routeSegment.destPostalContactMechId" from="contactMechId"/></if><entity-update value-field="routeSegment"/></iterate></if></actions></service>